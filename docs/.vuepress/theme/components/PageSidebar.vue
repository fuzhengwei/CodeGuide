<template xmlns="http://www.w3.org/1999/html">
  <aside class="page-sidebar">
    <slot name="top"/>

    <div class="page-side-toolbar">
      <div class="option-box-toc-fixed" v-if="showPageToc">
        <div class="toc-container-sidebar" ref="tocc">
            <div class="pos-box">
              <div class="icon-arrow"></div>
              <div class="scroll-box" style="max-height:650px">
                <div style="font-weight:bold;text-align:center;">{{pageSidebarItems[0].title}}</div>
                <hr/>
                <div class="toc-box">
                  <PageSidebarToc :depth="0" :items="pageSidebarItems" :sidebarDepth="3"/>
                </div>
<!--                  <hr/>-->
<!--                  <div class="pos-box">-->
<!--                      <div class="icon-arrow"></div>-->
<!--                      <div class="scroll-box" style="text-align:center" >-->
<!--                          <span style="font-size:0.8rem;font-weight:bold;">ğŸ‘¨ğŸ»â€ğŸ’» <a href="https://wx.zsxq.com/group/48411118851818" target="_blank" style="color: #2c3e50">å¸¦ä½ å­¦ä¹ ï¼Œå®æˆ˜é¡¹ç›®ã€‚</a><span style="font-size:12px;color:red;">æé«˜ç¼–ç¨‹æ€ç»´ï¼Œé”»ç‚¼ç¼–ç èƒ½åŠ›ï¼</span>17ä¸ªå®æˆ˜é¡¹ç›®ï¼Œå¢å¼ºé¢è¯•ç«äº‰åŠ›ï¼</span>-->
<!--                          <img height="180px" src="/images/personal/xingqiu.png"/>-->
<!--                          <b>æ‰«ç åŠ å…¥ï¼Œæ˜Ÿçƒ</b>ï¼šç å†œä¼šé”-->
<!--                      </div>-->
<!--                  </div>-->
              </div>
            </div>
        </div>
      </div>
      <div class="option-box-toc-over" v-on:mouseover="showTocOver($event)" v-on:mouseout="hideTocOver($event)">
        <img src="/images/system/toc.png" class="nozoom" />
        <span class="show-txt">ç›®å½•</span>

        <div class="toc-container" ref="tocc">
            <div class="pos-box">
              <div class="icon-arrow"></div>
              <div class="scroll-box" style="max-height:550px">
                <div style="font-weight:bold;text-align:center;">{{pageSidebarItems[0].title}}</div>
                <hr/>
                <div class="toc-box">
                  <PageSidebarToc :depth="0" :items="pageSidebarItems" :sidebarDepth="3"/>
                </div>
              </div>
            </div>
        </div>
      </div>
      <div class="option-box" v-on:mouseover="showToc($event)" v-on:mouseout="hideToc($event)">
        <img src="/images/system/wechat.png" class="nozoom" />
        <span class="show-txt">æ‰‹æœºçœ‹</span>
        <div class="toc-container">
            <div class="pos-box">
              <div class="icon-arrow"></div>
              <div class="scroll-box" style="text-align:center" >
                <span style="font-size:0.9rem">å¾®ä¿¡æ‰«ä¸€æ‰«</span>
                <img v-bind="{src: 'https://api.qrserver.com/v1/create-qr-code/?data=https://bugstack.cn'+this.$route.fullPath }" height="180px" style="margin:10px;"/>
                å¯ä»¥<b>æ‰‹æœºçœ‹</b>æˆ–åˆ†äº«è‡³<b>æœ‹å‹åœˆ</b>
              </div>
            </div>
        </div>
      </div>

<!--      <div class="option-box">-->
<!--        <FullScreenBtn />-->
<!--      </div>-->

      <div class="option-box" @click="$emit('toggle-sidebar-force')">
        <img src="/images/system/toggle.png" width="30px" class="nozoom" />
        <span class="show-txt">å·¦æ </span>
      </div>

      <div class="option-box" v-on:mouseout="hideToc($event)" v-on:mouseover="showToc($event)" onclick="javascript:window.open('https://wx.zsxq.com/group/48411118851818','_blank')">
        <img class="nozoom" src="/images/system/xingqiu.png" width="25px" />
        <span class="show-txt">æ˜Ÿçƒ</span>
        <div class="toc-container">
          <div class="pos-box">
            <div class="icon-arrow"></div>
            <div class="scroll-box" style="text-align:center" >
              <span style="font-size:0.8rem;font-weight:bold;">å¸¦ä½ å­¦ä¹ ï¼Œå®æˆ˜é¡¹ç›®ã€‚<span style="font-size:12px;color:red;">æé«˜ç¼–ç¨‹æ€ç»´ï¼Œé”»ç‚¼ç¼–ç èƒ½åŠ›ï¼</span>17ä¸ªå®æˆ˜é¡¹ç›®ï¼Œå¢å¼ºé¢è¯•ç«äº‰åŠ›ï¼</span>
              <img height="180px" src="/images/personal/xingqiu.png" style="margin:10px;"/>
              <b>çŸ¥è¯†æ˜Ÿçƒ</b>ï¼šç å†œä¼šé”
            </div>
          </div>
        </div>
      </div>

      <div class="option-box" v-on:mouseover="showToc($event)" v-on:mouseout="hideToc($event)">
        <img class="nozoom" src="/images/system/wexin4.png" width="25px" />
        <span class="show-txt">è¯»è€…ç¾¤</span>
        <div class="toc-container">
            <div class="pos-box">
              <div class="icon-arrow"></div>
              <div class="scroll-box" style="text-align:center" >
                <span style="font-size:0.8rem;font-weight:bold;">æ·»åŠ å°å‚…å“¥å¾®ä¿¡<span style="color:red;">(fustack)</span>è¿›è™«æ´æ ˆå­¦ä¹ äº¤æµåœˆã€Œæ— ä»»ä½•å¥—è·¯ã€</span>
                <img src="/images/personal/fustack.png" height="180px" style="margin:10px;"/>
                PSï¼šæ·»åŠ æ—¶è¯·å¤‡æ³¨<b>è¯»è€…åŠ ç¾¤</b>ï¼Œè°¢è°¢ï¼
              </div>
            </div>
        </div>
      </div>

      <div class="option-box" v-on:mouseover="showToc($event)" v-on:mouseout="hideToc($event)">
        <img class="nozoom" src="/images/system/download-2.png" width="25px" />
        <span class="show-txt">ä¸‹èµ„æ–™</span>
        <div class="toc-container">
            <div class="pos-box">
              <div class="icon-arrow"></div>
              <div class="scroll-box" style="text-align:center" >
                <span style="font-size:0.8rem;font-weight:bold;">æ‰«æå…¬ä¼—å·ï¼Œå›å¤<span style="color:red;">â€œ1024â€</span>ä¸‹è½½<span style="color:red;">100GB+</span>å¤§å­¦åˆ°æ¯•ä¸šåˆ†é˜¶æ®µå­¦ä¹ æŠ€æœ¯èµ„æ–™ã€PDFä¹¦ç±ã€å®æˆ˜é¡¹ç›®ã€ç®€å†æ¨¡æ¿ç­‰ã€Œæ— ä»»ä½•å¥—è·¯ã€</span>
                <img src="/images/personal/qrcode.png" height="180px" style="margin:10px;"/>
                <b>å…¬ä¼—å·:</b> bugstackè™«æ´æ ˆ
              </div>
            </div>
        </div>
      </div>

      <div class="option-box" v-on:mouseout="hideToc($event)" v-on:mouseover="showToc($event)" onclick="javascript:window.open('https://gaga.plus','_blank')">
        <img class="nozoom" src="/images/system/code.png" width="25px" />
        <span class="show-txt">åšé¡¹ç›®</span>
      </div>

      <div class="option-box" v-on:mouseout="hideToc($event)" v-on:mouseover="showToc($event)" onclick="javascript:window.open('https://t.zsxq.com/17UIvdgb3','_blank')">
          <img class="nozoom" src="/images/system/interview.png" width="25px" />
          <span class="show-txt">å…«è‚¡æ–‡</span>
<!--          <div class="toc-container">-->
<!--              <div class="pos-box">-->
<!--                  <div class="icon-arrow"></div>-->
<!--                  <div class="scroll-box" style="text-align:center" >-->
<!--                      <span style="font-size:0.8rem;font-weight:bold;">å®æˆ˜é¡¹ç›®<span style="font-size:8px;color:red;">ã€ŒDDD+RPCåˆ†å¸ƒå¼æŠ½å¥–ç³»ç»Ÿã€</span>ã€ä¸“å±å°å†Œã€é—®é¢˜è§£ç­”ã€ç®€å†æŒ‡å¯¼ã€æ¶æ„å›¾ç¨¿ã€è§†é¢‘è¯¾ç¨‹</span>-->
<!--                      <img height="180px" src="/images/personal/xingqiu.png" style="margin:10px;"/>-->
<!--                      <b>çŸ¥è¯†æ˜Ÿçƒ</b>ï¼šç å†œä¼šé”-->
<!--                  </div>-->
<!--              </div>-->
<!--          </div>-->
      </div>

<!--      <div class="option-box" v-on:mouseover="showToc($event)" v-on:mouseout="hideToc($event)">-->
<!--        <img class="nozoom" src="/images/system/heart-1.png" width="25px" />-->
<!--        <span class="show-txt">é¡¹ç›®</span>-->
<!--        <div class="toc-container">-->
<!--            <div class="pos-box">-->
<!--              <div class="icon-arrow"></div>-->
<!--              <div class="scroll-box" style="text-align:center" >-->
<!--                <span style="font-size:0.8rem;font-weight:bold;">é¼“åŠ±/æ”¯æŒ/èµèµæˆ‘</span>-->
<!--                <img height="180px" src="/images/personal/encourage-head.png" style="margin:5px;"/>-->
<!--                <br>1. ä¸é å®ƒç”Ÿå­˜ä½†ä»å¸Œæœ›å¾—åˆ°ä½ çš„é¼“åŠ±ï¼›-->
<!--                <br>2. æ—¶åˆ»è­¦é†’è‡ªå·±ä¿æŒæŠ€æœ¯äººçš„åˆå¿ƒï¼Œæ²‰æ·€ï¼Œåˆ†äº«ï¼Œæˆé•¿ï¼›-->
<!--              </div>-->
<!--            </div>-->
<!--        </div>-->
<!--      </div>-->

      <div class="option-box" v-if="prev" style="padding-left:2px;text-align:center;" v-bind:title="prev.title">
          <router-link v-if="prev" :to="prev.path" >
            <img src="/images/system/pre2.png" width="30px" class="nozoom" />
            <span class="show-txt">ä¸Šä¸€ç¯‡</span>
          </router-link>
      </div>
      <div class="option-box" v-if="next" style="padding-left:2px;text-align:center;" v-bind:title="next.title">
          <router-link v-if="next" :to="next.path" >
            <img src="/images/system/next2.png" width="30px" class="nozoom" />
            <span class="show-txt">ä¸‹ä¸€ç¯‡</span>
          </router-link>
      </div>
    </div>

    <slot name="middle"/>

    <div class="page-side-sitemap">
      <div class="option-box" v-on:mouseover="showSitemap($event)" v-on:mouseout="hideSitemap($event)">
        <img src="/images/system/sitemap.png" class="nozoom img" />
        <span class="show-txt">ç«™ç‚¹å›¾</span>
        <div class="sitemap-container">
            <h4>ç«™ç‚¹å¯¼èˆªå›¾
              <router-link class="sitemap-top-link" key="/md/about/me/2020-08-25-13å¹´æ¯•ä¸šï¼Œç”¨ä¸¤å¹´æ—¶é—´ä»å¤–åŒ…èµ°è¿›äº’è”ç½‘å¤§å‚.html" to="/md/about/me/2020-08-25-13å¹´æ¯•ä¸šï¼Œç”¨ä¸¤å¹´æ—¶é—´ä»å¤–åŒ…èµ°è¿›äº’è”ç½‘å¤§å‚.html" > å…³äºæˆ‘</router-link>
              <router-link class="sitemap-top-link" key="/md/about/study/2020-04-30-è®²é“ç†ï¼Œåªè¦ä½ æ˜¯ä¸€ä¸ªçˆ±æŠ˜è…¾çš„ç¨‹åºå‘˜ï¼Œæ¯•ä¸šæ‰¾å·¥ä½œçœŸçš„ä¸éœ€è¦å†èŠ±é’±åŸ¹è®­.html" to="/md/about/study/2020-04-30-è®²é“ç†ï¼Œåªè¦ä½ æ˜¯ä¸€ä¸ªçˆ±æŠ˜è…¾çš„ç¨‹åºå‘˜ï¼Œæ¯•ä¸šæ‰¾å·¥ä½œçœŸçš„ä¸éœ€è¦å†èŠ±é’±åŸ¹è®­.html" > å…³äºå­¦ä¹ </router-link>
              <router-link class="sitemap-top-link" key="/md/about/job/2020-11-15-BATJTMDï¼Œå¤§å‚æ‹›è˜ï¼Œéƒ½æ‹›ä»€ä¹ˆæ ·Javaç¨‹åºå‘˜ï¼Ÿ.html" to="/md/about/job/2020-11-15-BATJTMDï¼Œå¤§å‚æ‹›è˜ï¼Œéƒ½æ‹›ä»€ä¹ˆæ ·Javaç¨‹åºå‘˜ï¼Ÿ.html" > å…³äºèŒåœº</router-link>
            </h4>
            <SiteMap />
        </div>
      </div>
    </div>

    <PageSidebarBackToTop />

    <slot name="bottom"/>
  </aside>
</template>

<script>
import PageSidebarToc from '@theme/components/PageSidebarToc.vue'
import NavLinks from '@theme/components/NavLinks.vue'
import FullScreenBtn from '@theme/components/FullScreenBtn.vue'
import SiteMap from '@theme/components/SiteMap.vue'
import PageSidebarBackToTop from '@theme/components/PageSidebarBackToTop.vue'
import { resolvePage } from '../util'

export default {
  name: 'PageSidebar',

  components: { PageSidebarToc, NavLinks, FullScreenBtn, SiteMap, PageSidebarBackToTop },

  props: ['pageSidebarItems', 'sidebarItems'],

  computed: {
    showPageToc () {
      return this.prev || this.next
    },
    prev () {
      const prev = this.$page.frontmatter.prev
      if (prev === false) {
        return
      } else if (prev) {
        return resolvePage(this.$site.pages, prev, this.$route.path)
      } else {
        return resolvePrev(this.$page, this.sidebarItems)
      }
    },

    next () {
      const next = this.$page.frontmatter.next
      if (next === false) {
        return
      } else if (next) {
        return resolvePage(this.$site.pages, next, this.$route.path)
      } else {
        return resolveNext(this.$page, this.sidebarItems)
      }
    }
  },

  methods: {
      showToc($event){
          $event.currentTarget.className="option-box on";
      },
      hideToc($event){
          $event.currentTarget.className="option-box";
      },
      showTocOver($event){
          $event.currentTarget.className="option-box-toc-over on";
      },
      hideTocOver($event){
          $event.currentTarget.className="option-box-toc-over";
      },
      showSitemap($event){
          $event.currentTarget.className="option-box on";
      },
      hideSitemap($event){
          $event.currentTarget.className="option-box";
      }
  }

}

function resolvePrev (page, items) {
  return find(page, items, -1)
}

function resolveNext (page, items) {
  return find(page, items, 1)
}

function find (page, items, offset) {
  const res = []
  flatten(items, res)
  for (let i = 0; i < res.length; i++) {
    const cur = res[i]
    if (cur.type === 'page' && cur.path === decodeURIComponent(page.path)) {
      return res[i + offset]
    }
  }
}

function flatten (items, res) {
  for (let i = 0, l = items.length; i < l; i++) {
    if (items[i].type === 'group') {
      flatten(items[i].children || [], res)
    } else {
      res.push(items[i])
    }
  }
}
</script>

<style lang="stylus">
.page-sidebar
  font-size 12px
  width 3.8rem
  position fixed
  z-index 11
  margin 0
  top 3.6rem
  right 0
  bottom 0
  box-sizing border-box
  border-left 0px solid #eaecef
  ul
    margin 0
  a
    display inline-block
  .nav-links
    display none
    border-bottom 1px solid $borderColor
    padding 0.5rem 0 0.75rem 0
    a
      font-weight 600
    .nav-item, .repo-link
      display block
      line-height 1.25rem
      font-size 1.1em
      padding 0.5rem 0 0.5rem 1.5rem
  & > .sidebar-links
    padding 1.5rem 0
    & > li > a.sidebar-link
      font-size 1.1em
      line-height 1.4
      font-weight bold
    & > li:not(:first-child)
      margin-top .75rem

.toc-container-sidebar
  display: block;
  position: absolute;
  color $textColor
  left: 100%;
  top: 0px;
  margin-left: 16px;
  width: 240px;
  background: #fff;
  left: unset;
  right: 100%;
  margin-right: 10px;
  margin-left: 0;
  .on
    display: block;
  .pos-box
    position: relative;
    padding: 16px;
    .icon-arrow
      position: relative;
      margin-left: -20px;
    .scroll-box
      overflow-x: hidden;
      overflow-y: hidden;
      hr
        margin-top: 0.5rem
      .toc-box
        max-height:600px;
        overflow-y: auto;
        overflow-x: hidden;
        width: 238px;
        padding-right: 16px;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
      & > ol
        margin-top: -8px;
        li
          margin-top: 8px;
          line-height: 17px;
          text-align: left;
          overflow: auto;
          text-overflow: ellipsis;
          font-size: 12px;
          white-space: nowrap;
        .sub-box
          margin-top: 0;
        & > ol > li
          padding-left: 15px;

.toc-container
  display: none;
  position: absolute;
  color $textColor
  left: 100%;
  top: -1px;
  margin-left: 16px;
  width: 240px;
  background: #fff;
  border: 1px solid #eee;
  // -webkit-box-shadow: 0 1px 1px 0 rgba(0,0,0,0.1);
  // box-shadow: 0 1px 1px 0 rgba(0,0,0,0.1);
  // border-radius: 4px;
  left: unset;
  right: 100%;
  margin-right: 10px;
  margin-left: 0;
  .on
    display: block;
  .pos-box
    position: relative;
    padding: 16px;
    .icon-arrow
      position: relative;
      margin-left: -20px;
    .scroll-box
      overflow-x: hidden;
      overflow-y: hidden;
      hr
        margin-top: 0.5rem
      .toc-box
        max-height: 500px;
        overflow-y: auto;
        overflow-x: hidden;
        width: 238px;
        padding-right: 16px;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
      & > ol
        margin-top: -8px;
        li
          margin-top: 8px;
          line-height: 17px;
          text-align: left;
          overflow: auto;
          text-overflow: ellipsis;
          font-size: 12px;
          white-space: nowrap;
        .sub-box
          margin-top: 0;
        & > ol > li
          padding-left: 15px;

.page-side-toolbar
  position fixed
  right 10px
  top 70px !important
  width 44px
  div.option-box:last-child
    border-top 0px solid #eee
  div.option-box.on
    .toc-container
      display block
  div.option-box
    font-size 12px
    position relative
    display -webkit-box
    display -ms-flexbox
    display flex
    -webkit-box-orient vertical
    -webkit-box-direction normal
    -ms-flex-direction column
    flex-direction column
    -webkit-box-align center
    -ms-flex-align center
    align-items center
    -webkit-box-pack center
    -ms-flex-pack center
    justify-content center
    border-bottom 1px solid #eee
    background-color #fff
    height 60px
    cursor pointer
    .img
      margin-top 2px
    .show-txt
      color gray
      margin-top 3px
      font-size 11px
  div.option-box-toc-over
    font-size 12px
    position relative
    display none
    -webkit-box-orient vertical
    -webkit-box-direction normal
    -ms-flex-direction column
    flex-direction column
    -webkit-box-align center
    -ms-flex-align center
    align-items center
    -webkit-box-pack center
    -ms-flex-pack center
    justify-content center
    border-bottom 1px solid #eee
    background-color #fff
    height 60px
    cursor pointer
    .img
      margin-top 2px
    .show-txt
      color gray
      margin-top 3px
      font-size 11px
    .toc-container
      margin-right 0
  div.option-box-toc
    font-size 12px
    position relative
    display -webkit-box
    display -ms-flexbox
    display flex
    -webkit-box-orient vertical
    -webkit-box-direction normal
    -ms-flex-direction column
    flex-direction column
    -webkit-box-align center
    -ms-flex-align center
    align-items center
    -webkit-box-pack center
    -ms-flex-pack center
    justify-content center
    border-bottom 1px solid #eee
    background-color #fff
    height 60px
    cursor pointer
    .img
      margin-top 2px
    .show-txt
      color gray
      margin-top 3px
      font-size 11px
  div.option-box:hover
    color white
    background #eee
  div.option-box-toc-over:hover
    color white
    background #eee
  div.option-box-toc-over.on
    .toc-container
      display block
  div.option-box-toc
    display none

.page-side-sitemap
  position fixed
  right 10px
  bottom 50px !important
  width 44px
  div.option-box:last-child
    border-bottom 0px solid #eee
  div.option-box.on
    .sitemap-container
      display block
  div.option-box
    font-size 12px
    position relative
    display -webkit-box
    display -ms-flexbox
    display flex
    -webkit-box-orient vertical
    -webkit-box-direction normal
    -ms-flex-direction column
    flex-direction column
    -webkit-box-align center
    -ms-flex-align center
    align-items center
    -webkit-box-pack center
    -ms-flex-pack center
    justify-content center
    border-bottom 1px solid #eee
    background-color #fff
    //height 60px
    cursor pointer
    .show-txt
      color gray
      margin-top 2px
      font-size 11px
      padding 4px 0
  div.option-box:hover
    //color white
    //background #eee

.sitemap-container
  display: none;
  cursor auto
  position: absolute;
  color $textColor
  left: 100%;
  bottom: -30px;
  height: 500px;
  margin-left: 16px;
  padding: 0 10px;
  width: 850px;
  background: #fff;
  -webkit-box-shadow: 1px -2px 10px 7px rgba(0,0,0,0.08);
  box-shadow: 1px -2px 10px 7px rgba(0,0,0,0.08);
  border-radius: 4px;
  left: unset;
  right: 100%;
  margin-right: 2px;
  margin-left: 0;
  h4
    margin: 5px 0;
    font-size: 13px;
    text-align: center;
    padding: 3px 2px;
    border-bottom: 1px solid #eaecef;
    background: #42b983;
    color: white;
    .sitemap-top-link
      color: white;
      font-size: 10px;
      float:right;
      padding:2px 5px;
      text-decoration:underline;
  .on
    display: block;
  .pos-box
    position: relative;
    padding: 10px;

@media (max-width: $MQNarrow)
  .toc-container-sidebar
    display none
  .option-box-toc
    display none
  .page-side-toolbar
    right 6px
    top 65px !important
    div.option-box-toc-over
      display flex
  .page-side-sitemap
    right 6px

@media (max-width: $MQMobile)
  .toc-container-sidebar
    display none
  .page-sidebar
    display none
  .sidebar
    .nav-links
      display block
      .dropdown-wrapper .nav-dropdown .dropdown-item a.router-link-active::after
        top calc(1rem - 2px)
    & > .sidebar-links
      padding 1rem 0
</style>
