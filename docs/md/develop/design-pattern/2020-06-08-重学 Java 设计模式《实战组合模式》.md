---
layout: post
category: itstack-demo-design
title: é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜ç»„åˆæ¨¡å¼ã€Œè¥é”€å·®å¼‚åŒ–äººç¾¤å‘åˆ¸ï¼Œå†³ç­–æ ‘å¼•æ“æ­å»ºåœºæ™¯ã€
tagline: by å°å‚…å“¥
tag: [itstack-demo-design]
excerpt: ç¼–ç¨‹å¼€å‘ä¸æ˜¯ç‚«æŠ€ï¼Œä¸€å¤„ç‰¹æ€§çš„ä½¿ç”¨ä¸å¦‚ä¸€åŸŸè®¾è®¡æ¨¡å¼çš„æå‡ã€‚çºµç„¶ä½ æ€»æ˜¯å®¹æ˜“å¿½ç•¥ifelseçš„å­˜åœ¨å´åˆä¸ä»¥ä¸ºç„¶ï¼Œä½†æ›´å¤šçš„æ—¶å€™ä¸€å¤„ä»£ç çƒ‚ä¼šä¸æ–­çš„å»¶ç»­æ‰©å±•ï¼Œè®©å…¶ä»–åŒºåŸŸå—æ„ŸæŸ“ã€‚
lock: need
---

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`å°æœ‹å‹æ‰åšé€‰æ‹©é¢˜ï¼Œæˆå¹´äººæˆ‘éƒ½è¦`

å¤´å‡ å¹´åªè¦ç¾¤é‡Œä¸€é—®æˆ‘è¯¥å­¦å“ªä¸ªå¼€å‘è¯­è¨€ï¼Œå“ªä¸ªè¯­è¨€æœ€å¥½ã€‚ç¾¤é‡Œè‚¯å®šèŠçš„ç‰¹åˆ«ç«çƒ­ï¼Œæœ‰äººæ”¯æŒPHPã€æœ‰äººå–Šå·Javaã€ä¹Ÿæœ‰C++å’ŒC#ã€‚ä½†è¿™å‡ å¹´å¼€å§‹å¥½åƒå¤§å®¶å¹¶ä¸ä¼šçœŸçš„`åˆ€æªæ£æ£’ã€æ–§é’ºé’©å‰`èˆ¬è®¨è®ºäº†ï¼Œå¤§å¤šæ•°æ—¶å€™éƒ½æ˜¯å¼€ç©ç¬‘çš„é—¹ä¸€é—¹ã€‚äºæ­¤åŒæ—¶åœ¨æ•´ä½“çš„äº’è”ç½‘å¼€å‘ä¸­å¾ˆå¤šæ—¶å€™æ˜¯ä¸€äº›å¼€å‘è¯­è¨€å…¬ç”¨çš„ï¼Œå…±åŒæ‰“é€ æ•´ä½“çš„ç”Ÿæ€åœˆã€‚è€Œå¤§å®¶é€‰æ‹©çš„æ–¹å¼ä¹Ÿæ˜¯æ›´åå‘äºä¸åŒé¢†åŸŸä¸‹é€‰æ‹©é€‚åˆçš„æ¶æ„ï¼Œè€Œä¸æ˜¯ä¸€å‘³åœ°è¿½æ±‚æŸä¸ªè¯­è¨€ã€‚è¿™å¯ä»¥ç»™å¾ˆå¤šåˆå­¦ç¼–ç¨‹çš„æ–°äººä¸€äº›æè®®ï¼Œä¸è¦åˆ»æ„çš„è§‰å¾—æŸä¸ªè¯­è¨€å¥½ï¼ŒæŸä¸ªè¯­è¨€ä¸å¥½ï¼Œåªæ˜¯åœ¨é€‚åˆçš„åœºæ™¯ä¸‹é€‰æ‹©æœ€éœ€è¦çš„ã€‚è€Œä½ è¦é€‰æ‹©çš„é‚£ä¸ªè¯­è¨€å¯ä»¥å‚è€ƒæ‹›è˜ç½‘ç«™çš„éœ€æ±‚é‡å’Œè–ªèµ„æ°´å¹³å†³å®šã€‚

`ç¼–ç¨‹å¼€å‘ä¸æ˜¯ç‚«æŠ€`

æ€»ä¼šæœ‰äººå–œæ¬¢åœ¨æ•´ä½“çš„é¡¹ç›®å¼€å‘ä¸­ç”¨ä¸Šç‚¹æ–°ç‰¹æ€§ï¼ŒæŠŠè‡ªå·±æ–°å­¦çš„çŸ¥è¯†å®è·µè¯•è¯•ã€‚ä¸èƒ½è¯´è¿™æ ·å°±æ˜¯ä¸å¥½ï¼Œç”šè‡³å¯ä»¥è¯´è¿™æ˜¯ä¸€éƒ¨åˆ†å¾ˆçƒ­çˆ±å­¦ä¹ çš„äººï¼Œå–œæ¬¢åˆ›æ–°ï¼Œå–œæ¬¢å®è·µã€‚ä½†ç¼–ç¨‹é™¤äº†ç”¨ä¸Šæ–°ç‰¹æ€§å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘æ•´ä½“çš„æ‰©å±•æ€§ã€å¯è¯»æ€§ã€å¯ç»´æŠ¤ã€æ˜“æ‰©å±•ç­‰æ–¹é¢çš„è€ƒè™‘ã€‚å°±åƒä½ å®¶é‡Œé›‡ä½£äº†ä¸€ä¼™è£…ä¿®å¸ˆå‚…ï¼Œæœ‰é‚£ä¹ˆä¸€ä¸ªå°å·¥å–œæ¬¢ç‚«æŠ€æèŠ±æ´»ï¼Œåœ¨å®¶çš„æ·‹æµ´ä¸‹ğŸš¿å®‰è£…äº†é©¬æ¡¶ğŸš½ã€‚

`å³ä½¿æ˜¯å†™CRUDä¹Ÿåº”è¯¥æœ‰è®¾è®¡æ¨¡å¼`

å¾€å¾€å¾ˆå¤šå¤§éœ€æ±‚éƒ½æ˜¯é€šè¿‡å¢åˆ æ”¹æŸ¥å †å‡ºæ¥çš„ï¼Œä»Šå¤©è¦ä¸€ä¸ªéœ€æ±‚`if`ä¸€ä¸‹ï¼Œæ˜å¤©åŠ ä¸ªå†…å®¹`else`æ‰©å±•ä¸€ä¸‹ã€‚æ—¥ç§¯æœˆç´¯éœ€æ±‚ä¹Ÿå°±è¶Šæ¥è¶Šå¤§ï¼Œæ‰©å±•å’Œç»´æŠ¤çš„æˆæœ¬ä¹Ÿå°±è¶Šæ¥è¶Šé«˜ã€‚å¾€å¾€å¤§éƒ¨åˆ†ç ”å‘æ˜¯ä¸å…·å¤‡äº§å“æ€ç»´å’Œæ•´ä½“ä¸šåŠ¡éœ€æ±‚å¯¼å‘çš„ï¼Œæ€»ä»¥ä¸ºå†™å¥½ä»£ç å®ŒæˆåŠŸèƒ½å³å¯ã€‚ä½†è¿™æ ·çš„ä¸è€ƒè™‘æ‰©å±•æ€§çš„å®ç°ï¼Œå¾ˆéš¾è®©åç»­çš„éœ€æ±‚éƒ½å¿«é€Ÿè¿­ä»£ï¼Œä¹…è€Œä¹…ä¹‹å°±ä¼šè¢«é™·å…¥æ¶æ€§å¾ªç¯ï¼Œæ¯å¤©éƒ½æœ‰bugè¦æ”¹ã€‚

## äºŒã€å¼€å‘ç¯å¢ƒ

1. JDK 1.8
2. Idea + Maven
3. æ¶‰åŠå·¥ç¨‹ä¸‰ä¸ªï¼Œå¯ä»¥é€šè¿‡å…³æ³¨**å…¬ä¼—å·**ï¼š[`bugstackè™«æ´æ ˆ`](https://bugstack.cn/assets/images/qrcode.png)ï¼Œå›å¤`æºç ä¸‹è½½`è·å–(æ‰“å¼€è·å–çš„é“¾æ¥ï¼Œæ‰¾åˆ°åºå·18)

| å·¥ç¨‹                     | æè¿°                                         |
| ------------------------ | --------------------------------- |
| itstack-demo-design-8-01 | ä½¿ç”¨ä¸€å¨ä»£ç å®ç°ä¸šåŠ¡éœ€æ±‚ |
| itstack-demo-design-8-02 | é€šè¿‡è®¾è®¡æ¨¡å¼ä¼˜åŒ–æ”¹é€ ä»£ç ï¼Œäº§ç”Ÿå¯¹æ¯”æ€§ä»è€Œå­¦ä¹  |

## ä¸‰ã€ç»„åˆæ¨¡å¼ä»‹ç»

![ç»„åˆæ¨¡å¼ï¼Œå›¾ç‰‡æ¥è‡ª refactoringguru.cn](https://bugstack.cn/assets/images/2020/itstack-demo-design-8-01.png)

ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°è¿™æœ‰ç‚¹åƒèºä¸ğŸ”©å’Œèºæ¯ï¼Œé€šè¿‡ä¸€å †çš„é“¾æ¥ç»„ç»‡å‡ºä¸€æ£µç»“æ„æ ‘ã€‚è€Œè¿™ç§é€šè¿‡æŠŠç›¸ä¼¼å¯¹è±¡(*ä¹Ÿå¯ä»¥ç§°ä½œæ˜¯æ–¹æ³•*)ç»„åˆæˆä¸€ç»„å¯è¢«è°ƒç”¨çš„ç»“æ„æ ‘å¯¹è±¡çš„è®¾è®¡æ€è·¯å«åšç»„åˆæ¨¡å¼ã€‚

è¿™ç§è®¾è®¡æ–¹å¼å¯ä»¥è®©ä½ çš„æœåŠ¡ç»„èŠ‚ç‚¹è¿›è¡Œè‡ªç”±ç»„åˆå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¾‹å¦‚ä½ æœ‰ä¸‰ä¸ªåŸå­æ ¡éªŒåŠŸèƒ½(`Aï¼šèº«ä»½è¯`ã€`Bï¼šé“¶è¡Œå¡`ã€`Cï¼šæ‰‹æœºå·`)æœåŠ¡å¹¶å¯¹å¤–æä¾›è°ƒç”¨ä½¿ç”¨ã€‚æœ‰äº›è°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨ABç»„åˆï¼Œæœ‰äº›è°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨åˆ°CBAç»„åˆï¼Œè¿˜æœ‰ä¸€äº›å¯èƒ½åªä½¿ç”¨ä¸‰è€…ä¸­çš„ä¸€ä¸ªã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥ä½¿ç”¨ç»„åˆæ¨¡å¼è¿›è¡Œæ„å»ºæœåŠ¡ï¼Œå¯¹äºä¸åŒç±»å‹çš„è°ƒç”¨æ–¹é…ç½®ä¸åŒçš„ç»„ç»‡å…³ç³»æ ‘ï¼Œè€Œè¿™ä¸ªæ ‘ç»“æ„ä½ å¯ä»¥é…ç½®åˆ°æ•°æ®åº“ä¸­ä¹Ÿå¯ä»¥ä¸æ–­çš„é€šè¿‡å›¾å½¢ç•Œé¢æ¥æ§åˆ¶æ ‘ç»“æ„ã€‚

æ‰€ä»¥ä¸åŒçš„è®¾è®¡æ¨¡å¼ç”¨åœ¨æ°å½“å¥½å¤„çš„åœºæ™¯å¯ä»¥è®©ä»£ç é€»è¾‘éå¸¸æ¸…æ™°å¹¶æ˜“äºæ‰©å±•ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘å›¢é˜Ÿæ–°å¢äººå‘˜å¯¹é¡¹ç›®çš„å­¦ä¹ æˆæœ¬ã€‚

## å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

![åœºæ™¯æ¨¡å¼ï¼›è¥é”€å†³ç­–æ ‘](https://bugstack.cn/assets/images/2020/itstack-demo-design-8-02.png)

ä»¥ä¸Šæ˜¯ä¸€ä¸ªéå¸¸ç®€åŒ–ç‰ˆçš„è¥é”€è§„åˆ™`å†³ç­–æ ‘`ï¼Œæ ¹æ®`æ€§åˆ«`ã€`å¹´é¾„`æ¥å‘æ”¾ä¸åŒç±»å‹çš„ä¼˜æƒ åˆ¸ï¼Œæ¥åˆºæ¿€æ¶ˆè´¹èµ·åˆ°ç²¾å‡†ç”¨æˆ·ä¿ƒæ´»çš„ç›®çš„ã€‚

è™½ç„¶ä¸€éƒ¨åˆ†å°ä¼™ä¼´å¯èƒ½å¹¶æ²¡æœ‰å¼€å‘è¿‡è¥é”€åœºæ™¯ï¼Œä½†ä½ å¯èƒ½æ—¶æ—¶åˆ»åˆ»çš„è¢«è¥é”€ç€ã€‚æ¯”å¦‚ä½ å»ç»å¸¸æµè§ˆç”·æ€§å–œæ¬¢çš„æœºæ¢°é”®ç›˜ã€ç¬”è®°æœ¬ç”µè„‘ã€æ±½è½¦è£…é¥°ç­‰ç­‰ï¼Œé‚£ä¹ˆä¹…ç»™ä½ æ¨èæ­¤ç±»çš„ä¼˜æƒ åˆ¸åˆºæ¿€ä½ æ¶ˆè´¹ã€‚é‚£ä¹ˆå¦‚æœä½ è´­ç‰©ä¸å¤šï¼Œæˆ–è€…é’±ä¸åœ¨è‡ªå·±æ‰‹é‡Œã€‚é‚£ä¹ˆä½ æ˜¯å¦æ‰“è¿‡è½¦ï¼Œæœ‰ä¸€æ®µæ—¶é—´ç»å¸¸æœ‰å°ä¼™ä¼´å–Šï¼Œä¸ºä»€ä¹ˆåŒæ ·çš„è·ç¦»ä»–å°±10å…ƒï¼Œæˆ‘å°±15å…ƒå‘¢ï¼Ÿå…¶å®è¿™äº›éƒ½æ˜¯è¢«è¥é”€çš„æ¡ˆä¾‹ï¼Œä¸€èˆ¬å¯¹äºä¸å¸¸ä½¿ç”¨è½¯ä»¶çš„å°ä¼™ä¼´ï¼Œç»å¸¸ä¼šè¿›è¡Œç¨å¾®å¤§åŠ›åº¦çš„ä¿ƒæ´»ï¼Œå¢åŠ ç”¨æˆ·ç²˜æ€§ã€‚

é‚£ä¹ˆåœ¨è¿™é‡Œæˆ‘ä»¬å°±æ¨¡æ‹Ÿä¸€ä¸ªç±»ä¼¼çš„å†³ç­–åœºæ™¯ï¼Œä½“ç°å‡ºç»„åˆæ¨¡å¼åœ¨å…¶ä¸­èµ·åˆ°çš„é‡è¦æ€§ã€‚å¦å¤–ï¼Œç»„åˆæ¨¡å¼ä¸åªæ˜¯å¯ä»¥è¿ç”¨äºè§„åˆ™å†³ç­–æ ‘ï¼Œè¿˜å¯ä»¥åšæœåŠ¡åŒ…è£…å°†ä¸åŒçš„æ¥å£è¿›è¡Œç»„åˆé…ç½®ï¼Œå¯¹å¤–æä¾›æœåŠ¡èƒ½åŠ›ï¼Œå‡å°‘å¼€å‘æˆæœ¬ã€‚

## äº”ã€ç”¨ä¸€å¨å¨ä»£ç å®ç°

è¿™é‡Œæˆ‘ä»¬ä¸¾ä¸€ä¸ªå…³äº`ifelse`è¯ç”Ÿçš„ä¾‹å­ï¼Œä»‹ç»å°å§å§ä¸ç¨‹åºå‘˜ğŸ‘¨â€ğŸ’»â€ä¹‹é—´çš„`æ•…äº‹`å¯¼è‡´çš„`äº‹æ•…`ã€‚

| æ—¥æœŸ | éœ€æ±‚ | ç´§æ€¥ç¨‹åº¦ |  ç¨‹åºå‘˜(è¯å¤–éŸ³) |
|:---:|:---|:---|:---|
| æ˜ŸæœŸä¸€.æ—©ä¸Š | çŒ¿å“¥å“¥ï¼Œè€æ¿è¯´è¦æä¸€ä¸‹è¥é”€æ‹‰æ‹‰é‡ï¼Œç»™ç”·ç”Ÿå¥³ç”Ÿå‘ä¸åŒçš„ä¼˜æƒ åˆ¸ï¼Œä¿ƒæ´»æ¶ˆè´¹ã€‚ | å¾ˆç´§æ€¥ï¼Œä¸‹ç­å°±è¦ |  è¡Œå§ï¼Œä¹Ÿä¸éš¾ï¼ŒåŠ ä¸‹åˆ¤æ–­å°±ä¸Šçº¿ |
| æ˜ŸæœŸäºŒ.ä¸‹åˆ | å°å“¥å“¥ï¼Œå’±ä»¬ä¸Šçº¿åéå¸¸å¥½ã€‚è¦è®©å’±ä»¬æŒ‰ç…§å¹´è½»ã€ä¸­å¹´ã€æˆå¹´ï¼Œä¸åŒå¹´é¾„åŠ ä¸‹åˆ¤æ–­ï¼Œå‡†ç¡®åˆºæ¿€æ¶ˆè´¹ã€‚ | è¶…ç´§æ€¥ï¼Œæ˜å¤©å°±è¦ | ä¹Ÿä¸éš¾ï¼ŒåŠ å°±åŠ å§ |
| æ˜ŸæœŸä¸‰.æ™šä¸Š | å–‚ï¼Œå°å“¥å“¥ï¼ç¡äº†å—ï¼è€æ¿è¯´å’±ä»¬è¿™æ¬¡æ´»åŠ¨å¾ˆæˆåŠŸï¼Œå¯ä»¥ä¸å¯ä»¥åœ¨ç»†åˆ†ä¸‹ï¼ŒæŠŠå•èº«ã€ç»“å©šã€æœ‰å¨ƒçš„éƒ½åŠ ä¸Šä¸åŒåˆ¤æ–­ã€‚è¿™æ ·æ›´èƒ½åˆºæ¿€ç”¨æˆ·æ¶ˆè´¹ã€‚ | è´¼ç´§æ€¥ï¼Œæœ€å¿«ä¸Šçº¿ã€‚ | å·²ç»æ„è¯†åˆ°```ifelse```è¶Šæ¥è¶Šå¤šäº† |
| æ˜ŸæœŸå››.å‡Œæ™¨ | å“‡ï¼å°å“¥å“¥ä½ ä»¬å¤ªæ£’äº†ï¼Œä¸Šçš„çœŸå¿«ã€‚å˜»å˜»ï¼æœ‰ä¸ªå°è¯·æ±‚ï¼Œéœ€è¦è°ƒæ•´ä¸‹å¹´é¾„æ®µï¼Œå› ä¸ºç°åœ¨å­¦ç”Ÿå¤„å¯¹è±¡çš„éƒ½æ¯”è¾ƒæ—©ï¼Œæœ‰å¯¹è±¡çš„æ›´å®¹æ˜“ä¹°æŸæŸæŸä¸œè¥¿ã€‚è¦æ”¹ä¸‹å€¼ï¼è¾›è‹¦è¾›è‹¦ï¼ | è€æ¿ï¼Œåœ¨ç­‰ç€å‘¢ï¼ |  ä¸€å¤§ç‰‡çš„å€¼è¦ä¿®æ”¹ï¼Œå“ï¼è¿™ä¹ˆå¤š```ifelse```äº† |
| æ˜ŸæœŸäº”.åŠå¤œ | æ­ªæ­ªå–‚ï¼å·´å·´ï¼Œåäº†ï¼Œæ€ä¹ˆå‘çš„ä¼˜æƒ åˆ¸ä¸å¯¹äº†ï¼Œæœ‰å®¢è¯‰äº†ï¼Œå¾ˆå¤šå¥³ç”Ÿéƒ½æ¥æŠ•è¯‰ã€‚ä½ å¿«çœ‹çœ‹ã€‚è€æ¿ï¼Œä»–... | (ä¸€å¤´æ±—)ï¼Œå“ï¼Œå€¼ç²˜é”™ä½ç½®äº†ï¼ | ç»ˆç©¶è¿˜æ˜¯ä¸€ä¸ªäººæ‰›ä¸‹äº†æ‰€æœ‰ |

### 1. å·¥ç¨‹ç»“æ„

```java
itstack-demo-design-8-01
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â””â”€â”€ EngineController.java
```

- å…¬å¸é‡Œè¦éƒ½æ˜¯è¿™æ ·çš„ç¨‹åºå‘˜ç»å¯¹çœä¸‹ä¸å°‘æˆæœ¬ï¼Œæ ¹æœ¬ä¸è¦æ­å»ºå¾®æœåŠ¡ï¼Œä¸€ä¸ªå·¥ç¨‹æå®šæ‰€æœ‰ä¸šåŠ¡ï¼
- ä½†åƒä¸‡ä¸è¦è¿™ä¹ˆå¹²ï¼`é…’è‚‰ç©¿è‚ è¿‡ï¼Œä½›ç¥–å¿ƒä¸­ç•™ã€‚ä¸–äººè‹¥å­¦æˆ‘ï¼Œå¦‚åŒè¿›é­”é“ã€‚`

### 2. ä»£ç å®ç°

```java
public class EngineController {

    private Logger logger = LoggerFactory.getLogger(EngineController.class);

    public String process(final String userId, final String userSex, final int userAge) {

        logger.info("ifelseå®ç°æ–¹å¼åˆ¤æ–­ç”¨æˆ·ç»“æœã€‚userIdï¼š{} userSexï¼š{} userAgeï¼š{}", userId, userSex, userAge);

        if ("man".equals(userSex)) {
            if (userAge < 25) {
                return "æœå®A";
            }

            if (userAge >= 25) {
                return "æœå®B";
            }
        }

        if ("woman".equals(userSex)) {
            if (userAge < 25) {
                return "æœå®C";
            }

            if (userAge >= 25) {
                return "æœå®D";
            }
        }

        return null;

    }

}
```

- é™¤äº†æˆ‘ä»¬è¯´çš„æ‰©å±•æ€§å’Œæ¯æ¬¡çš„ç»´æŠ¤ä»¥å¤–ï¼Œè¿™æ ·çš„ä»£ç å®ç°èµ·æ¥æ˜¯æœ€å¿«çš„ã€‚è€Œä¸”ä»æ ·å­æ¥çœ‹ä¹Ÿå¾ˆé€‚åˆæ–°äººç†è§£ã€‚
- ä½†æ˜¯`æˆ‘åŠä½ åˆ«å†™`ï¼Œå†™è¿™æ ·ä»£ç ä¸æ˜¯è¢«æ‰£ç»©æ•ˆå°±æ˜¯è¢«å¼€é™¤ã€‚

### 3. æµ‹è¯•éªŒè¯

#### 3.1 ç¼–å†™æµ‹è¯•ç±»

```java
@Test
public void test_EngineController() {
    EngineController engineController = new EngineController();
    String process = engineController.process("Oli09pLkdjh", "man", 29);
    logger.info("æµ‹è¯•ç»“æœï¼š{}", process);
}
```

- è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªç”¨æˆ·IDï¼Œå¹¶ä¼ è¾“æ€§åˆ«ï¼šmanã€å¹´é¾„ï¼š29ï¼Œæˆ‘ä»¬çš„é¢„æœŸç»“æœæ˜¯ï¼šæœå®Bã€‚å®é™…å¯¹åº”ä¸šåŠ¡å°±æ˜¯ç»™`å¤´ç§ƒçš„ç¨‹åºå‘˜å‘ä¸€å¼ æ¸æä¼˜æƒ åˆ¸`ã€‚

#### 3.2 æµ‹è¯•ç»“æœ

```java
22:10:12.891 [main] INFO  o.i.demo.design.EngineController - ifelseå®ç°æ–¹å¼åˆ¤æ–­ç”¨æˆ·ç»“æœã€‚userIdï¼šOli09pLkdjh userSexï¼šman userAgeï¼š29
22:10:12.898 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœï¼šæœå®B

Process finished with exit code 0
```

- ä»æµ‹è¯•ç»“æœä¸Šçœ‹æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œæ­£å¸¸å¹¶ä¸”ç¬¦åˆé¢„æœŸï¼Œåªä¸è¿‡å®ç°ä¸Šå¹¶ä¸æ˜¯æˆ‘ä»¬æ¨èçš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé‡‡ç”¨`ç»„åˆæ¨¡å¼`æ¥ä¼˜åŒ–è¿™éƒ¨åˆ†ä»£ç ã€‚

## å…­ã€ç»„åˆæ¨¡å¼é‡æ„ä»£ç 

`æ¥ä¸‹æ¥ä½¿ç”¨ç»„åˆæ¨¡å¼æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡å¾ˆå°çš„é‡æ„ã€‚`

æ¥ä¸‹æ¥çš„é‡æ„éƒ¨åˆ†ä»£ç æ”¹åŠ¨é‡ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒå¤§ä¸€äº›ï¼Œä¸ºäº†è®©æˆ‘ä»¬å¯ä»¥æŠŠä¸åŒç±»å‹çš„å†³ç­–èŠ‚ç‚¹å’Œæœ€ç»ˆçš„æœå®ç»„è£…æˆä¸€æ£µå¯è¢«è¿è¡Œçš„å†³ç­–æ ‘ï¼Œéœ€è¦åšé€‚é…è®¾è®¡å’Œå·¥å‚æ–¹æ³•è°ƒç”¨ï¼Œå…·ä½“ä¼šä½“ç°åœ¨å®šä¹‰æ¥å£ä»¥åŠæŠ½è±¡ç±»å’Œåˆå§‹åŒ–é…ç½®å†³ç­–èŠ‚ç‚¹(`æ€§åˆ«`ã€`å¹´é¾„`)ä¸Šã€‚å»ºè®®è¿™éƒ¨åˆ†ä»£ç å¤šé˜…è¯»å‡ æ¬¡ï¼Œæœ€å¥½å®è·µä¸‹ã€‚

### 1. å·¥ç¨‹ç»“æ„

```java
itstack-demo-design-8-02
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚      â””â”€â”€ org.itstack.demo.design.domain
    â”‚          â”œâ”€â”€ model
    â”‚          â”‚   â”œâ”€â”€ aggregates
    â”‚          â”‚   â”‚   â””â”€â”€ TreeRich.java
    â”‚          â”‚   â””â”€â”€ vo
    â”‚          â”‚       â”œâ”€â”€ EngineResult.java
    â”‚          â”‚       â”œâ”€â”€ TreeNode.java
    â”‚          â”‚       â”œâ”€â”€ TreeNodeLink.java    
    â”‚          â”‚       â””â”€â”€ TreeRoot.java	
    â”‚          â””â”€â”€ service
    â”‚              â”œâ”€â”€ engine
    â”‚              â”‚   â”œâ”€â”€ impl	
    â”‚              â”‚   â”‚   â””â”€â”€ TreeEngineHandle.java	   
    â”‚              â”‚   â”œâ”€â”€ EngineBase.java 
    â”‚              â”‚   â”œâ”€â”€ EngineConfig.java       
    â”‚              â”‚   â””â”€â”€ IEngine.java	
    â”‚              â””â”€â”€ logic
    â”‚                  â”œâ”€â”€ impl	
    â”‚                  â”‚   â”œâ”€â”€ LogicFilter.java	 
    â”‚                  â”‚   â””â”€â”€ LogicFilter.java	    
    â”‚                  â””â”€â”€ LogicFilter.java	
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org.itstack.demo.design.test
                 â””â”€â”€ ApiTest.java
```

**ç»„åˆæ¨¡å¼æ¨¡å‹ç»“æ„**

![ç»„åˆæ¨¡å¼æ¨¡å‹ç»“æ„](https://bugstack.cn/assets/images/2020/itstack-demo-design-8-03.png)

- é¦–å…ˆå¯ä»¥çœ‹ä¸‹é»‘è‰²æ¡†æ¡†çš„æ¨¡æ‹ŸæŒ‡å¯¼æ ‘ç»“æ„ï¼›`1`ã€`11`ã€`12`ã€`111`ã€`112`ã€`121`ã€`122`ï¼Œè¿™æ˜¯ä¸€ç»„æ ‘ç»“æ„çš„IDï¼Œå¹¶ç”±èŠ‚ç‚¹ä¸²è”ç»„åˆå‡ºä¸€æ£µå…³ç³»æ ‘æ ‘ã€‚

- æ¥ä¸‹æ¥æ˜¯ç±»å›¾éƒ¨åˆ†ï¼Œå·¦ä¾§æ˜¯ä»`LogicFilter`å¼€å§‹å®šä¹‰é€‚é…çš„å†³ç­–è¿‡æ»¤å™¨ï¼Œ`BaseLogic`æ˜¯å¯¹æ¥å£çš„å®ç°ï¼Œæä¾›æœ€åŸºæœ¬çš„é€šç”¨æ–¹æ³•ã€‚`UserAgeFilter`ã€`UserGenerFilter`ï¼Œæ˜¯ä¸¤ä¸ªå…·ä½“çš„å®ç°ç±»ç”¨äºåˆ¤æ–­`å¹´é¾„`å’Œ`æ€§åˆ«`ã€‚

- æœ€ååˆ™æ˜¯å¯¹è¿™é¢—å¯ä»¥è¢«ç»„ç»‡å‡ºæ¥çš„å†³ç­–æ ‘ï¼Œè¿›è¡Œæ‰§è¡Œçš„å¼•æ“ã€‚åŒæ ·å®šä¹‰äº†å¼•æ“æ¥å£å’ŒåŸºç¡€çš„é…ç½®ï¼Œåœ¨é…ç½®é‡Œé¢è®¾å®šäº†éœ€è¦çš„æ¨¡å¼å†³ç­–èŠ‚ç‚¹ã€‚

  - ```java
    static {
         logicFilterMap = new ConcurrentHashMap<>();
         logicFilterMap.put("userAge", new UserAgeFilter());
         logicFilterMap.put("userGender", new UserGenderFilter());
    }
    ```

- æ¥ä¸‹æ¥ä¼šå¯¹æ¯ä¸€ä¸ªç±»è¿›è¡Œç»†è‡´çš„è®²è§£ï¼Œå¦‚æœæ„Ÿè§‰æ²¡æœ‰è¯»æ‡‚ä¸€å®šæ˜¯æˆ‘ä½œè€…çš„è¡¨è¿°ä¸å¤Ÿæ¸…æ™°ï¼Œå¯ä»¥æ·»åŠ æˆ‘çš„å¾®ä¿¡(fustack)ä¸æˆ‘äº¤æµã€‚

### 2. ä»£ç å®ç°

#### 2.1 åŸºç¡€å¯¹è±¡

| åŒ…è·¯å¾„           | ç±»           | ä»‹ç»                       |
| ---------------- | ------------ | -------------------------- |
| model.aggregates | TreeRich     | èšåˆå¯¹è±¡ï¼ŒåŒ…å«ç»„ç»‡æ ‘ä¿¡æ¯   |
| model.vo         | EngineResult | å†³ç­–è¿”å›å¯¹è±¡ä¿¡æ¯           |
| model.vo         | TreeNode     | æ ‘èŠ‚ç‚¹ï¼›å­å¶èŠ‚ç‚¹ã€æœå®èŠ‚ç‚¹ |
| model.vo         | TreeNodeLink | æ ‘èŠ‚ç‚¹é“¾æ¥é“¾è·¯             |
| model.vo         | TreeRoot     | æ ‘æ ¹ä¿¡æ¯                   |

- ä»¥ä¸Šè¿™éƒ¨åˆ†ç®€å•ä»‹ç»ï¼Œä¸åŒ…å«é€»è¾‘åªæ˜¯å„é¡¹å¿…è¦å±æ€§çš„`get/set`ï¼Œæ•´ä¸ªæºä»£ç å¯ä»¥é€šè¿‡å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š`bugstackè™«æ´æ ˆ`ï¼Œå›å¤æºç ä¸‹è½½æ‰“å¼€é“¾æ¥è·å–ã€‚

#### 2.2 æ ‘èŠ‚ç‚¹é€»è¾‘è¿‡æ»¤å™¨æ¥å£

```java
public interface LogicFilter {

    /**
     * é€»è¾‘å†³ç­–å™¨
     *
     * @param matterValue          å†³ç­–å€¼
     * @param treeNodeLineInfoList å†³ç­–èŠ‚ç‚¹
     * @return ä¸‹ä¸€ä¸ªèŠ‚ç‚¹Id
     */
    Long filter(String matterValue, List<TreeNodeLink> treeNodeLineInfoList);

    /**
     * è·å–å†³ç­–å€¼
     *
     * @param decisionMatter å†³ç­–ç‰©æ–™
     * @return å†³ç­–å€¼
     */
    String matterValue(Long treeId, String userId, Map<String, String> decisionMatter);

}
```

- è¿™ä¸€éƒ¨åˆ†å®šä¹‰äº†é€‚é…çš„é€šç”¨æ¥å£ï¼Œé€»è¾‘å†³ç­–å™¨ã€è·å–å†³ç­–å€¼ï¼Œè®©æ¯ä¸€ä¸ªæä¾›å†³ç­–èƒ½åŠ›çš„èŠ‚ç‚¹éƒ½å¿…é¡»å®ç°æ­¤æ¥å£ï¼Œä¿è¯ç»Ÿä¸€æ€§ã€‚

#### 2.3 å†³ç­–æŠ½è±¡ç±»æä¾›åŸºç¡€æœåŠ¡

```java
public abstract class BaseLogic implements LogicFilter {

    @Override
    public Long filter(String matterValue, List<TreeNodeLink> treeNodeLinkList) {
        for (TreeNodeLink nodeLine : treeNodeLinkList) {
            if (decisionLogic(matterValue, nodeLine)) return nodeLine.getNodeIdTo();
        }
        return 0L;
    }

    @Override
    public abstract String matterValue(Long treeId, String userId, Map<String, String> decisionMatter);

    private boolean decisionLogic(String matterValue, TreeNodeLink nodeLink) {
        switch (nodeLink.getRuleLimitType()) {
            case 1:
                return matterValue.equals(nodeLink.getRuleLimitValue());
            case 2:
                return Double.parseDouble(matterValue) > Double.parseDouble(nodeLink.getRuleLimitValue());
            case 3:
                return Double.parseDouble(matterValue) < Double.parseDouble(nodeLink.getRuleLimitValue());
            case 4:
                return Double.parseDouble(matterValue) <= Double.parseDouble(nodeLink.getRuleLimitValue());
            case 5:
                return Double.parseDouble(matterValue) >= Double.parseDouble(nodeLink.getRuleLimitValue());
            default:
                return false;
        }
    }

}
```

- åœ¨æŠ½è±¡æ–¹æ³•ä¸­å®ç°äº†æ¥å£æ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†åŸºæœ¬çš„å†³ç­–æ–¹æ³•ï¼›`1ã€2ã€3ã€4ã€5`ï¼Œ`ç­‰äºã€å°äºã€å¤§äºã€å°äºç­‰äºã€å¤§äºç­‰äº`çš„åˆ¤æ–­é€»è¾‘ã€‚
- åŒæ—¶å®šä¹‰äº†æŠ½è±¡æ–¹æ³•ï¼Œè®©æ¯ä¸€ä¸ªå®ç°æ¥å£çš„ç±»éƒ½å¿…é¡»æŒ‰ç…§è§„åˆ™æä¾›`å†³ç­–å€¼`ï¼Œè¿™ä¸ªå†³ç­–å€¼ç”¨äºåšé€»è¾‘æ¯”å¯¹ã€‚

#### 2.4 æ ‘èŠ‚ç‚¹é€»è¾‘å®ç°ç±»

**å¹´é¾„èŠ‚ç‚¹**

```java
public class UserAgeFilter extends BaseLogic {

    @Override
    public String matterValue(Long treeId, String userId, Map<String, String> decisionMatter) {
        return decisionMatter.get("age");
    }

}
```

**æ€§åˆ«èŠ‚ç‚¹**

```java
public class UserGenderFilter extends BaseLogic {

    @Override
    public String matterValue(Long treeId, String userId, Map<String, String> decisionMatter) {
        return decisionMatter.get("gender");
    }

}
```

- ä»¥ä¸Šä¸¤ä¸ªå†³ç­–é€»è¾‘çš„èŠ‚ç‚¹è·å–å€¼çš„æ–¹å¼éƒ½éå¸¸ç®€å•ï¼Œåªæ˜¯è·å–ç”¨æˆ·çš„å…¥å‚å³å¯ã€‚å®é™…çš„ä¸šåŠ¡å¼€å‘å¯ä»¥ä»æ•°æ®åº“ã€RPCæ¥å£ã€ç¼“å­˜è¿ç®—ç­‰å„ç§æ–¹å¼è·å–ã€‚

#### 2.5 å†³ç­–å¼•æ“æ¥å£å®šä¹‰

```java
public interface IEngine {

    EngineResult process(final Long treeId, final String userId, TreeRich treeRich, final Map<String, String> decisionMatter);

}
```

- å¯¹äºä½¿ç”¨æ–¹æ¥è¯´ä¹ŸåŒæ ·éœ€è¦å®šä¹‰ç»Ÿä¸€çš„æ¥å£æ“ä½œï¼Œè¿™æ ·çš„å¥½å¤„éå¸¸æ–¹ä¾¿åç»­æ‹“å±•å‡ºä¸åŒç±»å‹çš„å†³ç­–å¼•æ“ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å»ºé€ ä¸åŒçš„å†³ç­–å·¥å‚ã€‚

#### 2.6 å†³ç­–èŠ‚ç‚¹é…ç½®

```java
public class EngineConfig {

    static Map<String, LogicFilter> logicFilterMap;

    static {
        logicFilterMap = new ConcurrentHashMap<>();
        logicFilterMap.put("userAge", new UserAgeFilter());
        logicFilterMap.put("userGender", new UserGenderFilter());
    }

    public Map<String, LogicFilter> getLogicFilterMap() {
        return logicFilterMap;
    }

    public void setLogicFilterMap(Map<String, LogicFilter> logicFilterMap) {
        this.logicFilterMap = logicFilterMap;
    }

}
```

- åœ¨è¿™é‡Œå°†å¯æä¾›æœåŠ¡çš„å†³ç­–èŠ‚ç‚¹é…ç½®åˆ°`map`ç»“æ„ä¸­ï¼Œå¯¹äºè¿™æ ·çš„`map`ç»“æ„å¯ä»¥æŠ½å–åˆ°æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„ç®¡ç†ã€‚

#### 2.7 åŸºç¡€å†³ç­–å¼•æ“åŠŸèƒ½

```java
public abstract class EngineBase extends EngineConfig implements IEngine {

    private Logger logger = LoggerFactory.getLogger(EngineBase.class);

    @Override
    public abstract EngineResult process(Long treeId, String userId, TreeRich treeRich, Map<String, String> decisionMatter);

    protected TreeNode engineDecisionMaker(TreeRich treeRich, Long treeId, String userId, Map<String, String> decisionMatter) {
        TreeRoot treeRoot = treeRich.getTreeRoot();
        Map<Long, TreeNode> treeNodeMap = treeRich.getTreeNodeMap();
        // è§„åˆ™æ ‘æ ¹ID
        Long rootNodeId = treeRoot.getTreeRootNodeId();
        TreeNode treeNodeInfo = treeNodeMap.get(rootNodeId);
        //èŠ‚ç‚¹ç±»å‹[NodeType]ï¼›1å­å¶ã€2æœå®
        while (treeNodeInfo.getNodeType().equals(1)) {
            String ruleKey = treeNodeInfo.getRuleKey();
            LogicFilter logicFilter = logicFilterMap.get(ruleKey);
            String matterValue = logicFilter.matterValue(treeId, userId, decisionMatter);
            Long nextNode = logicFilter.filter(matterValue, treeNodeInfo.getTreeNodeLinkList());
            treeNodeInfo = treeNodeMap.get(nextNode);
            logger.info("å†³ç­–æ ‘å¼•æ“=>{} userIdï¼š{} treeIdï¼š{} treeNodeï¼š{} ruleKeyï¼š{} matterValueï¼š{}", treeRoot.getTreeName(), userId, treeId, treeNodeInfo.getTreeNodeId(), ruleKey, matterValue);
        }
        return treeNodeInfo;
    }

}
```

- è¿™é‡Œä¸»è¦æä¾›å†³ç­–æ ‘æµç¨‹çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ‰ç‚¹åƒé€šè¿‡é“¾è·¯çš„å…³ç³»(`æ€§åˆ«`ã€`å¹´é¾„`)åœ¨äºŒå‰æ ‘ä¸­å¯»æ‰¾æœå®èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚
- åŒæ—¶æä¾›ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ‰§è¡Œå†³ç­–æµç¨‹çš„æ–¹æ³•ä¾›å¤–éƒ¨å»åšå…·ä½“çš„å®ç°ã€‚

#### 2.8 å†³ç­–å¼•æ“çš„å®ç°

```java
public class TreeEngineHandle extends EngineBase {

    @Override
    public EngineResult process(Long treeId, String userId, TreeRich treeRich, Map<String, String> decisionMatter) {
        // å†³ç­–æµç¨‹
        TreeNode treeNode = engineDecisionMaker(treeRich, treeId, userId, decisionMatter);
        // å†³ç­–ç»“æœ
        return new EngineResult(userId, treeId, treeNode.getTreeNodeId(), treeNode.getNodeValue());
    }

}
```

- è¿™é‡Œå¯¹äºå†³ç­–å¼•æ“çš„å®ç°å°±éå¸¸ç®€å•äº†ï¼Œé€šè¿‡ä¼ é€’è¿›æ¥çš„å¿…è¦ä¿¡æ¯ï¼›å†³ç­–æ ‘ä¿¡æ¯ã€å†³ç­–ç‰©æ–™å€¼ï¼Œæ¥åšå…·ä½“çš„æ ‘å½¢ç»“æ„å†³ç­–ã€‚

### 3. æµ‹è¯•éªŒè¯

#### 3.1 ç»„è£…æ ‘å…³ç³»

```java
@Before
public void init() {
    // èŠ‚ç‚¹ï¼š1
    TreeNode treeNode_01 = new TreeNode();
    treeNode_01.setTreeId(10001L);
    treeNode_01.setTreeNodeId(1L);
    treeNode_01.setNodeType(1);
    treeNode_01.setNodeValue(null);
    treeNode_01.setRuleKey("userGender");
    treeNode_01.setRuleDesc("ç”¨æˆ·æ€§åˆ«[ç”·/å¥³]");
    // é“¾æ¥ï¼š1->11
    TreeNodeLink treeNodeLink_11 = new TreeNodeLink();
    treeNodeLink_11.setNodeIdFrom(1L);
    treeNodeLink_11.setNodeIdTo(11L);
    treeNodeLink_11.setRuleLimitType(1);
    treeNodeLink_11.setRuleLimitValue("man");
    // é“¾æ¥ï¼š1->12
    TreeNodeLink treeNodeLink_12 = new TreeNodeLink();
    treeNodeLink_12.setNodeIdTo(1L);
    treeNodeLink_12.setNodeIdTo(12L);
    treeNodeLink_12.setRuleLimitType(1);
    treeNodeLink_12.setRuleLimitValue("woman");
    List<TreeNodeLink> treeNodeLinkList_1 = new ArrayList<>();
    treeNodeLinkList_1.add(treeNodeLink_11);
    treeNodeLinkList_1.add(treeNodeLink_12);
    treeNode_01.setTreeNodeLinkList(treeNodeLinkList_1);
    // èŠ‚ç‚¹ï¼š11
    TreeNode treeNode_11 = new TreeNode();
    treeNode_11.setTreeId(10001L);
    treeNode_11.setTreeNodeId(11L);
    treeNode_11.setNodeType(1);
    treeNode_11.setNodeValue(null);
    treeNode_11.setRuleKey("userAge");
    treeNode_11.setRuleDesc("ç”¨æˆ·å¹´é¾„");
    // é“¾æ¥ï¼š11->111
    TreeNodeLink treeNodeLink_111 = new TreeNodeLink();
    treeNodeLink_111.setNodeIdFrom(11L);
    treeNodeLink_111.setNodeIdTo(111L);
    treeNodeLink_111.setRuleLimitType(3);
    treeNodeLink_111.setRuleLimitValue("25");
    // é“¾æ¥ï¼š11->112
    TreeNodeLink treeNodeLink_112 = new TreeNodeLink();
    treeNodeLink_112.setNodeIdFrom(11L);
    treeNodeLink_112.setNodeIdTo(112L);
    treeNodeLink_112.setRuleLimitType(5);
    treeNodeLink_112.setRuleLimitValue("25");
    List<TreeNodeLink> treeNodeLinkList_11 = new ArrayList<>();
    treeNodeLinkList_11.add(treeNodeLink_111);
    treeNodeLinkList_11.add(treeNodeLink_112);
    treeNode_11.setTreeNodeLinkList(treeNodeLinkList_11);
    // èŠ‚ç‚¹ï¼š12
    TreeNode treeNode_12 = new TreeNode();
    treeNode_12.setTreeId(10001L);
    treeNode_12.setTreeNodeId(12L);
    treeNode_12.setNodeType(1);
    treeNode_12.setNodeValue(null);
    treeNode_12.setRuleKey("userAge");
    treeNode_12.setRuleDesc("ç”¨æˆ·å¹´é¾„");
    // é“¾æ¥ï¼š12->121
    TreeNodeLink treeNodeLink_121 = new TreeNodeLink();
    treeNodeLink_121.setNodeIdFrom(12L);
    treeNodeLink_121.setNodeIdTo(121L);
    treeNodeLink_121.setRuleLimitType(3);
    treeNodeLink_121.setRuleLimitValue("25");
    // é“¾æ¥ï¼š12->122
    TreeNodeLink treeNodeLink_122 = new TreeNodeLink();
    treeNodeLink_122.setNodeIdFrom(12L);
    treeNodeLink_122.setNodeIdTo(122L);
    treeNodeLink_122.setRuleLimitType(5);
    treeNodeLink_122.setRuleLimitValue("25");
    List<TreeNodeLink> treeNodeLinkList_12 = new ArrayList<>();
    treeNodeLinkList_12.add(treeNodeLink_121);
    treeNodeLinkList_12.add(treeNodeLink_122);
    treeNode_12.setTreeNodeLinkList(treeNodeLinkList_12);
    // èŠ‚ç‚¹ï¼š111
    TreeNode treeNode_111 = new TreeNode();
    treeNode_111.setTreeId(10001L);
    treeNode_111.setTreeNodeId(111L);
    treeNode_111.setNodeType(2);
    treeNode_111.setNodeValue("æœå®A");
    // èŠ‚ç‚¹ï¼š112
    TreeNode treeNode_112 = new TreeNode();
    treeNode_112.setTreeId(10001L);
    treeNode_112.setTreeNodeId(112L);
    treeNode_112.setNodeType(2);
    treeNode_112.setNodeValue("æœå®B");
    // èŠ‚ç‚¹ï¼š121
    TreeNode treeNode_121 = new TreeNode();
    treeNode_121.setTreeId(10001L);
    treeNode_121.setTreeNodeId(121L);
    treeNode_121.setNodeType(2);
    treeNode_121.setNodeValue("æœå®C");
    // èŠ‚ç‚¹ï¼š122
    TreeNode treeNode_122 = new TreeNode();
    treeNode_122.setTreeId(10001L);
    treeNode_122.setTreeNodeId(122L);
    treeNode_122.setNodeType(2);
    treeNode_122.setNodeValue("æœå®D");
    // æ ‘æ ¹
    TreeRoot treeRoot = new TreeRoot();
    treeRoot.setTreeId(10001L);
    treeRoot.setTreeRootNodeId(1L);
    treeRoot.setTreeName("è§„åˆ™å†³ç­–æ ‘");
    Map<Long, TreeNode> treeNodeMap = new HashMap<>();
    treeNodeMap.put(1L, treeNode_01);
    treeNodeMap.put(11L, treeNode_11);
    treeNodeMap.put(12L, treeNode_12);
    treeNodeMap.put(111L, treeNode_111);
    treeNodeMap.put(112L, treeNode_112);
    treeNodeMap.put(121L, treeNode_121);
    treeNodeMap.put(122L, treeNode_122);
    treeRich = new TreeRich(treeRoot, treeNodeMap);
}
```

![æ ‘å½¢ç»“æ„çš„ç»„ç»‡å…³ç³»](https://bugstack.cn/assets/images/2020/itstack-demo-design-8-04.png)

- **é‡è¦**ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯ç»„åˆæ¨¡å¼éå¸¸é‡è¦çš„ä½¿ç”¨ï¼Œåœ¨æˆ‘ä»¬å·²ç»å»ºé€ å¥½çš„å†³ç­–æ ‘å…³ç³»ä¸‹ï¼Œå¯ä»¥åˆ›å»ºå‡ºæ ‘çš„å„ä¸ªèŠ‚ç‚¹ï¼Œä»¥åŠå¯¹èŠ‚ç‚¹é—´ä½¿ç”¨é“¾è·¯è¿›è¡Œä¸²è”ã€‚
- åŠæ—¶åç»­ä½ éœ€è¦åšä»»ä½•ä¸šåŠ¡çš„æ‰©å±•éƒ½å¯ä»¥åœ¨é‡Œé¢æ·»åŠ ç›¸åº”çš„èŠ‚ç‚¹ï¼Œå¹¶åšåŠ¨æ€åŒ–çš„é…ç½®ã€‚
- å…³äºè¿™éƒ¨åˆ†æ‰‹åŠ¨ç»„åˆçš„æ–¹å¼å¯ä»¥æå–åˆ°æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆä¹Ÿå°±å¯ä»¥æ‰©å±•åˆ°å›¾å½¢ç•Œé¢çš„è¿›è¡Œé…ç½®æ“ä½œã€‚

#### 3.2 ç¼–å†™æµ‹è¯•ç±»

```java
@Test
public void test_tree() {
    logger.info("å†³ç­–æ ‘ç»„åˆç»“æ„ä¿¡æ¯ï¼š\r\n" + JSON.toJSONString(treeRich));
    
    IEngine treeEngineHandle = new TreeEngineHandle();
    Map<String, String> decisionMatter = new HashMap<>();
    decisionMatter.put("gender", "man");
    decisionMatter.put("age", "29");
    
    EngineResult result = treeEngineHandle.process(10001L, "Oli09pLkdjh", treeRich, decisionMatter);
    
    logger.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(result));
}
```

- åœ¨è¿™é‡Œæä¾›äº†è°ƒç”¨çš„é€šè¿‡ç»„ç»‡æ¨¡å¼åˆ›å»ºå‡ºæ¥çš„æµç¨‹å†³ç­–æ ‘ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼ å…¥äº†å†³ç­–æ ‘çš„IDï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¸šåŠ¡å¼€å‘ä¸­å°±å¯ä»¥æ–¹ä¾¿çš„è§£è€¦å†³ç­–æ ‘ä¸ä¸šåŠ¡çš„ç»‘å®šå…³ç³»ï¼ŒæŒ‰éœ€ä¼ å…¥å†³ç­–æ ‘IDå³å¯ã€‚
- æ­¤å¤–å…¥å‚æˆ‘ä»¬è¿˜æä¾›äº†éœ€è¦å¤„ç†ï¼›`ç”·`(man)ã€`å¹´é¾„`(29å²)ï¼Œçš„å‚æ•°ä¿¡æ¯ã€‚

#### 3.3 æµ‹è¯•ç»“æœ

```java
23:35:05.711 [main] INFO  o.i.d.d.d.service.engine.EngineBase - å†³ç­–æ ‘å¼•æ“=>è§„åˆ™å†³ç­–æ ‘ userIdï¼šOli09pLkdjh treeIdï¼š10001 treeNodeï¼š11 ruleKeyï¼šuserGender matterValueï¼šman
23:35:05.712 [main] INFO  o.i.d.d.d.service.engine.EngineBase - å†³ç­–æ ‘å¼•æ“=>è§„åˆ™å†³ç­–æ ‘ userIdï¼šOli09pLkdjh treeIdï¼š10001 treeNodeï¼š112 ruleKeyï¼šuserAge matterValueï¼š29
23:35:05.715 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœï¼š{"nodeId":112,"nodeValue":"æœå®B","success":true,"treeId":10001,"userId":"Oli09pLkdjh"}

Process finished with exit code 0
```

- ä»æµ‹è¯•ç»“æœä¸Šçœ‹è¿™ä¸æˆ‘ä»¬ä½¿ç”¨`ifelse`æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç›®å‰è¿™ä¸çš„ç»„åˆæ¨¡å¼è®¾è®¡ä¸‹ï¼Œå°±éå¸¸æ–¹ä¾¿åç»­çš„æ‹“å±•å’Œä¿®æ”¹ã€‚
- æ•´ä½“çš„ç»„ç»‡å…³ç³»æ¡†æ¶ä»¥åŠè°ƒç”¨å†³ç­–æµç¨‹å·²ç»æ­å»ºå®Œæˆï¼Œå¦‚æœé˜…è¯»åˆ°æ­¤æ²¡æœ‰å®Œå…¨ç†è§£ï¼Œå¯ä»¥ä¸‹è½½ä»£ç è§‚å¯Ÿç»“æ„å¹¶è¿è¡Œè°ƒè¯•ã€‚

## ä¸ƒã€æ€»ç»“

- ä»ä»¥ä¸Šçš„å†³ç­–æ ‘åœºæ™¯æ¥çœ‹ï¼Œç»„åˆæ¨¡å¼çš„ä¸»è¦è§£å†³çš„æ˜¯ä¸€ç³»åˆ—ç®€å•é€»è¾‘èŠ‚ç‚¹æˆ–è€…æ‰©å±•çš„å¤æ‚é€»è¾‘èŠ‚ç‚¹åœ¨ä¸åŒç»“æ„çš„ç»„ç»‡ä¸‹ï¼Œå¯¹äºå¤–éƒ¨çš„è°ƒç”¨æ˜¯ä»ç„¶å¯ä»¥éå¸¸ç®€å•çš„ã€‚
- è¿™éƒ¨åˆ†è®¾è®¡æ¨¡å¼ä¿è¯äº†å¼€é—­åŸåˆ™ï¼Œæ— éœ€æ›´æ”¹æ¨¡å‹ç»“æ„ä½ å°±å¯ä»¥æä¾›æ–°çš„é€»è¾‘èŠ‚ç‚¹çš„ä½¿ç”¨å¹¶é…åˆç»„ç»‡å‡ºæ–°çš„å…³ç³»æ ‘ã€‚ä½†å¦‚æœæ˜¯ä¸€äº›åŠŸèƒ½å·®å¼‚åŒ–éå¸¸å¤§çš„æ¥å£è¿›è¡ŒåŒ…è£…å°±ä¼šå˜å¾—æ¯”è¾ƒå›°éš¾ï¼Œä½†ä¹Ÿä¸æ˜¯ä¸èƒ½å¾ˆå¥½çš„å¤„ç†ï¼Œåªä¸è¿‡éœ€è¦åšä¸€äº›é€‚é…å’Œç‰¹å®šåŒ–çš„å¼€å‘ã€‚
- å¾ˆå¤šæ—¶å€™å› ä¸ºä½ çš„æè‡´è¿½æ±‚å’Œç¨æœ‰å€”å¼ºçš„å·¥åŒ ç²¾ç¥ï¼Œå³ä½¿åœ¨é¢å¯¹åŒæ ·çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä½ èƒ½å®Œæˆå‡ºæœ€å¥½çš„ä»£ç ç»“æ„å’Œæœ€æ˜“äºæ‰©å±•çš„æŠ€æœ¯æ¶æ„ã€‚`ä¸è¦è¢«è¿œä¸èƒ½ç»™ä½ æŒ‡å¯¼æå‡èƒ½åŠ›çš„å½±å“åˆ°æ”¾å¼ƒè‡ªå·±çš„è¿½æ±‚ï¼`