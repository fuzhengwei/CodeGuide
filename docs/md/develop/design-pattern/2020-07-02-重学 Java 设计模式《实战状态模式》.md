---
layout: post
category: itstack-demo-design
title: é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜çŠ¶æ€æ¨¡å¼ã€Œæ¨¡æ‹Ÿç³»ç»Ÿè¥é”€æ´»åŠ¨ï¼ŒçŠ¶æ€æµç¨‹å®¡æ ¸å‘å¸ƒä¸Šçº¿åœºæ™¯ã€
tagline: by å°å‚…å“¥
tag: [itstack-demo-design]
excerpt: å†™å¥½ä»£ç ä¸‰ä¸ªå…³é”®ç‚¹æ˜¯ä»€ä¹ˆğŸ˜¯ï¼Ÿå¦‚æœæŠŠå†™ä»£ç æƒ³è±¡æˆå®¶é‡Œçš„è½¯è£…é‚£ä¹ˆï¼Œæ¶æ„æ˜¯(æˆ¿é—´çš„æ ¼å±€)ã€å‘½åæ˜¯(å“ç‰Œå’Œè´¨é‡)ã€æ³¨é‡Šæ˜¯(å°ºå¯¸å¤§å°è¯´æ˜ä¹¦)ï¼Œåªæœ‰è¿™ä¸‰ä¸ªç‚¹éƒ½åšå¥½æ‰èƒ½å®Œæˆå‡ºä¸€å¥—èµå¿ƒæ‚¦ç›®çš„å®¶ã€‚
lock: need
---

# é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜çŠ¶æ€æ¨¡å¼ã€Œæ¨¡æ‹Ÿç³»ç»Ÿè¥é”€æ´»åŠ¨ï¼ŒçŠ¶æ€æµç¨‹å®¡æ ¸å‘å¸ƒä¸Šçº¿åœºæ™¯ã€

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=683904414&bvid=BV1WU4y1S7uU&cid=716973391&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`å†™å¥½ä»£ç ä¸‰ä¸ªå…³é”®ç‚¹`

å¦‚æœæŠŠå†™ä»£ç æƒ³è±¡æˆå®¶é‡Œçš„è½¯è£…ï¼Œä½ è‚¯å®šä¼šæƒ³åˆ°å®¶é‡Œéœ€è¦æœ‰ä¸€ä¸ªéå¸¸ä¸é”™æ ¼å±€æœ€å¥½æ˜¯å—åŒ—é€šé€çš„ï¼Œä¹°å›æ¥çš„å®¶å…·æœ€å¥½æ˜¯å“ç‰Œä¿è¯è´¨é‡çš„ï¼Œä¹‹åå‘¢æ˜¯å¤§å°åˆé€‚ï¼Œä¸èƒ½æ‘†æ”¾å®Œäº†çœ‹ç€åˆ«æ‰­ã€‚é‚£ä¹ˆæŠŠè¿™ä¸€è¿‡ç¨‹æŠ½è±¡æˆå†™ä»£ç å°±æ˜¯éœ€è¦ä¸‰ä¸ªæ ¸å¿ƒçš„å…³é”®ç‚¹ï¼›`æ¶æ„`(æˆ¿é—´çš„æ ¼å±€)ã€`å‘½å`(å“ç‰Œå’Œè´¨é‡)ã€`æ³¨é‡Š`(å°ºå¯¸å¤§å°è¯´æ˜ä¹¦)ï¼Œåªæœ‰è¿™ä¸‰ä¸ªç‚¹éƒ½åšå¥½æ‰èƒ½å®Œæˆå‡ºä¸€å¥—èµå¿ƒæ‚¦ç›®çš„**å®¶**ã€‚

`å¹³åŸèµ°ç ğŸæ˜“æ”¾éš¾æ”¶`

ä¸Šå­¦æœŸé—´ä½ å†™äº†å¤šå°‘ä»£ç ï¼Ÿä¸Šç­ä¸€å¹´ä½ èƒ½å†™å¤šå°‘ä»£ç ï¼Ÿå›å®¶è‡ªå·±å­¦ä¹ å†™äº†å¤šå°‘ä»£ç ï¼Ÿä¸ªäººç´ å…»çš„æŠ€æœ¯æ ˆåœ°åŸºéƒ½æ˜¯ä¸€å—ä¸€å—ç –ç å‡ºæ¥çš„ï¼Œå†™çš„è¶Šå¹¿è¶Šæ·±ï¼Œæ ¹åŸºå°±è¶Šç‰¢å›ºã€‚å½“æ ¹åŸºç‰¢å›ºäº†ä»¥ååœ¨å†ä¸Šå±‚å»ºè®¾å°±å˜å¾—è¿åˆƒè€Œè§£äº†ï¼Œä¹Ÿæ›´å®¹æ˜“å»ºè®¾äº†ã€‚å¾€å¾€æœ€éš¾çš„å°±æ˜¯ä¸€å±‚ä¸€å±‚é˜¶æ®µçš„çªç ´ï¼Œçªç ´å°±åƒç ´å£³ä¸€æ ·ï¼Œä¹Ÿåƒå¤¯å®åœ°åŸºï¼ŒçŸ­æ—¶é—´çœ‹ä¸åˆ°æˆç»©ï¼Œä¹Ÿçœ‹ä¸å‡ºé«˜åº¦ã€‚ä½†ä»¥åè°èƒ½èµ°çš„ç¨³ï¼Œå°±é ç€é»˜é»˜çš„æ²‰æ·€ã€‚

`æŠ€æœ¯ä¼ æ‰¿çš„é‡è¦æ€§`

å¯èƒ½æ˜¯ç°åœ¨æ—¶é—´èŠ‚å¥å¤ªå¿«ï¼Œä¸€ä¸ªéœ€æ±‚ä¸‹æ¥æ¨ä¸å¾—å½“å¤©å°±ä¸Šçº¿(`è¿™ä¸ªéœ€æ±‚å¾ˆç®€å•ï¼Œæ€ä¹ˆå®ç°æˆ‘ä¸ç®¡ï¼Œæ˜å¤©ä¸Šçº¿ï¼`)ï¼Œå¯¼è‡´å›¢é˜Ÿçš„äººéƒ½`å¾ˆæ…Œ`ã€`å¾ˆæ€¥`ã€`å¾ˆç´¯`ã€`å¾ˆå´©æºƒ`ï¼Œæœ€ç»ˆååå¤å¤çš„äººå‘˜æ›´æ›¿ï¼Œé¡¹ç›®åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿäº¤æ¥äº†Næ¬¡ï¼Œæ–‡æ¡£ä¸å…¨ã€ä»£ç æ··ä¹±ã€é”™ç»¼å¤æ‚ï¼Œè°åœ¨åé¢æ¥æ‰‹ä¹Ÿéƒ½åªèƒ½ä¿®ä¿®è¡¥è¡¥ï¼Œå°±åƒçƒ‚å°¾æ¥¼ã€‚è¿™ä¸ªæ²¡æœ‰ä¼ æ‰¿ã€æ²¡æœ‰æ²‰æ·€çš„é¡¹ç›®ï¼Œå¾ˆéš¾è·Ÿéšä¸šåŠ¡çš„å‘å±•ã€‚æœ€ç»ˆï¼æ ¹åŸºä¸ç‰¢ï¼Œä¸€åœ°é¸¡æ¯›ã€‚

## äºŒã€å¼€å‘ç¯å¢ƒ

1. JDK 1.8
2. Idea + Maven
3. æ¶‰åŠå·¥ç¨‹ä¸‰ä¸ªï¼Œå¯ä»¥é€šè¿‡å…³æ³¨**å…¬ä¼—å·**ï¼š[`bugstackè™«æ´æ ˆ`](https://bugstack.cn/assets/images/qrcode.png)ï¼Œå›å¤`æºç ä¸‹è½½`è·å–(æ‰“å¼€è·å–çš„é“¾æ¥ï¼Œæ‰¾åˆ°åºå·18)

| å·¥ç¨‹                     | æè¿°                                         |
| ------------------------ | --------------------------------- |
| itstack-demo-design-19-00 | åœºæ™¯æ¨¡æ‹Ÿå·¥ç¨‹ï¼›æ¨¡æ‹Ÿè¥é”€æ´»åŠ¨æ“ä½œæœåŠ¡(æŸ¥è¯¢ã€å®¡æ ¸) |
| itstack-demo-design-19-01 | ä½¿ç”¨ä¸€å¨ä»£ç å®ç°ä¸šåŠ¡éœ€æ±‚ |
| itstack-demo-design-19-02 | é€šè¿‡è®¾è®¡æ¨¡å¼ä¼˜åŒ–æ”¹é€ ä»£ç ï¼Œäº§ç”Ÿå¯¹æ¯”æ€§ä»è€Œå­¦ä¹  |

## ä¸‰ã€çŠ¶æ€æ¨¡å¼ä»‹ç»

![çŠ¶æ€æ¨¡å¼ï¼Œå›¾ç‰‡æ¥è‡ª refactoringguru.cn](https://bugstack.cn/assets/images/2020/itstack-demo-design-19-01.png)

çŠ¶æ€æ¨¡å¼æè¿°çš„æ˜¯ä¸€ä¸ªè¡Œä¸ºä¸‹çš„å¤šç§çŠ¶æ€å˜æ›´ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸è§çš„ä¸€ä¸ªç½‘ç«™çš„é¡µé¢ï¼Œåœ¨ä½ ç™»å½•ä¸ä¸ç™»å½•ä¸‹å±•ç¤ºçš„å†…å®¹æ˜¯ç•¥æœ‰å·®å¼‚çš„(`ä¸ç™»å½•ä¸èƒ½å±•ç¤ºä¸ªäººä¿¡æ¯`)ï¼Œè€Œè¿™ç§`ç™»å½•`ä¸`ä¸ç™»å½•`å°±æ˜¯æˆ‘ä»¬é€šè¿‡æ”¹å˜**çŠ¶æ€**ï¼Œè€Œè®©æ•´ä¸ªè¡Œä¸ºå‘ç”Ÿäº†å˜åŒ–ã€‚

![æ”¶éŸ³æœº&æ”¾éŸ³æœº&ç£å¸¦æœº](https://bugstack.cn/assets/images/2020/itstack-demo-design-19-02.png)

è‡³å°‘80åã€90åçš„å°ä¼™ä¼´åŸºæœ¬éƒ½ç”¨è¿‡è¿™ç§ç£å¸¦æ”¾éŸ³æœº(`å¯èƒ½æ²¡æœ‰è¿™ä¸ªå¥½çœ‹`)ï¼Œå®ƒçš„ä¸Šé¢æ˜¯ä¸€æ’æŒ‰é’®ï¼Œå½“æ”¾å…¥ç£å¸¦åï¼Œé€šè¿‡ä¸Šé¢çš„æŒ‰é’®å°±å¯ä»¥è®©æ”¾éŸ³æœºæ’­æ”¾ç£å¸¦ä¸Šçš„å†…å®¹(`listen to è‹±è¯­å¬åŠ›è€ƒè¯•`)ï¼Œè€Œä¸”æœ‰äº›æŒ‰é’®æ˜¯äº’æ–¥çš„ï¼Œå½“åœ¨æŸä¸ªçŠ¶æ€ä¸‹æ‰å¯ä»¥æŒ‰å¦å¤–çš„æŒ‰é’®(`è¿™åœ¨è®¾è®¡æ¨¡å¼é‡Œä¹Ÿæ˜¯ä¸€ä¸ªå…³é”®çš„ç‚¹`)ã€‚

## å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

![åœºæ™¯æ¨¡æ‹Ÿï¼›è¥é”€æ´»åŠ¨å®¡æ ¸çŠ¶æ€æµè½¬](https://bugstack.cn/assets/images/2020/itstack-demo-design-19-03.png)

**åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿè¥é”€æ´»åŠ¨å®¡æ ¸çŠ¶æ€æµè½¬åœºæ™¯(ä¸€ä¸ªæ´»åŠ¨çš„ä¸Šçº¿æ˜¯å¤šä¸ªå±‚çº§å®¡æ ¸ä¸Šçº¿çš„)**

åœ¨ä¸Šå›¾ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æµç¨‹èŠ‚ç‚¹ä¸­åŒ…æ‹¬äº†å„ä¸ªçŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€æ‰­è½¬çš„å…³è”æ¡ä»¶ï¼Œæ¯”å¦‚ï¼›å®¡æ ¸é€šè¿‡æ‰èƒ½åˆ°æ´»åŠ¨ä¸­ï¼Œè€Œä¸èƒ½ä»ç¼–è¾‘ä¸­ç›´æ¥åˆ°æ´»åŠ¨ä¸­ï¼Œè€Œè¿™äº›çŠ¶æ€çš„è½¬å˜å°±æ˜¯æˆ‘ä»¬è¦å®Œæˆçš„åœºæ™¯å¤„ç†ã€‚

å¤§éƒ¨åˆ†ç¨‹åºå‘˜åŸºæœ¬éƒ½å¼€å‘è¿‡ç±»ä¼¼çš„ä¸šåŠ¡åœºæ™¯ï¼Œéœ€è¦å¯¹æ´»åŠ¨æˆ–è€…ä¸€äº›é…ç½®éœ€è¦å®¡æ ¸åæ‰èƒ½å¯¹å¤–å‘å¸ƒï¼Œè€Œè¿™ä¸ªå®¡æ ¸çš„è¿‡ç¨‹å¾€å¾€ä¼šéšç€ç³»ç»Ÿçš„é‡è¦ç¨‹åº¦è€Œè®¾ç«‹å¤šçº§æ§åˆ¶ï¼Œæ¥ä¿è¯ä¸€ä¸ªæ´»åŠ¨å¯ä»¥å®‰å…¨ä¸Šçº¿ï¼Œé¿å…é€ æˆèµ„æŸã€‚

å½“ç„¶æœ‰æ—¶å€™ä¼šç”¨åˆ°ä¸€äº›å®¡æ‰¹æµçš„è¿‡ç¨‹é…ç½®ï¼Œä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿å¼€å‘ç±»ä¼¼çš„æµç¨‹çš„ï¼Œä¹Ÿå¯ä»¥åœ¨é…ç½®ä¸­è®¾å®šæŸä¸ªèŠ‚ç‚¹çš„å®¡æ‰¹äººå‘˜ã€‚ä½†è¿™ä¸æ˜¯æˆ‘ä»¬ä¸»è¦ä½“ç°çš„ç‚¹ï¼Œåœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬ä¸»è¦æ˜¯æ¨¡æ‹Ÿå­¦ä¹ å¯¹ä¸€ä¸ªæ´»åŠ¨çš„å¤šä¸ªçŠ¶æ€èŠ‚ç‚¹çš„å®¡æ ¸æ§åˆ¶ã€‚

### 1. åœºæ™¯æ¨¡æ‹Ÿå·¥ç¨‹

```java
itstack-demo-design-19-00
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â”œâ”€â”€ ActivityInfo.java
                â”œâ”€â”€ Status.java
                â””â”€â”€ ActivityService.java
```

- åœ¨è¿™ä¸ªæ¨¡æ‹Ÿå·¥ç¨‹é‡Œæˆ‘ä»¬æä¾›äº†ä¸‰ä¸ªç±»ï¼ŒåŒ…æ‹¬ï¼›çŠ¶æ€æšä¸¾(`Status`)ã€æ´»åŠ¨å¯¹è±¡(`ActivityInfo`)ã€æ´»åŠ¨æœåŠ¡(`ActivityService`)ï¼Œä¸‰ä¸ªæœåŠ¡ç±»ã€‚
- æ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ†åˆ«ä»‹ç»ä¸‰ä¸ªç±»åŒ…æ‹¬çš„å†…å®¹ã€‚

### 2. ä»£ç å®ç°

#### 2.1 åŸºæœ¬æ´»åŠ¨ä¿¡æ¯

```java
public class ActivityInfo {

    private String activityId;    // æ´»åŠ¨ID
    private String activityName;  // æ´»åŠ¨åç§°
    private Enum<Status> status;  // æ´»åŠ¨çŠ¶æ€
    private Date beginTime;       // å¼€å§‹æ—¶é—´
    private Date endTime;         // ç»“æŸæ—¶é—´
   
    // ...get/set
}  
```

- ä¸€äº›åŸºæœ¬çš„æ´»åŠ¨ä¿¡æ¯ï¼›æ´»åŠ¨IDã€æ´»åŠ¨åç§°ã€æ´»åŠ¨çŠ¶æ€ã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€‚

#### 2.2 æ´»åŠ¨æšä¸¾çŠ¶æ€

```java
public enum Status {

    // 1åˆ›å»ºç¼–è¾‘ã€2å¾…å®¡æ ¸ã€3å®¡æ ¸é€šè¿‡(ä»»åŠ¡æ‰«ææˆæ´»åŠ¨ä¸­)ã€4å®¡æ ¸æ‹’ç»(å¯ä»¥æ’¤å®¡åˆ°ç¼–è¾‘çŠ¶æ€)ã€5æ´»åŠ¨ä¸­ã€6æ´»åŠ¨å…³é—­ã€7æ´»åŠ¨å¼€å¯(ä»»åŠ¡æ‰«ææˆæ´»åŠ¨ä¸­)
    Editing, Check, Pass, Refuse, Doing, Close, Open

}
```

- æ´»åŠ¨çš„æšä¸¾ï¼›1åˆ›å»ºç¼–è¾‘ã€2å¾…å®¡æ ¸ã€3å®¡æ ¸é€šè¿‡(ä»»åŠ¡æ‰«ææˆæ´»åŠ¨ä¸­)ã€4å®¡æ ¸æ‹’ç»(å¯ä»¥æ’¤å®¡åˆ°ç¼–è¾‘çŠ¶æ€)ã€5æ´»åŠ¨ä¸­ã€6æ´»åŠ¨å…³é—­ã€7æ´»åŠ¨å¼€å¯(ä»»åŠ¡æ‰«ææˆæ´»åŠ¨ä¸­)

#### 2.3 æ´»åŠ¨æœåŠ¡æ¥å£

```java
public class ActivityService {

    private static Map<String, Enum<Status>> statusMap = new ConcurrentHashMap<String, Enum<Status>>();

    public static void init(String activityId, Enum<Status> status) {
        // æ¨¡æ‹ŸæŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯
        ActivityInfo activityInfo = new ActivityInfo();
        activityInfo.setActivityId(activityId);
        activityInfo.setActivityName("æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨");
        activityInfo.setStatus(status);
        activityInfo.setBeginTime(new Date());
        activityInfo.setEndTime(new Date());
        statusMap.put(activityId, status);
    }

    /**
     * æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯
     *
     * @param activityId æ´»åŠ¨ID
     * @return æŸ¥è¯¢ç»“æœ
     */
    public static ActivityInfo queryActivityInfo(String activityId) {
        // æ¨¡æ‹ŸæŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯
        ActivityInfo activityInfo = new ActivityInfo();
        activityInfo.setActivityId(activityId);
        activityInfo.setActivityName("æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨");
        activityInfo.setStatus(statusMap.get(activityId));
        activityInfo.setBeginTime(new Date());
        activityInfo.setEndTime(new Date());
        return activityInfo;
    }

    /**
     * æŸ¥è¯¢æ´»åŠ¨çŠ¶æ€
     *
     * @param activityId æ´»åŠ¨ID
     * @return æŸ¥è¯¢ç»“æœ
     */
    public static Enum<Status> queryActivityStatus(String activityId) {
        return statusMap.get(activityId);
    }

    /**
     * æ‰§è¡ŒçŠ¶æ€å˜æ›´
     *
     * @param activityId   æ´»åŠ¨ID
     * @param beforeStatus å˜æ›´å‰çŠ¶æ€
     * @param afterStatus  å˜æ›´åçŠ¶æ€ b
     */
    public static synchronized void execStatus(String activityId, Enum<Status> beforeStatus, Enum<Status> afterStatus) {
        if (!beforeStatus.equals(statusMap.get(activityId))) return;
        statusMap.put(activityId, afterStatus);
    }

}
```

- åœ¨è¿™ä¸ªé™æ€ç±»ä¸­æä¾›äº†æ´»åŠ¨çš„æŸ¥è¯¢å’ŒçŠ¶æ€å˜æ›´æ¥å£ï¼›`queryActivityInfo`ã€`queryActivityStatus`ã€`execStatus`ã€‚
- åŒæ—¶ä½¿ç”¨Mapçš„ç»“æ„æ¥è®°å½•æ´»åŠ¨IDå’ŒçŠ¶æ€å˜åŒ–ä¿¡æ¯ï¼Œå¦å¤–è¿˜æœ‰initæ–¹æ³•æ¥åˆå§‹åŒ–æ´»åŠ¨æ•°æ®ã€‚å®é™…çš„å¼€å‘ä¸­è¿™ç±»ä¿¡æ¯åŸºæœ¬éƒ½æ˜¯ä»`æ•°æ®åº“`æˆ–è€…`Redis`ä¸­è·å–ã€‚

## äº”ã€ç”¨ä¸€å¨å¨ä»£ç å®ç°

`è¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨æœ€ç²—æš´çš„æ–¹å¼æ¥å®ç°åŠŸèƒ½`

å¯¹äºè¿™æ ·å„ç§çŠ¶æ€çš„å˜æ›´ï¼Œæœ€è®©æˆ‘ä»¬ç›´æ¥æƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨`if`å’Œ`else`è¿›è¡Œåˆ¤æ–­å¤„ç†ã€‚æ¯ä¸€ä¸ªçŠ¶æ€å¯ä»¥æµè½¬åˆ°ä¸‹ä¸€ä¸ªä»€ä¹ˆçŠ¶æ€ï¼Œéƒ½å¯ä»¥ä½¿ç”¨åµŒå¥—çš„`if`å®ç°ã€‚

### 1. å·¥ç¨‹ç»“æ„

```java
itstack-demo-design-19-01
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â”œâ”€â”€ ActivityExecStatusController.java
                â””â”€â”€ Result.java
```

- æ•´ä¸ªå®ç°çš„å·¥ç¨‹ç»“æ„æ¯”è¾ƒç®€å•ï¼ŒåªåŒ…æ‹¬äº†ä¸¤ä¸ªç±»ï¼›`ActivityExecStatusController`ã€`Result`ï¼Œä¸€ä¸ªæ˜¯å¤„ç†æµç¨‹çŠ¶æ€ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯è¿”å›çš„å¯¹è±¡ã€‚

### 2. ä»£ç å®ç°

```java 
public class ActivityExecStatusController {

    /**
     * æ´»åŠ¨çŠ¶æ€å˜æ›´
     * 1. ç¼–è¾‘ä¸­ -> æå®¡ã€å…³é—­
     * 2. å®¡æ ¸é€šè¿‡ -> æ‹’ç»ã€å…³é—­ã€æ´»åŠ¨ä¸­
     * 3. å®¡æ ¸æ‹’ç» -> æ’¤å®¡ã€å…³é—­
     * 4. æ´»åŠ¨ä¸­ -> å…³é—­
     * 5. æ´»åŠ¨å…³é—­ -> å¼€å¯
     * 6. æ´»åŠ¨å¼€å¯ -> å…³é—­
     *
     * @param activityId   æ´»åŠ¨ID
     * @param beforeStatus å˜æ›´å‰çŠ¶æ€
     * @param afterStatus  å˜æ›´åçŠ¶æ€
     * @return è¿”å›ç»“æœ
     */
    public Result execStatus(String activityId, Enum<Status> beforeStatus, Enum<Status> afterStatus) {

        // 1. ç¼–è¾‘ä¸­ -> æå®¡ã€å…³é—­
        if (Status.Editing.equals(beforeStatus)) {
            if (Status.Check.equals(afterStatus) || Status.Close.equals(afterStatus)) {
                ActivityService.execStatus(activityId, beforeStatus, afterStatus);
                return new Result("0000", "å˜æ›´çŠ¶æ€æˆåŠŸ");
            } else {
                return new Result("0001", "å˜æ›´çŠ¶æ€æ‹’ç»");
            }
        }

        // 2. å®¡æ ¸é€šè¿‡ -> æ‹’ç»ã€å…³é—­ã€æ´»åŠ¨ä¸­
        if (Status.Pass.equals(beforeStatus)) {
            if (Status.Refuse.equals(afterStatus) || Status.Doing.equals(afterStatus) || Status.Close.equals(afterStatus)) {
                ActivityService.execStatus(activityId, beforeStatus, afterStatus);
                return new Result("0000", "å˜æ›´çŠ¶æ€æˆåŠŸ");
            } else {
                return new Result("0001", "å˜æ›´çŠ¶æ€æ‹’ç»");
            }
        }

        // 3. å®¡æ ¸æ‹’ç» -> æ’¤å®¡ã€å…³é—­
        if (Status.Refuse.equals(beforeStatus)) {
            if (Status.Editing.equals(afterStatus) || Status.Close.equals(afterStatus)) {
                ActivityService.execStatus(activityId, beforeStatus, afterStatus);
                return new Result("0000", "å˜æ›´çŠ¶æ€æˆåŠŸ");
            } else {
                return new Result("0001", "å˜æ›´çŠ¶æ€æ‹’ç»");
            }
        }

        // 4. æ´»åŠ¨ä¸­ -> å…³é—­
        if (Status.Doing.equals(beforeStatus)) {
            if (Status.Close.equals(afterStatus)) {
                ActivityService.execStatus(activityId, beforeStatus, afterStatus);
                return new Result("0000", "å˜æ›´çŠ¶æ€æˆåŠŸ");
            } else {
                return new Result("0001", "å˜æ›´çŠ¶æ€æ‹’ç»");
            }
        }

        // 5. æ´»åŠ¨å…³é—­ -> å¼€å¯
        if (Status.Close.equals(beforeStatus)) {
            if (Status.Open.equals(afterStatus)) {
                ActivityService.execStatus(activityId, beforeStatus, afterStatus);
                return new Result("0000", "å˜æ›´çŠ¶æ€æˆåŠŸ");
            } else {
                return new Result("0001", "å˜æ›´çŠ¶æ€æ‹’ç»");
            }
        }

        // 6. æ´»åŠ¨å¼€å¯ -> å…³é—­
        if (Status.Open.equals(beforeStatus)) {
            if (Status.Close.equals(afterStatus)) {
                ActivityService.execStatus(activityId, beforeStatus, afterStatus);
                return new Result("0000", "å˜æ›´çŠ¶æ€æˆåŠŸ");
            } else {
                return new Result("0001", "å˜æ›´çŠ¶æ€æ‹’ç»");
            }
        }

        return new Result("0001", "éå¯å¤„ç†çš„æ´»åŠ¨çŠ¶æ€å˜æ›´");

    }

}
```

- è¿™é‡Œæˆ‘ä»¬åªéœ€è¦çœ‹ä¸€ä¸‹ä»£ç å®ç°çš„ç»“æ„å³å¯ã€‚ä»ä¸Šåˆ°ä¸‹æ˜¯ä¸€æ•´ç¯‡çš„`ifelse`ï¼ŒåŸºæœ¬è¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ†åˆçº§ç¨‹åºå‘˜çš„å¼€å‘æ–¹å¼ã€‚
- è¿™æ ·çš„é¢å‘è¿‡ç¨‹å¼å¼€å‘æ–¹å¼ï¼Œå¯¹äºä¸éœ€è¦æ”¹åŠ¨ä»£ç ï¼Œä¹Ÿä¸éœ€è¦äºŒæ¬¡è¿­ä»£çš„ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„(`ä½†åŸºæœ¬ä¸å¯èƒ½ä¸è¿­ä»£`)ã€‚è€Œä¸”éšç€çŠ¶æ€å’Œéœ€æ±‚å˜åŒ–ï¼Œä¼šè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ï¼Œåé¢çš„äººä¹Ÿä¸å¥½çœ‹æ‡‚å¹¶ä¸”å¾ˆå®¹æ˜“å¡«å……å…¶ä»–çš„æµç¨‹è¿›å»ã€‚`è¶Šæ¥è¶Šä¹±å°±æ˜¯ä»ç‚¹æ»´å¼€å§‹çš„`

### 3. æµ‹è¯•éªŒè¯

#### 3.1 ç¼–å†™æµ‹è¯•ç±»

```java
@Test
public void test() {
    // åˆå§‹åŒ–æ•°æ®
    String activityId = "100001";
    ActivityService.init(activityId, Status.Editing);  

    ActivityExecStatusController activityExecStatusController = new ActivityExecStatusController();
    Result resultRefuse = activityExecStatusController.execStatus(activityId, Status.Editing, Status.Refuse); 
    logger.info("æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toå®¡æ ¸æ‹’ç»)ï¼š{}", JSON.toJSONString(resultRefuse));                           

    Result resultCheck = activityExecStatusController.execStatus(activityId, Status.Editing, Status.Check);
    logger.info("æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toæäº¤å®¡æ ¸)ï¼š{}", JSON.toJSONString(resultCheck));
}
```

- æˆ‘ä»¬çš„æµ‹è¯•ä»£ç åŒ…æ‹¬äº†ä¸¤ä¸ªåŠŸèƒ½çš„éªŒè¯ï¼Œä¸€ä¸ªæ˜¯ä»`ç¼–è¾‘ä¸­`åˆ°`å®¡æ ¸æ‹’ç»`ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ä»ç¼–è¾‘ä¸­åˆ°`æäº¤å®¡æ ¸`ã€‚
- å› ä¸ºä»æˆ‘ä»¬çš„åœºæ™¯æµç¨‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¾‘ä¸­çš„æ´»åŠ¨æ˜¯ä¸èƒ½ç›´æ¥åˆ°`å®¡æ ¸æ‹’ç»`çš„ï¼Œè¿™ä¸­é—´è¿˜éœ€è¦`æå®¡`ã€‚

#### 3.2 æµ‹è¯•ç»“æœ

```java
23:24:30.774 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toå®¡æ ¸æ‹’ç»)ï¼š{"code":"0001","info":"å˜æ›´çŠ¶æ€æ‹’ç»"}
23:24:30.778 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toæäº¤å®¡æ ¸)ï¼š{"code":"0000","info":"å˜æ›´çŠ¶æ€æˆåŠŸ"}

Process finished with exit code 0
```

- ä»æµ‹è¯•ç»“æœå’Œæˆ‘ä»¬çš„çŠ¶æ€æµç¨‹çš„æµè½¬ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ç¬¦åˆæµ‹è¯•ç»“æœé¢„æœŸçš„ã€‚é™¤äº†ä¸å¥½ç»´æŠ¤å¤–ï¼Œè¿™æ ·çš„å¼€å‘è¿‡ç¨‹è¿˜æ˜¯è›®å¿«çš„ï¼Œä½†ä¸å»ºè®®è¿™ä¹ˆæï¼

## å…­ã€çŠ¶æ€æ¨¡å¼é‡æ„ä»£ç 

`æ¥ä¸‹æ¥ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡å¾ˆå°çš„é‡æ„ã€‚`

é‡æ„çš„é‡ç‚¹å¾€å¾€æ˜¯å¤„ç†æ‰`ifelse`ï¼Œè€Œæƒ³å¤„ç†æ‰`ifelse`åŸºæœ¬ç¦»ä¸å¼€**æ¥å£**ä¸**æŠ½è±¡ç±»**ï¼Œå¦å¤–è¿˜éœ€è¦é‡æ–°æ”¹é€ ä»£ç ç»“æ„ã€‚

### 1. å·¥ç¨‹ç»“æ„ 

```java
itstack-demo-design-19-02
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â”œâ”€â”€ event
                â”‚    â”œâ”€â”€ CheckState.java
                â”‚    â””â”€â”€ CloseState.java
                â”‚    â””â”€â”€ DoingState.java
                â”‚    â””â”€â”€ EditingState.java
                â”‚    â””â”€â”€ OpenState.java
                â”‚    â””â”€â”€ PassState.java
                â”‚    â””â”€â”€ RefuseState.java
                â”œâ”€â”€ Result.java
                â”œâ”€â”€ State.java
                â””â”€â”€ StateHandler.java
```

**çŠ¶æ€æ¨¡å¼æ¨¡å‹ç»“æ„**  

![çŠ¶æ€æ¨¡å¼æ¨¡å‹ç»“æ„](https://bugstack.cn/assets/images/2020/itstack-demo-design-19-04.png)

- ä»¥ä¸Šæ˜¯çŠ¶æ€æ¨¡å¼çš„æ•´ä¸ªå·¥ç¨‹ç»“æ„æ¨¡å‹ï¼ŒStateæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®šä¹‰äº†å„ç§æ“ä½œæ¥å£(`æå®¡ã€å®¡æ ¸ã€æ‹’å®¡ç­‰`)ã€‚
- å³ä¾§çš„ä¸åŒé¢œè‰²çŠ¶æ€ä¸æˆ‘ä»¬åœºæ™¯æ¨¡æ‹Ÿä¸­çš„é¢œè‰²ä¿æŒä¸€è‡´ï¼Œæ˜¯å„ç§çŠ¶æ€æµç¨‹æµè½¬çš„å®ç°æ“ä½œã€‚è¿™é‡Œçš„å®ç°æœ‰ä¸€ä¸ªå…³é”®ç‚¹å°±æ˜¯æ¯ä¸€ç§çŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œéƒ½åˆ†é…åˆ°å„ä¸ªå®ç°æ–¹æ³•ä¸­æ§åˆ¶ï¼Œä¹Ÿå°±ä¸éœ€è¦`if`è¯­è¨€è¿›è¡Œåˆ¤æ–­äº†ã€‚
- æœ€åæ˜¯`StateHandler`å¯¹çŠ¶æ€æµç¨‹çš„ç»Ÿä¸€å¤„ç†ï¼Œé‡Œé¢æä¾›`Map`ç»“æ„çš„å„é¡¹æœåŠ¡æ¥å£è°ƒç”¨ï¼Œä¹Ÿå°±é¿å…äº†ä½¿ç”¨`if`åˆ¤æ–­å„é¡¹çŠ¶æ€è½¬å˜çš„æµç¨‹ã€‚

### 2. ä»£ç å®ç°

#### 2.1 å®šä¹‰çŠ¶æ€æŠ½è±¡ç±»

```java
public abstract class State {

    /**
     * æ´»åŠ¨æå®¡
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result arraignment(String activityId, Enum<Status> currentStatus);

    /**
     * å®¡æ ¸é€šè¿‡
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result checkPass(String activityId, Enum<Status> currentStatus);

    /**
     * å®¡æ ¸æ‹’ç»
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result checkRefuse(String activityId, Enum<Status> currentStatus);

    /**
     * æ’¤å®¡æ’¤é”€
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result checkRevoke(String activityId, Enum<Status> currentStatus);

    /**
     * æ´»åŠ¨å…³é—­
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result close(String activityId, Enum<Status> currentStatus);

    /**
     * æ´»åŠ¨å¼€å¯
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result open(String activityId, Enum<Status> currentStatus);

    /**
     * æ´»åŠ¨æ‰§è¡Œ
     *
     * @param activityId    æ´»åŠ¨ID
     * @param currentStatus å½“å‰çŠ¶æ€
     * @return æ‰§è¡Œç»“æœ
     */
    public abstract Result doing(String activityId, Enum<Status> currentStatus);

}
```

- åœ¨æ•´ä¸ªæ¥å£ä¸­æä¾›äº†å„é¡¹çŠ¶æ€æµè½¬æœåŠ¡çš„æ¥å£ï¼Œä¾‹å¦‚ï¼›æ´»åŠ¨æå®¡ã€å®¡æ ¸é€šè¿‡ã€å®¡æ ¸æ‹’ç»ã€æ’¤å®¡æ’¤é”€ç­‰7ä¸ªæ–¹æ³•ã€‚
- åœ¨è¿™äº›æ–¹æ³•ä¸­æ‰€æœ‰çš„å…¥å‚éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒactivityId(`æ´»åŠ¨ID`)ã€currentStatus(`å½“å‰çŠ¶æ€`)ï¼Œåªæœ‰ä»–ä»¬çš„å…·ä½“å®ç°æ˜¯ä¸åŒçš„ã€‚

#### 2.2 éƒ¨åˆ†çŠ¶æ€æµè½¬å®ç°

**ç¼–è¾‘**

```java
public class EditingState extends State {

    public Result arraignment(String activityId, Enum<Status> currentStatus) {
        ActivityService.execStatus(activityId, currentStatus, Status.Check);
        return new Result("0000", "æ´»åŠ¨æå®¡æˆåŠŸ");
    }

    public Result checkPass(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸é€šè¿‡");
    }

    public Result checkRefuse(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸æ‹’ç»");
    }

    @Override
    public Result checkRevoke(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "ç¼–è¾‘ä¸­ä¸å¯æ’¤é”€å®¡æ ¸");
    }

    public Result close(String activityId, Enum<Status> currentStatus) {
        ActivityService.execStatus(activityId, currentStatus, Status.Close);
        return new Result("0000", "æ´»åŠ¨å…³é—­æˆåŠŸ");
    }

    public Result open(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯");
    }

    public Result doing(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "ç¼–è¾‘ä¸­æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´");
    }

}
```

**æå®¡**

```java
public class CheckState extends State {

    public Result arraignment(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "å¾…å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤æå®¡");
    }

    public Result checkPass(String activityId, Enum<Status> currentStatus) {
        ActivityService.execStatus(activityId, currentStatus, Status.Pass);
        return new Result("0000", "æ´»åŠ¨å®¡æ ¸é€šè¿‡å®Œæˆ");
    }

    public Result checkRefuse(String activityId, Enum<Status> currentStatus) {
        ActivityService.execStatus(activityId, currentStatus, Status.Refuse);
        return new Result("0000", "æ´»åŠ¨å®¡æ ¸æ‹’ç»å®Œæˆ");
    }

    @Override
    public Result checkRevoke(String activityId, Enum<Status> currentStatus) {
        ActivityService.execStatus(activityId, currentStatus, Status.Editing);
        return new Result("0000", "æ´»åŠ¨å®¡æ ¸æ’¤é”€å›åˆ°ç¼–è¾‘ä¸­");
    }

    public Result close(String activityId, Enum<Status> currentStatus) {
        ActivityService.execStatus(activityId, currentStatus, Status.Close);
        return new Result("0000", "æ´»åŠ¨å®¡æ ¸å…³é—­å®Œæˆ");
    }

    public Result open(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯");
    }

    public Result doing(String activityId, Enum<Status> currentStatus) {
        return new Result("0001", "å¾…å®¡æ ¸æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´");
    }

}
```

- è¿™é‡Œæä¾›äº†ä¸¤ä¸ªå…·ä½“å®ç°ç±»çš„å†…å®¹ï¼Œç¼–è¾‘çŠ¶æ€å’Œæå®¡çŠ¶æ€ã€‚
- ä¾‹å¦‚åœ¨è¿™ä¸¤ä¸ªå®ç°ç±»ä¸­ï¼Œ`checkRefuse`è¿™ä¸ªæ–¹æ³•å¯¹äºä¸åŒçš„ç±»ä¸­æœ‰ä¸åŒçš„å®ç°ï¼Œä¹Ÿå°±æ˜¯ä¸åŒçŠ¶æ€ä¸‹èƒ½åšçš„ä¸‹ä¸€æ­¥æµè½¬æ“ä½œå·²ç»å¯ä»¥åœ¨æ¯ä¸€ä¸ªæ–¹æ³•ä¸­å…·ä½“æ§åˆ¶äº†ã€‚
- å…¶ä»–5ä¸ªç±»çš„æ“ä½œæ˜¯ç±»ä¼¼çš„å…·ä½“å°±ä¸åœ¨è¿™é‡Œæ¼”ç¤ºäº†ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯é‡å¤ä»£ç ã€‚å¯ä»¥é€šè¿‡æºç è¿›è¡Œå­¦ä¹ ç†è§£ã€‚ 

#### 2.3 çŠ¶æ€å¤„ç†æœåŠ¡

```java
public class StateHandler {

    private Map<Enum<Status>, State> stateMap = new ConcurrentHashMap<Enum<Status>, State>();

    public StateHandler() {
        stateMap.put(Status.Check, new CheckState());     // å¾…å®¡æ ¸
        stateMap.put(Status.Close, new CloseState());     // å·²å…³é—­
        stateMap.put(Status.Doing, new DoingState());     // æ´»åŠ¨ä¸­
        stateMap.put(Status.Editing, new EditingState()); // ç¼–è¾‘ä¸­
        stateMap.put(Status.Open, new OpenState());       // å·²å¼€å¯
        stateMap.put(Status.Pass, new PassState());       // å®¡æ ¸é€šè¿‡
        stateMap.put(Status.Refuse, new RefuseState());   // å®¡æ ¸æ‹’ç»
    }

    public Result arraignment(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).arraignment(activityId, currentStatus);
    }

    public Result checkPass(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).checkPass(activityId, currentStatus);
    }

    public Result checkRefuse(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).checkRefuse(activityId, currentStatus);
    }

    public Result checkRevoke(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).checkRevoke(activityId, currentStatus);
    }

    public Result close(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).close(activityId, currentStatus);
    }

    public Result open(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).open(activityId, currentStatus);
    }

    public Result doing(String activityId, Enum<Status> currentStatus) {
        return stateMap.get(currentStatus).doing(activityId, currentStatus);
    }
    
}
```

- è¿™æ˜¯å¯¹çŠ¶æ€æœåŠ¡çš„ç»Ÿä¸€æ§åˆ¶ä¸­å¿ƒï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ„é€ å‡½æ•°ä¸­æä¾›äº†æ‰€æœ‰çŠ¶æ€å’Œå®ç°çš„å…·ä½“å…³è”ï¼Œæ”¾åˆ°Mapæ•°æ®ç»“æ„ä¸­ã€‚
- åŒæ—¶æä¾›äº†ä¸åŒåç§°çš„æ¥å£æ“ä½œç±»ï¼Œè®©å¤–éƒ¨è°ƒç”¨æ–¹å¯ä»¥æ›´åŠ å®¹æ˜“çš„ä½¿ç”¨æ­¤é¡¹åŠŸèƒ½æ¥å£ï¼Œè€Œä¸éœ€è¦åƒåœ¨`itstack-demo-design-19-01`ä¾‹å­ä¸­è¿˜å¾—ä¼ ä¸¤ä¸ªçŠ¶æ€æ¥åˆ¤æ–­ã€‚

### 3. æµ‹è¯•éªŒè¯

#### 3.1 ç¼–å†™æµ‹è¯•ç±»(Editing2Arraignment)

```java
@Test
public void test_Editing2Arraignment() {
    String activityId = "100001";
    ActivityService.init(activityId, Status.Editing);
    StateHandler stateHandler = new StateHandler();
    Result result = stateHandler.arraignment(activityId, Status.Editing);
    logger.info("æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toæå®¡æ´»åŠ¨)ï¼š{}", JSON.toJSONString(result));
    logger.info("æ´»åŠ¨ä¿¡æ¯ï¼š{} çŠ¶æ€ï¼š{}", JSON.toJSONString(ActivityService.queryActivityInfo(activityId)), JSON.toJSONString(ActivityService.queryActivityInfo(activityId).getStatus()));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:59:20.883 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toæå®¡æ´»åŠ¨)ï¼š{"code":"0000","info":"æ´»åŠ¨æå®¡æˆåŠŸ"}
23:59:20.907 [main] INFO  org.itstack.demo.design.test.ApiTest - æ´»åŠ¨ä¿¡æ¯ï¼š{"activityId":"100001","activityName":"æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨","beginTime":1593694760892,"endTime":1593694760892,"status":"Check"} çŠ¶æ€ï¼š"Check"

Process finished with exit code 0
```

- æµ‹è¯•ç¼–è¾‘ä¸­Toæå®¡æ´»åŠ¨ï¼Œçš„çŠ¶æ€æµè½¬ã€‚

#### 3.2 ç¼–å†™æµ‹è¯•ç±»(Editing2Open)

```java
@Test
public void test_Editing2Open() {
    String activityId = "100001";
    ActivityService.init(activityId, Status.Editing);
    StateHandler stateHandler = new StateHandler();
    Result result = stateHandler.open(activityId, Status.Editing);
    logger.info("æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toå¼€å¯æ´»åŠ¨)ï¼š{}", JSON.toJSONString(result));
    logger.info("æ´»åŠ¨ä¿¡æ¯ï¼š{} çŠ¶æ€ï¼š{}", JSON.toJSONString(ActivityService.queryActivityInfo(activityId)), JSON.toJSONString(ActivityService.queryActivityInfo(activityId).getStatus()));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:59:36.904 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toå¼€å¯æ´»åŠ¨)ï¼š{"code":"0001","info":"éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯"}
23:59:36.914 [main] INFO  org.itstack.demo.design.test.ApiTest - æ´»åŠ¨ä¿¡æ¯ï¼š{"activityId":"100001","activityName":"æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨","beginTime":1593694776907,"endTime":1593694776907,"status":"Editing"} çŠ¶æ€ï¼š"Editing"

Process finished with exit code 0
```

- æµ‹è¯•ç¼–è¾‘ä¸­Toå¼€å¯æ´»åŠ¨ï¼Œçš„çŠ¶æ€æµè½¬ã€‚

#### 3.3 ç¼–å†™æµ‹è¯•ç±»(Refuse2Doing)

```java
@Test
public void test_Refuse2Doing() {
    String activityId = "100001";
    ActivityService.init(activityId, Status.Refuse);
    StateHandler stateHandler = new StateHandler();
    Result result = stateHandler.doing(activityId, Status.Refuse);
    logger.info("æµ‹è¯•ç»“æœ(æ‹’ç»Toæ´»åŠ¨ä¸­)ï¼š{}", JSON.toJSONString(result));
    logger.info("æ´»åŠ¨ä¿¡æ¯ï¼š{} çŠ¶æ€ï¼š{}", JSON.toJSONString(ActivityService.queryActivityInfo(activityId)), JSON.toJSONString(ActivityService.queryActivityInfo(activityId).getStatus()));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:59:46.339 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœ(æ‹’ç»Toæ´»åŠ¨ä¸­)ï¼š{"code":"0001","info":"å®¡æ ¸æ‹’ç»ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸ºè¿›è¡Œä¸­"}
23:59:46.352 [main] INFO  org.itstack.demo.design.test.ApiTest - æ´»åŠ¨ä¿¡æ¯ï¼š{"activityId":"100001","activityName":"æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨","beginTime":1593694786342,"endTime":1593694786342,"status":"Refuse"} çŠ¶æ€ï¼š"Refuse"

Process finished with exit code 0
```

- æµ‹è¯•æ‹’ç»Toæ´»åŠ¨ä¸­ï¼Œçš„çŠ¶æ€æµè½¬ã€‚

#### 3.4 ç¼–å†™æµ‹è¯•ç±»(Refuse2Revoke)

```java
@Test
public void test_Refuse2Revoke() {
    String activityId = "100001";
    ActivityService.init(activityId, Status.Refuse);
    StateHandler stateHandler = new StateHandler();
    Result result = stateHandler.checkRevoke(activityId, Status.Refuse);
    logger.info("æµ‹è¯•ç»“æœ(æ‹’ç»Toæ’¤å®¡)ï¼š{}", JSON.toJSONString(result));
    logger.info("æ´»åŠ¨ä¿¡æ¯ï¼š{} çŠ¶æ€ï¼š{}", JSON.toJSONString(ActivityService.queryActivityInfo(activityId)), JSON.toJSONString(ActivityService.queryActivityInfo(activityId).getStatus()));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:59:50.197 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœ(æ‹’ç»Toæ’¤å®¡)ï¼š{"code":"0000","info":"æ’¤é”€å®¡æ ¸å®Œæˆ"}
23:59:50.208 [main] INFO  org.itstack.demo.design.test.ApiTest - æ´»åŠ¨ä¿¡æ¯ï¼š{"activityId":"100001","activityName":"æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨","beginTime":1593694810201,"endTime":1593694810201,"status":"Editing"} çŠ¶æ€ï¼š"Editing"

Process finished with exit code 0
```

- æµ‹è¯•æµ‹è¯•ç»“æœ(æ‹’ç»Toæ’¤å®¡)ï¼Œçš„çŠ¶æ€æµè½¬ã€‚

- **ç»¼ä¸Š**ä»¥ä¸Šå››ä¸ªæµ‹è¯•ç±»åˆ†åˆ«æ¨¡æ‹Ÿäº†ä¸åŒçŠ¶æ€ä¹‹é—´çš„`æœ‰æ•ˆæµè½¬`å’Œ`æ‹’ç»æµè½¬`ï¼Œä¸åŒçš„çŠ¶æ€æœåŠ¡å¤„ç†ä¸åŒçš„æœåŠ¡å†…å®¹ã€‚

## ä¸ƒã€æ€»ç»“

- ä»ä»¥ä¸Šçš„ä¸¤ç§æ–¹å¼å¯¹ä¸€ä¸ªéœ€æ±‚çš„å®ç°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¬¬äºŒç§ä½¿ç”¨è®¾è®¡æ¨¡å¼å¤„ç†åå·²ç»æ²¡æœ‰äº†`ifelse`ï¼Œä»£ç çš„ç»“æ„ä¹Ÿæ›´åŠ æ¸…æ™°æ˜“äºæ‰©å±•ã€‚è¿™å°±æ˜¯è®¾è®¡æ¨¡å¼çš„å¥½å¤„ï¼Œå¯ä»¥éå¸¸å¼ºå¤§çš„æ”¹å˜åŸæœ‰ä»£ç çš„ç»“æ„ï¼Œè®©ä»¥åçš„æ‰©å±•å’Œç»´æŠ¤éƒ½å˜å¾—å®¹æ˜“äº›ã€‚
- åœ¨å®ç°ç»“æ„çš„ç¼–ç æ–¹å¼ä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸å†æ˜¯é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹ï¼Œè€Œæ˜¯é¢å‘å¯¹è±¡çš„ç»“æ„ã€‚å¹¶ä¸”è¿™æ ·çš„è®¾è®¡æ¨¡å¼æ»¡è¶³äº†`å•ä¸€èŒè´£`å’Œ`å¼€é—­åŸåˆ™`ï¼Œå½“ä½ åªæœ‰æ»¡è¶³è¿™æ ·çš„ç»“æ„ä¸‹æ‰ä¼šå‘ç°ä»£ç çš„æ‰©å±•æ˜¯å®¹æ˜“çš„ï¼Œä¹Ÿå°±æ˜¯å¢åŠ å’Œä¿®æ”¹åŠŸèƒ½ä¸ä¼šå½±å“æ•´ä½“çš„å˜åŒ–ã€‚
- ä½†å¦‚æœçŠ¶æ€å’Œå„é¡¹æµè½¬è¾ƒå¤šåƒæœ¬æ–‡çš„æ¡ˆä¾‹ä¸­ï¼Œå°±ä¼šäº§ç”Ÿè¾ƒå¤šçš„å®ç°ç±»ã€‚å› æ­¤å¯èƒ½ä¹Ÿä¼šè®©ä»£ç çš„å®ç°ä¸Šå¸¦æ¥äº†æ—¶é—´æˆæœ¬ï¼Œå› ä¸ºå¦‚æœé‡åˆ°è¿™æ ·çš„åœºæ™¯å¯ä»¥æŒ‰éœ€è¯„ä¼°æŠ•å…¥å›æŠ¥ç‡ã€‚ä¸»è¦ç‚¹åœ¨äºçœ‹æ˜¯å¦ç»å¸¸ä¿®æ”¹ã€æ˜¯å¦å¯ä»¥åšæˆç»„ä»¶åŒ–ã€æŠ½ç¦»ä¸šåŠ¡ä¸éä¸šåŠ¡åŠŸèƒ½ã€‚

