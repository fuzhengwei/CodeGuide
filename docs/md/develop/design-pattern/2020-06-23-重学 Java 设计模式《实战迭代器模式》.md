---
layout: post
category: itstack-demo-design
title: é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜è¿­ä»£å™¨æ¨¡å¼ã€Œæ¨¡æ‹Ÿå…¬å¸ç»„ç»‡æ¶æ„æ ‘ç»“æ„å…³ç³»ï¼Œæ·±åº¦è¿­ä»£éå†äººå‘˜ä¿¡æ¯è¾“å‡ºåœºæ™¯ã€
tagline: by å°å‚…å“¥
tag: [itstack-demo-design]
excerpt: æ—¶é—´ç´§æ˜¯å†™åƒåœ¾ä»£ç çš„ç†ç”±ï¼Ÿæ‹§èºä¸ï¼ŸCtrl+Cã€Ctrl+Vï¼Ÿè´´è†è¯ä¸€æ ·å†™ä»£ç ï¼Ÿæ²¡æœ‰åŠæ³•ï¼Œæ²¡æœ‰æ—¶é—´ï¼Œå¾€å¾€çœŸçš„æ˜¯å€Ÿå£ï¼Œèƒ¸ä¸­æ²¡ç”¨ç¬”å¢¨ï¼Œæ‰åªèƒ½å‡‘åˆã€‚éŸ©ä¿¡ç‚¹å…µï¼Œå¤šå¤šç›Šå–„ï¼Œæ²¡æœ‰å“ªæ¬¡æ‰“ä»—æ˜¯ä¸€è‚¡è„‘çš„å†²ï¼Œéƒ½æ˜¯æœ‰è°‹æœ‰ç•¥çš„æˆ˜äº‰ã€‚
lock: need
---

# é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜è¿­ä»£å™¨æ¨¡å¼ã€Œæ¨¡æ‹Ÿå…¬å¸ç»„ç»‡æ¶æ„æ ‘ç»“æ„å…³ç³»ï¼Œæ·±åº¦è¿­ä»£éå†äººå‘˜ä¿¡æ¯è¾“å‡ºåœºæ™¯ã€

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=298698924&bvid=BV1hF411T71U&cid=710671759&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`ç›¸ä¿¡ç›¸ä¿¡çš„åŠ›é‡ï¼`

ä»æ‡µæ‡‚çš„å°‘å¹´ï¼Œåˆ°æ‹¿èµ·é”®ç›˜ï¼Œå¯ä»¥å†™ä¸€ä¸ªHelloWorldã€‚å¤šæ•°äººåœ¨è¿™å¹¶ä¸ä¼šæ„Ÿè§‰æœ‰å¤šéš¾ï¼Œä¹Ÿä¸ä¼šè®¤ä¸ºåšä¸å‡ºæ¥ã€‚å› ä¸ºè¿™æ ·çš„ä¾‹å­ï¼Œæœ‰è€å¸ˆçš„æŒ‡å¯¼ã€æœ‰ä¹¦æœ¬çš„ä¾‹å­ã€æœ‰å‰äººçš„ç»éªŒã€‚ä½†éšç€ä½ çš„å¼€å‘æ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œè¦è§£å†³æ›´å¤æ‚çš„é—®é¢˜æˆ–è€…æŠ€æœ¯åˆ›æ–°ï¼Œå› æ­¤åœ¨ç½‘ä¸Šæœäº†å‡ å¤©å‡ å¤œéƒ½æ²¡æœ‰ç­”æ¡ˆï¼Œè¿™ä¸ªæ—¶å€™æ˜¯å¦æƒ³è¿‡æ”¾å¼ƒï¼Œè¿˜æ˜¯ä¸€ç›´åšæŒä¸æ–­çš„å°è¯•ä¸€ç‚¹ç‚¹å®Œæˆè‡ªå·±å¿ƒé‡Œè¦çš„ç»“æœã€‚å¾€å¾€è¿™ç§æ²¡æœ‰å‰è½¦ä¹‹é‰´éœ€è¦è‡ªå·±è§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œå¯èƒ½çœŸçš„ä¼šæŠ˜ç£¨åˆ°è¦å´©æºƒï¼Œä½†ä½ è¦æ„¿æ„æ‰§ç€ã€æ„¿æ„å€”å¼ºï¼Œæ„¿æ„é€‰æ‹©ç›¸ä¿¡ç›¸ä¿¡çš„åŠ›é‡ï¼Œå°±ä¸€å®šèƒ½è§£å†³ã€‚å“ªæ€•è§£å†³ä¸äº†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™æ¡è·¯ä¸Šæ‘¸ç´¢å‡ºå…¶ä»–æ›´å¤šçš„æ”¶è·ï¼Œä¸ºåç»­å‰è¿›çš„é“è·¯å¡«å……å¥½å«è„šçŸ³ã€‚

`æ—¶é—´ç´§æ˜¯å†™åƒåœ¾ä»£ç çš„ç†ç”±ï¼Ÿ`

æ‹§èºä¸ï¼ŸCtrl+Cã€Ctrl+Vï¼Ÿè´´è†è¯ä¸€æ ·å†™ä»£ç ï¼Ÿæ²¡æœ‰åŠæ³•ï¼Œæ²¡æœ‰æ—¶é—´ï¼Œå¾€å¾€çœŸçš„æ˜¯å€Ÿå£ï¼Œèƒ¸ä¸­æ²¡æœ‰ç¬”å¢¨ï¼Œæ‰åªèƒ½å‡‘åˆã€‚éš¾é“ä¸€å®šæ˜¯å¥½å¥½å†™ä»£ç å°±æµªè´¹æ—¶é—´ï¼Œæ‹¼å‡‘CRUDå°±å¿«å—ï¼Œæ ¹æœ¬ä¸å¯èƒ½çš„ã€‚å› ä¸ºä¸ä¼šï¼Œæ²¡æœ‰å®æ“è¿‡ï¼Œå¾ˆå°‘æ¶æ„å‡ºå…¨åœºæ™¯çš„è®¾è®¡ï¼Œæ‰å¾ˆéš¾å†™å‡ºä¼˜è‰¯çš„ä»£ç ã€‚å¤šå¢å¼ºè‡ªèº«çš„ç¼–ç (`æ­¦æœ¯`)ä¿®ä¸ºï¼Œåœ¨å„ç§ç¼–ç åœºæ™¯ä¸­è®©è‡ªå·±å˜å¾—è€ç»ƒï¼Œæ‰å¥½åº”å¯¹ç´§æ€¥æƒ…å†µä¸‹çš„éœ€æ±‚å¼€å‘å’Œäººå‘˜å®‰æ’ã€‚å°±åƒéŸ©ä¿¡ä¸€æ ·æœ‰è°‹æœ‰ç•¥ï¼Œæ‰èƒ½æ‰§æŒç™¾ä¸‡é›„å…µã€‚

`ä¸è¦åªæ˜¯åšä¸ªå·¥å…·äººï¼`

å› ä¸ºæ—¥å¸¸çš„ç¼–å†™ç®€å•ä¸šåŠ¡éœ€æ±‚ï¼Œå¯¼è‡´è‡ªå·±åƒä¸ªå·¥å…·äººä¸€æ ·ï¼Œæ—¥ä¹…å¤©é•¿çš„ä¹Ÿå°±å¾ˆå°‘å»æ·±å…¥å­¦ä¹ æ›´å¤šæŠ€æœ¯æ ˆã€‚çœ‹è§æœ‰å·¥å…·ã€æœ‰ç»„ä»¶ã€æœ‰æ¡†æ¶ï¼Œæ‹¿æ¥å°±ç”¨ç”¨ï¼Œåæ­£æ²¡ä»€ä¹ˆä½“é‡ä¹Ÿä¸ä¼šå‡ºä»€ä¹ˆé—®é¢˜ã€‚ä½†å¦‚æœä½ æƒ³è¦æ›´å¤šçš„æ”¶å…¥ï¼Œå“ªæ€•æ˜¯é‡å¤çš„é€ è½®å­ï¼Œä½ ä¹Ÿè¦å»å°è¯•é€ ä¸€ä¸ªï¼Œå°±ç®—ä¸ç”¨åˆ°ç”Ÿäº§ï¼Œè‡ªå·±ç©ç©æ€»å¯ä»¥å§ã€‚æœ‰äº›äº‹æƒ…åªæœ‰è‡ªå·±ç»å†è¿‡ï¼Œæ‰èƒ½æœ‰æœ€æ·±çš„æ„Ÿè§¦ï¼Œå‚ä¸è¿‡å®è·µè¿‡ï¼Œæ‰å¥½æ€»ç»“ç‚¹è¯„å­¦ä¹ ã€‚

## äºŒã€å¼€å‘ç¯å¢ƒ

1. JDK 1.8
2. Idea + Maven
3. æ¶‰åŠå·¥ç¨‹ä¸€ä¸ªï¼Œå¯ä»¥é€šè¿‡å…³æ³¨**å…¬ä¼—å·**ï¼š[`bugstackè™«æ´æ ˆ`](https://bugstack.cn/assets/images/qrcode.png)ï¼Œå›å¤`æºç ä¸‹è½½`è·å–(æ‰“å¼€è·å–çš„é“¾æ¥ï¼Œæ‰¾åˆ°åºå·18)

| å·¥ç¨‹                     | æè¿°                                         |
| ------------------------ | --------------------------------- |
| itstack-demo-design-15-00 | å¼€å‘æ ‘å½¢ç»„ç»‡æ¶æ„å…³ç³»è¿­ä»£å™¨ |

## ä¸‰ã€è¿­ä»£å™¨æ¨¡å¼ä»‹ç»

![è¿­ä»£å™¨æ¨¡å¼ï¼Œå›¾ç‰‡æ¥è‡ª refactoringguru.cn](https://bugstack.cn/assets/images/2020/itstack-demo-design-15-01.png)

- å›¾ç‰‡æ¥è‡ªï¼š[https://refactoringguru.cn/design-patterns/iterator](https://refactoringguru.cn/design-patterns/iterator)

è¿­ä»£å™¨æ¨¡å¼ï¼Œå¸¸è§çš„å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„`iterator`éå†ã€‚è™½ç„¶è¿™ä¸ªè®¾è®¡æ¨¡å¼åœ¨æˆ‘ä»¬çš„å®é™…ä¸šåŠ¡å¼€å‘ä¸­çš„åœºæ™¯å¹¶ä¸å¤šï¼Œä½†å´å‡ ä¹æ¯å¤©éƒ½è¦ä½¿ç”¨`jdk`ä¸ºæˆ‘ä»¬æä¾›çš„`list`é›†åˆéå†ã€‚å¦å¤–å¢å¼ºçš„forå¾ªç¯è™½ç„¶æ˜¯å¾ªç¯è¾“å‡ºæ•°æ®ï¼Œä½†æ˜¯å®ƒä¸æ˜¯è¿­ä»£å™¨æ¨¡å¼ã€‚è¿­ä»£å™¨æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯å®ç°`Iterable`æ¥å£ï¼Œé€šè¿‡`next`çš„æ–¹å¼è·å–é›†åˆå…ƒç´ ï¼ŒåŒæ—¶å…·å¤‡å¯¹å…ƒç´ çš„åˆ é™¤ç­‰æ“ä½œã€‚è€Œå¢å¼ºçš„forå¾ªç¯æ˜¯ä¸å¯ä»¥çš„ã€‚

è¿™ç§è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è®©æˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œéå†ä¸åŒçš„æ•°æ®ç»“æ„å…ƒç´ ï¼Œè¿™äº›æ•°æ®ç»“æ„åŒ…æ‹¬ï¼š`æ•°ç»„`ã€`é“¾è¡¨`ã€`æ ‘`ç­‰ï¼Œè€Œç”¨æˆ·åœ¨ä½¿ç”¨éå†çš„æ—¶å€™å¹¶ä¸éœ€è¦å»å…³å¿ƒæ¯ä¸€ç§æ•°æ®ç»“æ„çš„éå†å¤„ç†é€»è¾‘ï¼Œä»è®©ä½¿ç”¨å˜å¾—ç»Ÿä¸€æ˜“ç”¨ã€‚

## å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

![åœºæ™¯æ¨¡æ‹Ÿï¼šå…¬å¸æ ‘å½¢ç»„ç»‡æ¶æ„](https://bugstack.cn/assets/images/2020/itstack-demo-design-15-02.png)

**åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿè¿­ä»£éå†è¾“å‡ºå…¬å¸ä¸­æ ‘å½¢ç»“æ„çš„ç»„ç»‡æ¶æ„å…³ç³»ä¸­é›‡å‘˜åˆ—è¡¨**

å¤§éƒ¨åˆ†å…¬å¸çš„ç»„ç»‡æ¶æ„éƒ½æ˜¯é‡‘å­—å¡”ç»“æ„ï¼Œä¹Ÿå°±è¿™ç§æ ‘å½¢ç»“æ„ï¼Œåˆ†ä¸ºä¸€çº§ã€äºŒçº§ã€ä¸‰çº§ç­‰éƒ¨é—¨ï¼Œæ¯ä¸ªç»„ç»‡éƒ¨é—¨ç”±é›‡å‘˜å¡«å……ï¼Œæœ€ç»ˆä½“ç°å‡ºä¸€ä¸ªæ•´ä½“çš„æ ‘å½¢ç»„ç»‡æ¶æ„å…³ç³»ã€‚

ä¸€èˆ¬æˆ‘ä»¬å¸¸ç”¨çš„éå†å°±æ˜¯jdké»˜è®¤æä¾›çš„æ–¹æ³•ï¼Œå¯¹listé›†åˆéå†ã€‚ä½†æ˜¯å¯¹äºè¿™æ ·çš„åä¸šåŠ¡ç‰¹æ€§è¾ƒå¤§çš„æ ‘å½¢ç»“æ„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åˆ°éå†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‡ªå·±æ¥å®ç°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªç»„ç»‡å±‚æ¬¡å…³ç³»é€šè¿‡æ ‘å½¢æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å®Œæˆè¿­ä»£å™¨åŠŸèƒ½ã€‚

## äº”ã€è¿­ä»£å™¨æ¨¡å¼éå†ç»„ç»‡ç»“æ„

åœ¨å®ç°è¿­ä»£å™¨æ¨¡å¼ä¹‹å‰å¯ä»¥å…ˆé˜…è¯»ä¸‹`java`ä¸­`list`æ–¹æ³•å…³äº`iterator`çš„å®ç°éƒ¨åˆ†ï¼Œå‡ ä¹æ‰€æœ‰çš„è¿­ä»£å™¨å¼€å‘éƒ½ä¼šæŒ‰ç…§è¿™ä¸ªæ¨¡å¼æ¥å®ç°ï¼Œè¿™ä¸ªæ¨¡å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ å—ï¼š
1. Collectionï¼Œé›†åˆæ–¹æ³•éƒ¨åˆ†ç”¨äºå¯¹è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„æ·»åŠ é€šç”¨æ–¹æ³•ï¼š`add`ã€`remove`ã€`iterator`ç­‰æ ¸å¿ƒæ–¹æ³•ã€‚
2. Iterableï¼Œæä¾›è·å–è¿­ä»£å™¨ï¼Œè¿™ä¸ªæ¥å£ç±»ä¼šè¢«`Collection`ç»§æ‰¿ã€‚
3. Iteratorï¼Œæä¾›äº†ä¸¤ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼š`hasNext`ã€`next`ï¼Œä¼šåœ¨å…·ä½“çš„æ•°æ®ç»“æ„ä¸­å†™å®ç°æ–¹å¼ã€‚

é™¤äº†è¿™æ ·é€šç”¨çš„è¿­ä»£å™¨å®ç°æ–¹å¼å¤–ï¼Œæˆ‘ä»¬çš„ç»„ç»‡å…³ç³»ç»“æ„æ ‘ï¼Œæ˜¯ç”±èŠ‚ç‚¹å’ŒèŠ‚ç‚¹é—´çš„å…³ç³»é“¾æ„æˆï¼Œæ‰€ä»¥ä¼šæ¯”ä¸Šè¿°çš„å†…å®¹å¤šä¸€äº›å…¥å‚ã€‚

### 1. å·¥ç¨‹ç»“æ„ 

```java
itstack-demo-design-15-00
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org.itstack.demo.design
    â”‚           â”œâ”€â”€ group
    â”‚           â”‚	â”œâ”€â”€ Employee.java
    â”‚           â”‚	â”œâ”€â”€ GroupStructure.java
    â”‚           â”‚	â””â”€â”€ Link.java
    â”‚           â””â”€â”€  lang
    â”‚            	â”œâ”€â”€ Collection.java
    â”‚            	â”œâ”€â”€ Iterable.java
    â”‚            	â””â”€â”€ Iterator.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design.test
                â””â”€â”€ ApiTest.java
```

**è¿­ä»£å™¨æ¨¡å¼æ¨¡å‹ç»“æ„**  

![è¿­ä»£å™¨æ¨¡å¼æ¨¡å‹ç»“æ„](https://bugstack.cn/assets/images/2020/itstack-demo-design-15-03.png)

- ä»¥ä¸Šæ˜¯æˆ‘ä»¬å·¥ç¨‹ç±»å›¾çš„æ¨¡å‹ç»“æ„ï¼Œå·¦ä¾§æ˜¯å¯¹è¿­ä»£å™¨çš„å®šä¹‰ï¼Œå³ä¾§æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­å®ç°è¿­ä»£å™¨åŠŸèƒ½ã€‚
- å…³äºå·¦ä¾§éƒ¨åˆ†çš„å®ç°ä¸jdkä¸­çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯ä»¥äº’ç›¸å‚è€ƒï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ‰©å±•å­¦ä¹ ã€‚
- å¦å¤–è¿™ä¸ªéå†æ–¹å¼ä¸€ä¸ªæ ‘å½¢ç»“æ„çš„æ·±åº¦éå†ï¼Œä¸ºäº†å¯ä»¥æ›´åŠ è®©å­¦ä¹ çš„å°ä¼™ä¼´å®¹æ˜“ç†è§£ï¼Œè¿™é‡Œæˆ‘å®ç°äº†ä¸€ç§æ¯”è¾ƒç®€å•çš„æ ‘å½¢ç»“æ„æ·±åº¦éå†æ–¹å¼ã€‚*åç»­è¯»è€…ä¹Ÿå¯ä»¥æŠŠéå†æ‰©å±•ä¸ºæ¨ªå‘éå†ä¹Ÿå°±æ˜¯å®½åº¦éå†ã€‚*

### 2. ä»£ç å®ç°

#### 2.1 é›‡å‘˜å®ä½“ç±»

```java
/**
 * é›‡å‘˜
 */
public class Employee {

    private String uId;   // ID
    private String name;  // å§“å
    private String desc;  // å¤‡æ³¨
    
    // ...get/set
}
```

- è¿™æ˜¯ä¸€ä¸ªç®€å•çš„é›‡å‘˜ç±»ï¼Œä¹Ÿå°±æ˜¯å…¬å¸å‘˜å·¥çš„ä¿¡æ¯ç±»ï¼ŒåŒ…æ‹¬å¿…è¦çš„ä¿¡æ¯ï¼šidã€å§“åã€å¤‡æ³¨ã€‚

#### 2.2 æ ‘èŠ‚ç‚¹é“¾è·¯

```java
/**
 * æ ‘èŠ‚ç‚¹é“¾è·¯
 */
public class Link {

    private String fromId; // é›‡å‘˜ID
    private String toId;   // é›‡å‘˜ID    
    
    // ...get/set
}
```

- è¿™ä¸ªç±»ç”¨äºæè¿°ç»“æ„æ ‘ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»é“¾ï¼Œä¹Ÿå°±æ˜¯`A to B`ã€`B to C`ã€`B to D`ï¼Œä»¥æ­¤æè¿°å‡ºä¸€å¥—å®Œæ•´çš„æ ‘ç»„ç»‡ç»“æ„ã€‚

#### 2.3 è¿­ä»£å™¨å®šä¹‰

```java
public interface Iterator<E> {

    boolean hasNext();

    E next();
    
}
```

- è¿™é‡Œçš„è¿™ä¸ªç±»å’Œ`java`çš„`jdk`ä¸­æä¾›çš„æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·ä¹Ÿæ–¹é¢åç»­è¯»è€…å¯ä»¥å¯¹ç…§`list`çš„`Iterator`è¿›è¡Œæºç å­¦ä¹ ã€‚
- æ–¹æ³•æè¿°ï¼š`hasNext`ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ã€`next`ï¼Œè·å–ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸ªåœ¨`list`çš„éå†ä¸­æ˜¯ç»å¸¸ç”¨åˆ°çš„ã€‚

#### 2.4 å¯è¿­ä»£æ¥å£å®šä¹‰

```java
public interface Iterable<E> {

    Iterator<E> iterator();

}
```

- è¿™ä¸ªæ¥å£ä¸­æä¾›äº†ä¸Šé¢è¿­ä»£å™¨çš„å®ç°`Iterator`çš„è·å–ï¼Œä¹Ÿå°±æ˜¯åç»­åœ¨è‡ªå·±çš„æ•°æ®ç»“æ„ä¸­éœ€è¦å®ç°è¿­ä»£å™¨çš„åŠŸèƒ½å¹¶äº¤ç»™`Iterable`ï¼Œç”±æ­¤è®©å¤–éƒ¨è°ƒç”¨æ–¹è¿›è¡Œè·å–ä½¿ç”¨ã€‚

#### 2.5 é›†åˆåŠŸèƒ½æ¥å£å®šä¹‰

```java
public interface Collection<E, L> extends Iterable<E> {

    boolean add(E e);

    boolean remove(E e);

    boolean addLink(String key, L l);

    boolean removeLink(String key);

    Iterator<E> iterator();

}
```

- è¿™é‡Œæˆ‘ä»¬å®šä¹‰é›†åˆæ“ä½œæ¥å£ï¼š`Collection`ï¼ŒåŒæ—¶ç»§æ‰¿äº†å¦å¤–ä¸€ä¸ªæ¥å£`Iterable`çš„æ–¹æ³•`iterator()`ã€‚è¿™æ ·åç»­è°æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå°±éœ€è¦å®ç°ä¸Šè¿°å®šä¹‰çš„ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼š`æ·»åŠ å…ƒç´ `ã€`åˆ é™¤å…ƒç´ `ã€`éå†`ã€‚
- åŒæ—¶ä½ å¯èƒ½æ³¨æ„åˆ°è¿™é‡Œå®šä¹‰äº†ä¸¤ä¸ªæ³›å‹`<E, L>`ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ç»“æ„ä¸€ä¸ªæ˜¯ç”¨äºæ·»åŠ å…ƒç´ ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç”¨äºæ·»åŠ æ ‘èŠ‚ç‚¹çš„é“¾è·¯å…³ç³»ã€‚

#### 2.6 (æ ¸å¿ƒ)è¿­ä»£å™¨åŠŸèƒ½å®ç°

```java
public class GroupStructure implements Collection<Employee, Link> {

    private String groupId;                                                 // ç»„ç»‡IDï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»„ç»‡é“¾çš„å¤´éƒ¨ID
    private String groupName;                                               // ç»„ç»‡åç§°
    private Map<String, Employee> employeeMap = new ConcurrentHashMap<String, Employee>();  // é›‡å‘˜åˆ—è¡¨
    private Map<String, List<Link>> linkMap = new ConcurrentHashMap<String, List<Link>>();  // ç»„ç»‡æ¶æ„å…³ç³»ï¼šid->list
    private Map<String, String> invertedMap = new ConcurrentHashMap<String, String>();       // åå‘å…³ç³»é“¾

    public GroupStructure(String groupId, String groupName) {
        this.groupId = groupId;
        this.groupName = groupName;
    }

    public boolean add(Employee employee) {
        return null != employeeMap.put(employee.getuId(), employee);
    }

    public boolean remove(Employee o) {
        return null != employeeMap.remove(o.getuId());
    }

    public boolean addLink(String key, Link link) {
        invertedMap.put(link.getToId(), link.getFromId());
        if (linkMap.containsKey(key)) {
            return linkMap.get(key).add(link);
        } else {
            List<Link> links = new LinkedList<Link>();
            links.add(link);
            linkMap.put(key, links);
            return true;
        }
    }

    public boolean removeLink(String key) {
        return null != linkMap.remove(key);
    }

    public Iterator<Employee> iterator() {

        return new Iterator<Employee>() {

            HashMap<String, Integer> keyMap = new HashMap<String, Integer>();

            int totalIdx = 0;
            private String fromId = groupId;  // é›‡å‘˜IDï¼ŒFrom
            private String toId = groupId;   // é›‡å‘˜IDï¼ŒTo

            public boolean hasNext() {
                return totalIdx < employeeMap.size();
            }

            public Employee next() {
                List<Link> links = linkMap.get(toId);
                int cursorIdx = getCursorIdx(toId);

                // åŒçº§èŠ‚ç‚¹æ‰«æ
                if (null == links) {
                    cursorIdx = getCursorIdx(fromId);
                    links = linkMap.get(fromId);
                }

                // ä¸Šçº§èŠ‚ç‚¹æ‰«æ
                while (cursorIdx > links.size() - 1) {
                    fromId = invertedMap.get(fromId);
                    cursorIdx = getCursorIdx(fromId);
                    links = linkMap.get(fromId);
                }

                // è·å–èŠ‚ç‚¹
                Link link = links.get(cursorIdx);
                toId = link.getToId();
                fromId = link.getFromId();
                totalIdx++;

                // è¿”å›ç»“æœ
                return employeeMap.get(link.getToId());
            }
             
            // ç»™æ¯ä¸ªå±‚çº§å®šä¹‰å®½åº¦éå†è¿›åº¦
            public int getCursorIdx(String key) {
                int idx = 0;
                if (keyMap.containsKey(key)) {
                    idx = keyMap.get(key);
                    keyMap.put(key, ++idx);
                } else {
                    keyMap.put(key, idx);
                }
                return idx;
            }
        };
    }

}
```

- ä»¥ä¸Šçš„è¿™éƒ¨åˆ†ä»£ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œä¸»è¦åŒ…æ‹¬äº†å¯¹å…ƒç´ çš„æ·»åŠ å’Œåˆ é™¤ã€‚å¦å¤–æœ€é‡è¦çš„æ˜¯å¯¹éå†çš„å®ç°` new Iterator<Employee>`ã€‚
- æ·»åŠ å’Œåˆ é™¤å…ƒç´ ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªmapæ•°ç»„ç»“æ„è¿›è¡Œå®šä¹‰ï¼š`é›‡å‘˜åˆ—è¡¨`ã€`ç»„ç»‡æ¶æ„å…³ç³»ï¼šid->list`ã€‚å½“å…ƒç´ æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¼šåˆ†åˆ«åœ¨ä¸åŒçš„æ–¹æ³•ä¸­å‘`map`ç»“æ„ä¸­è¿›è¡Œå¡«å……**æŒ‡å‘å…³ç³»(A->B)**ï¼Œä¹Ÿå°±æ„å»ºå‡ºäº†æˆ‘ä»¬çš„æ ‘å½¢ç»„ç»‡å…³ç³»ã€‚

**è¿­ä»£å™¨å®ç°æ€è·¯**

1. è¿™é‡Œçš„æ ‘å½¢ç»“æ„æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æ·±åº¦éå†ï¼Œä¹Ÿå°±æ˜¯å·¦ä¾§çš„ä¸€ç›´éå†åˆ°æœ€æ·±èŠ‚ç‚¹ã€‚
2. å½“éå†åˆ°æœ€æ·±èŠ‚ç‚¹åï¼Œå¼€å§‹éå†æœ€æ·±èŠ‚ç‚¹çš„æ¨ªå‘èŠ‚ç‚¹ã€‚
3. å½“æ¨ªå‘èŠ‚ç‚¹éå†å®Œæˆååˆ™å‘ä¸Šå¯»æ‰¾æ¨ªå‘èŠ‚ç‚¹ï¼Œç›´è‡³æ ‘ç»“æ„å…¨éƒ¨éå†å®Œæˆã€‚

### 3. æµ‹è¯•éªŒè¯

#### 3.1 ç¼–å†™æµ‹è¯•ç±»

```java
@Test
public void test_iterator() { 
    // æ•°æ®å¡«å……
    GroupStructure groupStructure = new GroupStructure("1", "å°å‚…å“¥");  
    
    // é›‡å‘˜ä¿¡æ¯
    groupStructure.add(new Employee("2", "èŠ±èŠ±", "äºŒçº§éƒ¨é—¨"));
    groupStructure.add(new Employee("3", "è±†åŒ…", "äºŒçº§éƒ¨é—¨"));
    groupStructure.add(new Employee("4", "è¹¦è¹¦", "ä¸‰çº§éƒ¨é—¨"));
    groupStructure.add(new Employee("5", "å¤§çƒ§", "ä¸‰çº§éƒ¨é—¨"));
    groupStructure.add(new Employee("6", "è™å“¥", "å››çº§éƒ¨é—¨"));
    groupStructure.add(new Employee("7", "ç²å§", "å››çº§éƒ¨é—¨"));
    groupStructure.add(new Employee("8", "ç§‹é›…", "å››çº§éƒ¨é—¨"));   
    
    // èŠ‚ç‚¹å…³ç³» 1->(1,2) 2->(4,5)
    groupStructure.addLink("1", new Link("1", "2"));
    groupStructure.addLink("1", new Link("1", "3"));
    groupStructure.addLink("2", new Link("2", "4"));
    groupStructure.addLink("2", new Link("2", "5"));
    groupStructure.addLink("5", new Link("5", "6"));
    groupStructure.addLink("5", new Link("5", "7"));
    groupStructure.addLink("5", new Link("5", "8"));       

    Iterator<Employee> iterator = groupStructure.iterator();
    while (iterator.hasNext()) {
        Employee employee = iterator.next();
        logger.info("{}ï¼Œé›‡å‘˜ Idï¼š{} Nameï¼š{}", employee.getDesc(), employee.getuId(), employee.getName());
    }
}
```

#### 3.2 æµ‹è¯•ç»“æœ

```java
22:23:37.166 [main] INFO  org.itstack.demo.design.test.ApiTest - äºŒçº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š2 Nameï¼šèŠ±èŠ±
22:23:37.168 [main] INFO  org.itstack.demo.design.test.ApiTest - ä¸‰çº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š4 Nameï¼šè¹¦è¹¦
22:23:37.169 [main] INFO  org.itstack.demo.design.test.ApiTest - ä¸‰çº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š5 Nameï¼šå¤§çƒ§
22:23:37.169 [main] INFO  org.itstack.demo.design.test.ApiTest - å››çº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š6 Nameï¼šè™å“¥
22:23:37.169 [main] INFO  org.itstack.demo.design.test.ApiTest - å››çº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š7 Nameï¼šç²å§
22:23:37.169 [main] INFO  org.itstack.demo.design.test.ApiTest - å››çº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š8 Nameï¼šç§‹é›…
22:23:37.169 [main] INFO  org.itstack.demo.design.test.ApiTest - äºŒçº§éƒ¨é—¨ï¼Œé›‡å‘˜ Idï¼š3 Nameï¼šè±†åŒ…

Process finished with exit code 0
```

- ä»éå†çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ˜¯é¡ºç€æ ‘å½¢ç»“æ„çš„å¼€å§‹æ·±åº¦éå†ï¼Œä¸€ç›´åˆ°å³ä¾§çš„èŠ‚ç‚¹**3**ï¼š`é›‡å‘˜ Idï¼š2ã€é›‡å‘˜ Idï¼š4...é›‡å‘˜ Idï¼š3`

## å…­ã€æ€»ç»“

- è¿­ä»£å™¨çš„è®¾è®¡æ¨¡å¼ä»ä»¥ä¸Šçš„åŠŸèƒ½å®ç°å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³äº†å•ä¸€èŒè´£å’Œå¼€é—­åŸåˆ™ï¼Œå¤–ç•Œçš„è°ƒç”¨æ–¹ä¹Ÿä¸éœ€è¦çŸ¥é“ä»»ä½•ä¸€ä¸ªä¸åŒçš„æ•°æ®ç»“æ„åœ¨ä½¿ç”¨ä¸Šçš„éå†å·®å¼‚ã€‚å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰©å±•ï¼Œä¹Ÿè®©æ•´ä¸ªéå†å˜å¾—æ›´åŠ å¹²å‡€æ•´æ´ã€‚
- ä½†ä»ç»“æ„çš„å®ç°ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¿­ä»£å™¨æ¨¡å¼çš„å®ç°è¿‡ç¨‹ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œç±»çš„å®ç°ä¸Šä¹Ÿæ‰©å¢äº†éœ€è¦å¤–éƒ¨å®šä¹‰çš„ç±»ï¼Œä½¿å¾—éå†ä¸åŸæ•°æ®ç»“æ„åˆ†å¼€ã€‚è™½ç„¶è¿™æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½†å¯ä»¥çœ‹åˆ°åœ¨ä½¿ç”¨javaçš„jdkæ—¶å€™ï¼Œè¿­ä»£å™¨çš„æ¨¡å¼è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿æ‰©å±•å’Œå‡çº§ã€‚
- ä»¥ä¸Šçš„è®¾è®¡æ¨¡å¼åœºæ™¯å®ç°è¿‡ç¨‹å¯èƒ½å¯¹æ–°äººæœ‰ä¸€äº›ä¸å¥½ç†è§£ç‚¹ï¼ŒåŒ…æ‹¬ï¼šè¿­ä»£å™¨ä¸‰ä¸ªæ¥å£çš„å®šä¹‰ã€æ ‘å½¢ç»“æ„çš„æ•°æ®å…³ç³»ã€æ ‘ç»“æ„æ·±åº¦éå†æ€è·¯ã€‚è¿™äº›éƒ½éœ€è¦åå¤å®ç°ç»ƒä¹ æ‰èƒ½æ·±å…¥çš„ç†è§£ï¼Œäº‹å¿…èº¬äº²ï¼Œäº²åŠ›äº²ä¸ºï¼Œæ‰èƒ½è®©è‡ªå·±æŒæ¡è¿™äº›çŸ¥è¯†ã€‚



