---
layout: post
category: itstack-demo-design
title: é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜å¤–è§‚æ¨¡å¼ã€ŒåŸºäºSpringBootå¼€å‘é—¨é¢æ¨¡å¼ä¸­é—´ä»¶ï¼Œç»Ÿä¸€æ§åˆ¶æ¥å£ç™½åå•åœºæ™¯ã€
tagline: by å°å‚…å“¥
tag: [itstack-demo-design]
excerpt: åˆ€æªæ£æ£’ã€æ–§é’ºé’©å‰ã€åŒ…å­æ²¹æ¡ã€ç›’å­éº»èŠ±ï¼Œæ˜¯è¯­è¨€ã€‚äº”éƒå…«å¦æ£ã€åäºŒè·¯å¼¹è…¿ã€æ´ªå®¶é“çº¿æ‹³ï¼Œæ˜¯è®¾è®¡ã€‚å°±åƒå¶é—®æ‰“è´¥é‡‘å±±æ‰¾ï¼Œä¸æ˜¯å—åŒ—æ‹³çš„è¾“èµ¢ï¼Œè€Œæ˜¯ä¸ªäººçš„æ­¦æœ¯ä¿®ä¸ºä¹‹å·®ã€‚
lock: need
---

# é‡å­¦ Java è®¾è®¡æ¨¡å¼ï¼šå®æˆ˜å¤–è§‚æ¨¡å¼ã€ŒåŸºäºSpringBootå¼€å‘é—¨é¢æ¨¡å¼ä¸­é—´ä»¶ï¼Œç»Ÿä¸€æ§åˆ¶æ¥å£ç™½åå•åœºæ™¯ã€

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=640500387&bvid=BV1JY4y1H711&cid=572131478&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`ä½ æ„Ÿå—åˆ°çš„å®¹æ˜“ï¼Œä¸€å®šæœ‰äººä¸ºä½ æ‰¿æ‹…ä¸å®¹æ˜“`

è¿™å¥è¯æ›´åƒæ˜¯æè¿°ç”Ÿæ´»çš„ï¼Œè®¸è®¸å¤šå¤šçš„ç£•ç£•ç»Šç»Šæ€»æœ‰äººä¸ºä½ æä¾›èº²é›¨çš„å±‹æªå’Œé¿é£çš„æ¸¯æ¹¾ã€‚å…¶å®ç¼–ç¨‹å¼€å‘çš„å›¢é˜Ÿä¸­ä¹Ÿä¸€æ ·æœ‰äººåªè´Ÿè´£CRUDä¸­çš„ç®€å•è°ƒç”¨ï¼Œå»ä½¿ç”¨å›¢é˜Ÿä¸­é«˜çº§ç¨‹åºå‘˜å¼€å‘å‡ºæ¥çš„æ ¸å¿ƒæœåŠ¡å’Œæ¥å£ã€‚è¿™æ ·çš„ç¼–ç¨‹å¼€å‘å¯¹äºåˆæœŸåˆšè¿›å…¥ç¨‹åºå‘˜è¡Œä¸šçš„å°ä¼™ä¼´æ¥è¯´é”»ç‚¼é”»ç‚¼è¿˜æ˜¯ä¸é”™çš„ï¼Œä½†éšç€å¼€å‘çš„æ—¥å­è¶Šæ¥è¶Šä¹…ä¸€ç›´åšè¿™æ ·çš„äº‹æƒ…å°±å¾ˆéš¾å¾—åˆ°æˆé•¿ï¼Œä¹Ÿæƒ³åŠªåŠ›çš„å»åšä¸€äº›æ›´æœ‰éš¾åº¦çš„æ‰¿æ‹…ï¼Œä»¥æ­¤æ¥å¢å¼ºä¸ªäººçš„æŠ€æœ¯èƒ½åŠ›ã€‚

`æ²¡æœ‰æœ€å¥½çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¯­è¨€åªæ˜¯å·¥å…·`

åˆ€æªæ£æ£’ã€æ–§é’ºé’©å‰ã€åŒ…å­æ²¹æ¡ã€ç›’å­éº»èŠ±ï¼Œæ˜¯**è¯­è¨€**ã€‚äº”éƒå…«å¦æ£ã€åäºŒè·¯å¼¹è…¿ã€æ´ªå®¶é“çº¿æ‹³ï¼Œæ˜¯**è®¾è®¡**ã€‚è®°å¾—å¶é—®é‡Œæœ‰ä¸€å¥å°è¯æ˜¯ï¼š`é‡‘å±±æ‰¾ï¼šä»Šå¤©æˆ‘åŒ—æ–¹æ‹³æœ¯ï¼Œè¾“ç»™ä½ å—æ–¹æ‹³æœ¯äº†ã€‚å¶é—®ï¼šä½ é”™äº†ï¼Œä¸æ˜¯å—åŒ—æ‹³çš„é—®é¢˜ï¼Œæ˜¯ä½ çš„é—®é¢˜ã€‚`æ‰€ä»¥å½“ä½ ç¼–ç¨‹å¼€å‘å†™çš„ä¹…äº†ï¼Œå°±ä¸ä¼šå†ç‰¹åˆ«åœ¨æ„ç”¨çš„è¯­è¨€ï¼Œè€Œæ˜¯ä¸ºç›®æ ‡æœåŠ¡ï¼Œç”¨æœ€å¥½çš„è®¾è®¡èƒ½åŠ›ä¹Ÿå°±æ˜¯ç¼–ç¨‹çš„æ™ºæ…§åšå‡ºæœ€æœ€å®Œç¾çš„æœåŠ¡ã€‚è¿™ä¹Ÿå°±æ˜¯ç¼–ç¨‹äººå‘˜çš„ä»·å€¼æ‰€åœ¨ï¼

`è®¾è®¡ä¸åè®¾è®¡ä»¥åŠè¿‡åº¦è®¾è®¡`

è®¾è®¡æ¨¡å¼æ˜¯è§£å†³ç¨‹åºä¸­ä¸åˆç†ã€ä¸æ˜“äºæ‰©å±•ã€ä¸æ˜“äºç»´æŠ¤çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯å¹²æ‰å¤§éƒ¨åˆ†`ifelse`çš„åˆ©å™¨ï¼Œåœ¨æˆ‘ä»¬å¸¸ç”¨çš„æ¡†æ¶ä¸­åŸºæœ¬éƒ½ä¼šç”¨åˆ°å¤§é‡çš„è®¾è®¡æ¨¡å¼æ¥æ„å»ºç»„ä»¶ï¼Œè¿™æ ·ä¹Ÿèƒ½æ–¹ä¾¿æ¡†æ¶çš„å‡çº§å’ŒåŠŸèƒ½çš„æ‰©å±•ã€‚ä½†ï¼å¦‚æœä¸èƒ½åˆç†çš„è®¾è®¡ä»¥åŠä¹±ç”¨è®¾è®¡æ¨¡å¼ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç¼–ç¨‹å˜å¾—æ›´åŠ å¤æ‚éš¾ç»´æŠ¤ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ï¼›`åè®¾è®¡`ã€`è¿‡åº¦è®¾è®¡`ã€‚è€Œè¿™éƒ¨åˆ†è®¾è®¡èƒ½åŠ›ä¹Ÿæ˜¯ä»å®è·µçš„é¡¹ç›®ä¸­è·å–çš„ç»éªŒï¼Œä¸æ–­çš„æ”¹é€ ä¼˜åŒ–æ‘¸ç´¢å‡ºçš„æœ€åˆç†çš„æ–¹å¼ï¼Œåº”å¯¹å½“å‰çš„æœåŠ¡ä½“é‡ã€‚

## äºŒã€å¼€å‘ç¯å¢ƒ

1. JDK 1.8
2. Idea + Maven
3. SpringBoot 2.1.2.RELEASE
4. æ¶‰åŠå·¥ç¨‹ä¸‰ä¸ªï¼Œå¯ä»¥é€šè¿‡å…³æ³¨**å…¬ä¼—å·**ï¼š[`bugstackè™«æ´æ ˆ`](https://bugstack.cn/assets/images/qrcode.png)ï¼Œå›å¤`æºç ä¸‹è½½`è·å–(æ‰“å¼€è·å–çš„é“¾æ¥ï¼Œæ‰¾åˆ°åºå·18)

| å·¥ç¨‹                     | æè¿°                                         |
| ------------------------ | --------------------------------- |
| itstack-demo-design-10-00 | åœºæ™¯æ¨¡æ‹Ÿå·¥ç¨‹ï¼›æ¨¡æ‹Ÿä¸€ä¸ªæä¾›æ¥å£æœåŠ¡çš„SpringBootå·¥ç¨‹ |
| itstack-demo-design-10-01 | ä½¿ç”¨ä¸€å¨ä»£ç å®ç°ä¸šåŠ¡éœ€æ±‚ |
| itstack-demo-design-10-02 | é€šè¿‡è®¾è®¡æ¨¡å¼å¼€å‘ä¸ºä¸­é—´ä»¶ï¼ŒåŒ…è£…é€šç”¨å‹æ ¸å¿ƒé€»è¾‘ |

## ä¸‰ã€å¤–è§‚æ¨¡å¼ä»‹ç»

![å¤–è§‚æ¨¡å¼ï¼Œå›¾ç‰‡æ¥è‡ª refactoringguru.cn](https://bugstack.cn/assets/images/2020/itstack-demo-design-10-01.png)

- å›¾ç‰‡æ¥è‡ªï¼š[https://refactoringguru.cn/design-patterns/facade](https://refactoringguru.cn/design-patterns/facade)

å¤–è§‚æ¨¡å¼ä¹Ÿå«é—¨é¢æ¨¡å¼ï¼Œä¸»è¦è§£å†³çš„æ˜¯é™ä½è°ƒç”¨æ–¹çš„ä½¿ç”¨æ¥å£çš„å¤æ‚é€»è¾‘ç»„åˆã€‚è¿™æ ·è°ƒç”¨æ–¹ä¸å®é™…çš„æ¥å£æä¾›æ–¹æä¾›æ–¹æä¾›äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œç”¨äºåŒ…è£…é€»è¾‘æä¾›APIæ¥å£ã€‚æœ‰äº›æ—¶å€™å¤–è§‚æ¨¡å¼ä¹Ÿè¢«ç”¨åœ¨ä¸­é—´ä»¶å±‚ï¼Œå¯¹æœåŠ¡ä¸­çš„é€šç”¨æ€§å¤æ‚é€»è¾‘è¿›è¡Œä¸­é—´ä»¶å±‚åŒ…è£…ï¼Œè®©ä½¿ç”¨æ–¹å¯ä»¥åªå…³å¿ƒä¸šåŠ¡å¼€å‘ã€‚

**é‚£ä¹ˆè¿™æ ·çš„æ¨¡å¼åœ¨æˆ‘ä»¬çš„æ‰€è§äº§å“åŠŸèƒ½ä¸­ä¹Ÿç»å¸¸é‡åˆ°**ï¼Œå°±åƒå‡ å¹´å‰æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªç½‘ç«™æ—¶å€™å¾€å¾€è¦æ·»åŠ å¾ˆå¤šä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼›å§“åã€æ˜µç§°ã€æ‰‹æœºå·ã€QQã€é‚®ç®±ã€ä½å€ã€å•èº«ç­‰ç­‰ï¼Œä½†ç°åœ¨æ³¨å†Œæˆä¸ºä¸€ä¸ªç½‘ç«™çš„ç”¨æˆ·åªéœ€è¦ä¸€æ­¥å³å¯ï¼Œæ— è®ºæ˜¯æ‰‹æœºå·è¿˜æ˜¯å¾®ä¿¡ä¹Ÿéƒ½æä¾›äº†è¿™æ ·çš„ç™»å½•æœåŠ¡ã€‚è€Œå¯¹äºæœåŠ¡ç«¯åº”ç”¨å¼€å‘æ¥è¯´ä»¥å‰æ˜¯æä¾›äº†ä¸€ä¸ªæ•´å¥—çš„æ¥å£ï¼Œç°åœ¨æ³¨å†Œçš„æ—¶å€™å¹¶æ²¡æœ‰è¿™äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å°±éœ€è¦è¿›è¡Œæ¥å£åŒ…è£…ï¼Œåœ¨å‰ç«¯è°ƒç”¨æ³¨å†Œçš„æ—¶å€™æœåŠ¡ç«¯è·å–ç›¸åº”çš„ç”¨æˆ·ä¿¡æ¯(ä»å„ä¸ªæ¸ é“)ï¼Œå¦‚æœè·å–ä¸åˆ°ä¼šè®©ç”¨æˆ·åç»­è¿›è¡Œè¡¥å…¨(è¥é”€è¡¥å…¨ä¿¡æ¯ç»™å¥–åŠ±)ï¼Œä»¥æ­¤æ¥æ‹‰åŠ¨ç”¨æˆ·çš„æ³¨å†Œé‡å’Œæ´»è·ƒåº¦ã€‚

## å››ã€æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

![åœºæ™¯æ¨¡æ‹Ÿï¼›æ‰€æœ‰æœåŠ¡æ·»åŠ ç™½åå•æ ¡éªŒ](https://bugstack.cn/assets/images/2020/itstack-demo-design-10-02.png)

**åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå°†æ‰€æœ‰æœåŠ¡æ¥å£æ·»åŠ ç™½åå•çš„åœºæ™¯**

åœ¨é¡¹ç›®ä¸æ–­å£®å¤§å‘å±•çš„è·¯ä¸Šï¼Œæ¯ä¸€æ¬¡å‘ç‰ˆä¸Šçº¿éƒ½éœ€è¦è¿›è¡Œæµ‹è¯•ï¼Œè€Œè¿™éƒ¨åˆ†æµ‹è¯•éªŒè¯ä¸€èˆ¬ä¼šè¿›è¡Œç™½åå•å¼€é‡æˆ–è€…åˆ‡é‡çš„æ–¹å¼è¿›è¡ŒéªŒè¯ã€‚é‚£ä¹ˆå¦‚æœåœ¨æ¯ä¸€ä¸ªæ¥å£ä¸­éƒ½æ·»åŠ è¿™æ ·çš„é€»è¾‘ï¼Œå°±ä¼šéå¸¸éº»çƒ¦ä¸”ä¸æ˜“ç»´æŠ¤ã€‚å¦å¤–è¿™æ˜¯ä¸€ç±»å…·å¤‡é€šç”¨é€»è¾‘çš„å…±æ€§éœ€æ±‚ï¼Œéå¸¸é€‚åˆå¼€å‘æˆç»„ä»¶ï¼Œä»¥æ­¤æ¥æ²»ç†æœåŠ¡ï¼Œè®©ç ”å‘äººå‘˜æ›´å¤šçš„å…³å¿ƒä¸šåŠ¡åŠŸèƒ½å¼€å‘ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹å¯¹äºå¤–è§‚æ¨¡å¼çš„ä½¿ç”¨é€šå¸¸æ˜¯ç”¨åœ¨å¤æ‚æˆ–å¤šä¸ªæ¥å£è¿›è¡ŒåŒ…è£…ç»Ÿä¸€å¯¹å¤–æä¾›æœåŠ¡ä¸Šï¼Œæ­¤ç§ä½¿ç”¨æ–¹å¼ä¹Ÿç›¸å¯¹ç®€å•åœ¨æˆ‘ä»¬å¹³å¸¸çš„ä¸šåŠ¡å¼€å‘ä¸­ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ã€‚*ä½ å¯èƒ½ç»å¸¸å¬åˆ°æŠŠè¿™ä¸¤ä¸ªæ¥å£åŒ…è£…ä¸€ä¸‹*ï¼Œä½†åœ¨æœ¬ä¾‹å­ä¸­æˆ‘ä»¬æŠŠè¿™ç§è®¾è®¡æ€è·¯æ”¾åˆ°ä¸­é—´ä»¶å±‚ï¼Œè®©æœåŠ¡å˜å¾—å¯ä»¥ç»Ÿä¸€æ§åˆ¶ã€‚

### 1. åœºæ™¯æ¨¡æ‹Ÿå·¥ç¨‹

```java
itstack-demo-design-10-00
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org.itstack.demo.design
    â”‚   â”‚       â”œâ”€â”€ domain
    â”‚   â”‚       â”‚	â””â”€â”€ UserInfo.java
    â”‚   â”‚       â”œâ”€â”€ web	
    â”‚   â”‚       â”‚	â””â”€â”€ HelloWorldController.java
    â”‚   â”‚       â””â”€â”€ HelloWorldApplication.java
    â”‚   â””â”€â”€ resources	
    â”‚       â””â”€â”€ application.yml	
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.test
                â””â”€â”€ ApiTest.java
```

- è¿™æ˜¯ä¸€ä¸ª`SpringBoot`çš„`HelloWorld`å·¥ç¨‹ï¼Œåœ¨å·¥ç¨‹ä¸­æä¾›äº†æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯çš„æ¥å£`HelloWorldController.queryUserInfo`ï¼Œä¸ºåç»­æ‰©å±•æ­¤æ¥å£çš„ç™½åå•è¿‡æ»¤åšå‡†å¤‡ã€‚

### 2. åœºæ™¯ç®€è¿°

#### 2.1 å®šä¹‰åŸºç¡€æŸ¥è¯¢æ¥å£

```java
@RestController
public class HelloWorldController {

    @Value("${server.port}")
    private int port;

    /**
     * keyï¼šéœ€è¦ä»å…¥å‚å–å€¼çš„å±æ€§å­—æ®µï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™ä»å¯¹è±¡ä¸­å–å€¼ï¼Œå¦‚æœæ˜¯å•ä¸ªå€¼åˆ™ç›´æ¥ä½¿ç”¨
     * returnJsonï¼šé¢„è®¾æ‹¦æˆªæ—¶è¿”å›å€¼ï¼Œæ˜¯è¿”å›å¯¹è±¡çš„Json
     *
     * http://localhost:8080/api/queryUserInfo?userId=1001
     * http://localhost:8080/api/queryUserInfo?userId=å°å›¢å›¢
     */
    @RequestMapping(path = "/api/queryUserInfo", method = RequestMethod.GET)
    public UserInfo queryUserInfo(@RequestParam String userId) {
        return new UserInfo("è™«è™«:" + userId, 19, "å¤©æ´¥å¸‚å—å¼€åŒºæ—®æ—¯èƒ¡åŒ100å·");
    }

}
```

- è¿™é‡Œæä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„æŸ¥è¯¢æœåŠ¡ï¼Œé€šè¿‡å…¥å‚`userId`ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚åç»­å°±éœ€è¦åœ¨è¿™é‡Œæ‰©å±•ç™½åå•ï¼Œåªæœ‰æŒ‡å®šç”¨æˆ·æ‰å¯ä»¥æŸ¥è¯¢ï¼Œå…¶ä»–ç”¨æˆ·ä¸èƒ½æŸ¥è¯¢ã€‚    

#### 2.2 è®¾ç½®Applicationå¯åŠ¨ç±»

```java
@SpringBootApplication
@Configuration
public class HelloWorldApplication {

    public static void main(String[] args) {
        SpringApplication.run(HelloWorldApplication.class, args);
    }

}
```

- è¿™é‡Œæ˜¯é€šç”¨çš„`SpringBoot`å¯åŠ¨ç±»ã€‚

## äº”ã€ç”¨ä¸€å¨å¨ä»£ç å®ç°

`ä¸€èˆ¬å¯¹äºæ­¤ç§åœºæ™¯æœ€ç®€å•çš„åšæ³•å°±æ˜¯ç›´æ¥ä¿®æ”¹ä»£ç `

ç´¯åŠ `if`å—å‡ ä¹æ˜¯å®ç°éœ€æ±‚æœ€å¿«ä¹Ÿæ˜¯æœ€æ…¢çš„æ–¹å¼ï¼Œ**å¿«**æ˜¯ä¿®æ”¹å½“å‰å†…å®¹å¾ˆå¿«ï¼Œ**æ…¢**æ˜¯å¦‚æœåŒç±»çš„å†…å®¹å‡ ç™¾ä¸ªä¹Ÿéƒ½éœ€è¦å¦‚æ­¤ä¿®æ”¹æ‰©å±•å’Œç»´æŠ¤ä¼šè¶Šæ¥è¶Šæ…¢ã€‚

### 1. å·¥ç¨‹ç»“æ„

```java
itstack-demo-design-10-01
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â””â”€â”€ HelloWorldController.java
```

- ä»¥ä¸Šçš„å®ç°æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªApiæ¥å£ç±»ï¼Œåœ¨é‡Œé¢æ·»åŠ ç™½åå•åŠŸèƒ½ï¼Œä½†ç±»ä¼¼æ­¤ç±»çš„æ¥å£ä¼šæœ‰å¾ˆå¤šéƒ½éœ€è¦ä¿®æ”¹ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸æ¨èä½¿ç”¨æ­¤ç§æ–¹å¼çš„é‡è¦åŸå› ã€‚

### 2. ä»£ç å®ç°

```java
public class HelloWorldController {

    public UserInfo queryUserInfo(@RequestParam String userId) {

        // åšç™½åå•æ‹¦æˆª
        List<String> userList = new ArrayList<String>();
        userList.add("1001");
        userList.add("aaaa");
        userList.add("ccc");
        if (!userList.contains(userId)) {
            return new UserInfo("1111", "éç™½åå•å¯è®¿é—®ç”¨æˆ·æ‹¦æˆªï¼");
        }

        return new UserInfo("è™«è™«:" + userId, 19, "å¤©æ´¥å¸‚å—å¼€åŒºæ—®æ—¯èƒ¡åŒ100å·");
    }

}
```

- åœ¨è¿™é‡Œç™½åå•çš„ä»£ç å æ®äº†ä¸€å¤§å—ï¼Œä½†å®ƒåˆä¸æ˜¯ä¸šåŠ¡ä¸­çš„é€»è¾‘ï¼Œè€Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸Šçº¿è¿‡ç¨‹ä¸­éœ€è¦åšçš„å¼€é‡å‰æµ‹è¯•éªŒè¯ã€‚
- å¦‚æœä½ æ—¥å¸¸å¯¹å¾…æ­¤ç±»éœ€æ±‚ç»å¸¸æ˜¯è¿™æ ·å¼€å‘ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§æ­¤è®¾è®¡æ¨¡å¼è¿›è¡Œä¼˜åŒ–ä½ çš„å¤„ç†æ–¹å¼ï¼Œè®©åç»­çš„æ‰©å±•å’Œæ‘˜é™¤æ›´åŠ å®¹æ˜“ã€‚

## å…­ã€å¤–è§‚æ¨¡å¼é‡æ„ä»£ç 

`æ¥ä¸‹æ¥ä½¿ç”¨å¤–è§‚æ¨¡å¼æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡å¾ˆå°çš„é‡æ„ã€‚`

è¿™æ¬¡é‡æ„çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨å¤–è§‚æ¨¡å¼ä¹Ÿå¯ä»¥è¯´é—¨é¢æ¨¡å¼ï¼Œç»“åˆ`SpringBoot`ä¸­çš„è‡ªå®šä¹‰`starter`ä¸­é—´ä»¶å¼€å‘çš„æ–¹å¼ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰éœ€è¦ç™½åå•çš„åœ°æ–¹ã€‚

åç»­æ¥ä¸‹æ¥çš„å®ç°ä¸­ï¼Œä¼šæ¶‰åŠçš„çŸ¥è¯†ï¼›
1. SpringBootçš„starterä¸­é—´ä»¶å¼€å‘æ–¹å¼ã€‚
2. é¢å‘åˆ‡é¢ç¼–ç¨‹å’Œè‡ªå®šä¹‰æ³¨è§£çš„ä½¿ç”¨ã€‚
3. å¤–éƒ¨è‡ªå®šä¹‰é…ç½®ä¿¡æ¯çš„é€ä¼ ï¼ŒSpringBootä¸Springä¸åŒï¼Œå¯¹äºæ­¤ç±»æ–¹å¼è·å–ç™½åå•é…ç½®å­˜åœ¨å·®å¼‚ã€‚

### 1. å·¥ç¨‹ç»“æ„

```java
itstack-demo-design-10-02
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org.itstack.demo.design.door
    â”‚   â”‚       â”œâ”€â”€ annotation
    â”‚   â”‚       â”‚	â””â”€â”€ DoDoor.java	
    â”‚   â”‚       â”œâ”€â”€ config
    â”‚   â”‚       â”‚	â”œâ”€â”€ StarterAutoConfigure.java
    â”‚   â”‚       â”‚	â”œâ”€â”€ StarterService.java
    â”‚   â”‚       â”‚	â””â”€â”€ StarterServiceProperties.java
    â”‚   â”‚       â””â”€â”€ DoJoinPoint.java
    â”‚   â””â”€â”€ resources	
    â”‚       â””â”€â”€ META_INF
    â”‚           â””â”€â”€ spring.factories
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.test
                â””â”€â”€ ApiTest.java
```

**é—¨é¢æ¨¡å¼æ¨¡å‹ç»“æ„**

![é—¨é¢æ¨¡å¼æ¨¡å‹ç»“æ„](https://bugstack.cn/assets/images/2020/itstack-demo-design-10-03.png)

- ä»¥ä¸Šæ˜¯å¤–è§‚æ¨¡å¼çš„ä¸­é—´ä»¶å®ç°æ€è·¯ï¼Œå³ä¾§æ˜¯ä¸ºäº†è·å–é…ç½®æ–‡ä»¶ï¼Œå·¦ä¾§æ˜¯å¯¹äºåˆ‡é¢çš„å¤„ç†ã€‚
- é—¨é¢æ¨¡å¼å¯ä»¥æ˜¯å¯¹æ¥å£çš„åŒ…è£…æä¾›å‡ºæ¥å£æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹é€»è¾‘çš„åŒ…è£…é€šè¿‡è‡ªå®šä¹‰æ³¨è§£å¯¹æ¥å£æä¾›æœåŠ¡èƒ½åŠ›ã€‚

### 2. ä»£ç å®ç°

#### 2.1 é…ç½®æœåŠ¡ç±»

```java 
public class StarterService {

    private String userStr;

    public StarterService(String userStr) {
        this.userStr = userStr;
    }

    public String[] split(String separatorChar) {
        return StringUtils.split(this.userStr, separatorChar);
    }

}
```     

- ä»¥ä¸Šç±»çš„å†…å®¹è¾ƒç®€å•åªæ˜¯ä¸ºäº†è·å–é…ç½®ä¿¡æ¯ã€‚

#### 2.2 é…ç½®ç±»æ³¨è§£å®šä¹‰

```java 
@ConfigurationProperties("itstack.door")
public class StarterServiceProperties {

    private String userStr;

    public String getUserStr() {
        return userStr;
    }

    public void setUserStr(String userStr) {
        this.userStr = userStr;
    }

}
```     

- ç”¨äºå®šä¹‰å¥½åç»­åœ¨ `application.yml` ä¸­æ·»åŠ  `itstack.door` çš„é…ç½®ä¿¡æ¯ã€‚

#### 2.3 è‡ªå®šä¹‰é…ç½®ç±»ä¿¡æ¯è·å–

```java
@Configuration
@ConditionalOnClass(StarterService.class)
@EnableConfigurationProperties(StarterServiceProperties.class)
public class StarterAutoConfigure {

    @Autowired
    private StarterServiceProperties properties;

    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnProperty(prefix = "itstack.door", value = "enabled", havingValue = "true")
    StarterService starterService() {
        return new StarterService(properties.getUserStr());
    }

}
```     

- ä»¥ä¸Šä»£ç æ˜¯å¯¹é…ç½®çš„è·å–æ“ä½œï¼Œä¸»è¦æ˜¯å¯¹æ³¨è§£çš„å®šä¹‰ï¼š`@Configuration`ã€`@ConditionalOnClass`ã€`@EnableConfigurationProperties`ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ä¸SpringBootçš„ç»“åˆä½¿ç”¨ã€‚

#### 2.4 åˆ‡é¢æ³¨è§£å®šä¹‰

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface DoDoor {

    String key() default "";

    String returnJson() default "";

}
```       

- å®šä¹‰äº†å¤–è§‚æ¨¡å¼é—¨é¢æ³¨è§£ï¼Œåç»­å°±æ˜¯æ­¤æ³¨è§£æ·»åŠ åˆ°éœ€è¦æ‰©å±•ç™½åå•çš„æ–¹æ³•ä¸Šã€‚
- è¿™é‡Œæä¾›äº†ä¸¤ä¸ªå…¥å‚ï¼Œ**key**ï¼šè·å–æŸä¸ªå­—æ®µä¾‹å¦‚ç”¨æˆ·IDã€**returnJson**ï¼šç¡®å®šç™½åå•æ‹¦æˆªåè¿”å›çš„å…·ä½“å†…å®¹ã€‚

#### 2.5 ç™½åå•åˆ‡é¢é€»è¾‘

```java
@Aspect
@Component
public class DoJoinPoint {

    private Logger logger = LoggerFactory.getLogger(DoJoinPoint.class);

    @Autowired
    private StarterService starterService;

    @Pointcut("@annotation(org.itstack.demo.design.door.annotation.DoDoor)")
    public void aopPoint() {
    }

    @Around("aopPoint()")
    public Object doRouter(ProceedingJoinPoint jp) throws Throwable {
        //è·å–å†…å®¹
        Method method = getMethod(jp);
        DoDoor door = method.getAnnotation(DoDoor.class);
        //è·å–å­—æ®µå€¼
        String keyValue = getFiledValue(door.key(), jp.getArgs());
        logger.info("itstack door handler methodï¼š{} valueï¼š{}", method.getName(), keyValue);
        if (null == keyValue || "".equals(keyValue)) return jp.proceed();
        //é…ç½®å†…å®¹
        String[] split = starterService.split(",");
        //ç™½åå•è¿‡æ»¤
        for (String str : split) {
            if (keyValue.equals(str)) {
                return jp.proceed();
            }
        }
        //æ‹¦æˆª
        return returnObject(door, method);
    }

    private Method getMethod(JoinPoint jp) throws NoSuchMethodException {
        Signature sig = jp.getSignature();
        MethodSignature methodSignature = (MethodSignature) sig;
        return getClass(jp).getMethod(methodSignature.getName(), methodSignature.getParameterTypes());
    }

    private Class<? extends Object> getClass(JoinPoint jp) throws NoSuchMethodException {
        return jp.getTarget().getClass();
    }

    //è¿”å›å¯¹è±¡
    private Object returnObject(DoDoor doGate, Method method) throws IllegalAccessException, InstantiationException {
        Class<?> returnType = method.getReturnType();
        String returnJson = doGate.returnJson();
        if ("".equals(returnJson)) {
            return returnType.newInstance();
        }
        return JSON.parseObject(returnJson, returnType);
    }

    //è·å–å±æ€§å€¼
    private String getFiledValue(String filed, Object[] args) {
        String filedValue = null;
        for (Object arg : args) {
            try {
                if (null == filedValue || "".equals(filedValue)) {
                    filedValue = BeanUtils.getProperty(arg, filed);
                } else {
                    break;
                }
            } catch (Exception e) {
                if (args.length == 1) {
                    return args[0].toString();
                }
            }
        }
        return filedValue;
    }

}
```   

- è¿™é‡ŒåŒ…æ‹¬çš„å†…å®¹è¾ƒå¤šï¼Œæ ¸å¿ƒé€»è¾‘ä¸»è¦æ˜¯ï¼›`Object doRouter(ProceedingJoinPoint jp)`ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ã€‚

**@Pointcut("@annotation(org.itstack.demo.design.door.annotation.DoDoor)")**

å®šä¹‰åˆ‡é¢ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯æ³¨è§£è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„åŠ å…¥è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢«åˆ‡é¢è¿›è¡Œç®¡ç†ã€‚

**getFiledValue**

è·å–æŒ‡å®škeyä¹Ÿå°±æ˜¯è·å–å…¥å‚ä¸­çš„æŸä¸ªå±æ€§ï¼Œè¿™é‡Œä¸»è¦æ˜¯è·å–ç”¨æˆ·IDï¼Œé€šè¿‡IDè¿›è¡Œæ‹¦æˆªæ ¡éªŒã€‚

**returnObject**

è¿”å›æ‹¦æˆªåçš„è½¬æ¢å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éç™½åå•ç”¨æˆ·è®¿é—®æ—¶åˆ™è¿”å›ä¸€äº›æç¤ºä¿¡æ¯ã€‚

**doRouter**

åˆ‡é¢æ ¸å¿ƒé€»è¾‘ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯åˆ¤æ–­å½“å‰è®¿é—®çš„ç”¨æˆ·IDæ˜¯å¦ç™½åå•ç”¨æˆ·ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œ`jp.proceed();`ï¼Œå¦åˆ™è¿”å›è‡ªå®šä¹‰çš„æ‹¦æˆªæç¤ºä¿¡æ¯ã€‚

### 3. æµ‹è¯•éªŒè¯

è¿™é‡Œçš„æµ‹è¯•æˆ‘ä»¬ä¼šåœ¨å·¥ç¨‹ï¼š`itstack-demo-design-10-00`ä¸­è¿›è¡Œæ“ä½œï¼Œé€šè¿‡å¼•å…¥jaråŒ…ï¼Œé…ç½®æ³¨è§£çš„æ–¹å¼è¿›è¡ŒéªŒè¯ã€‚

#### 3.1 å¼•å…¥ä¸­é—´ä»¶POMé…ç½®

```java
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>itstack-demo-design-10-02</artifactId>
</dependency>
```           

- æ‰“åŒ…ä¸­é—´ä»¶å·¥ç¨‹ï¼Œç»™å¤–éƒ¨æä¾›jaråŒ…æœåŠ¡

#### 3.2 é…ç½®application.yml

```java
# è‡ªå®šä¹‰ä¸­é—´ä»¶é…ç½®
itstack:
  door:
    enabled: true
    userStr: 1001,aaaa,ccc #ç™½åå•ç”¨æˆ·IDï¼Œå¤šä¸ªé€—å·éš”å¼€
```        

- è¿™é‡Œä¸»è¦æ˜¯åŠ å…¥äº†ç™½åå•çš„å¼€å…³å’Œç™½åå•çš„ç”¨æˆ·IDï¼Œé€—å·éš”å¼€ã€‚

#### 3.3 åœ¨Controllerä¸­æ·»åŠ è‡ªå®šä¹‰æ³¨è§£

```java 
/**
 * http://localhost:8080/api/queryUserInfo?userId=1001
 * http://localhost:8080/api/queryUserInfo?userId=å°å›¢å›¢
 */
@DoDoor(key = "userId", returnJson = "{\"code\":\"1111\",\"info\":\"éç™½åå•å¯è®¿é—®ç”¨æˆ·æ‹¦æˆªï¼\"}")
@RequestMapping(path = "/api/queryUserInfo", method = RequestMethod.GET)
public UserInfo queryUserInfo(@RequestParam String userId) {
    return new UserInfo("è™«è™«:" + userId, 19, "å¤©æ´¥å¸‚å—å¼€åŒºæ—®æ—¯èƒ¡åŒ100å·");
}
```    

- è¿™é‡Œæ ¸å¿ƒçš„å†…å®¹ä¸»è¦æ˜¯è‡ªå®šä¹‰çš„æ³¨è§£çš„æ·»åŠ `@DoDoor`ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å¤–è§‚æ¨¡å¼ä¸­é—´ä»¶åŒ–å®ç°ã€‚
- keyï¼šéœ€è¦ä»å…¥å‚å–å€¼çš„å±æ€§å­—æ®µï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™ä»å¯¹è±¡ä¸­å–å€¼ï¼Œå¦‚æœæ˜¯å•ä¸ªå€¼åˆ™ç›´æ¥ä½¿ç”¨ã€‚
- returnJsonï¼šé¢„è®¾æ‹¦æˆªæ—¶è¿”å›å€¼ï¼Œæ˜¯è¿”å›å¯¹è±¡çš„Jsonã€‚

#### 3.4 å¯åŠ¨SpringBoot

```java
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.1.2.RELEASE)

2020-06-11 23:56:55.451  WARN 65228 --- [           main] ion$DefaultTemplateResolverConfiguration : Cannot find template location: classpath:/templates/ (please add some templates or check your Thymeleaf configuration)
2020-06-11 23:56:55.531  INFO 65228 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2020-06-11 23:56:55.533  INFO 65228 --- [           main] o.i.demo.design.HelloWorldApplication    : Started HelloWorldApplication in 1.688 seconds (JVM running for 2.934)
```         

- å¯åŠ¨æ­£å¸¸ï¼ŒSpringBootå·²ç»å¯åŠ¨å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚

#### 3.5 è®¿é—®æ¥å£æ¥å£æµ‹è¯•

**ç™½åå•ç”¨æˆ·è®¿é—®**

[http://localhost:8080/api/queryUserInfo?userId=1001](http://localhost:8080/api/queryUserInfo?userId=1001)

```java
{"code":"0000","info":"success","name":"è™«è™«:1001","age":19,"address":"å¤©æ´¥å¸‚å—å¼€åŒºæ—®æ—¯èƒ¡åŒ100å·"}
```   

- æ­¤æ—¶çš„æµ‹è¯•ç»“æœæ­£å¸¸ï¼Œå¯ä»¥æ‹¿åˆ°æ¥å£æ•°æ®ã€‚

**éç™½åå•ç”¨æˆ·è®¿é—®**

[http://localhost:8080/api/queryUserInfo?userId=å°å›¢å›¢](http://localhost:8080/api/queryUserInfo?userId=å°å›¢å›¢)

```java
{"code":"1111","info":"éç™½åå•å¯è®¿é—®ç”¨æˆ·æ‹¦æˆªï¼","name":null,"age":null,"address":null}
```  

- è¿™æ¬¡æˆ‘ä»¬æŠŠ`userId`æ¢æˆ`å°å›¢å›¢`ï¼Œæ­¤æ—¶è¿”å›çš„ä¿¡æ¯å·²ç»æ˜¯è¢«æ‹¦æˆªçš„ä¿¡æ¯ã€‚è€Œè¿™ä¸ªæ‹¦æˆªä¿¡æ¯æ­£å¼æˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£ä¸­çš„ä¿¡æ¯ï¼š`@DoDoor(key = "userId", returnJson = "{\"code\":\"1111\",\"info\":\"éç™½åå•å¯è®¿é—®ç”¨æˆ·æ‹¦æˆªï¼\"}")`

## ä¸ƒã€æ€»ç»“

- ä»¥ä¸Šæˆ‘ä»¬é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼å®ç°å¤–è§‚æ¨¡å¼ï¼Œè¿™æ ·çš„è®¾è®¡å¯ä»¥å¾ˆå¥½çš„å¢å¼ºä»£ç çš„éš”ç¦»æ€§ï¼Œä»¥åŠå¤ç”¨æ€§ï¼Œä¸ä»…ä½¿ç”¨ä¸Šéå¸¸çµæ´»ä¹Ÿé™ä½äº†æ¯ä¸€ä¸ªç³»ç»Ÿéƒ½å¼€å‘è¿™æ ·çš„æœåŠ¡å¸¦æ¥çš„é£é™©ã€‚
- å¯èƒ½ç›®å‰ä½ çœ‹è¿™åªæ˜¯éå¸¸ç®€å•çš„ç™½åå•æ§åˆ¶ï¼Œæ˜¯å¦éœ€è¦è¿™æ ·çš„å¤„ç†ã€‚ä½†å¾€å¾€ä¸€ä¸ªå°å°çš„å¼€å§‹ä¼šå½±å“ç€åç»­æ— é™çš„æ‰©å±•ï¼Œå®é™…çš„ä¸šåŠ¡å¼€å‘å¾€å¾€ä¹Ÿè¦å¤æ‚çš„å¾ˆå¤šï¼Œä¸å¯èƒ½å¦‚æ­¤ç®€å•ã€‚å› è€Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ¥è®©ä»£ç ç»“æ„æ›´åŠ å¹²å‡€æ•´æ´ã€‚
- å¾ˆå¤šæ—¶å€™ä¸æ˜¯è®¾è®¡æ¨¡å¼æ²¡æœ‰ç”¨ï¼Œè€Œæ˜¯è‡ªå·±ç¼–ç¨‹å¼€å‘ç»éªŒä¸è¶³å¯¼è‡´å³ä½¿å­¦äº†è®¾è®¡æ¨¡å¼ä¹Ÿå¾ˆéš¾é©¾é©­ã€‚æ¯•ç«Ÿè¿™äº›çŸ¥è¯†éƒ½æ˜¯ç»è¿‡ä¸€äº›å®é™…æ“ä½œæç‚¼å‡ºæ¥çš„ç²¾åï¼Œä½†å¦‚æœä½ å¯ä»¥æŒ‰ç…§æœ¬ç³»åˆ—æ–‡ç« ä¸­çš„æ¡ˆä¾‹æ–¹å¼è¿›è¡Œå­¦ä¹ å®æ“ï¼Œè¿˜æ˜¯å¯ä»¥å¢å¼ºè¿™éƒ¨åˆ†è®¾è®¡èƒ½åŠ›çš„ã€‚
