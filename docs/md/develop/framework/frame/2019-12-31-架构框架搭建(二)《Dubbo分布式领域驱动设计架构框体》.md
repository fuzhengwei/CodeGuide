---
layout: post
category: itstack-demo-frame
title: æ¶æ„æ¡†æ¶æ­å»º(äºŒ)ã€ŠDubboåˆ†å¸ƒå¼é¢†åŸŸé©±åŠ¨è®¾è®¡æ¶æ„æ¡†ä½“ã€‹
tagline: by ä»˜æ”¿å§”
tag: [ddd,itstack-demo-frame]
excerpt: éšç€é¡¹ç›®éœ€æ±‚çš„å˜åŒ–ï¼Œæˆ–è€…è¯´ä»å°å…¬å¸è·³æ§½äº†äº’è”ç½‘ã€‚éœ€æ±‚å˜åŒ–äº†ã€æ‰¿è½½çš„ç”¨æˆ·ä½“é‡å¢å¤šäº†ï¼Œæ•´ä½“ç³»ç»Ÿçš„æ¶æ„ä¹Ÿéšç€æ”¹å˜äº†ã€‚å°±åƒä½ åšæ¯•ä¸šè®¾è®¡çš„æ—¶å€™ï¼Œå¯èƒ½åªä¸ºäº†å®ŒæˆåŠŸèƒ½å³å¯ï¼Œä¸€ä¸ªå•ä½“çš„MVCç»“æ„è¶³å¯ä»¥è®©ä½ æ¯•ä¸šã€‚ä½†ï¼ç°åœ¨ä½ é•¿å¤§äº†ï¼Œä¸ºäº†å¯ä»¥æ‰¿è½½å‡ ç™¾ã€å‡ åƒã€å‡ äº¿çš„ç”¨æˆ·ä½“é‡ï¼Œä½ å¼€å§‹å‘ç°åŸæ¥è¿˜æœ‰è¿™ä¹ˆå¤šå¥—è·¯åœ¨é‡Œé¢ã€‚å¯¹äºçˆ±å­¦ä¹ çš„äººï¼Œè‚¯å®šè ¢è ¢æ¬²åŠ¨çš„æƒ³ç ”ç©¶ç ”ç©¶äº†(ä¸ç ”ç©¶ä¹Ÿå†™ä¸äº†ä»£ç ï¼Œèƒ½æŠ—ä½æä¸)ï¼
lock: need
---

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## å‰è¨€ä»‹ç»
éšç€é¡¹ç›®éœ€æ±‚çš„å˜åŒ–ï¼Œæˆ–è€…è¯´ä»å°å…¬å¸è·³æ§½äº†äº’è”ç½‘ã€‚éœ€æ±‚å˜åŒ–äº†ã€æ‰¿è½½çš„ç”¨æˆ·ä½“é‡å¢å¤šäº†ï¼Œæ•´ä½“ç³»ç»Ÿçš„æ¶æ„ä¹Ÿéšç€æ”¹å˜äº†ã€‚å°±åƒä½ åšæ¯•ä¸šè®¾è®¡çš„æ—¶å€™ï¼Œå¯èƒ½åªä¸ºäº†å®ŒæˆåŠŸèƒ½å³å¯ï¼Œä¸€ä¸ªå•ä½“çš„MVCç»“æ„è¶³å¯ä»¥è®©ä½ æ¯•ä¸šã€‚ä½†ï¼ç°åœ¨ä½ é•¿å¤§äº†ï¼Œä¸ºäº†å¯ä»¥æ‰¿è½½å‡ ç™¾ã€å‡ åƒã€å‡ äº¿çš„ç”¨æˆ·ä½“é‡ï¼Œä½ å¼€å§‹å‘ç°åŸæ¥è¿˜æœ‰è¿™ä¹ˆå¤šå¥—è·¯åœ¨é‡Œé¢ã€‚å¯¹äºçˆ±å­¦ä¹ çš„äººï¼Œè‚¯å®šè ¢è ¢æ¬²åŠ¨çš„æƒ³ç ”ç©¶ç ”ç©¶äº†(ä¸ç ”ç©¶ä¹Ÿå†™ä¸äº†ä»£ç ï¼Œèƒ½æŠ—ä½æä¸)ï¼

åœ¨æˆ‘ä»¬çš„æŠ€æœ¯æ ˆä¸­RPCæ¡†æ¶æœ‰ï¼›Dubboã€Motanã€Tarsã€gRPCç­‰ç­‰ï¼Œè€Œä¸”æ¯ä¸ªå…¬å¸å¯èƒ½è¿˜æœ‰è‡ªå·±çš„RPCï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£é‚£ä¹ˆå¯ä»¥å‚ç…§ã€Š[æ‰‹å†™RPCæ¡†æ¶ç¬¬ä¸‰ç« ã€ŠRPCä¸­é—´ä»¶ã€‹](https://bugstack.cn/itstack-demo-netty-3/2019/09/03/%E6%89%8B%E5%86%99RPC%E6%A1%86%E6%9E%B6%E7%AC%AC%E4%B8%89%E7%AB%A0-RPC%E4%B8%AD%E9%97%B4%E4%BB%B6.html)ã€‹ã€‚å¯¹äºä¸€ä¸ªç¨‹åºçŒ¿æ¥è¯´è¿˜æ˜¯è¦ä»å¤šå®¶çš„æ¡†æ¶ä¸­å¸å–è¥å…»ï¼Œç²¾è¿›æŠ€æœ¯ã€‚

æœ¬ç« èŠ‚æˆ‘ä»¬ä¸»è¦å°†DubboæŠ€æœ¯ä¸DDDçš„æ¶æ„èåˆï¼Œæ­å»ºå‡ºåˆ†å¸ƒå¼æ¶æ„ä½“ç³»ã€‚éšç€ä¸€ç‚¹ç‚¹çš„æ·±å…¥ï¼Œæœ¬æ¡ˆä¾‹æ²¡æœ‰å¼•å…¥è¿‡å¤šçš„è¿‡æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚ï¼›Mqã€ESã€åˆ†åº“åˆ†è¡¨ç­‰ï¼Œè¿™äº›ä¼šéšç€åç»­çš„ç« èŠ‚é™†ç»­å®Œå–„ã€‚å½“å‰ç« èŠ‚å°½å¯èƒ½ç®€å•çš„ä½“ç°æ ¸å¿ƒå†…å®¹ï¼›
- åˆ†å¸ƒå¼æ¡†æ¶ä¸‹çˆ¶ç±»æ–‡ä»¶å®šä¹‰ï¼Œç»Ÿä¸€ç‰ˆæœ¬æ ‡å‡†
- RPCæ¡†æ¶éœ€è¦æ¥å£ä¿¡æ¯æè¿°æ€§Jarå¯¹å¤–å‘å¸ƒï¼Œç»“åˆé¢†åŸŸé©±åŠ¨è®¾è®¡è¿›è¡Œå®šä¹‰
- å°è¯•ä½¿ç”¨Dubboçš„å¹¿æ’­æ¨¡å¼ï¼Œè¿›è¡Œå‘å¸ƒå’Œä½¿ç”¨ï¼Œç®€åŒ–ç³»ç»Ÿè°ƒè¯•
- æ„Ÿå—é¢†åŸŸé©±åŠ¨è®¾è®¡çš„é­…åŠ›ï¼Œèƒ½è½åœ°æ‰æœ‰æœºä¼šä½¿ç”¨

**å¥½ï¼** é‚£ä¹ˆï¼Œæœ€ååœ¨å¼€å§‹ä¹‹å‰ï¼Œå†é—®ä¸€ä¸ªå°é—®é¢˜ã€‚

**å®ç°äº†Serializableæ¥å£çš„ç±»ï¼Œæ€ä¹ˆè‡ªåŠ¨ç”ŸæˆserialVersionUID(æ€»ä¸èƒ½è‡ªå·±ä¹±ç¼–å‘€)**

ç­”ï¼šå…¶å®åœ¨Ideaä¸­å·²ç»æä¾›äº†è¿™æ ·è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ï¼Œåªéœ€è¦é…ç½®ä¸Šå³å¯ï¼›File -> Settings -> Editor -> Inspections -> æœç´¢ Serialization issues ï¼Œæ‰¾åˆ° Serializable class without 'serialVersionUID' ->æ‰“ä¸Šå‹¾ï¼ŒApply->OK æ•ˆæœå¦‚å›¾ï¼›

![å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ & é…ç½®æ–¹å¼](https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-frame-dcs-01.png)

## å·¥ç¨‹ç¯å¢ƒ
1. JDK1.8
2. Maven 3.2.3
3. Spring 4.3.24.RELEASE + Mybatis 3.3.0
4. Mysql 5.6 + dbcp2
5. Dubbo 2.6.6
6. Redis 2.9.0

## å·¥ç¨‹æ¨¡å‹

>itstack-demo-frame-parent çˆ¶ç±»å·¥ç¨‹

```java
itstack-demo-frame-parent
â”œâ”€â”€ itstack-demo-frame-parent
â”‚	â”œâ”€â”€ src
â”‚	â”‚	â””â”€â”€ main
â”‚	â”‚	    â””â”€â”€ java
â”‚	â”‚	        â””â”€â”€ org.itstack.demo.frame.common
â”‚	â”‚	            â”œâ”€â”€ constants	
â”‚	â”‚	            â”‚	â””â”€â”€ Constants.java	
â”‚	â”‚	            â””â”€â”€ domain
â”‚	â”‚	             	â”œâ”€â”€ PageRequest.java
â”‚	â”‚	             	â””â”€â”€ Result.java
â”‚	â””â”€â”€	pom.xml
â””â”€â”€	pom.xml
```

>itstack-demo-frame-dcs åˆ†å¸ƒå¼æ¡†æ¶

```java
itstack-demo-frame-dcs
â”œâ”€â”€	itstack-demo-frame-dcs-ddd
â”‚	â””â”€â”€ src
â”‚		â”œâ”€â”€ main
â”‚		â”‚   â”œâ”€â”€ java
â”‚		â”‚   â”‚   â””â”€â”€ org.itstack.demo
â”‚		â”‚   â”‚       â”œâ”€â”€ application	
â”‚		â”‚   â”‚       â”‚	â””â”€â”€ UserService.java	
â”‚		â”‚   â”‚       â”œâ”€â”€ domain
â”‚		â”‚   â”‚       â”‚	â”œâ”€â”€ model
â”‚		â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ aggregates
â”‚		â”‚   â”‚       â”‚	â”‚   â”‚   â””â”€â”€ UserInfoCollect.java
â”‚		â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ req
â”‚		â”‚   â”‚       â”‚	â”‚   â”‚   â””â”€â”€ UserReq.java		
â”‚		â”‚   â”‚       â”‚	â”‚   â””â”€â”€ vo
â”‚		â”‚   â”‚       â”‚	â”‚       â””â”€â”€ UserInfo.java	
â”‚		â”‚   â”‚       â”‚	â”œâ”€â”€ repository
â”‚		â”‚   â”‚       â”‚	â”‚   â””â”€â”€ IUserRepository.java	
â”‚		â”‚   â”‚       â”‚	â””â”€â”€ service	
â”‚		â”‚   â”‚       â”‚	    â””â”€â”€ UserServiceImpl.java	
â”‚		â”‚   â”‚       â”œâ”€â”€ infrastructure
â”‚		â”‚   â”‚       â”‚	â”œâ”€â”€ common
â”‚		â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ EasyResult.java
â”‚		â”‚   â”‚       â”‚	â”‚   â””â”€â”€ PageRequest.java
â”‚		â”‚   â”‚       â”‚	â”œâ”€â”€ dao
â”‚		â”‚   â”‚       â”‚	â”‚   â””â”€â”€ IUserDao.java	
â”‚		â”‚   â”‚       â”‚	â”œâ”€â”€ po
â”‚		â”‚   â”‚       â”‚	â”‚   â””â”€â”€ User.java		
â”‚		â”‚   â”‚       â”‚	â””â”€â”€ repository
â”‚		â”‚   â”‚       â”‚	    â””â”€â”€ UserRepository.java	
â”‚		â”‚   â”‚       â””â”€â”€ interfaces
â”‚		â”‚   â”‚        	â””â”€â”€ UserController.java
â”‚		â”‚   â”œâ”€â”€ resources	
â”‚		â”‚   â”‚   â”œâ”€â”€ mapper
â”‚		â”‚   â”‚   â”œâ”€â”€ props	
â”‚		â”‚   â”‚   â”œâ”€â”€ spring
â”‚		â”‚   â”‚   â”œâ”€â”€ logback.xml
â”‚		â”‚   â”‚   â”œâ”€â”€ mybatis-config.xml
â”‚		â”‚   â”‚   â””â”€â”€ spring-config.xml
â”‚		â”‚   â””â”€â”€ webapp
â”‚		â”‚       â”œâ”€â”€ page
â”‚		â”‚       â”œâ”€â”€ res
â”‚		â”‚       â”œâ”€â”€ WEB-INF
â”‚		â”‚       â”œâ”€â”€ index.html
â”‚		â”‚       â””â”€â”€ res_layui.html
â”‚		â””â”€â”€ test
â”‚			â””â”€â”€ java
â”‚				â””â”€â”€ org.itstack.demo.test
â”‚					â””â”€â”€ ApiTest.java
â”‚					
â””â”€â”€ itstack-demo-frame-dcs-rpc
	â””â”€â”€ src
		â””â”€â”€ main
		    â””â”€â”€ java
		        â””â”€â”€ org.itstack.demo.rpc
		            â”œâ”€â”€ dto	
		            â”‚	â””â”€â”€ UserDto.java
		            â”œâ”€â”€ req	
		            â”‚	â””â”€â”€ UserReq.java
		            â”œâ”€â”€ res	
		            â”‚	â””â”€â”€ UserRes.java	
		            â””â”€â”€ IUserRpc.java					
```

>itstack-demo-frame-dcs-test RPCæµ‹è¯•å·¥ç¨‹

```java
itstack-demo-frame-dcs-test
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org.itstack.demo.interfaces
    â”‚   â”‚       â””â”€â”€ UserController.java
    â”‚   â”œâ”€â”€ resources		
    â”‚   â”‚   â”œâ”€â”€ spring
    â”‚   â”‚   â”œâ”€â”€ logback.xml
    â”‚   â”‚   â””â”€â”€ spring-config.xml
    â”‚   â””â”€â”€ webapp
    â”‚       â”œâ”€â”€ page
    â”‚       â”œâ”€â”€ res
    â”‚       â”œâ”€â”€ WEB-INF
    â”‚       â”œâ”€â”€ index.html
    â”‚       â””â”€â”€ res_layui.html
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org.itstack.demo.test
                 â””â”€â”€ ApiTest.java
```

**ä»¥ä¸‹å¯¹å·¥ç¨‹æ¨¡å—è¿›è¡Œä»‹ç»ï¼Œæ•´ä½“æºç è·å–ï¼Œå¯ä»¥å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œå›å¤ï¼šæ¡†æ¶æ­å»º**

### ä¸€ã€çˆ¶ç±»å·¥ç¨‹

- çˆ¶ç±»å·¥ç¨‹å¦‚æœæ²¡æœ‰å®šä¹‰ä¹Ÿæ˜¯å¯ä»¥å·¥ä½œçš„ï¼Œä½†æ˜¯éšç€ç³»ç»Ÿé‡çš„å¢åŠ å’Œå¤æ‚åº¦æé«˜åï¼Œä¼šè¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤å„ä¸ªç‰ˆæœ¬å’Œå‡çº§ï¼Œæ‰€ä»¥éœ€è¦ï¼›
- å®šä¹‰é€šç”¨commonï¼Œä½¿å„ä¸ªæœåŠ¡å·¥ç¨‹éƒ½æœ‰ç»Ÿä¸€çš„ï¼›å¼‚å¸¸æšä¸¾ã€åˆ†é¡µç±»ã€è¿”å›å¯¹è±¡ç­‰
- å®šä¹‰POMé…ç½®ï¼Œåè°ƒå„ä¸ªç»„ä»¶ç‰ˆæœ¬ä¿æŒç»Ÿä¸€ï¼›å‡å°‘jarå†²çªã€ç»´æŠ¤ç»Ÿä¸€ç‰ˆæœ¬ã€æ–¹ä¾¿å‡çº§

```xml
<groupId>org.itstack.demo</groupId>
<artifactId>itstack-demo-frame-parent</artifactId>
<version>1.0.0-RELEASE</version>
<modules>
    <module>itstack-demo-frame-common</module>
</modules>
<packaging>pom</packaging>
<name>itstack-demo-frame-parent</name>
<description>itstack Demo Project Dependencies</description>
<properties>
    <!-- Base -->
    <jdk.version>1.8</jdk.version>
    <sourceEncoding>UTF-8</sourceEncoding>
    <!-- Spring -->
    <spring.version>4.3.24.RELEASE</spring.version>
    <servlet-api.version>2.5</servlet-api.version>
    <spring.redis.version>1.8.4.RELEASE</spring.redis.version>
    <!-- DBï¼šmysqlã€mybatis-->
    <mysql.version>5.1.20</mysql.version>
    <mybatis.version>3.3.0</mybatis.version>
    <mybatis_spring.version>1.2.3</mybatis_spring.version>
    <!-- JSON -->
    <fastjson.version>1.2.60</fastjson.version>
    <jackson.version>2.5.4</jackson.version>
    <!-- Junit -->
    <junit.version>4.12</junit.version>
    <!-- Common -->
    <commons-dbcp2.version>2.6.0</commons-dbcp2.version>
    <commons-lang3.version>3.8.1</commons-lang3.version>
    <!-- æ—¥å¿— -->
    <slf4j.version>1.7.7</slf4j.version>
    <logback.version>1.0.9</logback.version>
    <!-- å…¶ä»–æœåŠ¡ -->
    <dubbo.version>2.6.6</dubbo.version>
    <zookeeper.version>3.4.14</zookeeper.version>
    <netty.version>4.1.36.Final</netty.version>
    <redis.version>2.9.0</redis.version>
    <scheduler.version>2.3.2</scheduler.version>
</properties>
```

### äºŒã€åˆ†å¸ƒå¼æ¡†æ¶

- Dubboç»“åˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œç”±RPCå®šä¹‰æ¥å£æè¿°ä¿¡æ¯ï¼Œå•ç‹¬å‡ºä¸€ä¸ªæ¨¡å—ä¾¿äºå¤–éƒ¨è°ƒç”¨æ–¹è¿›è¡Œå¼•ç”¨
- é¢†åŸŸé©±åŠ¨è®¾è®¡æ–¹é¢çŸ¥è¯†å·²ç»åœ¨https://bugstack.cnæä¾›å¾ˆå¤šæ€è·¯ï¼Œå¯ä»¥å‚è€ƒ
- æ•´ä½“æ¶æ„æ¨¡å‹åŠŸèƒ½å®šä¹‰å¦‚ä¸‹ï¼›

![å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ & åˆ†å¸ƒå¼æ¡†æ¶åŠŸèƒ½å®šä¹‰](https://bugstack.cn/assets/images/pic-content/2019/11/itstack-demo-frame-dcs-02.png)

#### applicationåº”ç”¨å±‚
åº”ç”¨å±‚æ˜¯æ¯”è¾ƒè–„çš„ä¸€å±‚ï¼Œä¸åšå…·ä½“é€»è¾‘å¼€å‘ã€‚æœ¬å·¥ç¨‹é‡ŒåªåŒ…æ‹¬æœåŠ¡çš„å®šä¹‰ï¼Œå…·ä½“é€»è¾‘æœ‰é¢†åŸŸå±‚å®ç°ã€‚

>UserService.java & æœåŠ¡å®šä¹‰

```java
public interface UserService {

    UserInfoCollect queryUserInfoList(UserReq req);

}
```

#### domainé¢†åŸŸå±‚

é¢†åŸŸå±‚æ˜¯æ•´ä¸ªå·¥ç¨‹çš„æ ¸å¿ƒæœåŠ¡å±‚ï¼Œè¿™é‡Œè´Ÿè´£å¤„ç†å…·ä½“çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®Œæˆé¢†åŸŸæœåŠ¡ã€‚domainä¸‹å¯ä»¥æœ‰å¤šä¸ªé¢†åŸŸï¼Œæ¯ä¸ªé¢†åŸŸé‡ŒåŒ…æ‹¬ï¼›èšåˆã€è¯·æ±‚å¯¹è±¡ã€ä¸šåŠ¡å¯¹è±¡ã€ä»“å‚¨ã€æœåŠ¡ã€‚

>UserServiceImpl.java & æœåŠ¡å®ç°

```java
@Service("userService")
public class UserServiceImpl implements UserService {

    @Resource(name = "userRepository")
    private IUserRepository userRepository;

    @Override
    public UserInfoCollect queryUserInfoList(UserReq req) {
        return userRepository.queryUserInfoList(req);
    }

}
```

>IUserRepository.java & ä»“åº“å®šä¹‰

```java
public interface IUserRepository {

    UserInfoCollect queryUserInfoList(UserReq req);

}
```

#### infrastructureåŸºç¡€å±‚

å®ç°é¢†åŸŸå±‚ä»“å‚¨å®šä¹‰ï¼Œæ•°æ®åº“æ“ä½œä¸ºéä¸šåŠ¡å±æ€§çš„åŠŸèƒ½æ“ä½œï¼Œåœ¨ä»“å‚¨å®ç°å±‚è¿›è¡Œç»„åˆè£…é…DAO&Redis&Cacheç­‰ã€‚

>UserDBRepository.java & ä»“åº“å®ç°

```java
@Repository("userDBRepository")
public class UserDBRepository implements IUserRepository {

    @Resource
    private IUserDao userDao;
    @Resource
    private Redis redis;

    @Override
    public UserInfoCollect queryUserInfoList(UserReq req) {
        Long count = userDao.queryUserInfoCount(req);
        List<User> userList = userDao.queryUserInfoList(req);
        List<UserInfo> userInfoList = new ArrayList<>();
        userList.forEach(user -> {
            UserInfo userInfo = new UserInfo();
            userInfo.setUserId(user.getId());
            userInfo.setName(user.getName());
            userInfo.setAge(user.getAge());
            userInfo.setAddress(user.getAddress());
            userInfo.setEntryTime(user.getEntryTime());
            userInfo.setStatus(user.getStatus());
            userInfoList.add(userInfo);
        });
        UserInfoCollect userInfoCollect = new UserInfoCollect(count, userInfoList);
        if (StringUtils.isNoneBlank(req.getName())) {
            redis.set(req.getName(), JSON.toJSONString(userInfoCollect));
        }
        return userInfoCollect;
    }

}
```

#### interfacesæ¥å£å±‚

- å®ç°rpcå®šä¹‰æ¥å£å¯¹å¤–æä¾›apiï¼Œç›®å‰è¿™ä¸€å±‚æ¯”è¾ƒç®€å•åªéœ€è¦è¿›è¡Œæ¥å£ä½¿ç”¨å³å¯
- å¦‚æœæ˜¯å¯¹å¤–éƒ¨æä¾›æœåŠ¡æ¥å£ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨DTOæ–¹å¼è¿›è¡Œè½¬æ¢ï¼Œé¿å…æ±¡æŸ“åˆ°ä¸šåŠ¡ç±»
- assembler æ˜¯å¯¹DTOå¯¹è±¡çš„è½¬æ¢ç±»ï¼Œå¯ä»¥å°è£…çš„æ›´åŠ ç²¾è‡´ä¸€äº›

>UserRpc.java & RPCæ¥å£å®ç°

```java
@Service("userRpc")
public class UserRpc implements IUserRpc {

    @Resource
    private UserService userService;

    @Override
    public UserRes queryUserInfoList(UserReq req) {
        UserInfoCollect userInfoCollect = userService.queryUserInfoList(UserAssembler.buildUserReq(req));
        return UserAssembler.buildUserInfoCollect(userInfoCollect);
    }

}
```

#### rpcå¯¹å¤–æä¾›æœåŠ¡å±‚

æœåŠ¡æ¥å£å®šä¹‰ï¼Œrpcæ¡†æ¶éœ€è¦å¯¹å¤–æä¾›æ¥å£æè¿°jaråŒ…ï¼Œå› æ­¤å•ç‹¬æå–å‡ºæ¥æ˜¯æœ€æ–¹é¢å¤„ç†çš„ã€‚ä¸è¦è®©è¿™ä¸€å±‚å¼•ç”¨å…¶ä»–å±‚çš„é€»è¾‘ä»£ç ã€‚

>IUserRpc.java & æ¥å£å®šä¹‰

```java
public interface IUserRpc {

    UserRes queryUserInfoList(UserReq req);

}

```

#### çˆ¶ç±»é…ç½®

è¿™ä¸€å±‚æ˜¯æ•´ä¸ªå·¥ç¨‹çš„æœ€å¤–å±‚POMæ–‡ä»¶ï¼Œå¼•å…¥çˆ¶ç±»çš„å®šä¹‰é…ç½®

```java
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <!-- æ¡†æ¶ç»Ÿä¸€æœåŠ¡å®šä¹‰ -->
    <parent>
        <groupId>org.itstack.demo</groupId>
        <artifactId>itstack-demo-frame-parent</artifactId>
        <version>1.0.0-RELEASE</version>
    </parent>

    <artifactId>itstack-demo-frame-dcs</artifactId>
    <packaging>pom</packaging>
    <version>1.0.0-SNAPSHOT</version>
    
    <modules>
        <module>itstack-demo-frame-dcs-ddd</module>
        <module>itstack-demo-frame-dcs-rpc</module>
    </modules>
	
	...
	
</project>
```

#### Dubboé…ç½®ä¿¡æ¯

- dubbo 2.6.x ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨å¹¿æ’­æ–¹å¼è¿›è¡ŒæœåŠ¡æš´æ¼ï¼Œä¹Ÿå°±çœå»äº†zookeeperæ³¨å†Œä¸­å¿ƒã€‚å¯¹äºä¸€äº›ä¸­å°æœåŠ¡æ¥è¨€ï¼Œå°±æ›´åŠ æ–¹ä¾¿äº†ã€‚
- å¹¿æ’­åœ°å€ï¼šaddress="multicast://224.5.6.7:1234"
- NettyæœåŠ¡ç«¯çš„ç«¯å£ï¼š<dubbo:protocol name="dubbo" port="20880"/>

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:dubbo="http://dubbo.apache.org/schema/dubbo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
       http://dubbo.apache.org/schema/dubbo
       http://dubbo.apache.org/schema/dubbo/dubbo.xsd">

    <!-- æä¾›æ–¹åº”ç”¨ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³» -->
    <dubbo:application name="itstack-demo-frame-dcs"/>

    <!-- ä½¿ç”¨multicastå¹¿æ’­æ³¨å†Œä¸­å¿ƒæš´éœ²æœåŠ¡åœ°å€ -->
    <dubbo:registry address="multicast://224.5.6.7:1234"/>

    <!-- ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ -->
    <dubbo:protocol name="dubbo" port="20880"/>

    <!-- å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ -->
    <dubbo:service interface="org.itstack.demo.rpc.IUserRpc" ref="userRpc"/>

</beans>
```

#### æ•°æ®åº“è¡¨é…ç½®(itstack.sql)

```java
DROP TABLE user;
CREATE TABLE user ( id bigint(11) NOT NULL AUTO_INCREMENT, name varchar(32), age int(4), address varchar(128), entryTime datetime, remark varchar(64), createTime datetime, updateTime datetime, status int(4) DEFAULT '0', PRIMARY KEY (id), INDEX idx_name (name) ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
insert into user (id, name, age, address, entryTime, remark, createTime, updateTime, status) values (1, 'æ°´æ°´', 18, 'å‰æ—çœæ¦†æ ‘å¸‚é»‘æ—é•‡å°¹å®¶æ‘5ç»„', '2019-12-22 00:00:00', 'æ— ', '2019-12-22 00:00:00', '2019-12-22 00:00:00', 0);
insert into user (id, name, age, address, entryTime, remark, createTime, updateTime, status) values (2, 'è±†è±†', 18, 'è¾½å®çœå¤§è¿å¸‚æ¸…æ²³æ¹¾å¸é©¬é“407è·¯', '2019-12-22 00:00:00', 'æ— ', '2019-12-22 00:00:00', '2019-12-22 00:00:00', 1);
insert into user (id, name, age, address, entryTime, remark, createTime, updateTime, status) values (3, 'èŠ±èŠ±', 19, 'è¾½å®çœå¤§è¿å¸‚æ¸…æ²³æ¹¾å¸é©¬é“407è·¯', '2019-12-22 00:00:00', 'æ— ', '2019-12-22 00:00:00', '2019-12-22 00:00:00', 0);
```

### ä¸‰ã€RPCæµ‹è¯•å·¥ç¨‹

è¿™ä¸€å±‚å°±å¾ˆç®€å•äº†ï¼Œæ·»åŠ å¥½dubboé…ç½®ï¼Œå¼•ç”¨RPCæ¥å£å®šä¹‰POMï¼Œè°ƒç”¨æœåŠ¡ç«¯æ¥å£è¿”å›æ•°æ®å³å¯

>pom.xml å¼•ç”¨RPCå®šä¹‰æ¥å£

```java
<dependency>
    <groupId>org.itstack.demo</groupId>
    <artifactId>itstack-demo-frame-dcs-rpc</artifactId>
    <version>1.0.0-SNAPSHOT</version>
</dependency>
```

>spring-config-dubbo-consumer.xml & dubboé…ç½®

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:dubbo="http://dubbo.apache.org/schema/dubbo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd">

    <!-- æ¶ˆè´¹æ–¹åº”ç”¨åï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³»ï¼Œä¸æ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸è¦ä¸æä¾›æ–¹ä¸€æ · -->
    <dubbo:application name="itstack-demo-frame-dcs-test"  />

    <!-- ä½¿ç”¨multicastå¹¿æ’­æ³¨å†Œä¸­å¿ƒæš´éœ²å‘ç°æœåŠ¡åœ°å€ -->
    <dubbo:registry address="multicast://224.5.6.7:1234" />

    <!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œå¯ä»¥å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService -->
    <dubbo:reference id="userRpc" interface="org.itstack.demo.rpc.IUserRpc" />

</beans>
```

>ApiTest.java & å•å…ƒæµ‹è¯•ç±»

```java
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:spring-config.xml")
public class ApiTest {

    private Logger logger = LoggerFactory.getLogger(ApiTest.class);

    @Resource
    private IUserRpc userRpc;

    @Test
    public void test_queryUserInfoList() {
        UserReq req = new UserReq();
        req.setName("è±†è±†");
        req.setPage("1", "5");
        UserRes res = userRpc.queryUserInfoList(req);
        logger.info("\r\næµ‹è¯•ç»“æœ reqï¼š{} resï¼š{}", JSON.toJSONString(req), JSON.toJSONString(res));
    }

}
```

## æµ‹è¯•éªŒè¯

1. å¯åŠ¨Redisé…ç½®æœåŠ¡(å¯ä»¥ä¸‹è½½winç‰ˆæœ¬)ï¼Œå› ä¸ºæœ¬æ¡ˆä¾‹ä½¿ç”¨åˆ°Redisã€‚
2. tomcatä¸­å¯åŠ¨itstack-demo-frame-dcs
3. å¯åŠ¨å•å…ƒæµ‹è¯•è°ƒç”¨itstack-demo-frame-dcs-test

```java
2019-12-29 09:20:43.268 [DubboMulticastRegistryReceiver] INFO  com.alibaba.dubbo.registry.multicast.MulticastRegistry[387] -  [DUBBO] Notify urls for subscribe url consumer://127.0.0.1/org.itstack.demo.rpc.IUserRpc?application=itstack-demo-frame-dcs-test&category=providers,configurators,routers&dubbo=2.0.2&interface=org.itstack.demo.rpc.IUserRpc&methods=queryUserInfoList&pid=14416&revision=1.0.0-SNAPSHOT&side=consumer&timestamp=1577582442523, urls: [dubbo://127.0.0.1:20880/org.itstack.demo.rpc.IUserRpc?anyhost=true&application=itstack-demo-frame-dcs&bean.name=org.itstack.demo.rpc.IUserRpc&dubbo=2.0.2&generic=false&interface=org.itstack.demo.rpc.IUserRpc&methods=queryUserInfoList&pid=15048&revision=1.0.0-SNAPSHOT&side=provider&timestamp=1577582403854], dubbo version: 2.6.6, current host: 127.0.0.1
2019-12-29 09:20:43.397 [DubboMulticastRegistryReceiver] INFO  com.alibaba.dubbo.remoting.transport.AbstractClient[282] -  [DUBBO] Successed connect to server /127.0.0.1:20880 from NettyClient 127.0.0.1 using dubbo version 2.6.6, channel is NettyChannel [channel=[id: 0x82d694ae, L:/127.0.0.1:65193 - R:/127.0.0.1:20880]], dubbo version: 2.6.6, current host: 127.0.0.1
2019-12-29 09:20:43.398 [DubboMulticastRegistryReceiver] INFO  com.alibaba.dubbo.remoting.transport.AbstractClient[91] -  [DUBBO] Start NettyClient JRA1W11T0247/127.0.0.1 connect to the server /127.0.0.1:20880, dubbo version: 2.6.6, current host: 127.0.0.1
2019-12-29 09:20:43.449 [main] INFO  com.alibaba.dubbo.registry.multicast.MulticastRegistry[387] -  [DUBBO] Notify urls for subscribe url consumer://127.0.0.1/org.itstack.demo.rpc.IUserRpc?application=itstack-demo-frame-dcs-test&category=providers,configurators,routers&dubbo=2.0.2&interface=org.itstack.demo.rpc.IUserRpc&methods=queryUserInfoList&pid=14416&revision=1.0.0-SNAPSHOT&side=consumer&timestamp=1577582442523, urls: [dubbo://127.0.0.1:20880/org.itstack.demo.rpc.IUserRpc?anyhost=true&application=itstack-demo-frame-dcs&bean.name=org.itstack.demo.rpc.IUserRpc&dubbo=2.0.2&generic=false&interface=org.itstack.demo.rpc.IUserRpc&methods=queryUserInfoList&pid=15048&revision=1.0.0-SNAPSHOT&side=provider&timestamp=1577582403854], dubbo version: 2.6.6, current host: 127.0.0.1
2019-12-29 09:20:43.454 [main] INFO  com.alibaba.dubbo.config.AbstractConfig[429] -  [DUBBO] Refer dubbo service org.itstack.demo.rpc.IUserRpc from url multicast://224.5.6.7:1234/com.alibaba.dubbo.registry.RegistryService?anyhost=true&application=itstack-demo-frame-dcs-test&bean.name=org.itstack.demo.rpc.IUserRpc&check=false&dubbo=2.0.2&generic=false&interface=org.itstack.demo.rpc.IUserRpc&methods=queryUserInfoList&pid=14416&register.ip=127.0.0.1&remote.timestamp=1577582403854&revision=1.0.0-SNAPSHOT&side=consumer&timestamp=1577582442523, dubbo version: 2.6.6, current host: 127.0.0.1
åäºŒæœˆ 29, 2019 9:20:43 ä¸Šåˆ org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping register
ä¿¡æ¯: Mapped "{[/api/user/queryUserInfoList],methods=[GET]}" onto public org.itstack.demo.rpc.res.UserRes org.itstack.demo.controller.UserController.queryUserInfoList(java.lang.String,java.lang.String,java.lang.String)
åäºŒæœˆ 29, 2019 9:20:43 ä¸Šåˆ org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter initControllerAdviceCache
ä¿¡æ¯: Looking for @ControllerAdvice: org.springframework.context.support.GenericApplicationContext@4f51b3e0: startup date [Sun Dec 29 09:20:41 CST 2019]; root of context hierarchy
åäºŒæœˆ 29, 2019 9:20:43 ä¸Šåˆ org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter initControllerAdviceCache
ä¿¡æ¯: Looking for @ControllerAdvice: org.springframework.context.support.GenericApplicationContext@4f51b3e0: startup date [Sun Dec 29 09:20:41 CST 2019]; root of context hierarchy
åäºŒæœˆ 29, 2019 9:20:44 ä¸Šåˆ org.springframework.web.servlet.handler.SimpleUrlHandlerMapping registerHandler
ä¿¡æ¯: Mapped URL path [/**] onto handler 'org.springframework.web.servlet.resource.DefaultServletHttpRequestHandler#0'
2019-12-29 09:20:45.157 [main] INFO  org.itstack.demo.test.ApiTest[31] - 
æµ‹è¯•ç»“æœ reqï¼š{"name":"è±†è±†","pageEnd":5,"pageStart":0} resï¼š{"count":1,"list":[{"name":"è±†è±†","status":1}],"result":{"code":"0000","info":"æˆåŠŸ"}}
åäºŒæœˆ 29, 2019 9:20:45 ä¸Šåˆ org.springframework.context.support.GenericApplicationContext doClose
ä¿¡æ¯: Closing org.springframework.context.support.GenericApplicationContext@4f51b3e0: startup date [Sun Dec 29 09:20:41 CST 2019]; root of context hierarchy
2019-12-29 09:20:45.159 [DubboShutdownHook] INFO  com.alibaba.dubbo.config.DubboShutdownHook[56] -  [DUBBO] Run shutdown hook now., dubbo version: 2.6.6, current host: 127.0.0.1
2019-12-29 09:20:45.160 [Thread-1] INFO  com.alibaba.dubbo.registry.support.AbstractRegistryFactory[64] -  [DUBBO] Close all registries [multicast://224.5.6.7:1234/com.alibaba.dubbo.registry.RegistryService?application=itstack-demo-frame-dcs-test&dubbo=2.0.2&interface=com.alibaba.dubbo.registry.RegistryService&pid=14416&timestamp=1577582442547], dubbo version: 2.6.6, current host: 127.0.0.1
```

## ç»¼ä¸Šæ€»ç»“

- å¹³å¸¸è¿™ç§æ¡†æ¶çš„å¼€å‘å¯èƒ½ä¹Ÿå¾ˆå¤šï¼Œä½†æ˜¯å¾€å¾€ä¸æ€»ç»“æ²‰æ·€ä¸‹æ¥ï¼Œä¹Ÿå°±æ²¡æœ‰åŠæ³•ä»å…¨å±€å»å­¦ä¹ ã€‚å­¦ä¼šçš„åªæ˜¯å¼€å‘åŠŸèƒ½ï¼Œè‚¯å®šæ»¡è¶³ä¸äº†ä½ çš„æˆé•¿å¿«ä¹ï¼
- å½“DDDé›†åˆdubboåï¼Œæˆ‘ä¹Ÿæƒ³è¿‡è¯•å›¾å°†å››å±‚åˆ†ä¸ºå››ä¸ªæ¨¡å—å¼€å‘ã€‚ä½†æ˜¯æ¯ä¸€å±‚è¡”æ¥å®šä¹‰å®ç°ï¼Œä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œé™¤éæ”¹å˜æ•´ä½“çš„ç»“æ„ã€‚ä½†å¦‚æœæ”¹å˜äº†å°±ä¸å¤ªç¬¦åˆç›®å‰çš„DDDäº†ï¼Œåˆæ˜¯è´«è¡€æ¨¡å‹ã€‚
- æ¶æ„çš„å­¦ä¹ è¿˜æ˜¯éœ€è¦ä»å¤šç§æ¶æ„æ¨¡å¼ä¸­å¸å–è¥å…»ï¼Œå¥½çš„æ¶æ„ä¼šè®©æ•´ä¸ªå¼€å‘éƒ½å˜å¾—èˆ’æœé¡ºç•…ï¼Œå¦‚æœæ€»æ˜¯åœ¨ä¸€å¨ä¸€å¨çš„ä¸œè¥¿é‡Œå¼€å‘ï¼Œæ—¥ä¹…ç”Ÿæƒ…å°±å±é™©äº†ï¼ï¼ˆå·§å…‹åŠ›å‘³çš„shiï¼Œå’Œshiå‘³çš„å·§å…‹åŠ›ä½ åƒå“ªä¸ªï¼‰

