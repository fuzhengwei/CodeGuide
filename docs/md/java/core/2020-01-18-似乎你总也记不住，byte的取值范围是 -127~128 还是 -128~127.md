---
layout: post
category: itstack-demo-any
title: ä¼¼ä¹ä½ æ€»ä¹Ÿè®°ä¸ä½ï¼Œbyteå–å€¼èŒƒå›´æ˜¯ -127~128 è¿˜æ˜¯ -128~127
tagline: by ä»˜æ”¿å§”
tag: [itstack-demo-any]
excerpt: æ— è®ºåœ¨é¢è¯•è¿‡ç¨‹ä¸­è¿˜æ˜¯å¹³æ—¶çš„æŠ€æœ¯äº¤æµä¸­ï¼Œä¼¼ä¹æœ‰å¾ˆå¤šå°ä¼™ä¼´å§‹ç»ˆè®°ä¸ä½javaä¸­byteç±»å‹çš„å–å€¼èŒƒå›´æ˜¯å¤šå°‘ã€‚ç©¶å…¶åŸå› å¤§éƒ¨åˆ†ç¨‹åºå‘˜å¯¹è¿™ä¸ªå–å€¼èŒƒå›´æ˜¯ä¸åœ¨æ„çš„ï¼Œå› ä¸ºçŸ¥é“ä¸ä¸çŸ¥é“éƒ½ä¸å½±å“ä½ å®Œæˆå·¥ä½œã€‚å¦å¤–è¿™ç§çŸ¥è¯†ç‚¹å‹æ ¹ä¸æ˜¯è®©ä½ æ­»è®°ç¡¬èƒŒçš„ï¼Œå½“ç„¶å¦‚æœä½ æ˜¯ä»å…¶ä»–æ–‡ç§‘ä¸“ä¸šè½¬è¿‡æ¥å­¦ç¼–ç¨‹å¼€å‘çš„ï¼Œè¿˜æƒ…æœ‰å¯åŸã€‚ä½†å¯¹ä¸€ä¸ªç†ç§‘ç”Ÿæ¥è¯´ï¼Œå°±ä¸å¤ªåº”è¯¥äº†ã€‚
lock: need
---

# ä¼¼ä¹ä½ æ€»ä¹Ÿè®°ä¸ä½ï¼Œbyteå–å€¼èŒƒå›´æ˜¯ -127~128 è¿˜æ˜¯ -128~127

>å°å‚…å“¥ &  [https://bugstack.cn](https://bugstack.cn) <br/>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œä¸“æ³¨äºåŸåˆ›ä¸“é¢˜æ¡ˆä¾‹ï¼Œä»¥æœ€æ˜“å­¦ä¹ ç¼–ç¨‹çš„æ–¹å¼åˆ†äº«çŸ¥è¯†ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ã€‚ç›®å‰å·²å®Œæˆçš„ä¸“é¢˜æœ‰ï¼›Netty4.xå®æˆ˜ä¸“é¢˜æ¡ˆä¾‹ã€ç”¨Javaå®ç°JVMã€åŸºäºJavaAgentçš„å…¨é“¾è·¯ç›‘æ§ã€æ‰‹å†™RPCæ¡†æ¶ã€æ¶æ„è®¾è®¡ä¸“é¢˜æ¡ˆä¾‹ã€æºç åˆ†æç­‰ã€‚<br/><br/>ä½ ç”¨å‰‘ğŸ—¡ã€æˆ‘ç”¨åˆ€ğŸ”ªï¼Œå¥½çš„ä»£ç éƒ½å¾ˆçƒ§ï¼Œæœ›ä½ ä¸åå‡ºæ‹›ï¼

## ä¸€ã€å‰è¨€ä»‹ç»
æ— è®ºåœ¨é¢è¯•è¿‡ç¨‹ä¸­è¿˜æ˜¯å¹³æ—¶çš„æŠ€æœ¯äº¤æµä¸­ï¼Œä¼¼ä¹æœ‰å¾ˆå¤šå°ä¼™ä¼´å§‹ç»ˆè®°ä¸ä½javaä¸­byteç±»å‹çš„å–å€¼èŒƒå›´æ˜¯å¤šå°‘ã€‚ç©¶å…¶åŸå› å¤§éƒ¨åˆ†ç¨‹åºå‘˜å¯¹è¿™ä¸ªå–å€¼èŒƒå›´æ˜¯ä¸åœ¨æ„çš„ï¼Œå› ä¸ºçŸ¥é“ä¸ä¸çŸ¥é“éƒ½ä¸å½±å“ä½ å®Œæˆå·¥ä½œã€‚å¦å¤–è¿™ç§çŸ¥è¯†ç‚¹å‹æ ¹ä¸æ˜¯è®©ä½ æ­»è®°ç¡¬èƒŒçš„ï¼Œå½“ç„¶å¦‚æœä½ æ˜¯ä»å…¶ä»–æ–‡ç§‘ä¸“ä¸šè½¬è¿‡æ¥å­¦ç¼–ç¨‹å¼€å‘çš„ï¼Œè¿˜æƒ…æœ‰å¯åŸã€‚ä½†å¯¹ä¸€ä¸ªç†ç§‘ç”Ÿæ¥è¯´ï¼Œå°±ä¸å¤ªåº”è¯¥äº†ã€‚

## äºŒã€å–å€¼èŒƒå›´è®¡ç®—

åœ¨javaä¸­ï¼Œbyteå 1ä¸ªå­—èŠ‚ï¼Œ8æ¯”ç‰¹ä½ï¼Œå¯ä»¥æƒ³è±¡æˆ8ä¸ªå°å—çš„æ•°æ®åŒºé—´ï¼Œé¦–ä½ç”¨0ã€1ä»£è¡¨ç¬¦å·ä½ã€‚**0[æ­£]**ã€**1[è´Ÿ]**ï¼Œé‚£ä¹ˆç»˜åˆ¶å‡ºä¸€ä¸ªè¡¨æ ¼å¦‚ä¸‹ï¼›

| byte | | | | | | | | |
| :------|:------|:------|:------|:------|:------|:------|:------|------|
|åºå·|	8	|	7	|	6   |5  |4   |3   |2   |1   |
|2â¿|	2^7 |2^6 |2^5 |2^4 |2^3 |2^2   |2^1   | 2^0 |
|å€¼|	128	|	64	|	32   |16  |8  |4   |2   |1   |
|+127|	0	|	1	|	1   |1  |1   |1   |1   |1   |
|-128|	1	|	0	|	0   |0  |0   |0   |0  |0   |

> +127 äºŒè¿›åˆ¶æ±‚å’Œ

```java
  2^0+2^1+2^2+2^3+2^4+2^5+2^6+2^7
= 2^(n+1) - 1
= 127
```

> -128 äºŒè¿›åˆ¶æ±‚å’Œ

```java
  2^8
= 128
```

å¥½äº†ï¼Œç°åœ¨çœ‹æ‡‚é€»è¾‘å°±å¾ˆæ¸…æ™°äº†ï¼Œä¸ºä»€ä¹ˆæ˜¯è´Ÿæ•°åˆ°-128ï¼Œå› ä¸º1ä»£è¡¨è´Ÿæ•°çš„ç¬¦å·ä½ï¼Œä¹Ÿå°±æ•´æ•´å¥½å¥½æ˜¯2çš„8æ¬¡æ–¹ï¼Œ-128ã€‚

## ä¸‰ã€è¿›åˆ¶æ•°å€¼è½¬æ¢

å› ä¸ºjavaè¯­è¨€ä¸ä¸€äº›å…¶ä»–è¯­è¨€byteçš„å–å€¼èŒƒå›´ä¸åŒï¼Œæ‰€ä»¥åœ¨æœ‰æ—¶å€™å¤„ç†ä¸€äº›æ–‡ä»¶æ—¶å€™éœ€è¦è¿›è¡Œè¿›åˆ¶è½¬æ¢ã€‚ä¹Ÿå°±æ˜¯ -128~127 ä¸ 0~255 çš„è½¬æ¢å¤„ç†ï¼›

æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å°†ä¸€ä¸ªjavaä¸­byte=120ï¼Œè½¬æ¢æˆ 0~255å–å€¼èŒƒå›´çš„æ•°å€¼ï¼›

ä¸€èˆ¬å¯ä»¥è¿›è¡Œä¸è¿ç®—ï¼›

```java
120 & 0x0FF
```

åŒæ—¶è¿˜å¯ä»¥è¿›è¡Œå¢ä½è¿ç®—ï¼›(ä¹Ÿå°±æ˜¯å°†8ä¸ªå­—èŠ‚é•¿åº¦çš„å†…å®¹ï¼Œæ”¾åˆ°16ä¸ªé•¿åº¦ä¸­ï¼Œè¿›è¡Œè½¬æ¢)

```java
byte[] val = {-120};
BigInteger bigInteger = new BigInteger(1, val);
//æœ‰ç¬¦å·
System.out.println(bigInteger.byteValue());
//æ— ç¬¦å·ï¼ˆå¢ä½ï¼‰
String str_hex = bigInteger.toString(16);
System.out.println(Integer.parseInt(str_hex, 16)); // 136
```

## å››ã€è§£æä¸€æ®µclasså­—èŠ‚ç 

javaçš„ç±»æ–‡ä»¶éƒ½ä¼šè¢«ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œé‚£ä¹ˆclassæ–‡ä»¶éœ€è¦ç»è¿‡jvmçš„è§£æã€éªŒè¯ï¼ŒåŠ è½½ç­‰å¤„ç†æ‰å¯ä»¥è¢«è™šæ‹Ÿæœºçš„æŒ‡ä»¤æ‰§è¡Œæ“ä½œã€‚

å¦‚æœä¸‹æ˜¯ä¸€æ®µclassæ–‡ä»¶çš„byteæ•°ç»„ï¼Œå°†å†…å®¹è§£æå‡ºå¯¹åº”çš„ç»“æœï¼›

```java
public class ClassReaderTest {

    //å–éƒ¨åˆ†å­—èŠ‚ç ï¼šjava.lang.String
    private static byte[] classData = {
            -54, -2, -70, -66, 0, 0, 0, 52, 2, 26, 3, 0, 0, -40, 0, 3, 0, 0, -37, -1, 3, 0, 0, -33, -1, 3, 0, 1, 0, 0, 8, 0,
            59, 8, 0, 83, 8, 0, 86, 8, 0, 87, 8, 0, 110, 8, 0, -83, 8, 0, -77, 8, 0, -49, 8, 0, -47, 1, 0, 3, 40, 41, 73, 1,
            0, 20, 40, 41, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 59, 1, 0, 20, 40, 41,
            76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 3, 40, 41, 86, 1, 0, 3,
            40, 41, 90, 1, 0, 4, 40, 41, 91, 66, 1, 0, 4, 40, 41, 91, 67, 1, 0, 4, 40, 67, 41, 67, 1, 0, 21, 40, 68, 41, 76,
            106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 4, 40, 73, 41, 67, 1, 0, 4};

    public static void main(String[] args) {

        //classDataæ˜¯æˆ‘ä»¬çš„å­—èŠ‚ç ï¼Œç¬¬ä¸€æ˜¯-54ï¼Œå› ä¸ºbyteå–å€¼èŒƒå›´æ˜¯-128~+127ï¼Œæ‰€ä»¥å¦‚æœæƒ³çœ‹åˆ°å’Œå…¶ä»–è™šæ‹Ÿæœºä¸€æ ·çš„å€¼ï¼Œéœ€è¦è¿›è¡Œä¸è¿ç®—ã€‚
        System.out.println("* byteå­—èŠ‚ç ä¸è¿ç®—åŸå€¼(-54)æ¢è¡Œå(-54 & 0x0FF)ï¼š" + (-54 & 0x0FF));

        //æ ¡éªŒé­”æ•°
        readAndCheckMagic();

        //æ ¡éªŒç‰ˆæœ¬å·
        readAndCheckVersion();

        //æ¥ä¸‹æ¥ä¼šä¾æ¬¡è¯»å–[å¯ä»¥å‚ç…§javaç‰ˆæœ¬è™šæ‹Ÿæœºä»£ç ]ï¼›constantPoolã€accessFlagsã€thisClassIdxã€supperClassIdxã€interfacesã€fieldsã€methodsã€attributes
    }

    /**
     * æ ¡éªŒé­”æ•°
     * <p>
     * å¾ˆå¤šæ–‡ä»¶æ ¼å¼éƒ½ä¼šè§„å®šæ»¡è¶³è¯¥æ ¼å¼çš„æ–‡ä»¶å¿…é¡»ä»¥æŸå‡ ä¸ªå›ºå®šå­—èŠ‚å¼€å¤´ï¼Œè¿™å‡ ä¸ªå­—èŠ‚ä¸»è¦èµ·åˆ°æ ‡è¯†ä½œç”¨ï¼Œå«ä½œé­”æ•°(magic number)ã€‚
     * ä¾‹å¦‚ï¼›
     * PDFæ–‡ä»¶ä»¥4å­—èŠ‚â€œ%PDFâ€(0x25ã€0x50ã€0x44ã€0x46)å¼€å¤´ï¼Œ
     * ZIPæ–‡ä»¶ä»¥2å­—èŠ‚â€œPKâ€(0x50ã€0x4B)å¼€å¤´
     * classæ–‡ä»¶ä»¥4å­—èŠ‚â€œ0xCAFEBABEâ€å¼€å¤´
     */
    private static void readAndCheckMagic() {
        System.out.println("\r\n------------ æ ¡éªŒé­”æ•° ------------");
        //ä»classå­—èŠ‚ç ä¸­è¯»å–å‰å››ä½
        byte[] magic_byte = new byte[4];
        System.arraycopy(classData, 0, magic_byte, 0, 4);

        //å°†4ä½byteå­—èŠ‚è½¬æˆ16è¿›åˆ¶å­—ç¬¦ä¸²
        String magic_hex_str = new BigInteger(1, magic_byte).toString(16);
        System.out.println("magic_hex_strï¼š" + magic_hex_str);

        //byte_magic_str æ˜¯16è¿›åˆ¶çš„å­—ç¬¦ä¸²ï¼Œcafebabeï¼Œå› ä¸ºjavaä¸­æ²¡æœ‰æ— ç¬¦å·æ•´å‹ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦æ— ç¬¦å·åªèƒ½æ”¾åˆ°æ›´é«˜ä½ä¸­
        long magic_unsigned_int32 = Long.parseLong(magic_hex_str, 16);
        System.out.println("magic_unsigned_int32ï¼š" + magic_unsigned_int32);

        //é­”æ•°æ¯”å¯¹ï¼Œä¸€ç§é€šè¿‡å­—ç¬¦ä¸²æ¯”å¯¹ï¼Œå¦å¤–ä¸€ç§ä½¿ç”¨å‡è®¾çš„æ— ç¬¦å·16è¿›åˆ¶æ¯”è¾ƒã€‚å¦‚æœä½¿ç”¨æ— ç¬¦å·æ¯”è¾ƒéœ€è¦å°†0xCAFEBABE & 0x0FFFFFFFFLä¸è¿ç®—
        System.out.println("0xCAFEBABE & 0x0FFFFFFFFLï¼š" + (0xCAFEBABE & 0x0FFFFFFFFL));

        if (magic_unsigned_int32 == (0xCAFEBABE & 0x0FFFFFFFFL)) {
            System.out.println("classå­—èŠ‚ç é­”æ•°æ— ç¬¦å·16è¿›åˆ¶æ•°å€¼ä¸€è‡´æ ¡éªŒé€šè¿‡");
        } else {
            System.out.println("classå­—èŠ‚ç é­”æ•°æ— ç¬¦å·16è¿›åˆ¶æ•°å€¼ä¸€è‡´æ ¡éªŒæ‹’ç»");
        }

    }

    /**
     * æ ¡éªŒç‰ˆæœ¬å·
     * <p>
     * é­”æ•°ä¹‹åæ˜¯classæ–‡ä»¶çš„æ¬¡ç‰ˆæœ¬å·å’Œä¸»ç‰ˆæœ¬å·ï¼Œéƒ½æ˜¯u2ç±»å‹ã€‚å‡è®¾æŸclassæ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·æ˜¯Mï¼Œæ¬¡ç‰ˆæœ¬å·æ˜¯mï¼Œé‚£ä¹ˆå®Œæ•´çš„ç‰ˆæœ¬å·å¯ä»¥
     * è¡¨ç¤ºæˆâ€œM.mâ€çš„å½¢å¼ã€‚æ¬¡ç‰ˆæœ¬å·åªåœ¨J2SE 1.2ä¹‹å‰ç”¨è¿‡ï¼Œä»1.2å¼€å§‹åŸºæœ¬ä¸Šå°±æ²¡æœ‰ä»€ä¹ˆç”¨äº†(éƒ½æ˜¯0)ã€‚ä¸»ç‰ˆæœ¬å·åœ¨J2SE 1.2ä¹‹å‰æ˜¯45ï¼Œ
     * ä»1.2å¼€å§‹ï¼Œæ¯æ¬¡æœ‰å¤§ç‰ˆæœ¬çš„Javaç‰ˆæœ¬å‘å¸ƒï¼Œéƒ½ä¼šåŠ 1ï½›45ã€46ã€47ã€48ã€49ã€50ã€51ã€52ï½
     */
    private static void readAndCheckVersion() {
        System.out.println("\r\n------------ æ ¡éªŒç‰ˆæœ¬å· ------------");

        //ä»classå­—èŠ‚ç ç¬¬4ä½å¼€å§‹è¯»å–ï¼Œè¯»å–2ä½
        byte[] minor_byte = new byte[2];
        System.arraycopy(classData, 4, minor_byte, 0, 2);
        //å°†2ä½byteå­—èŠ‚è½¬æˆ16è¿›åˆ¶å­—ç¬¦ä¸²
        String minor_hex_str = new BigInteger(1, minor_byte).toString(16);
        System.out.println("minor_hex_strï¼š" + minor_hex_str);
        //minor_unsigned_int32 è½¬æˆæ— ç¬¦å·16è¿›åˆ¶
        int minor_unsigned_int32 = Integer.parseInt(minor_hex_str, 16);
        System.out.println("minor_unsigned_int32ï¼š" + minor_unsigned_int32);

        //ä»classå­—èŠ‚ç ç¬¬6ä½å¼€å§‹è¯»å–ï¼Œè¯»å–2ä½
        byte[] major_byte = new byte[2];
        System.arraycopy(classData, 6, major_byte, 0, 2);
        //å°†2ä½byteå­—èŠ‚è½¬æˆ16è¿›åˆ¶å­—ç¬¦ä¸²
        String major_hex_str = new BigInteger(1, major_byte).toString(16);
        System.out.println("major_hex_strï¼š" + major_hex_str);
        //major_unsigned_int32 è½¬æˆæ— ç¬¦å·16è¿›åˆ¶
        int major_unsigned_int32 = Integer.parseInt(major_hex_str, 16);
        System.out.println("major_unsigned_int32ï¼š" + major_unsigned_int32);

        System.out.println("ç‰ˆæœ¬å·ï¼š" + major_unsigned_int32 + "." + minor_unsigned_int32);

    }

}
```

**æµ‹è¯•ç»“æœï¼š**

```java
* byteå­—èŠ‚ç ä¸è¿ç®—åŸå€¼(-54)æ¢è¡Œå(-54 & 0x0FF)ï¼š202

------------ æ ¡éªŒé­”æ•° ------------
magic_hex_strï¼šcafebabe
magic_unsigned_int32ï¼š3405691582
0xCAFEBABE & 0x0FFFFFFFFLï¼š3405691582
classå­—èŠ‚ç é­”æ•°æ— ç¬¦å·16è¿›åˆ¶æ•°å€¼ä¸€è‡´æ ¡éªŒé€šè¿‡

------------ æ ¡éªŒç‰ˆæœ¬å· ------------
minor_hex_strï¼š0
minor_unsigned_int32ï¼š0
major_hex_strï¼š34
major_unsigned_int32ï¼š52
ç‰ˆæœ¬å·ï¼š52.0

Process finished with exit code 0
```

## äº”ã€ç»¼ä¸Šæ€»ç»“

- å…³äºbyteåœ¨æ–‡ç« ï¼›[ã€Šç”¨javaå®ç°jvmè™šæ‹Ÿæœºã€‹](https://bugstack.cn/itstack-demo-jvm/itstack-demo-jvm.html)ä¸­è®²è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰å•ç‹¬æ‹¿å‡ºæ¥åˆ†æï¼Œç°åœ¨å•ç‹¬åˆ†æä¸‹ä¹Ÿå¢å¼ºè®°å¿†ã€‚
- ä»»ä½•ä¸€ä¸ªå¯èƒ½ä¸èµ·çœ¼çš„çŸ¥è¯†ç‚¹ï¼Œä¸æ˜¯ä»–ä¸é‡è¦ï¼Œè€Œæ˜¯ä½ è¿˜æ²¡æœ‰ç”¨åˆ°ã€‚å°±åƒæœ‰å¥è¯è¯´ï¼Œä¸æ˜¯è¯»ä¹¦æ²¡ç”¨ï¼Œè€Œæ˜¯ä½ æ²¡ç”¨ã€‚å›½è¯­åšå¤§ç²¾æ·±ï¼
- è®¤è®¤çœŸçœŸå¯¹å¾…æ¯ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œä¸æ–­çš„å¤¯å®è‡ªå·±çš„åœ°åŸºï¼Œè¿™å°±åƒæ˜¯ç›–æˆ¿å­åœ¨æ‰“åœ°åŸºä¸€æ ·ã€‚è¶Šæ·±è¶Šç¨³ï¼Œæœ€ç»ˆæ‰€æœèƒ½äºä½ çš„ä¸Šå±‚æ¶æ„æ‰ä¼šæ›´åŠ ç²¾è¿›ã€‚
