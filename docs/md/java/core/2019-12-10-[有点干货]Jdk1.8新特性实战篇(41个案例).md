---
layout: post
category: itstack-demo-any
title: æœ‰ç‚¹å¹²è´§ | Jdk1.8æ–°ç‰¹æ€§å®æˆ˜ç¯‡(41ä¸ªæ¡ˆä¾‹)
tagline: by ä»˜æ”¿å§”
tag: [java,itstack-demo-any]
excerpt: jdk8çš„æ–°ç‰¹æ€§åŒ…æ‹¬äº†ï¼›Lambdaã€å‡½æ•°å¼æ¥å£ã€å››é¥¼è°ƒç”¨::ã€å†…ç½®å‡½æ•°(æ–­è¨€ã€Functionã€ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…)ã€Streamæµã€Mapé›†åˆç‰¹æ€§ã€æ—¥æœŸã€æ³¨è§£ç­‰
lock: need
---

# æœ‰ç‚¹å¹²è´§ | Jdk1.8æ–°ç‰¹æ€§å®æˆ˜ç¯‡(41ä¸ªæ¡ˆä¾‹)

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## å‰è¨€
ä¸€ç›´æƒ³æŠŠjdk1.8çš„æ–°ç‰¹æ€§æ•´ç†ä¸‹ï¼Œæ°å¥½çœ‹åˆ°è€å¤–çš„git(æ–‡åæœ‰é“¾æ¥)ï¼Œåœ¨è¿™ä¸ªç»“æ„ä¸Šç»§ç»­å®Œå–„äº†è¯´æ˜å’ŒåŠŸèƒ½ï¼Œåšäº†41ä¸ªå•å…ƒæµ‹è¯•æ¡ˆä¾‹ï¼Œæ–¹ä¾¿æ–°äººå­¦ä¹ ã€‚ä»¥ä¸‹å†…å®¹å¾ˆå¹²ï¼Œå¯¹äºä¸€ä¸ªèŒæ–°å°ç™½æ¥è¯´ï¼Œå­¦ä¹ jdk1.8çš„æ–°ç‰¹æ€§ï¼ŒåŸºæœ¬çœ‹ä¸€éå°±çŸ¥é“ä¸ª7788äº†ï¼Œåœ¨ç†Ÿè¯»ä¸¤éæœ€åè·Ÿç€å†™ä¸€éï¼Œé‚£ä¹ˆåœ¨å®é™…é¡¹ç›®ä¸­å°±å¯ä»¥è¿ç”¨äº†ã€‚ä¸è¿‡ï¼æ–°ç‰¹æ€§ï¼Œè™½ç„¶å¾ˆå¥½ã€‚ä½†å¦‚æœæƒ³ç”¨ï¼Œé‚£ä¹ˆè‡ªå·±ä¸€å®šè¦çœ‹çœ‹ç›¸å¯¹åº”çš„æºç å¹¶å¤šç»ƒä¹ ï¼Œå¦åˆ™çœŸçš„å®¹æ˜“ç»™è‡ªå·±ææ™•ï¼Œåˆå¾ˆéš¾é˜…è¯»ã€‚

## é›¶ã€å›é¡¾ä¸€ä¸ªæŠ½è±¡ç±»

åœ¨jdk1.8ä¹‹å‰ï¼Œå› ä¸ºæ¥å£é‡Œåªèƒ½åšæ–¹æ³•å®šä¹‰ä¸èƒ½æœ‰æ–¹æ³•çš„å®ç°ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šåœ¨æŠ½è±¡ç±»é‡Œé¢å®ç°é»˜è®¤çš„æ–¹æ³•ï½›ä¸€èˆ¬è¿™ä¸ªé»˜è®¤çš„æ–¹æ³•æ˜¯æŠ½è±¡åå…¬ç”¨çš„æ–¹æ³•ï¼Œä¸éœ€è¦æ¯ä¸€ä¸ªç»§æ‰¿è€…éƒ½å»å®ç°ï¼Œåªéœ€è°ƒç”¨å³å¯ï½ã€‚å°±åƒä¸‹é¢è¿™æ ·ï¼›

>åœ¨å®šä¹‰çš„æ—¶å€™ï¼›
```java
public abstract class AFormula {

    abstract double calculate(int a);

    // å¹³æ–¹
    double sqrt(int a) {
        return Math.sqrt(a);
    }

}
```

>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼›
```java
@Test
public void test_00() {
    AFormula aFormula = new AFormula() {
        @Override
        double calculate(int a) {
            return a * a;
        }
    };
    System.out.println(aFormula.calculate(2)); //æ±‚å¹³æ–¹ï¼š4
    System.out.println(aFormula.sqrt(2));     //æ±‚å¼€æ–¹ï¼š1.4142135623730951
}
```

## ä¸€ã€åœ¨æ¥å£ä¸­æä¾›é»˜è®¤çš„æ–¹æ³•å®ç°ï¼ˆæœ‰ç‚¹åƒæŠ½è±¡ç±»ï¼‰

åœ¨jdk1.8é‡Œé¢ï¼Œä¸ä»…å¯ä»¥å®šä¹‰æ¥å£ï¼Œè¿˜å¯ä»¥åœ¨æ¥å£ä¸­æä¾›é»˜è®¤çš„å®ç°ã€‚è¿™ä¸€ä¸ªå°å°çš„æ”¹å˜å´è®©æ•´ä¸ªæŠ½è±¡è®¾è®¡éƒ½éšç€æ”¹å˜äº†ï¼

>åœ¨å®šä¹‰çš„æ—¶å€™ï¼›{default å…³é”®å­—å¿…é¡»}
```java
public interface IFormula {

    double calculate(int a);

    // å¹³æ–¹
    default double sqrt(int a) {
        return Math.sqrt(a);
    }

}
```

>åœ¨ä½¿ç”¨çš„æ—¶å€™(ä¸€)ï¼›
```java
@Test
public void test_01() {
    IFormula formula = new IFormula() {
        @Override
        public double calculate(int a) {
            return a * a;
        }
    };
    System.out.println(formula.calculate(2));
    System.out.println(formula.sqrt(2));
}
```

>åœ¨ä½¿ç”¨çš„æ—¶å€™(äºŒ)ï¼›å¦‚æœåªæ˜¯ä¸€é‡Œé¢æ–¹å¼è¿™ä¹ˆä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡å¤šå¤§æ„æ€äº†ã€‚æˆ‘ä¸€ç›´è¯´è¿‡ï¼›å¥½çš„ä»£ç éƒ½å¾ˆéªšï¼

1. a;		aæ˜¯ä¸€ä¸ªå…¥å‚åç§°ï¼Œå¯ä»¥å…¶ä»–ä»»ä½•åå­—
2. ->a*aï¼›	ç®­å¤´æŒ‡å‘æ˜¯å…·ä½“çš„å®ç°
3. ä½†æ˜¯ï¼Œè¿™æ ·å…¶å®ä¸å¤ªé€‚åˆåŠ æ—¥å¿—äº†

```java
@Test
public void test_02() {
    // å…¥å‚a å’Œ å®ç°
    IFormula formula = a -> a * a;
    System.out.println(formula.calculate(2));
    System.out.println(formula.sqrt(2));
}
```

## äºŒã€Lambda è¡¨è¾¾å¼

å› ä¸ºæœ‰æ¥å£ä¸­å¯ä»¥å¢åŠ é»˜è®¤çš„æ–¹æ³•å®ç°ï¼Œé‚£ä¹ˆJavaè‚¯å®šæ˜¯å› ä¸ºè¦ç®€åŒ–å¼€å‘æ‰å‡ºç°çš„è¿™ä¹ˆä¸ªè®¾è®¡ã€‚æ‰€ä»¥ä½ ä¼šä»å„ä¸ªæˆ‘ä»¬ä»¥å‰çš„Listã€Setç­‰ç­‰æ‰€æœ‰æ¥å£ä¸­çœ‹åˆ°é»˜è®¤çš„æ–¹æ³•å®ç°ã€‚

ä»ä¸€æ®µç†Ÿæ‚‰çš„æ’åºåˆ—å­å…¥æ‰‹

```java
List<String> names = Arrays.asList("peter", "anna", "mike", "xenia");

Collections.sort(names, new Comparator<String>() {
    @Override
    public int compare(String a, String b) {
        return b.compareTo(a);
    }
});
```

Collections å·¥å…·ç±»æä¾›äº†é™æ€æ–¹æ³• sort æ–¹æ³•ï¼Œå…¥å‚æ˜¯ä¸€ä¸ª List é›†åˆï¼Œå’Œä¸€ä¸ª Comparator æ¯”è¾ƒå™¨ï¼Œä»¥ä¾¿å¯¹ç»™å®šçš„ List é›†åˆè¿›è¡Œæ’åºã€‚ä¸Šé¢çš„ç¤ºä¾‹ä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ä½œä¸ºå…¥å‚ï¼Œè¿™ç§ç±»ä¼¼çš„æ“ä½œåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å·¥ä½œä¸­éšå¤„å¯è§ã€‚

Java 8 ä¸­ä¸å†æ¨èè¿™ç§å†™æ³•ï¼Œè€Œæ˜¯æ¨èä½¿ç”¨ Lambda è¡¨è¾¾ï¼š

```java
Collections.sort(names, (String a, String b) -> {
    return b.compareTo(a);
});
```
 
ä¸Šé¢çš„è¿™æ®µåŒæ ·åŠŸèƒ½çš„ä»£ç å—ï¼Œç®€çŸ­å¹²å‡€äº†è®¸å¤šã€‚å°±åƒå©†åª³ä¸€æ ·å¯èƒ½åˆšå¼€å§‹çœ‹ä¸ä¹ æƒ¯ï¼Œä½†æ˜¯æ¥è§¦æ¥è§¦å°±å–œæ¬¢äº†ã€‚å› ä¸ºï¼Œå®ƒè¿˜å¯ä»¥æ›´åŠ ç®€çŸ­ä¼˜ç§€ï¼›

```java
Collections.sort(names, (String a, String b) -> b.compareTo(a));
```

ä¸ºäº†è¿½æ±‚æè‡´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©å®ƒå†çŸ­ç‚¹ï¼šï½›å½“ç„¶è¿‡ä½ çš„å®ç°ä¸æ˜¯ä¸€è¡Œä»£ç ï¼Œé‚£ä¹ˆä¸èƒ½è¿™ä¹ˆå¹²ï½

```java
names.sort((a, b) -> b.compareTo(a));
```

java.util.List é›†åˆç°åœ¨å·²ç»æ·»åŠ äº† sort æ–¹æ³•ã€‚è€Œä¸” Java ç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®ç±»å‹æ¨æ–­æœºåˆ¶åˆ¤æ–­å‡ºå‚æ•°ç±»å‹ï¼Œè¿™æ ·ï¼Œä½ è¿å…¥å‚çš„ç±»å‹éƒ½å¯ä»¥çœç•¥å•¦ï¼Œæ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆéªšæ°”å‘¢ï¼

>java.util.List.sort

```
default void sort(Comparator<? super E> c) {
    Object[] a = this.toArray();
    Arrays.sort(a, (Comparator) c);
    ListIterator<E> i = this.listIterator();
    for (Object e : a) {
        i.next();
        i.set((E) e);
    }
}
```

å¥½äº†ï¼ä½ ä»¥ä¸ºè¿™å°±ç»“æŸäº†å—ï¼Œä¸ï¼å®ƒè¿˜å¯ä»¥æ›´çŸ­ï¼(å¾—ç›ŠäºComparatoræ¥å£ä¸­è¿˜æä¾›äº†stacké»˜è®¤æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æ¥å£ä¸­ä¸æ˜¯åªå¯æœ‰defaulté»˜è®¤å®ç°ï¼Œè¿˜å¯ä»¥æœ‰é™æ€æ–¹æ³•)

```java
names.sort(Comparator.reverseOrder());
```

## ä¸‰ã€å‡½æ•°å¼æ¥å£ Functional Interfaces

>How does lambda expressions fit into Java's type system? Each lambda corresponds to a given type, specified by an interface. A so called functional interface must contain exactly one abstract method declaration. Each lambda expression of that type will be matched to this abstract method. Since default methods are not abstract you're free to add default methods to your functional interface.

é€šè¿‡ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šè¿‡Lambdaå¯ä»¥å¼€å‘å‡ºåŒæ ·åŠŸèƒ½çš„é€»è¾‘ä½†æ˜¯ä»£ç å´å¾ˆç®€å•ï¼Œé‚£ä¹ˆJvmæ˜¯å¦‚ä½•è¿›è¡Œç±»å‹æ¨æ–­ï¼Œå¹¶ä¸”æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å‘¢ï¼Ÿ

é€šè¿‡å®˜æ–‡ä»‹ç»ä»¥åŠæˆ‘ä»¬ä½¿ç”¨å‘ç°ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªæ¥å£éƒ½å¯ä»¥ç¼©å†™æˆLambdaè¡¨è¾¾å¼çš„å¼€å‘æ–¹å¼ã€‚å…¶å®æ˜¯åªæœ‰é‚£äº›å‡½æ•°å¼æ¥å£(Functional Interface)æ‰èƒ½ç¼©å†™æˆ Lambda è¡¨ç¤ºå¼ã€‚

æ‰€è°“å‡½æ•°å¼æ¥å£(Functional Interface)å°±æ˜¯åªåŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„å£°æ˜ã€‚é’ˆå¯¹è¯¥æ¥å£ç±»å‹çš„æ‰€æœ‰ Lambda è¡¨è¾¾å¼éƒ½ä¼šä¸è¿™ä¸ªæŠ½è±¡æ–¹æ³•åŒ¹é…ã€‚{å¦å¤–ï¼Œåªæ˜¯åœ¨æ¥å£ä¸Šæ·»åŠ defaultå¹¶ä¸ç®—æŠ½è±¡æ–¹æ³•}

æ€»ç»“ï¼šä¸ºäº†ä¿è¯ä¸€ä¸ªæ¥å£æ˜ç¡®çš„è¢«å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°å¼æ¥å£(Functional Interface)ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¯¥æ¥å£æ·»åŠ æ³¨è§£ï¼š@FunctionalInterfaceã€‚è¿™æ ·ï¼Œä¸€æ—¦ä½ æ·»åŠ äº†ç¬¬äºŒä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šç«‹åˆ»æŠ›å‡ºé”™è¯¯æç¤ºã€‚ï½›ä¸å¡«å†™ï¼Œä½†æ˜¯åªå†™ä¸€ä¸ªdefaultä¹Ÿå¯ä»¥ï½

>å®šä¹‰å«æœ‰æ³¨è§£@FunctionalInterfaceçš„æ¥å£

```java
@FunctionalInterface
public interface IConverter<F, T> {

    T convert(F from);

}
```

1. å…ˆæ¥ä¸€æ®µä¼ ç»Ÿæ–¹å¼ & ç®€å•æ˜“æ‡‚å“ˆï¼Œå› ä¸ºçœ‹ä¹ æƒ¯äº†

```java
IConverter<String, Integer> converter01 = new IConverter<String, Integer>() {
@Override
public Integer convert(String from) {
	return Integer.valueOf(from);
}
```

2. ç¨å¾®ç®€åŒ–ä¸‹ï¼ŒåŒ–ä¸ªå¦† & (form)ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°æ‹¬å·å¯ä»¥ä¸è¦

```java
IConverter<String, Integer> converter02 = (from) -> {
    return Integer.valueOf(from);
};
```

3. ç»§ç»­ç®€åŒ–ï¼Œå› ä¸ºä»–çš„å®ç°åªæœ‰ä¸€è¡Œä»£ç ï¼Œå¯ä»¥æ›´åŠ ç®€çŸ­

```java
IConverter<String, Integer> converter03 = from -> Integer.valueOf(from);
```

4. è¿˜èƒ½çŸ­ç‚¹ï¼Œå…¶å®è¿™ä¸ªå¦ç±»å±äºä¸‹ä¸€æ®µçš„å†…å®¹äº†ï¼Œå…ˆæ”¾è¿™æœ‰ä¸ªå°è±¡

```java
IConverter<Integer, String> converter04 = String::valueOf;
```

## å››ã€æ–¹æ³•å’Œæ„é€ å‡½æ•°çš„ä¾¿æ·åº”ç”¨

åœ¨ä¸Šé¢æˆ‘ä»¬å…ˆåŠ äº†å°è±¡ç‰‡æ®µ XX::xxï¼Œå®ƒä¹Ÿæ˜¯Java8çš„æ–°ç‰¹æ€§ä¾¿æ·å¼å¼•ç”¨ï¼Œè¿™å››ä¸ªç‚¹å¯èƒ½ä½ åœ¨å…¶ä»–è¯­è¨€é‡Œä¹Ÿè§è¿‡ã€‚

```java
IConverter<Integer, String> converter04 = String::valueOf;
String converted04 = converter04.convert(11);
System.out.println(converted04);
```

è¿™å››ä¸ªç‚¹::çš„å…³é”®å­—ï¼Œä¸åªæ˜¯å¯ä»¥å¼•ç”¨æ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼Œè¿˜å¯ä»¥å¼•ç”¨æ™®é€šæ–¹æ³•ã€‚

```java
public class Something{
    public String startsWith(String s) {
        return String.valueOf(s.charAt(0));
    }
}
```

```java
IConverter<String, String> converter01 = s -> String.valueOf(s.charAt(0)); //[å‚ç…§ç‰©]ç›´æ¥æŠŠé€»è¾‘æ”¾åˆ°è¿™è°ƒç”¨
IConverter<String, String> converter02 = something::startsWith;            //å¼•ç”¨çš„æ–¹æ³•ä½“é‡Œé¢é€»è¾‘å¯ä»¥æ›´å¤šï¼Œå¦åˆ™åªæ˜¯ä¸€å¥ä»£ç å¹¶ä¸èƒ½é€‚åˆæ‰€æœ‰çš„æƒ…å†µ
System.out.println(converter01.convert("Java"));
System.out.println(converter02.convert("Java"));
```

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ä½¿ç”¨è¿™å››ä¸ªç‚¹ï¼Œæ¥çœ‹ä¸‹å¦‚ä½•å¼•ç”¨ç±»çš„æ„é€ å™¨ã€‚é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ç±»ï¼›

```java
public class Person {
    String firstName;
    String lastName;

    Person() {}

    Person(String firstName, String lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }
}
```

ç„¶åæˆ‘è¿˜éœ€è¦é¡¶ä¸€ä¸ªå·¥å‚ç±»ï¼Œç”¨äºç”ŸæˆPersonå¯¹è±¡ï¼›

```java
@FunctionalInterface
public interface IPersonFactory<P extends Person> {

    P create(String firstName, String lastName);

}
```

ç°åœ¨å°±åˆ°äº†ç”¨å››é¥¼::çš„æ—¶å€™äº†ï¼›

```java
IPersonFactory<Person> personFactory = Person::new;  //[å‚ç…§ç‰©]ï¼š(firstName, lastName) -> new Person(firstName, lastName);
Person person = personFactory.create("Peter", "Parker");
```

æé†’ï¼›å·¥å‚å‡½æ•°ä¸­ä¾ç„¶åªèƒ½æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™
![](https://github.com/fuzhengwei/fuzhengwei.github.io/blob/master/assets/images/pic-content/2019/11/itstack-demo-any-01.png?raw=true)

å››é¥¼::ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç›´æ¥å¼•ç”¨åˆ°Personç±»çš„æ„é€ å‡½æ•°ï¼Œç„¶å Java ç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®ç±»çš„ç­¾åé€‰ä¸­æ­£ç¡®çš„æ„é€ å™¨å»å®ç° PersonFactory.create æ–¹æ³•ã€‚

## äº”ã€Lambdaä½œç”¨èŒƒå›´

>Accessing outer scope variables from lambda expressions is very similar to anonymous objects. You can access final variables from the local outer scope as well as instance fields and static variables.

Lambdaè¡¨è¾¾å¼è®¿é—®å¤–éƒ¨çš„å˜é‡(å±€éƒ¨å˜é‡ï¼Œæˆå‘˜å˜é‡ï¼Œé™æ€å˜é‡ï¼Œæ¥å£çš„é»˜è®¤æ–¹æ³•),å®ƒä¸åŒ¿åå†…éƒ¨ç±»è®¿é—®å¤–éƒ¨å˜é‡éå¸¸ç›¸ä¼¼ã€‚

### 1. è®¿é—®å±€éƒ¨å˜é‡

æˆ‘ä»¬å¯ä»¥ä»lambdaè¡¨è¾¾å¼çš„å¤–éƒ¨èŒƒå›´è¯»å–æœ€ç»ˆå±€éƒ¨å˜é‡numï¼›

```java
int num = 1;
IConverter<Integer, String> stringConverter = from -> String.valueOf(from + num);
String convert = stringConverter.convert(2);
System.out.println(convert); // 3
```

ä½†æ˜¯è¿™ä¸ªnumæ˜¯ä¸å¯å˜å€¼ï¼Œè¿™æ ·æ”¹å˜å€¼ä¼šæŠ¥é”™ï¼›

```java
int num = 1;
IConverter<Integer, String> stringConverter =
        (from) -> String.valueOf(from + num);
num = 3;
```

>Variable used in lambda expression should be final or effectively final

å¦å¤–åœ¨lambdaè¡¨è¾¾å¼å†…éƒ¨ä¿®æ”¹ä¹Ÿæ˜¯ä¸å…è®¸çš„ï¼›

```java
int num = 1;
IConverter<Integer, String> converter = (from) -> {
    String value = String.valueOf(from + num);
    num = 3;
    return value;
};
```

>Variable used in lambda expression should be final or effectively final

### 2. è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡

åœ¨ Lambda è¡¨è¾¾å¼ä¸­è®¿é—®å±€éƒ¨å˜é‡ã€‚ä¸å±€éƒ¨å˜é‡ç›¸æ¯”ï¼Œåœ¨ Lambda è¡¨è¾¾å¼ä¸­å¯¹æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ‹¥æœ‰è¯»å†™æƒé™ï¼š

```java
public class Lambda4 {

    // é™æ€å˜é‡
    static int outerStaticNum;
    // æˆå‘˜å˜é‡
    int outerNum;

    void testScopes() {
        IConverter<Integer, String> stringConverter1 = (from) -> {
            // å¯¹æˆå‘˜å˜é‡èµ‹å€¼
            outerNum = 23;
            return String.valueOf(from);
        };

        IConverter<Integer, String> stringConverter2 = (from) -> {
            // å¯¹é™æ€å˜é‡èµ‹å€¼
            outerStaticNum = 72;
            return String.valueOf(from);
        };
    }

}
```

### 3. è®¿é—®é»˜è®¤æ¥å£æ–¹æ³•ã€€

è¿˜è®°å¾—ç¬¬ä¸€èŠ‚çš„IFormulaç¤ºä¾‹å—ï¼Ÿã€€

```java
public interface IFormula {

    double calculate(int a);

    // å¹³æ–¹
    default double sqrt(int a) {
        return Math.sqrt(a);
    }

}
```

å½“æ—¶ï¼Œæˆ‘ä»¬åœ¨æ¥å£ä¸­å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰é»˜è®¤å®ç°çš„ sqrt æ±‚å¹³æ–¹æ ¹æ–¹æ³•ï¼Œåœ¨åŒ¿åå†…éƒ¨ç±»ä¸­æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®¿é—®æ­¤æ–¹æ³•ï¼š

```java
IFormula formula = new IFormula() {
    @Override
    public double calculate(int a) {
        return a * a;
    }
};
```

ä½†æ˜¯ä¸èƒ½é€šè¿‡lambdaè¡¨è¾¾å¼è®¿é—®é»˜è®¤æ–¹æ³•ï¼Œè¿™æ ·çš„ä»£ç æ²¡æ³•é€šè¿‡ç¼–è¯‘ï¼›

```java
IFormula formula = (a) -> sqrt(a * a);
```

å¸¦æœ‰é»˜è®¤å®ç°çš„æ¥å£æ–¹æ³•ï¼Œæ˜¯ä¸èƒ½åœ¨ lambda è¡¨è¾¾å¼ä¸­è®¿é—®çš„ï¼Œä¸Šé¢è¿™æ®µä»£ç å°†æ— æ³•è¢«ç¼–è¯‘é€šè¿‡ã€‚

## å…­ã€å†…ç½®çš„å‡½æ•°å¼æ¥å£

JDK 1.8 API åŒ…å«äº†å¾ˆå¤šå†…ç½®çš„å‡½æ•°å¼æ¥å£ã€‚å…¶ä¸­å°±åŒ…æ‹¬æˆ‘ä»¬åœ¨è€ç‰ˆæœ¬ä¸­ç»å¸¸è§åˆ°çš„ Comparator å’Œ Runnableï¼ŒJava 8 ä¸ºä»–ä»¬éƒ½æ·»åŠ äº† @FunctionalInterface æ³¨è§£ï¼Œä»¥ç”¨æ¥æ”¯æŒ Lambda è¡¨è¾¾å¼ã€‚

ä¾‹å¦‚æˆ‘ä»¬æ—§ç‰ˆæœ¬çš„Jdkä¸­å¸¸ç”¨çš„ Comparator å’Œ Runnable å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ–°çš„å‡½æ•°å¼æ¥å£ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°æ³¨è§£å®ç°Lamdbaæ”¯æŒï¼Œå®ƒä»¬å¾ˆå¤šéƒ½å€Ÿé‰´äºçŸ¥åçš„ [Google Guava](https://github.com/google/guava) åº“ã€‚

å³ä½¿ä½ å·²ç»ç†Ÿæ‚‰è¿™ä¸ªç±»åº“ï¼Œä¹Ÿåº”è¯¥å¯†åˆ‡å…³æ³¨é‚£äº›æ¥å£æ˜¯å¦‚ä½•é€šè¿‡ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•æ‰©å±•æ¥æ‰©å±•çš„ï¼š

### 1. Predicate æ–­è¨€

Predicate æ˜¯ä¸€ä¸ªå¯ä»¥æŒ‡å®šå…¥å‚ç±»å‹ï¼Œå¹¶è¿”å› boolean å€¼çš„å‡½æ•°å¼æ¥å£ã€‚å®ƒå†…éƒ¨æä¾›äº†ä¸€äº›å¸¦æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼Œå¯ä»¥ è¢«ç”¨æ¥ç»„åˆä¸€ä¸ªå¤æ‚çš„é€»è¾‘åˆ¤æ–­ï¼ˆand, or, negateï¼‰ï¼š

```java
@Test
public void test11() {
	Predicate<String> predicate = (s) -> s.length() > 0;

	boolean foo0 = predicate.test("foo");           // true
	boolean foo1 = predicate.negate().test("foo");  // negateå¦å®šç›¸å½“äº!true

	Predicate<Boolean> nonNull = Objects::nonNull;
	Predicate<Boolean> isNull = Objects::isNull;

	Predicate<String> isEmpty = String::isEmpty;
	Predicate<String> isNotEmpty = isEmpty.negate();
}
```

### 2. Functions

Function å‡½æ•°å¼æ¥å£çš„ä½œç”¨æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…¶æä¾›ä¸€ä¸ªåŸæ–™ï¼Œä»–ç»™ç”Ÿäº§ä¸€ä¸ªæœ€ç»ˆçš„äº§å“ã€‚é€šè¿‡å®ƒæä¾›çš„é»˜è®¤æ–¹æ³•ï¼Œç»„åˆ,é“¾è¡Œå¤„ç†(compose, andThen)ï¼š

```java
@Test
public void test12() {
    Function<String, Integer> toInteger = Integer::valueOf;                                         //è½¬Integer
    Function<String, String> backToString = toInteger.andThen(String::valueOf);                     //è½¬String
    Function<String, String> afterToStartsWith = backToString.andThen(new Something()::startsWith); //æˆªå–ç¬¬ä¸€ä½ 
    String apply = afterToStartsWith.apply("123");// "123"
    System.out.println(apply);
}
```

### 3. Suppliers

Supplier ä¸ Function ä¸åŒï¼Œå®ƒä¸æ¥å—å…¥å‚ï¼Œç›´æ¥ä¸ºæˆ‘ä»¬ç”Ÿäº§ä¸€ä¸ªæŒ‡å®šçš„ç»“æœï¼Œæœ‰ç‚¹åƒç”Ÿäº§è€…æ¨¡å¼ï¼š

```java
@Test
public void test13() {
    Supplier<Person> personSupplier0 = Person::new;
    personSupplier0.get();   // new Person
    Supplier<String> personSupplier1 = Something::test01;  //è¿™ä¸ªtestæ–¹æ³•æ˜¯é™æ€çš„ï¼Œä¸”æ— å…¥å‚
    personSupplier1.get();   // hi
    
    Supplier<String> personSupplier2 = new Something()::test02;
}
```

### 4. Consumers

å¯¹äº Consumerï¼Œæˆ‘ä»¬éœ€è¦æä¾›å…¥å‚ï¼Œç”¨æ¥è¢«æ¶ˆè´¹ï¼Œå¦‚ä¸‹é¢è¿™æ®µç¤ºä¾‹ä»£ç ï¼š

```java
@Test
public void test14() {
    // å‚ç…§ç‰©ï¼Œæ–¹ä¾¿çŸ¥é“ä¸‹é¢çš„Lamdbaè¡¨è¾¾å¼å†™æ³•
    Consumer<Person> greeter01 = new Consumer<Person>() {
        @Override
        public void accept(Person p) {
            System.out.println("Hello, " + p.firstName);
        }
    };
    Consumer<Person> greeter02 = (p) -> System.out.println("Hello, " + p.firstName);
    greeter02.accept(new Person("Luke", "Skywalker"));  //Hello, Luke
    Consumer<Person> greeter03 = new MyConsumer<Person>()::accept;    // ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰ç±»å’Œæ–¹æ³•çš„æ–¹å¼å»è°ƒç”¨ï¼Œè¿™æ ·æ‰æ˜¯å®é™…å¼€å‘çš„å§¿åŠ¿
    greeter03.accept(new Person("Luke", "Skywalker"));  //Hello, Luke
}
```

### 5. Comparators

Comparator åœ¨ Java 8 ä¹‹å‰æ˜¯ä½¿ç”¨æ¯”è¾ƒæ™®éçš„ã€‚Java 8 ä¸­é™¤äº†å°†å…¶å‡çº§æˆäº†å‡½æ•°å¼æ¥å£ï¼Œè¿˜ä¸ºå®ƒæ‹“å±•äº†ä¸€äº›é»˜è®¤æ–¹æ³•ï¼š

```java
@Test
public void test15(){
    Comparator<Person> comparator01 = (p1, p2) -> p1.firstName.compareTo(p2.firstName);
    Comparator<Person> comparator02 = Comparator.comparing(p -> p.firstName);           //ç­‰åŒäºä¸Šé¢çš„æ–¹å¼
    Person p1 = new Person("John", "Doe");
    Person p2 = new Person("Alice", "Wonderland");
    comparator01.compare(p1, p2);             // > 0
    comparator02.reversed().compare(p1, p2);  // < 0
}
```

## ä¸ƒã€Optionals

é¦–å…ˆï¼ŒOptional å®ƒä¸æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œè®¾è®¡å®ƒçš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆNullPointerExceptionï¼‰ï¼Œè¦çŸ¥é“åœ¨ Java ç¼–ç¨‹ä¸­ï¼Œç©ºæŒ‡é’ˆå¼‚å¸¸å¯æ˜¯è‡­åæ˜­è‘—çš„ã€‚

è®©æˆ‘ä»¬æ¥å¿«é€Ÿäº†è§£ä¸€ä¸‹ Optional è¦å¦‚ä½•ä½¿ç”¨ï¼ä½ å¯ä»¥å°† Optional çœ‹åšæ˜¯åŒ…è£…å¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ null, ä¹Ÿæœ‰å¯èƒ½é nullï¼‰çš„å®¹å™¨ã€‚å½“ä½ å®šä¹‰äº†

ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„å¯¹è±¡å¯èƒ½æ˜¯ç©ºï¼Œä¹Ÿæœ‰å¯èƒ½éç©ºçš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥è€ƒè™‘ç”¨ Optional æ¥åŒ…è£…å®ƒï¼Œè¿™ä¹Ÿæ˜¯åœ¨ Java 8 è¢«æ¨èä½¿ç”¨çš„åšæ³•ã€‚

```java
@Test
public void test16(){
    Optional<String> optional = Optional.of("bam");
    optional.isPresent();                  // true
    optional.get();                        // "bam"
    optional.orElse("fallback");    // "bam"
    optional.ifPresent((s) -> System.out.println(s.charAt(0)));     // "b"
    Optional<Person> optionalPerson = Optional.of(new Person());
    optionalPerson.ifPresent(s -> System.out.println(s.firstName));
}
```

## å…«ã€Stream æµ

ä»€ä¹ˆæ˜¯ Stream æµï¼Ÿ

ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ java.util.Stream å¯¹ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ çš„é›†åˆåšå„ç§æ“ä½œã€‚è¿™äº›æ“ä½œå¯èƒ½æ˜¯ ä¸­é—´æ“ä½œ äº¦æˆ–æ˜¯ ç»ˆç«¯æ“ä½œã€‚
ç»ˆç«¯æ“ä½œä¼šè¿”å›ä¸€ä¸ªç»“æœï¼Œè€Œä¸­é—´æ“ä½œä¼šè¿”å›ä¸€ä¸ª Stream æµã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åªèƒ½å¯¹å®ç°äº† java.util.Collection æ¥å£çš„ç±»åšæµçš„æ“ä½œã€‚

Stream æµæ”¯æŒåŒæ­¥æ‰§è¡Œï¼Œä¹Ÿæ”¯æŒå¹¶å‘æ‰§è¡Œã€‚

æ³¨æ„ï¼šMapä¸æ”¯æŒStreamæµï¼Œä½†æ˜¯ä»–çš„keyå’Œvalueæ˜¯æ”¯æŒçš„ï¼

è®©æˆ‘ä»¬å…ˆçœ‹çœ‹Streamæµæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»¥å­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼åˆ›å»ºä¸€ä¸ªç¤ºä¾‹ï¼›

```java
List<String> stringCollection = new ArrayList<>();
stringCollection.add("ddd2");
stringCollection.add("aaa2");
stringCollection.add("bbb1");
stringCollection.add("aaa1");
stringCollection.add("bbb3");
stringCollection.add("ccc");
stringCollection.add("bbb2");
stringCollection.add("ddd1");
```

### 1. Filter è¿‡æ»¤

Filter çš„å…¥å‚æ˜¯ä¸€ä¸ª Predicate, ä¸Šé¢å·²ç»è¯´åˆ°ï¼ŒPredicate æ˜¯ä¸€ä¸ªæ–­è¨€çš„ä¸­é—´æ“ä½œï¼Œå®ƒèƒ½å¤Ÿå¸®æˆ‘ä»¬ç­›é€‰å‡ºæˆ‘ä»¬éœ€è¦çš„é›†åˆå…ƒç´ ã€‚å®ƒçš„è¿”å‚åŒæ · æ˜¯ä¸€ä¸ª Stream æµï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ foreach ç»ˆç«¯æ“ä½œï¼Œæ¥æ‰“å°è¢«ç­›é€‰çš„å…ƒç´ ï¼š

```java
@Test
public void test17(){
    stringCollection
            .stream()
            .filter((s) -> s.startsWith("a"))
            .forEach(System.out::println);
}
```

### 2. Sorted æ’åº

Sorted åŒæ ·æ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œï¼Œå®ƒçš„è¿”å‚æ˜¯ä¸€ä¸ª Stream æµã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ª Comparator ç”¨æ¥è‡ªå®šä¹‰æ’åºï¼Œå¦‚æœä¸ä¼ ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„æ’åºè§„åˆ™ã€‚

```java
@Test
public void test18() {
	stringCollection
			.stream()
			.sorted()
			.filter((s) -> s.startsWith("a"))
			.forEach(System.out::println);
}
```

>æ³¨æ„ï¼›è¿™ä¸ªsorted åªæ˜¯åšäº†ä¸€ä¸ªæ’åºçš„è§†å›¾è¿›è¡Œè¾“å‡ºï¼Œå®é™…æ²¡æœ‰å°†Listå†…çš„æ•°æ®è¿›è¡Œæ’åº

```java
System.out.println(stringCollection);
// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1
```

### 3. Map è½¬æ¢

ä¸­é—´æ“ä½œæ˜ å°„é€šè¿‡ç»™å®šçš„å‡½æ•°å°†æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ã€‚ä¾‹å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼Œé€šè¿‡ map æˆ‘ä»¬å°†æ¯ä¸€ä¸ª string è½¬æˆå¤§å†™ï¼š

```java
@Test
public void test19(){
    stringCollection
            .stream()
            .map(String::toUpperCase)
            .sorted(Comparator.reverseOrder())  //ç­‰åŒäº(a, b) -> b.compareTo(a)
            .forEach(System.out::println);
}
```

è¿™ä¸ªå¯ä»¥ç”¨åšDTOæ•°æ®å¯¹è±¡è½¬æ¢ï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å‘ä¸­å°†DTOè½¬ä¸ºDOå‘åå°ä¼ è¾“ã€‚

### 4. Match åŒ¹é…

é¡¾åæ€ä¹‰ï¼Œmatch ç”¨æ¥åšåŒ¹é…æ“ä½œï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ª boolean ç±»å‹ã€‚é€šè¿‡ match, æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„éªŒè¯ä¸€ä¸ª list ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªç±»å‹çš„å…ƒç´ ã€‚

```java
@Test
public void test20(){
    // anyMatchï¼šéªŒè¯ list ä¸­ string æ˜¯å¦æœ‰ä»¥ a å¼€å¤´çš„, åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªï¼Œå³è¿”å› true
    boolean anyStartsWithA =
            stringCollection
                    .stream()
                    .anyMatch((s) -> s.startsWith("a"));
    System.out.println(anyStartsWithA);      // true
    // allMatchï¼šéªŒè¯ list ä¸­ string æ˜¯å¦éƒ½æ˜¯ä»¥ a å¼€å¤´çš„
    boolean allStartsWithA =
            stringCollection
                    .stream()
                    .allMatch((s) -> s.startsWith("a"));
    System.out.println(allStartsWithA);      // false
    // noneMatchï¼šéªŒè¯ list ä¸­ string æ˜¯å¦éƒ½ä¸æ˜¯ä»¥ z å¼€å¤´çš„
    boolean noneStartsWithZ =
            stringCollection
                    .stream()
                    .noneMatch((s) -> s.startsWith("z"));
    System.out.println(noneStartsWithZ);      // true
}
```

### 5. Count è®¡æ•°

count æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒèƒ½å¤Ÿç»Ÿè®¡ stream æµä¸­çš„å…ƒç´ æ€»æ•°ï¼Œè¿”å›å€¼æ˜¯ long ç±»å‹ã€‚

```java
@Test
public void test21() {
    // countï¼šå…ˆå¯¹ list ä¸­å­—ç¬¦ä¸²å¼€å¤´ä¸º b è¿›è¡Œè¿‡æ»¤ï¼Œè®©åç»Ÿè®¡æ•°é‡
    long startsWithB =
            stringCollection
                    .stream()
                    .filter((s) -> s.startsWith("b"))
                    .count();
    System.out.println(startsWithB);    // 3
}
```

### 6. Reduce

Reduce ä¸­æ–‡ç¿»è¯‘ä¸ºï¼šå‡å°‘ã€ç¼©å°ã€‚é€šè¿‡å…¥å‚çš„ Functionï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°† list å½’çº¦æˆä¸€ä¸ªå€¼ã€‚å®ƒçš„è¿”å›ç±»å‹æ˜¯ Optional ç±»å‹ã€‚

```java
@Test
public void test22() {
    Optional<String> reduced =
            stringCollection
                    .stream()
                    .sorted()
                    .reduce((s1, s2) -> s1 + "#" + s2);
    reduced.ifPresent(System.out::println);
    // aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2
}
```

## ä¹ã€Parallel-Streams å¹¶è¡Œæµ

å¦‚ä¸Šæ‰€è¿°ï¼Œæµå¯ä»¥æ˜¯é¡ºåºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚é¡ºåºæµä¸Šçš„æ“ä½œåœ¨å•ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè€Œå¹¶è¡Œæµä¸Šçš„æ“ä½œåœ¨å¤šä¸ªçº¿ç¨‹ä¸Šå¹¶å‘æ‰§è¡Œã€‚

ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨å¹¶è¡Œæµæ¥æé«˜æ€§èƒ½æ˜¯å¤šä¹ˆçš„å®¹æ˜“ã€‚äº²æµ‹æå‡äº†1å€æ€§èƒ½ï¼

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¾ƒå¤§çš„Listï¼š

```java
int max = 1000000;
List<String> values = new ArrayList<>(max);
for (int i = 0; i < max; i++) {
    UUID uuid = UUID.randomUUID();
    values.add(uuid.toString());
}
```

### 1. Sequential Sort é¡ºåºæµæ’åº

```java
@Test
public void test23() {
    int max = 1000000;
    List<String> values = new ArrayList<>(max);
    for (int i = 0; i < max; i++) {
        UUID uuid = UUID.randomUUID();
        values.add(uuid.toString());
    }
    // çº³ç§’
    long t0 = System.nanoTime();
    long count = values.stream().sorted().count();
    System.out.println(count);
    long t1 = System.nanoTime();
    // çº³ç§’è½¬å¾®ç§’
    long millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);
    System.out.println(String.format("é¡ºåºæµæ’åºè€—æ—¶: %d ms", millis));
    //é¡ºåºæµæ’åºè€—æ—¶: 712 ms
}
```

### 2. Parallel Sort å¹¶è¡Œæµæ’åº

```java
@Test
public void test24(){
    int max = 1000000;
    List<String> values = new ArrayList<>(max);
    for (int i = 0; i < max; i++) {
        UUID uuid = UUID.randomUUID();
        values.add(uuid.toString());
    }
    long t0 = System.nanoTime();
    long count = values.parallelStream().sorted().count();
    System.out.println(count);
    long t1 = System.nanoTime();
    long millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);
    System.out.println(String.format("parallel sort took: %d ms", millis));
    //parallel sort took: 385 ms
}
```

å¦‚æ‚¨æ‰€è§ï¼Œè¿™ä¸¤ä¸ªä»£ç ç‰‡æ®µå‡ ä¹ç›¸åŒï¼Œä½†å¹¶è¡Œæ’åºå¤§çº¦å¿«50%ã€‚æ‚¨åªéœ€å°†streamï¼ˆï¼‰æ›´æ”¹ä¸ºparallelStreamï¼ˆï¼‰ã€‚

## åã€Map é›†åˆ

å¦‚å‰æ‰€è®²ï¼ŒMapæ˜¯ä¸æ”¯æŒ Stream æµçš„ï¼Œå› ä¸º Map æ¥å£å¹¶æ²¡æœ‰åƒ Collection æ¥å£é‚£æ ·ï¼Œå®šä¹‰äº† stream() æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶ key, values, entry ä½¿ç”¨ æµæ“ä½œï¼Œå¦‚ map.keySet().stream(), map.values().stream() å’Œ map.entrySet().stream().

å¦å¤–, JDK 8 ä¸­å¯¹ map æä¾›äº†ä¸€äº›å…¶ä»–æ–°ç‰¹æ€§:

```java
@Test
public void test25() {
    Map<Integer, String> map = new HashMap<>();
    for (int i = 0; i < 10; i++) {
        // ä¸è€ç‰ˆä¸åŒçš„æ˜¯ï¼ŒputIfAbent() æ–¹æ³•åœ¨ put ä¹‹å‰ï¼Œ  ä¸ç”¨åœ¨å†™if null continueäº†
        // ä¼šåˆ¤æ–­ key æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç›´æ¥è¿”å› value, å¦åˆ™ put, å†è¿”å› value
        map.putIfAbsent(i, "val" + i);
    }
    // forEach å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹ map è¿›è¡Œéå†æ“ä½œ
    map.forEach((key, value) -> System.out.println(value));
}
```

ä¹‹åæˆ‘ä»¬åšä¸€ä¸ªMapå¯¹è±¡çš„è½¬æ¢è¾“å‡ºï¼›ï¼ˆå®šä¹‰ä¸¤ä¸ªç±»BeanAã€BeanBï¼‰

```java
@Test
public void test26() {
    Map<Integer, BeanA> map = new HashMap<>();
    for (int i = 0; i < 10; i++) {
        // ä¸è€ç‰ˆä¸åŒçš„æ˜¯ï¼ŒputIfAbent() æ–¹æ³•åœ¨ put ä¹‹å‰ï¼Œ  ä¸ç”¨åœ¨å†™if null continueäº†
        // ä¼šåˆ¤æ–­ key æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç›´æ¥è¿”å› value, å¦åˆ™ put, å†è¿”å› value
        map.putIfAbsent(i, new BeanA(i, "æ˜æ˜" + i, i + 20, "89021839021830912809" + i));
    }
    Stream<BeanB> beanBStream00 = map.values().stream().map(new Function<BeanA, BeanB>() {
        @Override
        public BeanB apply(BeanA beanA) {
            return new BeanB(beanA.getName(), beanA.getAge());
        }
    });
    Stream<BeanB> beanBStream01 = map.values().stream().map(beanA -> new BeanB(beanA.getName(), beanA.getAge()));
    beanBStream01.forEach(System.out::println);
}
```

é™¤äº†ä¸Šé¢çš„ putIfAbsent() å’Œ forEach() å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹æŸä¸ª key çš„å€¼åšç›¸å…³æ“ä½œï¼š

```java
@Test
public void test27() {
	// å¦‚ä¸‹ï¼šå¯¹ key ä¸º 3 çš„å€¼ï¼Œå†…éƒ¨ä¼šå…ˆåˆ¤æ–­å€¼æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ï¼Œåˆ™åš value + key çš„æ‹¼æ¥æ“ä½œ
	map.computeIfPresent(3, (num, val) -> val + num);
	map.get(3);             // val33

	// å…ˆåˆ¤æ–­ key ä¸º 9 çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ï¼Œåˆ™åšåˆ é™¤æ“ä½œ
	map.computeIfPresent(9, (num, val) -> null);
	map.containsKey(9);     // false

	// computeIfAbsent(), å½“ key ä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šåšç›¸å…³å¤„ç†
	// å¦‚ä¸‹ï¼šå…ˆåˆ¤æ–­ key ä¸º 23 çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ï¼Œåˆ™æ·»åŠ 
	map.computeIfAbsent(23, num -> "val" + num);
	map.containsKey(23);    // true

	// å…ˆåˆ¤æ–­ key ä¸º 3 çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨ï¼Œåˆ™ä¸åšä»»ä½•å¤„ç†
	map.computeIfAbsent(3, num -> "bam");
	map.get(3);             // val33
}
```

å…³äºåˆ é™¤æ“ä½œï¼ŒJDK 8 ä¸­æä¾›äº†èƒ½å¤Ÿæ–°çš„ remove() API:

```java
@Test
public void test28() {
	map.remove(3, "val3");
	map.get(3);             // val33

	map.remove(3, "val33");
	map.get(3);             // null
}
```

å¦‚ä¸Šä»£ç ï¼Œåªæœ‰å½“ç»™å®šçš„ key å’Œ value å®Œå…¨åŒ¹é…æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œã€‚

å…³äºæ·»åŠ æ–¹æ³•ï¼ŒJDK 8 ä¸­æä¾›äº†å¸¦æœ‰é»˜è®¤å€¼çš„ getOrDefault() æ–¹æ³•ï¼š

```java
@Test
public void test29() {
    // è‹¥ key 42 ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› not found
    map.getOrDefault(42, "not found");  // not found
}
```

å¯¹äº value çš„åˆå¹¶æ“ä½œä¹Ÿå˜å¾—æ›´åŠ ç®€å•ï¼š

```java
@Test
public void test30() {
    // merge æ–¹æ³•ï¼Œä¼šå…ˆåˆ¤æ–­è¿›è¡Œåˆå¹¶çš„ key æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ·»åŠ å…ƒç´ 
    map.merge(9, "val9", (value, newValue) -> value.concat(newValue));
    map.get(9);             // val9
    // è‹¥ key çš„å…ƒç´ å­˜åœ¨ï¼Œåˆ™å¯¹ value æ‰§è¡Œæ‹¼æ¥æ“ä½œ
    map.merge(9, "concat", (value, newValue) -> value.concat(newValue));
    map.get(9);             // val9concat
}
```

## åä¸€ã€æ—¥æœŸ Date API

Java 8 ä¸­åœ¨åŒ… java.time ä¸‹æ·»åŠ äº†æ–°çš„æ—¥æœŸ API. å®ƒå’Œ [Joda-Time](http://www.joda.org/joda-time/) åº“ç›¸ä¼¼ï¼Œä½†åˆä¸å®Œå…¨ç›¸åŒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šé€šè¿‡ä¸€äº›ç¤ºä¾‹ä»£ç ä»‹ç»ä¸€ä¸‹æ–° API ä¸­ æœ€å…³é”®çš„ç‰¹æ€§ï¼š

### 1. Clock

Clock æä¾›å¯¹å½“å‰æ—¥æœŸå’Œæ—¶é—´çš„è®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥æ›¿ä»£ System.currentTimeMillis() æ–¹æ³•ã€‚å¦å¤–ï¼Œé€šè¿‡ clock.instant() èƒ½å¤Ÿè·å–ä¸€ä¸ª instant å®ä¾‹ï¼Œ
æ­¤å®ä¾‹èƒ½å¤Ÿæ–¹ä¾¿åœ°è½¬æ¢æˆè€ç‰ˆæœ¬ä¸­çš„ java.util.Date å¯¹è±¡ã€‚

```java
@Test
public void test31(){
    Clock clock = Clock.systemDefaultZone();
    long millis = clock.millis();
    Instant instant = clock.instant();
    Date legacyDate = Date.from(instant);   // è€ç‰ˆæœ¬ java.util.Date
}
```

### 2. Timezones æ—¶åŒº

ZoneId ä»£è¡¨æ—¶åŒºç±»ã€‚é€šè¿‡é™æ€å·¥å‚æ–¹æ³•æ–¹ä¾¿åœ°è·å–å®ƒï¼Œå…¥å‚æˆ‘ä»¬å¯ä»¥ä¼ å…¥æŸä¸ªæ—¶åŒºç¼–ç ã€‚å¦å¤–ï¼Œæ—¶åŒºç±»è¿˜å®šä¹‰äº†ä¸€ä¸ªåç§»é‡ï¼Œç”¨æ¥åœ¨å½“å‰æ—¶åˆ»æˆ–æŸæ—¶é—´ ä¸ç›®æ ‡æ—¶åŒºæ—¶é—´ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚

```java
@Test
public void test32() {
	System.out.println(ZoneId.getAvailableZoneIds());
	// prints all available timezone ids

	ZoneId zone1 = ZoneId.of("Europe/Berlin");
	ZoneId zone2 = ZoneId.of("Brazil/East");
	System.out.println(zone1.getRules());
	System.out.println(zone2.getRules());
	
	//[Asia/Aden, America/Cuiaba, Etc/GMT+9, Etc/Gada/Atlantic, Atlantic/St_Helena, Australia/Tasmania, Libya, Europe/Guernsey, America/Grand_Turk, US/Pacific-New, Asia/Samarkand, America/Argentina/Cordoba, Asia/Phnom_Penh, Africa/Kigali, Asia/Almaty, US/Alaska, Asi...
	// ZoneRules[currentStandardOffset=+01:00]
	// ZoneRules[currentStandardOffset=-03:00]
}
```

### 3. LocalTime

LocalTime è¡¨ç¤ºä¸€ä¸ªæ²¡æœ‰æŒ‡å®šæ—¶åŒºçš„æ—¶é—´ç±»ï¼Œä¾‹å¦‚ï¼Œ10 p.m.æˆ–è€… 17ï¼š30:15ï¼Œä¸‹é¢ç¤ºä¾‹ä»£ç ä¸­ï¼Œå°†ä¼šä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ æ—¶åŒºå¯¹è±¡åˆ›å»ºä¸¤ä¸ª LocalTimeã€‚ç„¶åæˆ‘ä»¬ä¼šæ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å°æ—¶å’Œåˆ†é’Ÿçš„ä¸åŒã€‚

```java
@Test
public void test33(){
    ZoneId zone1 = ZoneId.of("Europe/Berlin");
    ZoneId zone2 = ZoneId.of("Brazil/East");
    LocalTime now1 = LocalTime.now(zone1);
    LocalTime now2 = LocalTime.now(zone2);
    System.out.println(now1.isBefore(now2));  // false
    long hoursBetween = ChronoUnit.HOURS.between(now1, now2);
    long minutesBetween = ChronoUnit.MINUTES.between(now1, now2);
    System.out.println(hoursBetween);       // -3
    System.out.println(minutesBetween);     // -239
}
```

LocalTime æä¾›å¤šä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–å¯¹æ—¶é—´å¯¹è±¡å®ä¾‹çš„åˆ›å»ºå’Œæ“ä½œï¼ŒåŒ…æ‹¬å¯¹æ—¶é—´å­—ç¬¦ä¸²è¿›è¡Œè§£æçš„æ“ä½œç­‰ã€‚

```java
@Test
public void test34(){
    LocalTime late = LocalTime.of(23, 59, 59);
    System.out.println(late);       // 23:59:59
    DateTimeFormatter germanFormatter =
            DateTimeFormatter
                    .ofLocalizedTime(FormatStyle.SHORT)
                    .withLocale(Locale.GERMAN);
    LocalTime leetTime = LocalTime.parse("13:37", germanFormatter);
    System.out.println(leetTime);   // 13:37
}
```

### 4. LocalDate

LocalDate æ˜¯ä¸€ä¸ªæ—¥æœŸå¯¹è±¡ï¼Œä¾‹å¦‚ï¼š2014-03-11ã€‚å®ƒå’Œ LocalTime ä¸€æ ·æ˜¯ä¸ª final ç±»å‹å¯¹è±¡ã€‚ä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡åŠ å‡æ—¥ï¼Œæœˆï¼Œå¹´ç­‰æ¥è®¡ç®—ä¸€ä¸ªæ–°çš„æ—¥æœŸã€‚

```java
@Test
public void test35(){
    LocalDate today = LocalDate.now();
    // ä»Šå¤©åŠ ä¸€å¤©
    LocalDate tomorrow = today.plus(1, ChronoUnit.DAYS);
    // æ˜å¤©å‡ä¸¤å¤©
    LocalDate yesterday = tomorrow.minusDays(2);
    // 2014 å¹´ä¸ƒæœˆçš„ç¬¬å››å¤©
    LocalDate independenceDay = LocalDate.of(2014, Month.JULY, 4);
    DayOfWeek dayOfWeek = independenceDay.getDayOfWeek();
    System.out.println(dayOfWeek);    // æ˜ŸæœŸäº”
}
```

ä¹Ÿå¯ä»¥ç›´æ¥è§£ææ—¥æœŸå­—ç¬¦ä¸²ï¼Œç”Ÿæˆ LocalDate å®ä¾‹ã€‚ï¼ˆå’Œ LocalTime æ“ä½œä¸€æ ·ç®€å•ï¼‰

```java
@Test
public void test36(){
    DateTimeFormatter germanFormatter =
            DateTimeFormatter
                    .ofLocalizedDate(FormatStyle.MEDIUM)
                    .withLocale(Locale.GERMAN);
    LocalDate xmas = LocalDate.parse("24.12.2014", germanFormatter);
    System.out.println(xmas);   // 2014-12-24
}
```

### 5. LocalDateTime

LocalDateTime æ˜¯ä¸€ä¸ªæ—¥æœŸ-æ—¶é—´å¯¹è±¡ã€‚ä½ ä¹Ÿå¯ä»¥å°†å…¶çœ‹æˆæ˜¯ LocalDate å’Œ LocalTime çš„ç»“åˆä½“ã€‚æ“ä½œä¸Šï¼Œä¹Ÿå¤§è‡´ç›¸åŒã€‚

```java
@Test
public void test37(){
    LocalDateTime sylvester = LocalDateTime.of(2014, Month.DECEMBER, 31, 23, 59, 59);
    DayOfWeek dayOfWeek = sylvester.getDayOfWeek();
    System.out.println(dayOfWeek);      // æ˜ŸæœŸä¸‰
    Month month = sylvester.getMonth();
    System.out.println(month);          // åäºŒæœˆ
    // è·å–æ”¹æ—¶é—´æ˜¯è¯¥å¤©ä¸­çš„ç¬¬å‡ åˆ†é’Ÿ
    long minuteOfDay = sylvester.getLong(ChronoField.MINUTE_OF_DAY);
    System.out.println(minuteOfDay);    // 1439
}
```

å¦‚æœå†åŠ ä¸Šçš„æ—¶åŒºä¿¡æ¯ï¼ŒLocalDateTime è¿˜èƒ½å¤Ÿè¢«è½¬æ¢æˆ Instance å®ä¾‹ã€‚Instance èƒ½å¤Ÿè¢«è½¬æ¢æˆè€ç‰ˆæœ¬ä¸­ java.util.Date å¯¹è±¡ã€‚

```java
@Test
public void test38(){
    LocalDateTime sylvester = LocalDateTime.of(2014, Month.DECEMBER, 31, 23, 59, 59);
    Instant instant = sylvester
            .atZone(ZoneId.systemDefault())
            .toInstant();
    Date legacyDate = Date.from(instant);
    System.out.println(legacyDate);     // Wed Dec 31 23:59:59 CET 2014
}
```

æ ¼å¼åŒ– LocalDateTime å¯¹è±¡å°±å’Œæ ¼å¼åŒ– LocalDate æˆ–è€… LocalTime ä¸€æ ·ã€‚é™¤äº†ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ ¼å¼åŒ–è¾“å‡ºã€‚

```java
@Test
public void test39(){
    DateTimeFormatter formatter =
            DateTimeFormatter
                    .ofPattern("MMM dd, yyyy - HH:mm");
    LocalDateTime parsed = LocalDateTime.parse("Nov 03, 2014 - 07:13", formatter);
    String string = formatter.format(parsed);
    System.out.println(string);     // Nov 03, 2014 - 07:13
}
```

Unlike java.text.NumberFormat the new DateTimeFormatter is immutable and thread-safe.

For details on the pattern syntax read [here](https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html).

## åäºŒã€Annotations æ³¨è§£

Java8ä¸­çš„æ³¨é‡Šæ˜¯å¯é‡å¤çš„ã€‚è®©æˆ‘ä»¬ç›´æ¥æ·±å…¥åˆ°ä¸€ä¸ªä¾‹å­ä¸­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚{åœ¨SpringBootçš„å¯åŠ¨ç±»ä¸­å°±å¯ä»¥çœ‹åˆ°è¿™ä¸­ç±»å‹çš„æ³¨è§£}

é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…è£…å™¨æ³¨é‡Šï¼Œå®ƒåŒ…å«ä¸€ä¸ªå®é™…æ³¨é‡Šæ•°ç»„ï¼š

```java
@Repeatable(Hints.class)
public @interface Hint {
    String value();
}

public @interface Hints {
    Hint[] value();
}
```

Java 8é€šè¿‡å£°æ˜æ³¨é‡Š@Repeatableï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨åŒä¸€ç±»å‹çš„å¤šä¸ªæ³¨é‡Šã€‚

ç¬¬ä¸€ç§å½¢æ€ï¼šä½¿ç”¨æ³¨è§£å®¹å™¨ï¼ˆè€æ–¹æ³•ï¼‰

```java
 @Test
 public void test40() {
     @Hints({@Hint("hint1"), @Hint("hint2")})
     class Person {
     }
 }
```

ç¬¬äºŒç§å½¢æ€ï¼šä½¿ç”¨å¯é‡å¤æ³¨è§£ï¼ˆæ–°æ–¹æ³•ï¼‰

```java
@Test
public void test41() {
    @Hint("hint1")
    @Hint("hint2")
    class Person {
    }
}
```

javaç¼–è¯‘å™¨ä½¿ç”¨å˜é‡2éšå¼åœ°åœ¨å¼•æ“ç›–ä¸‹è®¾ç½®@Hintsæ³¨é‡Šã€‚è¿™å¯¹äºé€šè¿‡åå°„è¯»å–æ³¨é‡Šä¿¡æ¯å¾ˆé‡è¦ã€‚

```java
@Test
public void test41() {
    @Hint("hint1")
    @Hint("hint2")
    class Person {
    }
    Hint hint = Person.class.getAnnotation(Hint.class);
    System.out.println(hint);                   // null
    Hints hints1 = Person.class.getAnnotation(Hints.class);
    System.out.println(hints1.value().length);  // 2
    Hint[] hints2 = Person.class.getAnnotationsByType(Hint.class
    System.out.println(hints2.length);          // 2
}
```

å°½ç®¡æˆ‘ä»¬ç»å¯¹ä¸ä¼šåœ¨ Person ç±»ä¸Šå£°æ˜ @Hints æ³¨è§£ï¼Œä½†æ˜¯å®ƒçš„ä¿¡æ¯ä»ç„¶æ˜¯å¯ä»¥é€šè¿‡ getAnnotation(Hints.class) æ¥è¯»å–çš„ã€‚
å¹¶ä¸”ï¼ŒgetAnnotationsByType æ–¹æ³•ä¼šæ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒèµ‹äºˆäº†æ‰€æœ‰ @Hints æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ç›´æ¥çš„è®¿é—®æƒé™ã€‚

```java
@Target({ElementType.TYPE_PARAMETER, ElementType.TYPE_USE})
@interface MyAnnotation {}
```

## ç»¼ä¸Šæ€»ç»“

- jdk8çš„æ–°ç‰¹æ€§åŒ…æ‹¬äº†ï¼›Lambdaã€å‡½æ•°å¼æ¥å£ã€å››é¥¼è°ƒç”¨::ã€å†…ç½®å‡½æ•°(æ–­è¨€ã€Functionã€ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…)ã€Streamæµã€Mapé›†åˆç‰¹æ€§ã€æ—¥æœŸã€æ³¨è§£ç­‰
- åˆç†çš„ç»„åˆè¿è¡Œæ–°çš„ç‰¹æ€§å¯ä»¥å‡å°‘å¾ˆå¤šçš„ç¼–ç é‡ï¼ŒåŒæ—¶è®©ä»£ç æ›´åŠ æ•´æ´
- åœ¨ä¸€äº›æ–°çš„æ¡†æ¶ä¸­SpringBooté‡Œå¦‚æœç¿»çœ‹æºç å¯ä»¥çœ‹åˆ°å¾ˆå¤šçš„æ–°ç‰¹æ€§ä½¿ç”¨
- æ¡ˆä¾‹æ¥æºï¼›https://github.com/winterbe/java8-tutorial ï½›è‹±æ–‡ï½
- æºç è´¡çŒ®ï¼›https://github.com/fuzhengwei/itstack-demo-jdk8

