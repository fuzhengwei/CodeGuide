---
layout: post
category: interview
title: é¢ç»æ‰‹å†Œ Â· ç¬¬4ç¯‡ã€ŠHashMapæ•°æ®æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤ã€éå†ï¼Œæºç åˆ†æã€‹
tagline: by å°å‚…å“¥
tag: [java,interview]
excerpt: HashMapæ ¸å¿ƒæºç åˆ†æï¼Œå­¦ä¹ å“ˆå¸Œç¢°æ’å¤„ç†ã€é“¾è¡¨æ ‘åŒ–ã€çº¢é»‘æ ‘è½¬é“¾è¡¨ä»¥åŠSetéå†ä¸­çš„å…ƒç´ é¡ºåºæ˜¯å¦‚ä½•å¤„ç†çš„ã€‚
lock: need
---

# é¢ç»æ‰‹å†Œ Â· ç¬¬4ç¯‡ã€ŠHashMapæ•°æ®æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤ã€éå†ï¼Œæºç åˆ†æã€‹

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

åœ¨ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬è®²è§£å¹¶ç”¨æ•°æ®éªŒè¯äº†ï¼ŒHashMapä¸­çš„ï¼Œ`æ•£åˆ—è¡¨çš„å®ç°`ã€`æ‰°åŠ¨å‡½æ•°`ã€`è´Ÿè½½å› å­`ä»¥åŠ`æ‰©å®¹æ‹†åˆ†`ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹ä»¥åŠç›¸åº”çš„ä½œç”¨ã€‚

é™¤äº†ä»¥ä¸Šè¿™äº›çŸ¥è¯†ç‚¹å¤–ï¼ŒHashMapè¿˜æœ‰åŸºæœ¬çš„æ•°æ®åŠŸèƒ½ï¼›`å­˜å‚¨`ã€`åˆ é™¤`ã€`è·å–`ã€`éå†`ï¼Œåœ¨è¿™äº›åŠŸèƒ½ä¸­ç»å¸¸ä¼šå¬åˆ°é“¾è¡¨ã€çº¢é»‘æ ‘ã€ä¹‹é—´è½¬æ¢ç­‰åŠŸèƒ½ã€‚è€Œçº¢é»‘æ ‘æ˜¯åœ¨jdk1.8å¼•å…¥åˆ°HashMapä¸­è§£å†³é“¾è¡¨è¿‡é•¿é—®é¢˜çš„ï¼Œç®€å•è¯´å½“é“¾è¡¨é•¿åº¦`>=8`æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä½çº¢é»‘æ ‘(*å½“ç„¶è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ‰©å®¹çš„çŸ¥è¯†ç‚¹ï¼Œä¸ä¸€å®šéƒ½ä¼šæ ‘åŒ–[MIN_TREEIFY_CAPACITY]*)ã€‚

é‚£ä¹ˆæœ¬ç« èŠ‚ä¼šè¿›è¡Œè®²è§£ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼›
1. æ•°æ®æ’å…¥æµç¨‹å’Œæºç åˆ†æ
2. é“¾è¡¨æ ‘åŒ–ä»¥åŠæ ‘è½¬é“¾è¡¨
3. éå†è¿‡ç¨‹ä¸­çš„æ— åºSetçš„æ ¸å¿ƒçŸ¥è¯†

**ğŸ•µæ³¨æ„ï¼š** å»ºè®®é˜…è¯»ä¸Šä¸€ç¯‡åï¼Œå†é˜…è¯»æœ¬ç¯‡æ–‡ç« [ã€ŠHashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹](https://bugstack.cn/interview/2020/08/07/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC3%E7%AF%87-HashMap%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86-%E6%89%B0%E5%8A%A8%E5%87%BD%E6%95%B0-%E8%B4%9F%E8%BD%BD%E5%9B%A0%E5%AD%90-%E6%89%A9%E5%AE%B9%E9%93%BE%E8%A1%A8%E6%8B%86%E5%88%86-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0.html)

## äºŒã€HashMapæºç åˆ†æ

### 1.  æ’å…¥

#### 1.1 ç–‘é—®ç‚¹&è€ƒé¢˜

é€šè¿‡ä¸Šä¸€ç« èŠ‚çš„å­¦ä¹ ï¼š[ã€ŠHashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹](https://bugstack.cn/interview/2020/08/07/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC3%E7%AF%87-HashMap%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86-%E6%89%B0%E5%8A%A8%E5%87%BD%E6%95%B0-%E8%B4%9F%E8%BD%BD%E5%9B%A0%E5%AD%90-%E6%89%A9%E5%AE%B9%E9%93%BE%E8%A1%A8%E6%8B%86%E5%88%86-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0.html) 

å¤§å®¶å¯¹äºä¸€ä¸ªæ•£åˆ—è¡¨æ•°æ®ç»“æ„çš„HashMapå¾€é‡Œé¢æ’å…¥æ•°æ®æ—¶ï¼ŒåŸºæœ¬å·²ç»æœ‰äº†ä¸€ä¸ªå°è±¡ã€‚ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ä½ çš„Keyå€¼å–å¾—å“ˆå¸Œå†è®¡ç®—ä¸‹æ ‡ï¼Œä¹‹åæŠŠç›¸åº”çš„æ•°æ®å­˜æ”¾åˆ°é‡Œé¢ã€‚

ä½†å†è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼›
1. å¦‚æœå‡ºç°å“ˆå¸Œå€¼è®¡ç®—çš„ä¸‹æ ‡ç¢°æ’äº†æ€ä¹ˆåŠï¼Ÿ
2. å¦‚æœç¢°æ’äº†æ˜¯æ‰©å®¹æ•°ç»„è¿˜æ˜¯æŠŠå€¼å­˜æˆé“¾è¡¨ç»“æ„ï¼Œè®©ä¸€ä¸ªèŠ‚ç‚¹æœ‰å¤šä¸ªå€¼å­˜æ”¾å‘¢ï¼Ÿ
3. å¦‚æœå­˜æ”¾çš„æ•°æ®çš„é“¾è¡¨è¿‡é•¿ï¼Œå°±å¤±å»äº†æ•£åˆ—è¡¨çš„æ€§èƒ½äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ
4. å¦‚æœæƒ³è§£å†³é“¾è¡¨è¿‡é•¿ï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ ‘ç»“æ„å‘¢ï¼Œä½¿ç”¨å“ªç§æ ‘å‘¢ï¼Ÿ

è¿™äº›ç–‘é—®ç‚¹éƒ½ä¼šåœ¨åé¢çš„å†…å®¹ä¸­é€æ­¥è®²è§£ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœæ˜¯ä½ æ¥è®¾è®¡ï¼Œä½ ä¼šæ€ä¹ˆåšã€‚

#### 1.2 æ’å…¥æµç¨‹å’Œæºç åˆ†æ

**HashMapæ’å…¥æ•°æ®æµç¨‹å›¾**

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼ŒHashMapæ’å…¥æ•°æ®æµç¨‹å›¾](https://bugstack.cn/assets/images/2020/interview/interview-5-01.png)

*visioåŸç‰ˆæµç¨‹å›¾ï¼Œå¯ä»¥é€šè¿‡å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œè¿›è¡Œä¸‹è½½*

ä»¥ä¸Šå°±æ˜¯HashMapä¸­ä¸€ä¸ªæ•°æ®æ’å…¥çš„æ•´ä½“æµç¨‹ï¼ŒåŒ…æ‹¬äº†ï¼›è®¡ç®—ä¸‹æ ‡ã€ä½•æ—¶æ‰©å®¹ã€ä½•æ—¶é“¾è¡¨è½¬çº¢é»‘æ ‘ç­‰ï¼Œå…·ä½“å¦‚ä¸‹ï¼›

1. é¦–å…ˆè¿›è¡Œå“ˆå¸Œå€¼çš„æ‰°åŠ¨ï¼Œè·å–ä¸€ä¸ªæ–°çš„å“ˆå¸Œå€¼ã€‚`(key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);`

2. åˆ¤æ–­tabæ˜¯å¦ä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0ï¼Œå¦‚æœæ˜¯åˆ™è¿›è¡Œæ‰©å®¹æ“ä½œã€‚

   ```java
   if ((tab = table) == null || (n = tab.length) == 0)
       n = (tab = resize()).length;
   ```

3. æ ¹æ®å“ˆå¸Œå€¼è®¡ç®—ä¸‹æ ‡ï¼Œå¦‚æœå¯¹åº”ä¸‹æ ‡æ­£å¥½æ²¡æœ‰å­˜æ”¾æ•°æ®ï¼Œåˆ™ç›´æ¥æ’å…¥å³å¯å¦åˆ™éœ€è¦è¦†ç›–ã€‚`tab[i = (n - 1) & hash])`

4. åˆ¤æ–­tab[i]æ˜¯å¦ä¸ºæ ‘èŠ‚ç‚¹ï¼Œå¦åˆ™å‘é“¾è¡¨ä¸­æ’å…¥æ•°æ®ï¼Œæ˜¯åˆ™å‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ã€‚

5. å¦‚æœé“¾è¡¨ä¸­æ’å…¥èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé“¾è¡¨é•¿åº¦å¤§äºç­‰äº8ï¼Œåˆ™éœ€è¦æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚`treeifyBin(tab, hash);`

6. æœ€åæ‰€æœ‰å…ƒç´ å¤„ç†å®Œæˆåï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼›`threshold`ï¼Œè¶…è¿‡åˆ™æ‰©å®¹ã€‚

7. `treeifyBin`,æ˜¯ä¸€ä¸ªé“¾è¡¨è½¬æ ‘çš„æ–¹æ³•ï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„é“¾è¡¨é•¿åº¦ä¸º8åéƒ½ä¼šè½¬æˆæ ‘ï¼Œè¿˜éœ€è¦åˆ¤æ–­å­˜æ”¾keyå€¼çš„æ•°ç»„æ¡¶é•¿åº¦æ˜¯å¦å°äº64 `MIN_TREEIFY_CAPACITY`ã€‚å¦‚æœå°äºåˆ™éœ€è¦æ‰©å®¹ï¼Œæ‰©å®¹åé“¾è¡¨ä¸Šçš„æ•°æ®ä¼šè¢«æ‹†åˆ†æ•£åˆ—çš„ç›¸åº”çš„æ¡¶èŠ‚ç‚¹ä¸Šï¼Œä¹Ÿå°±æŠŠé“¾è¡¨é•¿åº¦ç¼©çŸ­äº†ã€‚

**JDK1.8 HashMapçš„putæ–¹æ³•æºç å¦‚ä¸‹:**

```java
public V put(K key, V value) {
    return putVal(hash(key), key, value, false, true);
}

final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
               boolean evict) {
    Node<K,V>[] tab; Node<K,V> p; int n, i;
    // åˆå§‹åŒ–æ¡¶æ•°ç»„ tableï¼Œtable è¢«å»¶è¿Ÿåˆ°æ’å…¥æ–°æ•°æ®æ—¶å†è¿›è¡Œåˆå§‹åŒ–
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;
    // å¦‚æœæ¡¶ä¸­ä¸åŒ…å«é”®å€¼å¯¹èŠ‚ç‚¹å¼•ç”¨ï¼Œåˆ™å°†æ–°é”®å€¼å¯¹èŠ‚ç‚¹çš„å¼•ç”¨å­˜å…¥æ¡¶ä¸­å³å¯
    if ((p = tab[i = (n - 1) & hash]) == null)
        tab[i] = newNode(hash, key, value, null);
    else {
        Node<K,V> e; K k;
        // å¦‚æœé”®çš„å€¼ä»¥åŠèŠ‚ç‚¹ hash ç­‰äºé“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹èŠ‚ç‚¹æ—¶ï¼Œåˆ™å°† e æŒ‡å‘è¯¥é”®å€¼å¯¹
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
            
        // å¦‚æœæ¡¶ä¸­çš„å¼•ç”¨ç±»å‹ä¸º TreeNodeï¼Œåˆ™è°ƒç”¨çº¢é»‘æ ‘çš„æ’å…¥æ–¹æ³•
        else if (p instanceof TreeNode)  
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        else {
            // å¯¹é“¾è¡¨è¿›è¡Œéå†ï¼Œå¹¶ç»Ÿè®¡é“¾è¡¨é•¿åº¦
            for (int binCount = 0; ; ++binCount) {
                // é“¾è¡¨ä¸­ä¸åŒ…å«è¦æ’å…¥çš„é”®å€¼å¯¹èŠ‚ç‚¹æ—¶ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹æ¥åœ¨é“¾è¡¨çš„æœ€å
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    // å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºæˆ–ç­‰äºæ ‘åŒ–é˜ˆå€¼ï¼Œåˆ™è¿›è¡Œæ ‘åŒ–æ“ä½œ
                    if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
                        treeifyBin(tab, hash);
                    break;
                }
                
                // æ¡ä»¶ä¸º trueï¼Œè¡¨ç¤ºå½“å‰é“¾è¡¨åŒ…å«è¦æ’å…¥çš„é”®å€¼å¯¹ï¼Œç»ˆæ­¢éå†
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;
                p = e;
            }
        }
        
        // åˆ¤æ–­è¦æ’å…¥çš„é”®å€¼å¯¹æ˜¯å¦å­˜åœ¨ HashMap ä¸­
        if (e != null) { // existing mapping for key
            V oldValue = e.value;
            // onlyIfAbsent è¡¨ç¤ºæ˜¯å¦ä»…åœ¨ oldValue ä¸º null çš„æƒ…å†µä¸‹æ›´æ–°é”®å€¼å¯¹çš„å€¼
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;
    // é”®å€¼å¯¹æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œåˆ™è¿›è¡Œæ‰©å®¹
    if (++size > threshold)
        resize();
    afterNodeInsertion(evict);
    return null;
}
```

#### 1.3 æ‰©å®¹æœºåˆ¶

HashMapæ˜¯åŸºäºæ•°ç»„+é“¾è¡¨å’Œçº¢é»‘æ ‘å®ç°çš„ï¼Œä½†ç”¨äºå­˜æ”¾keyå€¼å¾—çš„æ•°ç»„æ¡¶çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œç”±åˆå§‹åŒ–å†³å®šã€‚

é‚£ä¹ˆï¼Œéšç€æ•°æ®çš„æ’å…¥æ•°é‡å¢åŠ ä»¥åŠè´Ÿè½½å› å­çš„ä½œç”¨ä¸‹ï¼Œå°±éœ€è¦æ‰©å®¹æ¥å­˜æ”¾æ›´å¤šçš„æ•°æ®ã€‚è€Œæ‰©å®¹ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ï¼Œå°±æ˜¯jdk1.8ä¸­çš„ä¼˜åŒ–æ“ä½œï¼Œå¯ä»¥ä¸éœ€è¦å†é‡æ–°è®¡ç®—æ¯ä¸€ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼ï¼Œè¿™åœ¨ä¸Šä¸€ç« èŠ‚ä¸­å·²ç»è®²åˆ°ï¼Œå¯ä»¥é˜…è¯»ç³»åˆ—ä¸“é¢˜æ–‡ç« ï¼Œæœºåˆ¶å¦‚ä¸‹å›¾ï¼›

![](https://bugstack.cn/assets/images/2020/interview/interview-4-06.png)

**é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸‹æ‰©å®¹çš„ä»£ç (æ³¨é‡Šéƒ¨åˆ†)ï¼›**

```java
final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table;
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    int oldThr = threshold;
    int newCap, newThr = 0;
    // Cap æ˜¯ capacity çš„ç¼©å†™ï¼Œå®¹é‡ã€‚å¦‚æœå®¹é‡ä¸ä¸ºç©ºï¼Œåˆ™è¯´æ˜å·²ç»åˆå§‹åŒ–ã€‚
    if (oldCap > 0) {
        // å¦‚æœå®¹é‡è¾¾åˆ°æœ€å¤§1 << 30åˆ™ä¸å†æ‰©å®¹
        if (oldCap >= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        
        // æŒ‰æ—§å®¹é‡å’Œé˜€å€¼çš„2å€è®¡ç®—æ–°å®¹é‡å’Œé˜€å€¼
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1; // double threshold
    }
    else if (oldThr > 0) // initial capacity was placed in threshold
    
        // initial capacity was placed in threshold ç¿»è¯‘è¿‡æ¥çš„æ„æ€ï¼Œå¦‚ä¸‹ï¼›
        // åˆå§‹åŒ–æ—¶ï¼Œå°† threshold çš„å€¼èµ‹å€¼ç»™ newCapï¼Œ
        // HashMap ä½¿ç”¨ threshold å˜é‡æš‚æ—¶ä¿å­˜ initialCapacity å‚æ•°çš„å€¼
        newCap = oldThr;
    else {               // zero initial threshold signifies using defaults
        // è¿™ä¸€éƒ¨åˆ†ä¹Ÿæ˜¯ï¼Œæºä»£ç ä¸­ä¹Ÿæœ‰ç›¸åº”çš„è‹±æ–‡æ³¨é‡Š
        // è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•æ—¶ï¼Œæ•°ç»„æ¡¶æ•°ç»„å®¹é‡ä¸ºé»˜è®¤å®¹é‡ 1 << 4; aka 16
        // é˜€å€¼ï¼›æ˜¯é»˜è®¤å®¹é‡ä¸è´Ÿè½½å› å­çš„ä¹˜ç§¯ï¼Œ0.75
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }
    
    // newThrä¸º0ï¼Œåˆ™ä½¿ç”¨é˜€å€¼å…¬å¼è®¡ç®—å®¹é‡
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr;
    
    @SuppressWarnings({"rawtypes","unchecked"})
        // åˆå§‹åŒ–æ•°ç»„æ¡¶ï¼Œç”¨äºå­˜æ”¾key
        Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
    table = newTab;
    if (oldTab != null) {
        // å¦‚æœæ—§æ•°ç»„æ¡¶ï¼ŒoldCapæœ‰å€¼ï¼Œåˆ™éå†å°†é”®å€¼æ˜ å°„åˆ°æ–°æ•°ç»„æ¡¶ä¸­
        for (int j = 0; j < oldCap; ++j) {
            Node<K,V> e;
            if ((e = oldTab[j]) != null) {
                oldTab[j] = null;
                if (e.next == null)
                    newTab[e.hash & (newCap - 1)] = e;
                else if (e instanceof TreeNode)
                    // è¿™é‡Œsplitï¼Œæ˜¯çº¢é»‘æ ‘æ‹†åˆ†æ“ä½œã€‚åœ¨é‡æ–°æ˜ å°„æ—¶æ“ä½œçš„ã€‚
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);
                else { // preserve order
                    Node<K,V> loHead = null, loTail = null;
                    Node<K,V> hiHead = null, hiTail = null;
                    Node<K,V> next;
                    // è¿™é‡Œæ˜¯é“¾è¡¨ï¼Œå¦‚æœå½“å‰æ˜¯æŒ‰ç…§é“¾è¡¨å­˜æ”¾çš„ï¼Œåˆ™å°†é“¾è¡¨èŠ‚ç‚¹æŒ‰åŸé¡ºåºè¿›è¡Œåˆ†ç»„{è¿™é‡Œæœ‰ä¸“é—¨çš„æ–‡ç« ä»‹ç»ï¼Œå¦‚ä½•ä¸éœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼è¿›è¡Œæ‹†åˆ†ã€ŠHashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹}
                    do {
                        next = e.next;
                        if ((e.hash & oldCap) == 0) {
                            if (loTail == null)
                                loHead = e;
                            else
                                loTail.next = e;
                            loTail = e;
                        }
                        else {
                            if (hiTail == null)
                                hiHead = e;
                            else
                                hiTail.next = e;
                            hiTail = e;
                        }
                    } while ((e = next) != null);
                    
                    // å°†åˆ†ç»„åçš„é“¾è¡¨æ˜ å°„åˆ°æ¡¶ä¸­
                    if (loTail != null) {
                        loTail.next = null;
                        newTab[j] = loHead;
                    }
                    if (hiTail != null) {
                        hiTail.next = null;
                        newTab[j + oldCap] = hiHead;
                    }
                }
            }
        }
    }
    return newTab;
}
```

ä»¥ä¸Šçš„ä»£ç ç¨å¾®æœ‰äº›é•¿ï¼Œä½†æ˜¯æ•´ä½“çš„é€»è¾‘è¿˜æ˜¯è›®æ¸…æ™°çš„ï¼Œä¸»è¦åŒ…æ‹¬ï¼›
1. æ‰©å®¹æ—¶è®¡ç®—å‡ºæ–°çš„newCapã€newThrï¼Œè¿™æ˜¯ä¸¤ä¸ªå•è¯çš„ç¼©å†™ï¼Œä¸€ä¸ªæ˜¯Capacity ï¼Œå¦ä¸€ä¸ªæ˜¯é˜€Threshold
2. newCapç”¨äºåˆ›æ–°çš„æ•°ç»„æ¡¶ `new Node[newCap];`
3. éšç€æ‰©å®¹åï¼ŒåŸæ¥é‚£äº›å› ä¸ºå“ˆå¸Œç¢°æ’ï¼Œå­˜æ”¾æˆé“¾è¡¨å’Œçº¢é»‘æ ‘çš„å…ƒç´ ï¼Œéƒ½éœ€è¦è¿›è¡Œæ‹†åˆ†å­˜æ”¾åˆ°æ–°çš„ä½ç½®ä¸­ã€‚

#### 1.4 é“¾è¡¨æ ‘åŒ–

HashMapè¿™ç§æ•£åˆ—è¡¨çš„æ•°æ®ç»“æ„ï¼Œæœ€å¤§çš„æ€§èƒ½åœ¨äºå¯ä»¥O(1)æ—¶é—´å¤æ‚åº¦å®šä½åˆ°å…ƒç´ ï¼Œä½†å› ä¸ºå“ˆå¸Œç¢°æ’ä¸å¾—å·²åœ¨ä¸€ä¸ªä¸‹æ ‡é‡Œå­˜æ”¾å¤šç»„æ•°æ®ï¼Œé‚£ä¹ˆjdk1.8ä¹‹å‰çš„è®¾è®¡åªæ˜¯é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼è¿›è¡Œå­˜æ”¾ï¼Œå¦‚æœéœ€è¦ä»é“¾è¡¨ä¸­å®šä½åˆ°æ•°æ®æ—¶é—´å¤æ‚åº¦å°±æ˜¯O(n)ï¼Œé“¾è¡¨è¶Šé•¿æ€§èƒ½è¶Šå·®ã€‚å› ä¸ºåœ¨jdk1.8ä¸­æŠŠè¿‡é•¿çš„é“¾è¡¨ä¹Ÿå°±æ˜¯8ä¸ªï¼Œä¼˜åŒ–ä¸ºè‡ªå¹³è¡¡çš„çº¢é»‘æ ‘ç»“æ„ï¼Œä»¥æ­¤è®©å®šä½å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è¿‘ä¼¼äºO(logn)ï¼Œè¿™æ ·æ¥æå‡å…ƒç´ æŸ¥æ‰¾çš„æ•ˆç‡ã€‚ä½†ä¹Ÿä¸æ˜¯å®Œå…¨æŠ›å¼ƒé“¾è¡¨ï¼Œå› ä¸ºåœ¨å…ƒç´ ç›¸å¯¹ä¸å¤šçš„æƒ…å†µä¸‹ï¼Œé“¾è¡¨çš„æ’å…¥é€Ÿåº¦æ›´å¿«ï¼Œæ‰€ä»¥ç»¼åˆè€ƒè™‘ä¸‹è®¾å®šé˜ˆå€¼ä¸º8æ‰è¿›è¡Œçº¢é»‘æ ‘è½¬æ¢æ“ä½œã€‚

**é“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œå¦‚ä¸‹å›¾ï¼›**

![å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œé“¾è¡¨è½¬çº¢é»‘æ ‘](https://bugstack.cn/assets/images/2020/interview/interview-5-02.png)

ä»¥ä¸Šå°±æ˜¯ä¸€ç»„é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„æƒ…å†µï¼Œå…ƒç´ åŒ…æ‹¬ï¼›40ã€51ã€62ã€73ã€84ã€95ã€150ã€161 *è¿™äº›æ˜¯ç»è¿‡å®é™…éªŒè¯å¯åˆ†é…åˆ°Idxï¼š12çš„èŠ‚ç‚¹*

é€šè¿‡è¿™å¼ å›¾ï¼ŒåŸºæœ¬å¯ä»¥æœ‰ä¸€ä¸ª`é“¾è¡¨`æ¢è¡Œåˆ°`çº¢é»‘æ ‘`çš„å°è±¡ï¼Œæ¥ä¸‹æ¥é˜…è¯»ä¸‹å¯¹åº”çš„æºç ã€‚

**é“¾è¡¨æ ‘åŒ–æºç **

```java
final void treeifyBin(Node<K,V>[] tab, int hash) {
    int n, index; Node<K,V> e;
    // è¿™å—å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ï¼Œä¸ä¸€å®šæ ‘åŒ–è¿˜å¯èƒ½åªæ˜¯æ‰©å®¹ã€‚ä¸»è¦æ¡¶æ•°ç»„å®¹é‡æ˜¯å¦å°äº64 MIN_TREEIFY_CAPACITY 
    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
        resize();
    else if ((e = tab[index = (n - 1) & hash]) != null) {
    	// åˆæ˜¯å•è¯ç¼©å†™ï¼›hd = head (å¤´éƒ¨)ï¼Œtl = tile (ç»“å°¾)
        TreeNode<K,V> hd = null, tl = null;
        do {
            // å°†æ™®é€šèŠ‚ç‚¹è½¬æ¢ä¸ºæ ‘èŠ‚ç‚¹ï¼Œä½†æ­¤æ—¶è¿˜ä¸æ˜¯çº¢é»‘æ ‘ï¼Œä¹Ÿå°±æ˜¯è¯´è¿˜ä¸ä¸€å®šå¹³è¡¡
            TreeNode<K,V> p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);
        if ((tab[index] = hd) != null)
            // è½¬çº¢é»‘æ ‘æ“ä½œï¼Œè¿™é‡Œéœ€è¦å¾ªç¯æ¯”è¾ƒï¼ŒæŸ“è‰²ã€æ—‹è½¬ã€‚å…³äºçº¢é»‘æ ‘ï¼Œåœ¨ä¸‹ä¸€ç« èŠ‚è¯¦ç»†è®²è§£
            hd.treeify(tab);
    }
}
```

è¿™ä¸€éƒ¨åˆ†é“¾è¡¨æ ‘åŒ–çš„æ“ä½œå¹¶ä¸å¤æ‚ï¼Œå¤æ‚ç‚¹åœ¨äºä¸‹ä¸€å±‚çš„çº¢é»‘æ ‘è½¬æ¢ä¸Šï¼Œè¿™éƒ¨åˆ†çŸ¥è¯†ç‚¹ä¼šåœ¨åç»­ç« èŠ‚ä¸­ä¸“é—¨ä»‹ç»ï¼›

ä»¥ä¸Šæºç ä¸»è¦åŒ…æ‹¬çš„çŸ¥è¯†ç‚¹å¦‚ä¸‹ï¼›
1. é“¾è¡¨æ ‘åŒ–çš„æ¡ä»¶æœ‰ä¸¤ç‚¹ï¼›é“¾è¡¨é•¿åº¦å¤§äºç­‰äº8ã€æ¡¶å®¹é‡å¤§äº64ï¼Œå¦åˆ™åªæ˜¯æ‰©å®¹ï¼Œä¸ä¼šæ ‘åŒ–ã€‚
2. é“¾è¡¨æ ‘åŒ–çš„è¿‡ç¨‹ä¸­æ˜¯å…ˆç”±é“¾è¡¨è½¬æ¢ä¸ºæ ‘èŠ‚ç‚¹ï¼Œæ­¤æ—¶çš„æ ‘å¯èƒ½ä¸æ˜¯ä¸€é¢—å¹³è¡¡æ ‘ã€‚åŒæ—¶åœ¨æ ‘è½¬æ¢è¿‡ç¨‹ä¸­ä¼šè®°å½•é“¾è¡¨çš„é¡ºåºï¼Œ`tl.next = p`ï¼Œè¿™ä¸»è¦æ–¹ä¾¿åç»­æ ‘è½¬é“¾è¡¨å’Œæ‹†åˆ†æ›´æ–¹ä¾¿ã€‚
3. é“¾è¡¨è½¬æ¢æˆæ ‘å®Œæˆåï¼Œåœ¨è¿›è¡Œçº¢é»‘æ ‘çš„è½¬æ¢ã€‚å…ˆç®€å•ä»‹ç»ä¸‹ï¼Œçº¢é»‘æ ‘çš„è½¬æ¢éœ€è¦æŸ“è‰²å’Œæ—‹è½¬ï¼Œä»¥åŠæ¯”å¯¹å¤§å°ã€‚åœ¨æ¯”è¾ƒå…ƒç´ çš„å¤§å°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„æ–¹æ³•ï¼Œ`tieBreakOrder`åŠ æ—¶èµ›ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºHashMapæ²¡æœ‰åƒTreeMapé‚£æ ·æœ¬èº«å°±æœ‰Comparatorçš„å®ç°ã€‚

#### 1.5 çº¢é»‘æ ‘è½¬é“¾

åœ¨é“¾è¡¨è½¬çº¢é»‘æ ‘ä¸­æˆ‘ä»¬é‡ç‚¹ä»‹ç»äº†ä¸€å¥ï¼Œåœ¨è½¬æ¢æ ‘çš„è¿‡ç¨‹ä¸­ï¼Œè®°å½•äº†åŸæœ‰é“¾è¡¨çš„é¡ºåºã€‚

é‚£ä¹ˆï¼Œè¿™å°±ç®€å•äº†ï¼Œçº¢é»‘æ ‘è½¬é“¾è¡¨æ—¶å€™ï¼Œç›´æ¥æŠŠTreeNodeè½¬æ¢ä¸ºNodeå³å¯ï¼Œæºç å¦‚ä¸‹ï¼›

```java
final Node<K,V> untreeify(HashMap<K,V> map) {
    Node<K,V> hd = null, tl = null;
    // éå†TreeNode
    for (Node<K,V> q = this; q != null; q = q.next) {
    	// TreeNodeæ›¿æ¢Node
        Node<K,V> p = map.replacementNode(q, null);
        if (tl == null)
            hd = p;
        else
            tl.next = p;
        tl = p;
    }
    return hd;
}

// æ›¿æ¢æ–¹æ³•
Node<K,V> replacementNode(Node<K,V> p, Node<K,V> next) {
    return new Node<>(p.hash, p.key, p.value, next);
}
```

å› ä¸ºè®°å½•äº†é“¾è¡¨å…³ç³»ï¼Œæ‰€ä»¥æ›¿æ¢è¿‡ç¨‹å¾ˆå®¹æ˜“ã€‚æ‰€ä»¥å¥½çš„æ•°æ®ç»“æ„å¯ä»¥è®©æ“ä½œå˜å¾—æ›´åŠ å®¹æ˜“ã€‚

### 2. æŸ¥æ‰¾

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼ŒHashMapæŸ¥æ‰¾æµç¨‹å›¾](https://bugstack.cn/assets/images/2020/interview/interview-5-03.png)

ä¸Šå›¾å°±æ˜¯HashMapæŸ¥æ‰¾çš„ä¸€ä¸ªæµç¨‹å›¾ï¼Œè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯é«˜æ•ˆçš„ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ç»“åˆä»£ç ï¼Œæ¥åˆ†æè¿™æ®µæµç¨‹ï¼Œå¦‚ä¸‹ï¼›

```java
public V get(Object key) {
    Node<K,V> e;
    // åŒæ ·éœ€è¦ç»è¿‡æ‰°åŠ¨å‡½æ•°è®¡ç®—å“ˆå¸Œå€¼
    return (e = getNode(hash(key), key)) == null ? null : e.value;
}

final Node<K,V> getNode(int hash, Object key) {
    Node<K,V>[] tab; Node<K,V> first, e; int n; K k;
    // åˆ¤æ–­æ¡¶æ•°ç»„çš„æ˜¯å¦ä¸ºç©ºå’Œé•¿åº¦å€¼
    if ((tab = table) != null && (n = tab.length) > 0 &&
        // è®¡ç®—ä¸‹æ ‡ï¼Œå“ˆå¸Œå€¼ä¸æ•°ç»„é•¿åº¦-1
        (first = tab[(n - 1) & hash]) != null) {
        if (first.hash == hash && // always check first node
            ((k = first.key) == key || (key != null && key.equals(k))))
            return first;
        if ((e = first.next) != null) {
            // TreeNode èŠ‚ç‚¹ç›´æ¥è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ–¹æ³•ï¼Œæ—¶é—´å¤æ‚åº¦O(logn)
            if (first instanceof TreeNode)
                return ((TreeNode<K,V>)first).getTreeNode(hash, key);
            // å¦‚æœæ˜¯é“¾è¡¨å°±ä¾æ¬¡éå†æŸ¥æ‰¾
            do {
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    return e;
            } while ((e = e.next) != null);
        }
    }
    return null;
}
```

ä»¥ä¸ŠæŸ¥æ‰¾çš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹çŸ¥è¯†ç‚¹ï¼›
1. æ‰°åŠ¨å‡½æ•°çš„ä½¿ç”¨ï¼Œè·å–æ–°çš„å“ˆå¸Œå€¼ï¼Œè¿™åœ¨ä¸Šä¸€ç« èŠ‚å·²ç»è®²è¿‡
2. ä¸‹æ ‡çš„è®¡ç®—ï¼ŒåŒæ ·ä¹Ÿä»‹ç»è¿‡ `tab[(n - 1) & hash]) `
3. ç¡®å®šäº†æ¡¶æ•°ç»„ä¸‹æ ‡ä½ç½®ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¹çº¢é»‘æ ‘å’Œé“¾è¡¨è¿›è¡ŒæŸ¥æ‰¾å’Œéå†æ“ä½œäº†

### 3. åˆ é™¤

```java
 public V remove(Object key) {
     Node<K,V> e;
     return (e = removeNode(hash(key), key, null, false, true)) == null ?
         null : e.value;
 }
 
final Node<K,V> removeNode(int hash, Object key, Object value,
                           boolean matchValue, boolean movable) {
    Node<K,V>[] tab; Node<K,V> p; int n, index;
    // å®šä½æ¡¶æ•°ç»„ä¸­çš„ä¸‹æ ‡ä½ç½®ï¼Œindex = (n - 1) & hash
    if ((tab = table) != null && (n = tab.length) > 0 &&
        (p = tab[index = (n - 1) & hash]) != null) {
        Node<K,V> node = null, e; K k; V v;
        // å¦‚æœé”®çš„å€¼ä¸é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ç›¸ç­‰ï¼Œåˆ™å°† node æŒ‡å‘è¯¥èŠ‚ç‚¹
        if (p.hash == hash &&
            ((k = p.key) == key || (key != null && key.equals(k))))
            node = p;
        else if ((e = p.next) != null) {
            // æ ‘èŠ‚ç‚¹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ–¹æ³•ï¼Œå®šä½èŠ‚ç‚¹ã€‚
            if (p instanceof TreeNode)
                node = ((TreeNode<K,V>)p).getTreeNode(hash, key);
            else {
                // éå†é“¾è¡¨ï¼Œæ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹
                do {
                    if (e.hash == hash &&
                        ((k = e.key) == key ||
                         (key != null && key.equals(k)))) {
                        node = e;
                        break;
                    }
                    p = e;
                } while ((e = e.next) != null);
            }
        }
        
        // åˆ é™¤èŠ‚ç‚¹ï¼Œä»¥åŠçº¢é»‘æ ‘éœ€è¦ä¿®å¤ï¼Œå› ä¸ºåˆ é™¤åä¼šç ´åå¹³è¡¡æ€§ã€‚é“¾è¡¨çš„åˆ é™¤æ›´åŠ ç®€å•ã€‚
        if (node != null && (!matchValue || (v = node.value) == value ||
                             (value != null && value.equals(v)))) {
            if (node instanceof TreeNode)
                ((TreeNode<K,V>)node).removeTreeNode(this, tab, movable);
            else if (node == p)
                tab[index] = node.next;
            else
                p.next = node.next;
            ++modCount;
            --size;
            afterNodeRemoval(node);
            return node;
        }
    }
    return null;
} 
```

- åˆ é™¤çš„æ“ä½œä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œé¢éƒ½æ²¡æœ‰å¤ªå¤šçš„å¤æ‚çš„é€»è¾‘ã€‚
- å¦å¤–çº¢é»‘æ ‘çš„æ“ä½œå› ä¸ºè¢«åŒ…è£…äº†ï¼Œåªçœ‹ä½¿ç”¨ä¸Šä¹Ÿæ˜¯å¾ˆå®¹æ˜“ã€‚

### 4. éå†

#### 4.1 é—®é¢˜ç‚¹

HashMapä¸­çš„éå†ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„APIæ–¹æ³•ï¼ŒåŒ…æ‹¬ï¼›

**KeySet**

```java
 for (String key : map.keySet()) {
     System.out.print(key + " ");
 }
```

**EntrySet**

```java
 for (HashMap.Entry entry : map.entrySet()) {
     System.out.print(entry + " ");
 }
```

ä»æ–¹æ³•ä¸Šä»¥åŠæ—¥å¸¸ä½¿ç”¨éƒ½çŸ¥é“ï¼ŒKeySetæ˜¯éå†æ˜¯æ— åºçš„ï¼Œä½†æ¯æ¬¡ä½¿ç”¨ä¸åŒæ–¹å¼éå†åŒ…æ‹¬`keys.iterator()`ï¼Œå®ƒä»¬éå†çš„ç»“æœæ˜¯å›ºå®šçš„ã€‚

é‚£ä¹ˆä»å®ç°çš„è§’åº¦æ¥çœ‹ï¼Œè¿™äº›ç§éå†éƒ½æ˜¯ä»æ•£åˆ—è¡¨ä¸­çš„é“¾è¡¨å’Œçº¢é»‘æ ‘è·å–é›†åˆå€¼ï¼Œé‚£ä¹ˆä»–ä»¬æœ‰ä¸€ä¸ªä»€ä¹ˆå›ºå®šçš„è§„å¾‹å—ï¼Ÿ

#### 4.2 ç”¨ä»£ç æµ‹è¯•

æµ‹è¯•çš„åœºæ™¯å’Œå‰æï¼›
1. è¿™é‡Œæˆ‘ä»¬è¦è®¾å®šä¸€ä¸ªæ—¢æœ‰çº¢é»‘æ ‘åˆæœ‰é“¾è¡¨ç»“æ„çš„æ•°æ®åœºæ™¯
2. ä¸ºäº†å¯ä»¥æœ‰è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬æœ€å¥½æŠŠHashMapçš„åˆå§‹é•¿åº¦è®¾å®šä¸º64ï¼Œé¿å…åœ¨é“¾è¡¨è¶…è¿‡8ä½åæ‰©å®¹ï¼Œè€Œæ˜¯ç›´æ¥è®©å…¶è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚
3. æ‰¾åˆ°18ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ”¾åœ¨ä¸åŒèŠ‚ç‚¹(è¿™äº›æ•°æ®é€šè¿‡ç¨‹åºè®¡ç®—å¾—æ¥)ï¼›
   1. æ¡¶æ•°ç»„02èŠ‚ç‚¹ï¼š24ã€46ã€68
   2. æ¡¶æ•°ç»„07èŠ‚ç‚¹ï¼š29
   3. æ¡¶æ•°ç»„12èŠ‚ç‚¹ï¼š150ã€172ã€194ã€271ã€293ã€370ã€392ã€491ã€590

**ä»£ç æµ‹è¯•**

```java
@Test
public void test_Iterator() {
    Map<String, String> map = new HashMap<String, String>(64);
    map.put("24", "Idxï¼š2");
    map.put("46", "Idxï¼š2");
    map.put("68", "Idxï¼š2");
    map.put("29", "Idxï¼š7");
    map.put("150", "Idxï¼š12");
    map.put("172", "Idxï¼š12");
    map.put("194", "Idxï¼š12");
    map.put("271", "Idxï¼š12");
    System.out.println("æ’åº01ï¼š");
    for (String key : map.keySet()) {
        System.out.print(key + " ");
    }
    
    map.put("293", "Idxï¼š12");
    map.put("370", "Idxï¼š12");
    map.put("392", "Idxï¼š12");
    map.put("491", "Idxï¼š12");
    map.put("590", "Idxï¼š12");
    System.out.println("\n\næ’åº02ï¼š");
    for (String key : map.keySet()) {
        System.out.print(key + " ");
    }    
    
    map.remove("293");
    map.remove("370");
    map.remove("392");
    map.remove("491");
    map.remove("590");
    System.out.println("\n\næ’åº03ï¼š");
    for (String key : map.keySet()) {
        System.out.print(key + " ");
    }
    
}
```

è¿™æ®µä»£ç åˆ†åˆ«æµ‹è¯•äº†ä¸‰ç§åœºæ™¯ï¼Œå¦‚ä¸‹ï¼›
1. æ·»åŠ å…ƒç´ ï¼Œåœ¨HashMapè¿˜æ˜¯åªé“¾è¡¨ç»“æ„æ—¶ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœ01
2. æ·»åŠ å…ƒç´ ï¼Œåœ¨HashMapè½¬æ¢ä¸ºçº¢é»‘æ ‘æ—¶å€™ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœ02
3. åˆ é™¤å…ƒç´ ï¼Œåœ¨HashMapè½¬æ¢ä¸ºé“¾è¡¨ç»“æ„æ—¶ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœ03

#### 4.3 æµ‹è¯•ç»“æœåˆ†æ

```java
æ’åº01ï¼š
24 46 68 29 150 172 194 271 

æ’åº02ï¼š
24 46 68 29 271 150 172 194 293 370 392 491 590 

æ’åº03ï¼š
24 46 68 29 172 271 150 194 
Process finished with exit code 0
```

ä»map.keySet()æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸‹ä¿¡æ¯ï¼›
1. 01æƒ…å†µä¸‹ï¼Œæ’åºå®šä½å“ˆå¸Œå€¼ä¸‹æ ‡å’Œé“¾è¡¨ä¿¡æ¯

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œé“¾è¡¨ç»“æ„](https://bugstack.cn/assets/images/2020/interview/interview-5-04.png)

2. 02æƒ…å†µä¸‹ï¼Œå› ä¸ºé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæ ‘æ ¹ä¼šç§»åŠ¨åˆ°æ•°ç»„å¤´éƒ¨ã€‚`moveRootToFront()æ–¹æ³•`

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œé“¾è¡¨æ ‘åŒ–](https://bugstack.cn/assets/images/2020/interview/interview-5-05.png)

3. 03æƒ…å†µä¸‹ï¼Œå› ä¸ºåˆ é™¤äº†éƒ¨åˆ†å…ƒç´ ï¼Œçº¢é»‘æ ‘é€€åŒ–æˆé“¾è¡¨ã€‚

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œçº¢é»‘æ ‘è½¬é“¾è¡¨](https://bugstack.cn/assets/images/2020/interview/interview-5-06.png)

## ä¸‰ã€æ€»ç»“

- è¿™ä¸€ç¯‡APIæºç ä»¥åŠé€»è¾‘ä¸ä¸Šä¸€ç¯‡æ•°æ®ç»“æ„ä¸­æ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ•£åˆ—è¡¨å®ç°ç­‰ï¼Œå†…å®¹çš„ç»“åˆï¼Œç®—æ˜¯æŠŠHashMapåŸºæœ¬å¸¸ç”¨æŠ€æœ¯ç‚¹ï¼Œæ¢³ç†å®Œæˆäº†ã€‚ä½†çŸ¥è¯†ç»ä¸æ­¢äºæ­¤ï¼Œè¿™é‡Œè¿˜æœ‰çº¢é»‘æ ‘çš„ç›¸å…³æŠ€æœ¯å†…å®¹ï¼Œåç»­ä¼šè¿›è¡Œè¯¦ç»†ã€‚
- é™¤äº†HashMapä»¥å¤–è¿˜æœ‰TreeMapã€ConcurrentHashMapç­‰ï¼Œæ¯ä¸€ä¸ªæ ¸å¿ƒç±»éƒ½æœ‰ä¸€äº›ç›¸å…³çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œæ¯ä¸€ä¸ªéƒ½éå¸¸å€¼å¾—æ·±å…¥ç ”ç©¶ã€‚è¿™ä¸ªçƒ§è„‘çš„è¿‡ç¨‹ï¼Œæ˜¯å­¦ä¹ è·å¾—çŸ¥è¯†çš„æœ€ä½³æ–¹å¼ã€‚
- å¯èƒ½å…³äºHashMapè¿˜æœ‰ä¸€äº›ç–æ¼çš„ç‚¹ï¼Œä¹Ÿå¸Œæœ›é˜…è¯»çš„å°ä¼™ä¼´å¯ä»¥æå‡ºæ›´å¤šçš„é—®é¢˜ï¼Œäº’ç›¸å­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ï¼Œæœ¬æ–‡å°±åˆ°è¿™é‡Œï¼Œæ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼
