---
layout: post
category: interview
title: é¢ç»æ‰‹å†Œ Â· ç¬¬9ç¯‡ã€Šé˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ—ã€å»¶è¿Ÿå¯¹åˆ—ã€é˜»å¡é˜Ÿåˆ—ï¼Œå…¨æ˜¯çŸ¥è¯†ç›²åŒºï¼ã€‹
tagline: by å°å‚…å“¥
tag: [java,interview]
excerpt: å»å¨æˆ¿ğŸ¥£å«è¿›æ ˆã€ŒLIFOã€ï¼Œä¸Šå•æ‰€ğŸš½å«å…¥é˜Ÿåˆ—ã€ŒFIFOã€ï¼Œé‚£åŒç«¯é˜Ÿåˆ—å‘¢ï¼Ÿéƒ½æ˜¯çŸ¥è¯†ç›²åŒºï¼å¿«ç‚¹ä¸Šè½¦ğŸšŒå§ï¼ğŸ¤¦ğŸ»â€â™‚æ•°ç»„ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€æ•£åˆ—è¡¨ã€æ ‘ã€å †ã€å›¾ï¼Œéƒ½æ˜¯åŸºæœ¬çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¬å¯ä»¥æœ‰å¤šä¸ªç‰¹æ€§ä¹Ÿå¯ä»¥ç»„åˆï¼Œä¾‹å¦‚ï¼›LinkedListæ—¢æ˜¯é“¾è¡¨ä¹Ÿæ˜¯é˜Ÿåˆ—ï¼ŒHashMapä¸­ç”¨åˆ°äº†æ•£åˆ—è¡¨ã€æ•°ç»„ã€é˜Ÿåˆ—ã€æ ‘çš„ç»„åˆç­‰ç­‰ã€‚
lock: need
---

# é¢ç»æ‰‹å†Œ Â· ç¬¬9ç¯‡ã€Šé˜Ÿåˆ—æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ—ã€å»¶è¿Ÿå¯¹åˆ—ã€é˜»å¡é˜Ÿåˆ—ï¼Œå…¨æ˜¯çŸ¥è¯†ç›²åŒºï¼ã€‹

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`ä¹°æˆ¿å­æœ€é‡è¦çš„æ˜¯æˆ¿å±‹æ ¼å±€ï¼`

å¦‚æœä¹°æˆ¿å­èƒ½æ¥å—åœ°ç†ä½ç½®ã€å¹³ç±³ä»·æ ¼å¤–ï¼Œæœ€é‡è¦çš„å°±æ˜¯æˆ¿å±‹æ ¼å±€ã€‚*ä»€ä¹ˆï¼Ÿä¸ˆæ¯å¨˜ï¼ä½ ğŸ¤¦ğŸ»â€â™‚ï¼Œå‡ºå»ï¼* æˆ¿å±‹çš„æ ¼å±€å…¶å®å¯¹åº”çš„å°±æ˜¯ç¨‹åºå¼€å‘çš„æ ¹æœ¬ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ç»“æ„ã€‚æœ‰çš„åœŸè±ªå¯ä»¥ç”¨é’±æ¢ç©ºé—´ï¼Œæˆ¿é—´æ ¼å±€æ›´å¤§ï¼Œé‚£æ²¡é’±çš„å°±åªèƒ½é€‰ç»æµå°ç©ºé—´èŠ‚çœé’±ã€‚æ˜¯ä¸æ˜¯å¾ˆåƒä¸åŒçš„æ•°æ®ç»“æ„ï¼Œç›´æ¥å½±å“ç€æ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œè¿˜æ˜¯æ—¶é—´æ¢ç©ºé—´ã€‚é‚£ä¹ˆï¼Œå†ç»†çœ‹æˆ¿é—´ï¼Œå¦‚ï¼›å®¢å…æ²™å‘åäººåƒæ•£åˆ—è¡¨ã€å»å¨æˆ¿ğŸ¥£å«è¿›æ ˆ`ã€ŒLIFOã€`ã€ä¸Šå•æ‰€ğŸš½å«å…¥é˜Ÿåˆ—`ã€ŒFIFOã€`ã€æ™šä¸Šå„å›å„å±‹å­åƒè¿›æ•°ç»„ã€‚æ‰€ä»¥ä½ èƒ½åœ¨è¿™ä¸ªå±‹å­ç”Ÿæ´»çš„èˆ’æœï¼Œå¾ˆå¤§ä¸€éƒ¨åˆ†å–å†³äºæ•´ä¸ªæˆ¿é—´çš„å¸ƒå±€ã€‚ä¹ŸåŒæ ·ä½ èƒ½æŠŠç¨‹åºå†™å¥½ï¼Œå¾ˆå¤§çš„åŸå› æ˜¯å› ä¸ºæ•°æ®ç»“æ„å®šä¹‰çš„åˆç†ã€‚

`é‚£ä¹ˆå†³å®šè¿™ç¨‹åºå¼€å‘åŸºç¡€æ•°æ®ç»“æ„æœ‰å“ªäº›å‘¢ï¼Ÿ`

![](https://bugstack.cn/assets/images/2020/interview/interview-10-01.png)

ç¨‹åºå¼€å‘ä¸­æ•°æ®ç»“æ„å¯ä»¥åˆ†ä¸ºè¿™å…«ç±»ï¼›`æ•°ç»„`ã€`é“¾è¡¨`ã€`æ ˆ`ã€`é˜Ÿåˆ—`ã€`æ•£åˆ—è¡¨`ã€`æ ‘`ã€`å †`ã€`å›¾`ã€‚å…¶ä¸­ï¼Œæ•°ç»„ã€é“¾è¡¨ã€æ•£åˆ—è¡¨ã€æ ‘æ˜¯ç¨‹åºå¼€å‘ç›´æ¥æˆ–è€…é—´æ¥ç”¨åˆ°çš„æœ€å¤šçš„ã€‚ç›¸å…³çš„å¯¹åº”å®ç°ç±»å¯ä»¥åŒ…æ‹¬å¦‚ä¸‹ï¼›

| ç±»å‹   | å®ç°                         | æ–‡ç«                                                          |
| ------ | ---------------------------- | ------------------------------------------------------------ |
| æ•°ç»„   | ArrayList                    | [ArrayListä¹Ÿè¿™ä¹ˆå¤šçŸ¥è¯†ï¼Ÿä¸€ä¸ªæŒ‡å®šä½ç½®æ’å…¥å°±æŠŠè°¢é£æœºé¢æ™•äº†ï¼]([https://bugstack.cn/interview/2020/08/27/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC7%E7%AF%87-ArrayList%E4%B9%9F%E8%BF%99%E4%B9%88%E5%A4%9A%E7%9F%A5%E8%AF%86-%E4%B8%80%E4%B8%AA%E6%8C%87%E5%AE%9A%E4%BD%8D%E7%BD%AE%E6%8F%92%E5%85%A5%E5%B0%B1%E6%8A%8A%E8%B0%A2%E9%A3%9E%E6%9C%BA%E9%9D%A2%E6%99%95%E4%BA%86.html](https://bugstack.cn/interview/2020/08/27/é¢ç»æ‰‹å†Œ-ç¬¬7ç¯‡-ArrayListä¹Ÿè¿™ä¹ˆå¤šçŸ¥è¯†-ä¸€ä¸ªæŒ‡å®šä½ç½®æ’å…¥å°±æŠŠè°¢é£æœºé¢æ™•äº†.html)) |
| é“¾è¡¨   | LinkedList                   | [LinkedListæ’å…¥é€Ÿåº¦æ¯”ArrayListå¿«ï¼Ÿä½ ç¡®å®šå—ï¼Ÿ]([https://bugstack.cn/interview/2020/08/30/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC8%E7%AF%87-LinkedList%E6%8F%92%E5%85%A5%E9%80%9F%E5%BA%A6%E6%AF%94ArrayList%E5%BF%AB-%E4%BD%A0%E7%A1%AE%E5%AE%9A%E5%90%97.html](https://bugstack.cn/interview/2020/08/30/é¢ç»æ‰‹å†Œ-ç¬¬8ç¯‡-LinkedListæ’å…¥é€Ÿåº¦æ¯”ArrayListå¿«-ä½ ç¡®å®šå—.html)) |
| æ ‘     | 2-3æ ‘ã€çº¢é»‘æ ‘                | [çœ‹å›¾è¯´è¯ï¼Œè®²è§£2-3å¹³è¡¡æ ‘ã€Œçº¢é»‘æ ‘çš„å‰èº«ã€]([https://bugstack.cn/interview/2020/08/16/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC5%E7%AF%87-%E7%9C%8B%E5%9B%BE%E8%AF%B4%E8%AF%9D-%E8%AE%B2%E8%A7%A32-3%E5%B9%B3%E8%A1%A1%E6%A0%91-%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%89%8D%E8%BA%AB.html](https://bugstack.cn/interview/2020/08/16/é¢ç»æ‰‹å†Œ-ç¬¬5ç¯‡-çœ‹å›¾è¯´è¯-è®²è§£2-3å¹³è¡¡æ ‘-çº¢é»‘æ ‘çš„å‰èº«.html)) <br/>[çº¢é»‘æ ‘æ“ä½œåŸç†ï¼Œè§£æä»€ä¹ˆæ—¶å€™æŸ“è‰²ã€æ€ä¹ˆè¿›è¡Œæ—‹è½¬ã€ä¸2-3æ ‘æœ‰ä»€ä¹ˆå…³è”]([https://bugstack.cn/interview/2020/08/20/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC6%E7%AF%87-%E5%B8%A6%E7%9D%80%E9%9D%A2%E8%AF%95%E9%A2%98%E5%AD%A6%E4%B9%A0%E7%BA%A2%E9%BB%91%E6%A0%91%E6%93%8D%E4%BD%9C%E5%8E%9F%E7%90%86-%E8%A7%A3%E6%9E%90%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%9F%93%E8%89%B2-%E6%80%8E%E4%B9%88%E8%BF%9B%E8%A1%8C%E6%97%8B%E8%BD%AC-%E4%B8%8E2-3%E6%A0%91%E6%9C%89%E4%BB%80%E4%B9%88%E5%85%B3%E8%81%94.html](https://bugstack.cn/interview/2020/08/20/é¢ç»æ‰‹å†Œ-ç¬¬6ç¯‡-å¸¦ç€é¢è¯•é¢˜å­¦ä¹ çº¢é»‘æ ‘æ“ä½œåŸç†-è§£æä»€ä¹ˆæ—¶å€™æŸ“è‰²-æ€ä¹ˆè¿›è¡Œæ—‹è½¬-ä¸2-3æ ‘æœ‰ä»€ä¹ˆå…³è”.html)) |
| æ•£åˆ—è¡¨ | HashMap                      | [HashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ]([https://bugstack.cn/interview/2020/08/07/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC3%E7%AF%87-HashMap%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86-%E6%89%B0%E5%8A%A8%E5%87%BD%E6%95%B0-%E8%B4%9F%E8%BD%BD%E5%9B%A0%E5%AD%90-%E6%89%A9%E5%AE%B9%E9%93%BE%E8%A1%A8%E6%8B%86%E5%88%86-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0.html](https://bugstack.cn/interview/2020/08/07/é¢ç»æ‰‹å†Œ-ç¬¬3ç¯‡-HashMapæ ¸å¿ƒçŸ¥è¯†-æ‰°åŠ¨å‡½æ•°-è´Ÿè½½å› å­-æ‰©å®¹é“¾è¡¨æ‹†åˆ†-æ·±åº¦å­¦ä¹ .html))<br/>[HashMapæ•°æ®æ’å…¥ã€æŸ¥æ‰¾ã€åˆ é™¤ã€éå†ï¼Œæºç åˆ†æ]([https://bugstack.cn/interview/2020/08/13/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC4%E7%AF%87-HashMap%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5-%E6%9F%A5%E6%89%BE-%E5%88%A0%E9%99%A4-%E9%81%8D%E5%8E%86-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html](https://bugstack.cn/interview/2020/08/13/é¢ç»æ‰‹å†Œ-ç¬¬4ç¯‡-HashMapæ•°æ®æ’å…¥-æŸ¥æ‰¾-åˆ é™¤-éå†-æºç åˆ†æ.html)) |
| æ ˆ     | `Stack<String>`                |                                                              |
| é˜Ÿåˆ—   | `Queue<String>`ã€`Deque<String>` |                                                              |

- å¦‚ä¸Šï¼Œé™¤äº†æ ˆå’Œé˜Ÿåˆ—å¤–ï¼Œå°å‚…å“¥å·²ç»ç¼–å†™äº†éå¸¸ç»†è‡´çš„æ–‡ç« æ¥ä»‹ç»äº†å…¶ä»–æ•°æ®ç»“æ„çš„æ ¸å¿ƒçŸ¥è¯†å’Œå…·ä½“çš„å®ç°åº”ç”¨ã€‚
- æ¥ä¸‹æ¥å°±æŠŠå‰©ä¸‹çš„æ ˆå’Œé˜Ÿåˆ—åœ¨æœ¬ç« ä»‹ç»å®Œï¼Œå…¶å®è¿™éƒ¨åˆ†çŸ¥è¯†å¹¶ä¸éš¾äº†ï¼Œæœ‰äº†ä»¥ä¸Šå¯¹æ•°ç»„å’Œé“¾è¡¨çš„ç†è§£ï¼Œå…¶ä»–çš„æ•°æ®ç»“æ„åŸºæœ¬éƒ½ä»è¿™ä¸¤æ–¹é¢æ‰©å±•å‡ºæ¥çš„ã€‚

*æœ¬æ–‡æ¶‰åŠäº†è¾ƒå¤šçš„ä»£ç å’Œå®è·µéªŒè¯å›¾ç¨¿ï¼Œæ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼š`bugstackè™«æ´æ ˆ`ï¼Œå›å¤ä¸‹è½½å¾—åˆ°ä¸€ä¸ªé“¾æ¥æ‰“å¼€åï¼Œæ‰¾åˆ°IDï¼š19ğŸ¤«è·å–ï¼*

## äºŒã€é¢è¯•é¢˜

`è°¢é£æœº`ï¼Œé£æœºä½ æ—è¾¹è¿™æ˜¯ï¼Ÿ

**ç­”**ï¼šå•Šï¼Œè°¢å¦å…‹ï¼Œæˆ‘å¼Ÿå¼Ÿã€‚è¿˜æ²¡æ¯•ä¸šï¼Œæƒ³æ¥çœ‹çœ‹å¤§å…¬å¸é¢è¯•å®˜çš„å®¹é¢œã€‚

**é—®**ï¼šé£æœºï¼Œä¸Šæ¬¡æŠŠ`LinkedList`éƒ½çœ‹äº†å§ï¼Œé‚£æˆ‘é—®ä½ å“ˆã€‚`LinkedList`å¯ä»¥å½“é˜Ÿåˆ—ç”¨å—ï¼Ÿ

**ç­”**ï¼šå•Šï¼Ÿå¯ä»¥ï¼Œå¯ä»¥å§ï¼

**é—®**ï¼šé‚£ï¼Œæ•°ç»„èƒ½å½“é˜Ÿåˆ—ç”¨å—ï¼Ÿä¸èƒ½ï¼Ÿå¯¹åˆ—æœ‰å•¥ç‰¹ç‚¹å—ï¼Ÿ

**ç­”**ï¼šé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼Œå—¯ï¼Œå—¯ã€‚

**é—®**ï¼šè¿˜æœ‰å—ï¼Ÿäº†è§£å»¶æ—¶é˜Ÿåˆ—å—ï¼ŸåŒç«¯é˜Ÿåˆ—å‘¢ï¼Ÿ

é£æœºæ‹‰ç€å¦å…‹çš„æ‰‹å‡ºé—¨äº†ï¼Œè¿˜å¸¦èµ°äº†é¢è¯•å®˜é€çš„ä¸€æœ¬`ã€Šé¢ç»æ‰‹å†Œã€‹`ï¼Œå¦å…‹å¯¹é£æœºè¯´ï¼ŒåŸºç¡€ä¸ç‰¢ï¼Œåœ°åŠ¨å±±æ‘‡ï¼Œæˆ‘è¦å¥½å¥½å­¦ä¹ ã€‚

## ä¸‰ã€æ•°æ®ç»“æ„

`æŠŠæˆ‘ä»¬å·²ç»æŒæ¡äº†çš„æ•°ç»„å’Œé“¾è¡¨ç«‹èµ·æ¥ï¼Œå°±æ˜¯æ ˆå’Œé˜Ÿåˆ—äº†ï¼`

![](https://bugstack.cn/assets/images/2020/interview/interview-10-02.png)

å¦‚å›¾ï¼Œè¿™ä¸€ç« èŠ‚çš„æ•°æ®ç»“æ„çš„çŸ¥è¯†ç‚¹å¹¶ä¸éš¾ï¼Œåªè¦å·²ç»å­¦ä¹ è¿‡æ•°ç»„å’Œé“¾è¡¨ï¼Œé‚£ä¹ˆå¯¹äºæŒæ¡å…¶ä»–æ•°æ®ç»“æ„å°±å·²ç»æœ‰äº†åŸºç¡€ï¼Œåªä¸è¿‡å¯¹äºæ•°æ®çš„å­˜æ”¾ã€è¯»å–åŠ äº†ä¸€äº›é™å®šè§„åˆ™ã€‚å°¤å…¶åƒé“¾è¡¨è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œåªæ“ä½œå¤´å°¾çš„æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚

## å››ã€æºç å­¦ä¹ 

### 1. å…ˆè¯´ä¸€ä¸ªè¢«æŠ›å¼ƒStack

`æœ‰æ—¶å€™ä¸ä¼šåè€Œä¸ä¼šçŠ¯é”™è¯¯ï¼æ€•å°±æ€•åœ¨åªçŸ¥é“ä¸€çŸ¥åŠè§£ã€‚`

æŠ›å¼ƒçš„ä¸æ˜¯æ ˆè¿™ç§æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯Stackå®ç°ç±»ï¼Œå¦‚æœä½ è¿˜ä¸äº†è§£å°±ç”¨åˆ°ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå°±å¾ˆå¯èƒ½ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚å…¶å®Stackè¿™ä¸ªæ ˆå·²ç»æ˜¯ä¸å»ºè®®ä½¿ç”¨äº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨å’Œæºç åˆ†æäº†è§£ä¸‹æ ¹æœ¬åŸå› ã€‚

åœ¨å­¦ä¹ ä¹‹å‰å…ˆå¤§æ¦‚çš„äº†è§£ä¸‹è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œå®ƒå¾ˆåƒç¾½æ¯›çƒçš„æ‘†æ”¾ï¼Œæ˜¯ä¸€ç§åè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œå¦‚ä¸‹ï¼›

![](https://bugstack.cn/assets/images/2020/interview/interview-10-03.png)

#### 1.1 åŠŸèƒ½ä½¿ç”¨

```java
@Test
public void test_stack() {
    Stack<String> s = new Stack<String>();
    s.push("aaa");
    s.push("bbb");
    s.push("ccc");
    
    System.out.println("è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼š" + s.peek());
    System.out.println("è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼š" + s.lastElement());
    System.out.println("è·å–æœ€å…ˆæ”¾ç½®å…ƒç´ ï¼š" + s.firstElement());
    
    System.out.println("å¼¹å‡ºä¸€ä¸ªå…ƒç´ [LIFO]ï¼š" + s.pop());
    System.out.println("å¼¹å‡ºä¸€ä¸ªå…ƒç´ [LIFO]ï¼š" + s.pop());
    System.out.println("å¼¹å‡ºä¸€ä¸ªå…ƒç´ [LIFO]ï¼š" + s.pop());
}
```

ä¾‹å­æ˜¯å¯¹`Stack`æ ˆçš„ä½¿ç”¨ï¼Œå¦‚æœä¸è¿è¡Œä½ èƒ½çŸ¥é“å®ƒçš„è¾“å‡ºç»“æœå—ï¼Ÿ

**æµ‹è¯•ç»“æœï¼š**

```java
è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼šccc
è·å–æœ€åä¸€ä¸ªå…ƒç´ ï¼šccc
è·å–æœ€å…ˆæ”¾ç½®å…ƒç´ ï¼šaaa
å¼¹å‡ºä¸€ä¸ªå…ƒç´ [LIFO]ï¼šccc
å¼¹å‡ºä¸€ä¸ªå…ƒç´ [LIFO]ï¼šbbb
å¼¹å‡ºä¸€ä¸ªå…ƒç´ [LIFO]ï¼šaaa

Process finished with exit code 0
```

çœ‹åˆ°æµ‹è¯•ç»“æœï¼Œä¸ä½ æƒ³çš„ç­”æ¡ˆæ˜¯å¦ä¸€è‡´ï¼Ÿ
- peekï¼Œæ˜¯å·çœ‹çš„æ„æ€ï¼Œå°±æ˜¯çœ‹ä¸€ä¸‹ï¼Œä¸ä¼šå¼¹å‡ºå…ƒç´ ã€‚æ»¡è¶³åè¿›å…ˆå‡ºçš„è§„åˆ™ï¼Œå®ƒçœ‹çš„æ˜¯æœ€åæ”¾è¿›å»çš„å…ƒç´ `ccc`ã€‚
- lastElementã€firstElementï¼Œå­—é¢æ„æ€çš„æ–¹æ³•ï¼Œè·å–æœ€åä¸€ä¸ªå’Œè·å–ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚
- popï¼Œæ˜¯é˜Ÿåˆ—ä¸­å¼¹å‡ºå…ƒç´ ï¼Œå¼¹å‡ºåä¹Ÿä»£è¡¨ç€è¦æŠŠå±äºè¿™ä¸ªä½ç½®éƒ½å…ƒç´ æ¸…ç©ºï¼Œåˆ æ‰ã€‚

#### 1.2 æºç åˆ†æ

æˆ‘ä»¬è¯´`Stack`æ ˆï¼Œè¿™ä¸ªå®ç°ç±»å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œéœ€è¦ä»å®ƒçš„æºç ä¸Šçœ‹ã€‚

```java
/**
 *
 * <p>A more complete and consistent set of LIFO stack operations is
 * provided by the {@link Deque} interface and its implementations, which
 * should be used in preference to this class.  For example:
 * <pre>   {@code
 *   Deque<Integer> stack = new ArrayDeque<Integer>();}</pre>
 *   
 * @author  Jonathan Payne
 * @since   JDK1.0
 */
public class Stack<E> extends Vector<E> 
```

```java
s.push("aaa");

public synchronized void addElement(E obj) {
    modCount++;
    ensureCapacityHelper(elementCount + 1);
    elementData[elementCount++] = obj;
}
```

1. `Stack` æ ˆæ˜¯åœ¨JDK1.0æ—¶ä»£æ—¶ï¼ŒåŸºäºç»§æ‰¿`Vector`ï¼Œå®ç°çš„ã€‚æœ¬èº«`Vector`å°±æ˜¯ä¸€ä¸ªä¸æ¨èä½¿ç”¨çš„ç±»ï¼Œä¸»è¦åœ¨äºå®ƒçš„ä¸€äº›æ“ä½œæ–¹æ³•é”ğŸ”’(*synchronized*)çš„åŠ›åº¦å¤ªç²—ï¼Œéƒ½æ˜¯æ”¾åˆ°æ–¹æ³•ä¸Šã€‚
2. `Stack` æ ˆåº•å±‚æ˜¯ä½¿ç”¨`Vector`æ•°ç»„å®ç°ï¼Œåœ¨å­¦ä¹ `ArrayList`æ—¶å€™æˆ‘ä»¬çŸ¥é“ï¼Œæ•°ç»„ç»“æ„åœ¨å…ƒç´ æ·»åŠ å’Œæ“…é•¿éœ€è¦é€šè¿‡`System.arraycopy`ï¼Œè¿›è¡Œæ‰©å®¹æ“ä½œã€‚è€Œæœ¬èº«æ ˆçš„ç‰¹ç‚¹æ˜¯é¦–å°¾å…ƒç´ çš„æ“ä½œï¼Œä¹Ÿä¸éœ€è¦éå†ï¼Œä½¿ç”¨æ•°ç»„ç»“æ„å…¶å®å¹¶ä¸å¤ªç†æƒ³ã€‚
3. åŒæ—¶åœ¨è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šä¸Šä¹Ÿæ˜ç¡®æ ‡å‡ºæ¥ï¼Œæ¨èä½¿ç”¨`Deque<Integer> stack = new ArrayDeque<Integer>();`ï¼Œè™½ç„¶è¿™ä¹Ÿæ˜¯æ•°ç»„ç»“æ„ï¼Œä½†æ˜¯å®ƒæ²¡æœ‰ç²—ç²’åº¦çš„é”ï¼ŒåŒæ—¶å¯ä»¥ç”³è¯·æŒ‡å®šç©ºé—´å¹¶ä¸”åœ¨æ‰©å®¹æ—¶æ“ä½œæ—¶ä¹Ÿè¦ä¼˜äº`Stack` ã€‚å¹¶ä¸”å®ƒè¿˜æ˜¯ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œä½¿ç”¨èµ·æ¥æ›´çµæ´»ã€‚

### 2. åŒç«¯é˜Ÿåˆ—ArrayDeque

`ArrayDeque` æ˜¯åŸºäºæ•°ç»„å®ç°çš„å¯åŠ¨æ€æ‰©å®¹çš„åŒç«¯é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥åœ¨é˜Ÿåˆ—çš„å¤´å’Œå°¾åŒæ—¶æ’å…¥å’Œå¼¹å‡ºå…ƒç´ ã€‚å½“å…ƒç´ æ•°é‡è¶…è¿‡æ•°ç»„åˆå§‹åŒ–é•¿åº¦æ—¶ï¼Œåˆ™éœ€è¦æ‰©å®¹å’Œè¿ç§»æ•°æ®ã€‚

**æ•°æ®ç»“æ„å’Œæ“ä½œ**ï¼Œå¦‚ä¸‹ï¼›

![å°å‚…å“¥ bugstack.cn & åŒç«¯é˜Ÿåˆ—æ•°æ®ç»“æ„æ“ä½œ](https://bugstack.cn/assets/images/2020/interview/interview-10-04.png)

ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°å¦‚ä¸‹å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼›
1. åŒç«¯é˜Ÿåˆ—æ˜¯åŸºäºæ•°ç»„å®ç°ï¼Œæ‰€ä»¥æ‰©å®¹è¿ç§»æ•°æ®æ“ä½œã€‚
2. `pushã€offerFirstã€addFirst`ï¼Œå¤´æ’æ–¹æ³•ï¼Œæ•ˆæœä¸€è‡´ã€`offerLastã€addLast`ï¼Œå°¾æ’æ–¹æ³•ï¼Œè¿™æ ·ä¸¤ç«¯éƒ½æ»¡è¶³åè¿›å…ˆå‡ºã€‚
3. æ•´ä½“æ¥çœ‹ï¼ŒåŒç«¯é˜Ÿåˆ—ï¼Œå°±æ˜¯ä¸€ä¸ªç¯å½¢ã€‚æ‰€ä»¥æ‰©å®¹åç»§ç»­æ’å…¥å…ƒç´ ä¹Ÿæ»¡è¶³åè¿›å…ˆå‡ºã€‚

#### 2.1 åŠŸèƒ½ä½¿ç”¨

```java
@Test
public void test_ArrayDeque() {
    Deque<String> deque = new ArrayDeque<String>(1);
    
    deque.push("a");
    deque.push("b");
    deque.push("c");
    deque.push("d");
    
    deque.offerLast("e");
    deque.offerLast("f");
    deque.offerLast("g");
    deque.offerLast("h");  // è¿™æ—¶å€™æ‰©å®¹äº†
    
    deque.push("i");
    deque.offerLast("j");
    
    System.out.println("æ•°æ®å‡ºæ ˆï¼š");
    while (!deque.isEmpty()) {
        System.out.print(deque.pop() + " ");
    }
}
```

ä»¥ä¸Šè¿™éƒ¨åˆ†ä»£ç å°±æ˜¯ä¸ä¸Šå›¾çš„å±•ç°æ˜¯ä¸€è‡´çš„ï¼ŒæŒ‰ç…§å›¾ä¸­çš„åˆ†ææˆ‘ä»¬çœ‹ä¸‹è¾“å‡ºç»“æœï¼Œå¦‚ä¸‹ï¼›

```java
æ•°æ®å‡ºæ ˆï¼š
i d c b a e f g h j 
Process finished with exit code 0
```

- `i d c b a e f g h j `ï¼Œæ­£å¥½æ»¡è¶³äº†æˆ‘ä»¬çš„è¯´çš„æ•°æ®å‡ºæ ˆé¡ºåºã€‚*å¯ä»¥å‚è€ƒä¸Šå›¾å†è¿›è¡Œç†è§£*

#### 2.2 æºç åˆ†æ

`ArrayDeque` è¿™ç§åŒç«¯é˜Ÿåˆ—æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥æºç ä¸Šä»åˆå§‹åŒ–åˆ°æ•°æ®å…¥æ ˆæ‰©å®¹ï¼Œéƒ½ä¼šæœ‰æ•°ç»„æ“ä½œçš„ç—•è¿¹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¾æ¬¡åˆ†æä¸‹ã€‚

##### 2.2.1 åˆå§‹åŒ–

`new ArrayDeque<String>(1);`ï¼Œå…¶å®å®ƒçš„æ„é€ å‡½æ•°åˆå§‹åŒ–é»˜è®¤ä¹Ÿæä¾›äº†å‡ ä¸ªæ–¹æ³•ï¼Œæ¯”å¦‚ä½ å¯ä»¥æŒ‡å®šå¤§å°ä»¥åŠæä¾›é»˜è®¤å…ƒç´ ã€‚

```java
private static int calculateSize(int numElements) {
    int initialCapacity = MIN_INITIAL_CAPACITY;
    // Find the best power of two to hold elements.
    // Tests "<=" because arrays aren't kept full.
    if (numElements >= initialCapacity) {
        initialCapacity = numElements;
        initialCapacity |= (initialCapacity >>>  1);
        initialCapacity |= (initialCapacity >>>  2);
        initialCapacity |= (initialCapacity >>>  4);
        initialCapacity |= (initialCapacity >>>  8);
        initialCapacity |= (initialCapacity >>> 16);
        initialCapacity++;
        if (initialCapacity < 0)   // Too many elements, must back off
            initialCapacity >>>= 1;// Good luck allocating 2 ^ 30 element
    }
    return initialCapacity;
}
```

- åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå®ƒéœ€è¦æ‰¾åˆ°ä½ å½“å‰ä¼ è¾“å€¼æœ€å°çš„2çš„å€æ•°çš„ä¸€ä¸ªå®¹é‡ã€‚è¿™ä¸HashMapçš„åˆå§‹åŒ–è¿‡ç¨‹ç›¸ä¼¼ã€‚

##### 2.2.2 æ•°æ®å…¥æ ˆ

`deque.push("a");`ï¼ŒArrayDequeï¼Œæä¾›äº†ä¸€ä¸ª push æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸`deque.offerFirst(â€œaâ€)`ï¼Œä¸€è‡´ï¼Œå› ä¸ºå®ƒä»¬çš„åº•å±‚æºç æ˜¯ä¸€æ ·çš„ï¼Œå¦‚ä¸‹ï¼›

**addFirstï¼š**

```java
public void addFirst(E e) {
    if (e == null)
        throw new NullPointerException();
    elements[head = (head - 1) & (elements.length - 1)] = e;
    if (head == tail)
        doubleCapacity();
}
```

**addLastï¼š**

```java
public void addLast(E e) {
    if (e == null)
        throw new NullPointerException();
    elements[tail] = e;
    if ( (tail = (tail + 1) & (elements.length - 1)) == head)
        doubleCapacity();
}
```

è¿™éƒ¨åˆ†å…¥æ ˆå…ƒç´ ï¼Œå…¶å®å°±æ˜¯ç»™æ•°ç»„èµ‹å€¼ï¼ŒçŸ¥è¯†ç‚¹å¦‚ä¸‹ï¼›
1. åœ¨`addFirst()`ä¸­ï¼Œå®šä½ä¸‹æ ‡ï¼Œ`head = (head - 1) & (elements.length - 1)`ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°ç»„é•¿åº¦æ˜¯`2^n`çš„å€æ•°ï¼Œæ‰€ä»¥ `2^n - 1` å°±æ˜¯ä¸€ä¸ªå…¨æ˜¯1çš„äºŒè¿›åˆ¶æ•°ï¼Œå¯ä»¥ç”¨äºä¸è¿ç®—å¾—å‡ºæ•°ç»„ä¸‹æ ‡ã€‚
2. åŒæ ·`addLast()`ä¸­ï¼Œä¹Ÿä½¿ç”¨äº†ç›¸åŒçš„æ–¹å¼å®šä½ä¸‹æ ‡ï¼Œåªä¸è¿‡å®ƒæ˜¯ä»0å¼€å§‹ï¼Œå¾€ä¸Šå¢åŠ ã€‚
3. æœ€åï¼Œå½“å¤´(head)ä¸å°¾(tile)ï¼Œæ•°ç»„åˆ™éœ€è¦ä¸¤å€æ‰©å®¹`doubleCapacity`ã€‚

ä¸‹æ ‡è®¡ç®—ï¼š`head = (head - 1) & (elements.length - 1)`ï¼š
- (0 - 1) & (8 - 1) = 7
- (7 - 1) & (8 - 1) = 6
- (6 - 1) & (8 - 1) = 5
- ...

##### 2.2.3 ä¸¤å€æ‰©å®¹ï¼Œæ•°æ®è¿ç§»

```java
private void doubleCapacity() {
    assert head == tail;
    int p = head;
    int n = elements.length;
    int r = n - p; // number of elements to the right of p
    int newCapacity = n << 1;
    if (newCapacity < 0)
        throw new IllegalStateException("Sorry, deque too big");
    Object[] a = new Object[newCapacity];
    System.arraycopy(elements, p, a, 0, r);
    System.arraycopy(elements, 0, a, r, p);
    elements = a;
    head = 0;
    tail = n;
}
```

å…¶å®ä»¥ä¸Šè¿™éƒ¨åˆ†æºç ï¼Œå°±æ˜¯è¿›è¡Œä¸¤å€`*n << 1*`æ‰©å®¹ï¼ŒåŒæ—¶æŠŠä¸¤ç«¯æ•°æ®è¿ç§»è¿›æ–°çš„æ•°ç»„ï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹ä¹Ÿä¸æˆ‘ä»¬ä¸Šå›¾å¯¹åº”ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£ï¼Œæˆ‘ä»¬å•ç‹¬æŠŠè¿™éƒ¨åˆ†ä»£ç åšä¸€äº›æµ‹è¯•ã€‚

**æµ‹è¯•ä»£ç ï¼š**

```java
@Test
public void test_arraycopy() {
    int head = 0, tail = 0;
    Object[] elements = new Object[8];
    elements[head = (head - 1) & (elements.length - 1)] = "a";
    elements[head = (head - 1) & (elements.length - 1)] = "b";
    elements[head = (head - 1) & (elements.length - 1)] = "c";
    elements[head = (head - 1) & (elements.length - 1)] = "d";
    
    elements[tail] = "e";
    tail = (tail + 1) & (elements.length - 1);
    elements[tail] = "f";
    tail = (tail + 1) & (elements.length - 1);
    elements[tail] = "g";
    tail = (tail + 1) & (elements.length - 1);
    elements[tail] = "h";
    tail = (tail + 1) & (elements.length - 1);
    
    System.out.println("headï¼š" + head);
    System.out.println("tailï¼š" + tail);
    
    int p = head;
    int n = elements.length;
    int r = n - p; // number of elements to the right of p
    
    // è¾“å‡ºå½“å‰çš„å…ƒç´ 
    System.out.println(JSON.toJSONString(elements));
    
    // head == tail æ‰©å®¹
    Object[] a = new Object[8 << 1];
    System.arraycopy(elements, p, a, 0, r);
    System.out.println(JSON.toJSONString(a));
    System.arraycopy(elements, 0, a, r, p);
    System.out.println(JSON.toJSONString(a));
    
    elements = a;
    head = 0;
    tail = n;
    a[head = (head - 1) & (a.length - 1)] = "i";
    System.out.println(JSON.toJSONString(a));
}
```

ä»¥ä¸Šçš„æµ‹è¯•è¿‡ç¨‹ä¸»è¦æ¨¡æ‹Ÿäº†8ä¸ªé•¿åº¦çš„ç©ºé—´çš„æ•°ç»„ï¼Œåœ¨è¿›è¡ŒåŒç«¯é˜Ÿåˆ—æ“ä½œæ—¶æ•°ç»„æ‰©å®¹ï¼Œæ•°æ®è¿ç§»æ“ä½œï¼Œå¯ä»¥å•ç‹¬è¿è¡Œï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼›

```java
headï¼š4
tailï¼š4
["e","f","g","h","d","c","b","a"]
["d","c","b","a",null,null,null,null,null,null,null,null,null,null,null,null]
["d","c","b","a","e","f","g","h",null,null,null,null,null,null,null,null]
["d","c","b","a","e","f","g","h","j",null,null,null,null,null,null,"i"]

Process finished with exit code 0
```

ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼›
1. å½“headä¸tailç›¸ç­‰æ—¶ï¼Œè¿›è¡Œæ‰©å®¹æ“ä½œã€‚
2. ç¬¬ä¸€æ¬¡æ•°æ®è¿ç§»ï¼Œ`System.arraycopy(elements, p, a, 0, r);`ï¼Œ**dã€cã€bã€a**ï¼Œè½å…¥æ–°æ•°ç»„ã€‚
3. ç¬¬äºŒæ¬¡æ•°æ®è¿ç§»ï¼Œ`System.arraycopy(elements, 0, a, r, p);`ï¼Œ**eã€fã€gã€h**ï¼Œè½å…¥æ–°æ•°ç»„ã€‚
4. æœ€åå†å°è¯•æ·»åŠ æ–°çš„å…ƒç´ ï¼Œiå’Œjã€‚æ¯ä¸€æ¬¡çš„è¾“å‡ºç»“æœéƒ½å¯ä»¥çœ‹åˆ°æ•´ä¸ªåŒç«¯é“¾è·¯çš„å˜åŒ–ã€‚

### 3. åŒç«¯é˜Ÿåˆ—LinkedList

`Linkedlist`å¤©ç”Ÿå°±å¯ä»¥æ”¯æŒåŒç«¯é˜Ÿåˆ—ï¼Œè€Œä¸”ä»å¤´å°¾å–æ•°æ®ä¹Ÿæ˜¯å®ƒæ—¶é—´å¤æ‚åº¦O(1)çš„ã€‚åŒæ—¶æ•°æ®çš„æ’å…¥å’Œåˆ é™¤ä¹Ÿä¸éœ€è¦åƒæ•°ç»„é˜Ÿåˆ—é‚£æ ·æ‹·è´æ•°æ®ï¼Œè™½ç„¶`Linkedlist`æœ‰è¿™äº›ä¼˜ç‚¹ï¼Œä½†ä¸èƒ½è¯´`ArrayDeque`å› ä¸ºæœ‰æ•°ç»„å¤åˆ¶æ€§èƒ½æ¯”å®ƒä½ã€‚

**Linkedlistï¼Œæ•°æ®ç»“æ„**ï¼š

![](https://bugstack.cn/assets/images/2020/interview/interview-10-05.png)

#### 3.1 åŠŸèƒ½ä½¿ç”¨

```java
@Test
public void test_Deque_LinkedList(){
    Deque<String> deque = new LinkedList<>();
    deque.push("a");
    deque.push("b");
    deque.push("c");
    deque.push("d");
    deque.offerLast("e");
    deque.offerLast("f");
    deque.offerLast("g");
    deque.offerLast("h"); 
    deque.push("i");
    deque.offerLast("j");
    
    System.out.println("æ•°æ®å‡ºæ ˆï¼š");
    while (!deque.isEmpty()) {
        System.out.print(deque.pop() + " ");
    }
}
```

**æµ‹è¯•ç»“æœ**ï¼š

```java
æ•°æ®å‡ºæ ˆï¼š
i d c b a e f g h j 

Process finished with exit code 0
```

- æµ‹è¯•ç»“æœä¸Šçœ‹ä¸ä½¿ç”¨`ArrayDeque`æ˜¯ä¸€æ ·çš„ï¼ŒåŠŸèƒ½ä¸Šæ²¡æœ‰å·®å¼‚ã€‚

#### 3.2 æºç åˆ†æ

**å‹æ ˆ**ï¼š`deque.push("a");`ã€`deque.offerFirst("a");`

```java
private void linkFirst(E e) {
    final Node<E> f = first;
    final Node<E> newNode = new Node<>(null, e, f);
    first = newNode;
    if (f == null)
        last = newNode;
    else
        f.prev = newNode;
    size++;
    modCount++;
}
```

**å‹æ ˆ**ï¼š`deque.offerLast("e");`

```java
void linkLast(E e) {
    final Node<E> l = last;
    final Node<E> newNode = new Node<>(l, e, null);
    last = newNode;
    if (l == null)
        first = newNode;
    else
        l.next = newNode;
    size++;
    modCount++;
}
```

- `linkFirst`ã€`linkLast`ï¼Œä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯ç»™é“¾è¡¨çš„é¦–å°¾èŠ‚ç‚¹æ’å…¥å…ƒç´ ï¼Œå› ä¸ºè¿™æ˜¯é“¾è¡¨ç»“æ„ï¼Œæ‰€ä»¥ä¹Ÿä¸å­˜åœ¨æ‰©å®¹ï¼Œåªéœ€è¦æŠŠåŒå‘é“¾è·¯é“¾æ¥ä¸Šå³å¯ã€‚

### 4. å»¶æ—¶é˜Ÿåˆ—DelayQueue

`ä½ æ˜¯å¦æœ‰æ—¶å€™éœ€è¦æŠŠä¸€äº›æ•°æ®å­˜èµ·æ¥ï¼Œå€’è®¡æ—¶åˆ°æŸä¸ªæ—¶åˆ»åœ¨ä½¿ç”¨ï¼Ÿ`

åœ¨Javaçš„é˜Ÿåˆ—æ•°æ®ç»“æ„ä¸­ï¼Œè¿˜æœ‰ä¸€ç§é˜Ÿåˆ—æ˜¯å»¶æ—¶é˜Ÿåˆ—ï¼Œå¯ä»¥é€šè¿‡è®¾å®šå­˜æ”¾æ—¶é—´ï¼Œä¾æ¬¡è½®è¯¢è·å–ã€‚

#### 4.1 åŠŸèƒ½ä½¿ç”¨

**å…ˆå†™ä¸€ä¸ªDelayedçš„å®ç°ç±»**ï¼š

```java
public class TestDelayed implements Delayed {

    private String str;
    private long time;

    public TestDelayed(String str, long time, TimeUnit unit) {
        this.str = str;
        this.time = System.currentTimeMillis() + (time > 0 ? unit.toMillis(time) : 0);
    }

    @Override
    public long getDelay(TimeUnit unit) {
        return time - System.currentTimeMillis();
    }

    @Override
    public int compareTo(Delayed o) {
        TestDelayed work = (TestDelayed) o;
        long diff = this.time - work.time;
        if (diff <= 0) {
            return -1;
        } else {
            return 1;
        }
    }

    public String getStr() {
        return str;
    }
}
```

- è¿™ä¸ªç›¸å½“äºå»¶æ—¶é˜Ÿåˆ—çš„ä¸€ä¸ªå›ºå®šæ¨¡ç‰ˆæ–¹æ³•ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥æ§åˆ¶å»¶æ—¶ã€‚

**æ¡ˆä¾‹æµ‹è¯•**ï¼š

```java
@Test
public void test_DelayQueue() throws InterruptedException {
    DelayQueue<TestDelayed> delayQueue = new DelayQueue<TestDelayed>();
    delayQueue.offer(new TestDelayed("aaa", 5, TimeUnit.SECONDS));
    delayQueue.offer(new TestDelayed("ccc", 1, TimeUnit.SECONDS));
    delayQueue.offer(new TestDelayed("bbb", 3, TimeUnit.SECONDS));
    
    logger.info(((TestDelayed) delayQueue.take()).getStr());
    logger.info(((TestDelayed) delayQueue.take()).getStr());
    logger.info(((TestDelayed) delayQueue.take()).getStr());
}
```

**æµ‹è¯•ç»“æœ**ï¼š

```java
01:44:21.000 [main] INFO  org.itstack.interview.test.ApiTest - ccc
01:44:22.997 [main] INFO  org.itstack.interview.test.ApiTest - bbb
01:44:24.997 [main] INFO  org.itstack.interview.test.ApiTest - aaa

Process finished with exit code 0
```

- åœ¨æ¡ˆä¾‹æµ‹è¯•ä¸­æˆ‘ä»¬åˆ†åˆ«è®¾å®šä¸åŒçš„ä¼‘çœ æ—¶é—´ï¼Œ`1ã€3ã€5`ï¼Œ`TimeUnit.SECONDS`ã€‚
- æµ‹è¯•ç»“æœåˆ†åˆ«åœ¨21ã€22ã€24ï¼Œè¾“å‡ºäº†æˆ‘ä»¬è¦çš„é˜Ÿåˆ—ç»“æœã€‚
- é˜Ÿåˆ—ä¸­çš„å…ƒç´ ä¸ä¼šå› ä¸ºå­˜æ”¾çš„å…ˆåé¡ºåºè€Œå¯¼è‡´è¾“å‡ºé¡ºåºï¼Œå®ƒä»¬æ˜¯ä¾èµ–äºä¼‘çœ æ—¶é•¿å†³å®šã€‚

#### 4.2 æºç åˆ†æ

##### 4.2.1 å…ƒç´ å…¥æ ˆ

**å…¥æ ˆï¼š**ï¼š`delayQueue.offer(new TestDelayed("aaa", 5, TimeUnit.SECONDS));`

```java
public boolean offer(E e) {
    if (e == null)
        throw new NullPointerException();
    modCount++;
    int i = size;
    if (i >= queue.length)
        grow(i + 1);
    size = i + 1;
    if (i == 0)
        queue[0] = e;
    else
        siftUp(i, e);
    return true;
}

private void siftUpUsingComparator(int k, E x) {
    while (k > 0) {
        int parent = (k - 1) >>> 1;
        Object e = queue[parent];
        if (comparator.compare(x, (E) e) >= 0)
            break;
        queue[k] = e;
        k = parent;
    }
    queue[k] = x;
}
```

- å…³äºæ•°æ®å­˜æ”¾è¿˜æœ‰ `ReentrantLock` å¯é‡å…¥é”ğŸ”’ï¼Œä½†æš‚æ—¶ä¸æ˜¯æˆ‘ä»¬æœ¬ç« èŠ‚æ•°æ®ç»“æ„çš„é‡ç‚¹ï¼Œåé¢ç« èŠ‚ä¼šä»‹ç»åˆ°ã€‚
- `DelayQueue` æ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥åŠ¨æ€æ‰©å®¹ï¼Œå¦å¤–å®ƒæ’å…¥å…ƒç´ çš„é¡ºåºå¹¶ä¸å½±å“æœ€ç»ˆçš„è¾“å‡ºé¡ºåºã€‚
- è€Œå…ƒç´ çš„æ’åºä¾èµ–äº`compareTo`æ–¹æ³•è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯ä¼‘çœ çš„æ—¶é—´é•¿çŸ­å†³å®šçš„ã€‚
- åŒæ—¶åªæœ‰å®ç°äº†`Delayed`æ¥å£ï¼Œæ‰èƒ½å­˜æ”¾å…ƒç´ ã€‚

##### 4.2.2 å…ƒç´ å‡ºæ ˆ

**å‡ºæ ˆ**ï¼š`delayQueue.take()`

```java
public E take() throws InterruptedException {
    final ReentrantLock lock = this.lock;
    lock.lockInterruptibly();
    try {
        for (;;) {
            E first = q.peek();
            if (first == null)
                available.await();
            else {
                long delay = first.getDelay(NANOSECONDS
                if (delay <= 0)
                    return q.poll();
                first = null; // don't retain ref while
                if (leader != null)
                    available.await();
                else {
                    Thread thisThread = Thread.currentT
                    leader = thisThread;
                    try {
                        available.awaitNanos(delay);
                    } finally {
                        if (leader == thisThread)
                            leader = null;
                    }
                }
            }
        }
    } finally {
        if (leader == null && q.peek() != null)
            available.signal();
        lock.unlock();
    }
}
```

- è¿™éƒ¨åˆ†çš„ä»£ç æœ‰ç‚¹é•¿ï¼Œä¸»è¦æ˜¯å…ƒç´ çš„è·å–ã€‚`DelayQueue` æ˜¯ `Leader-Followr` æ¨¡å¼çš„å˜ç§ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹å¤„äºç­‰å¾…awaitæ—¶ï¼Œæ€»æ˜¯ç­‰å¾…æœ€å…ˆä¼‘çœ å®Œæˆçš„å…ƒç´ ã€‚
- è¿™é‡Œä¼šæœ€å°åŒ–çš„ç©ºç­‰æ—¶é—´ï¼Œæé«˜çº¿ç¨‹åˆ©ç”¨ç‡ã€‚*æ•°æ®ç»“æ„è®²å®Œåï¼Œåé¢ä¼šæœ‰ä¸“é—¨ç« èŠ‚ä»‹ç»*

### 5. è¿˜æœ‰å“ªäº›é˜Ÿåˆ—ï¼Ÿ

#### 5.1 é˜Ÿåˆ—ç±»ç»“æ„

![](https://bugstack.cn/assets/images/2020/interview/interview-10-06.png)

| ç±»å‹  | å®ç°                  | æè¿°                                   |
| ----- | --------------------- | -------------------------------------- |
| Queue | LinkedBlockingQueue   | ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—           |
| Queue | ArrayBlockingQueue    | ç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—           |
| Queue | PriorityBlockingQueue | æ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—           |
| Queue | SynchronousQueue      | ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—                   |
| Queue | LinkedTransferQueue   | ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—           |
| Deque | LinkedBlockingDeque   | ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—           |
| Deque | ConcurrentLinkedDeque | ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„çº¿ç¨‹å®‰å…¨çš„åŒå‘é˜»å¡é˜Ÿåˆ— |

- é™¤äº†æˆ‘ä»¬å·²ç»è®²è¿‡çš„é˜Ÿåˆ—ä»¥å¤–ï¼Œå‰©ä½™çš„åŸºæœ¬éƒ½æ˜¯é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è¿™äº›ã€‚
- åœ¨æ•°æ®ç»“æ„æ–¹é¢åŸºæœ¬æ²¡æœ‰å·®å¼‚ï¼Œåªä¸è¿‡æ·»åŠ äº†ç›¸åº”çš„é˜»å¡åŠŸèƒ½å’Œé”çš„æœºåˆ¶ã€‚

#### 5.2 ä½¿ç”¨æ¡ˆä¾‹

```java
public class DataQueueStack {

	private BlockingQueue<DataBean> dataQueue = null;
	
	public DataQueueStack(){
		//å®ä¾‹åŒ–é˜Ÿåˆ—
		dataQueue = new LinkedBlockingQueue<DataBean>(100);
	}
	
	/**
	 * æ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—
	 * @param dataBean
	 * @return
	 */
	public boolean doOfferData(DataBean dataBean){
		try {
			return dataQueue.offer(dataBean, 2, TimeUnit.SECONDS);
		} catch (InterruptedException e) {
			e.printStackTrace();
			return false;
		}
	}
	
	/**
	 * å¼¹å‡ºé˜Ÿåˆ—æ•°æ®
	 * @return
	 */
	public DataBean doPollData(){
		try {
			return dataQueue.poll(2, TimeUnit.SECONDS);
		} catch (InterruptedException e) {
			e.printStackTrace();
			return null;
		}
	}
	
	/**
	 * è·å¾—é˜Ÿåˆ—æ•°æ®ä¸ªæ•°
	 * @return
	 */
	public int doGetQueueCount(){
		return dataQueue.size();
	}
	
}
```

- è¿™æ˜¯ä¸€ä¸ª`LinkedBlockingQueue`é˜Ÿåˆ—ä½¿ç”¨æ¡ˆä¾‹ï¼Œä¸€æ–¹é¢å­˜å‚¨æ•°æ®ï¼Œä¸€æ–¹é¢ä»é˜Ÿåˆ—ä¸­è·å–è¿›è¡Œæ¶ˆè´¹ã€‚
- å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥åœ¨è·å–å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šè¿›è¡Œé˜»å¡ã€‚
- `LinkedBlockingQueue`æ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œå†…éƒ¨ç”±ä¸¤ä¸ªReentrantLockæ¥å®ç°å‡ºå…¥é˜Ÿåˆ—çš„çº¿ç¨‹å®‰å…¨ï¼Œç”±å„è‡ªçš„Conditionå¯¹è±¡çš„awaitå’Œsignalæ¥å®ç°ç­‰å¾…å’Œå”¤é†’åŠŸèƒ½ã€‚

## äº”ã€æ€»ç»“

- å…³äºæ ˆå’Œé˜Ÿåˆ—çš„æ•°æ®ç»“æ„æ–¹é¢åˆ°è¿™é‡Œå°±ä»‹ç»å®Œäº†ï¼Œå¦å¤–è¿™é‡Œè¿˜æœ‰ä¸€äº›å…³äºé˜»å¡é˜Ÿåˆ—é”ğŸ”’çš„åº”ç”¨è¿‡ç¨‹ï¼Œåˆ°æˆ‘ä»¬åé¢è®²é”ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå†é‡ç‚¹ä»‹ç»ã€‚
- é˜Ÿåˆ—ç»“æ„çš„è®¾è®¡éå¸¸é€‚åˆæŸäº›éœ€è¦`LIFO`æˆ–è€…`FIFO`çš„åº”ç”¨åœºæ™¯ï¼ŒåŒæ—¶åœ¨é˜Ÿåˆ—çš„æ•°æ®ç»“æ„ä¸­ä¹Ÿæœ‰åŒç«¯ã€å»¶æ—¶å’Œç»„åˆçš„åŠŸèƒ½ç±»ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚
- æ•°æ®ç»“æ„æ–¹é¢çš„çŸ¥è¯†åˆ°æœ¬ç« èŠ‚ç®—æ˜¯å‘Šä¸€æ®µè½ï¼Œå¦‚æœæœ‰ä¼˜ç§€çš„å†…å®¹ï¼Œåé¢è¿˜ä¼šç»§ç»­è¡¥å……ã€‚å†ä¸‹ä¸€ç« èŠ‚å°å‚…å“¥([bugstack.cn](http://bugstack.cn))å‡†å¤‡ç»™å¤§å®¶ä»‹ç»ï¼Œå…³äºæ•°æ®ç»“æ„ä¸­æ¶‰åŠçš„ç®—æ³•éƒ¨åˆ†ï¼Œè¿™äº›ä¸»è¦æ¥è‡ªäº`Collections`ç±»çš„å®ç°éƒ¨åˆ†ã€‚
