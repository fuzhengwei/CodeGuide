---
layout: post
category: interview
title: é¢ç»æ‰‹å†Œ Â· ç¬¬29ç¯‡ã€ŠSpring IOC ç‰¹æ€§æœ‰å“ªäº›ï¼Œä¸ä¼šè¯»ä¸æ‡‚æºç ï¼ã€‹
tagline: by å°å‚…å“¥
tag: [java,interview]
excerpt: IOC(Inversion of Control)ï¼Œæ§åˆ¶åè½¬çš„æ ¸å¿ƒæ€æƒ³åœ¨äºï¼Œèµ„æºçš„ä½¿ç”¨ä¸ç”±ä½¿ç”¨å„è‡ªç®¡ç†ï¼Œè€Œæ˜¯äº¤ç»™ä¸ä½¿ç”¨èµ„æºçš„ç¬¬ä¸‰æ–¹è¿›è¡Œç®¡ç†ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯èµ„æºæ˜¯é›†ä¸­ç®¡ç†çš„ï¼Œå¯é…ç½®ã€æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†åŒæ–¹çš„ä¾èµ–åº¦åšåˆ°äº†ä½è€¦åˆã€‚
lock: need
---

# é¢ç»æ‰‹å†Œ Â· ç¬¬29ç¯‡ã€ŠSpring IOC ç‰¹æ€§æœ‰å“ªäº›ï¼Œä¸ä¼šè¯»ä¸æ‡‚æºç ï¼ã€‹

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`å¤šçº¿ç¨‹ã€é”ã€JVMè°ƒä¼˜ï¼Œéƒ½èƒŒå‡ºèŠ±å•¦ï¼Œæ€ä¹ˆä¸€å†™ä»£ç è¿˜æ˜¯ä¹±ç³Ÿç³Ÿï¼Ÿ`

ä¸ºä»€ä¹ˆè¿™äº›æ— è®ºä»ä¹¦æœ¬ã€è¯¾å ‚ã€é¢è¯•éƒ½æ˜¾å¾—éå¸¸é‡è¦çš„çŸ¥è¯†ï¼Œä½†æ˜¯åœ¨å®é™…çš„ç¼–ç¨‹ä¸­æ²¡æœ‰æå‡ä½ çš„ç¼–ç èƒ½åŠ›å‘¢ï¼Ÿ

é¦–å…ˆè¿™äº›è¿™äº›çŸ¥è¯†åœ¨å®é™…çš„äº’è”ç½‘ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå‡ ä¹æ˜¯ä¸å¸¸ç”¨çš„ï¼Œå‡ ä¹æœ‰é”å’Œå¤šçº¿ç¨‹çš„åœºæ™¯ï¼Œä¸ºäº†æ€§èƒ½çš„æå‡ä¹ŸåŸºæœ¬éƒ½æ˜¯é‡‡ç”¨åˆ†å¸ƒå¼è®¾è®¡å’Œå®ç°äº†ã€‚è€Œè¿™äº›çœ‹ä¸Šå»å¾ˆæœ‰æŠ€æœ¯å«é‡çš„çŸ¥è¯†å¤šæ•°éƒ½è¢«åŒ…è£…åœ¨éä¸šåŠ¡é€»è¾‘åŠŸèƒ½çš„ç»„ä»¶ä¸­ï¼Œè€Œç¨‹åºå‘˜åœ¨åšä¸šåŠ¡å¼€å‘æ—¶å€™å‡ ä¹æ˜¯å…³å¿ƒä¸åˆ°ã€‚æ‰€ä»¥ä¼šäº†è¿™äº›ä¹Ÿå‡ ä¹ä¸å¤ªå¯èƒ½å°±æŠŠä½ çš„ç¼–ç èƒ½æå‡èµ·æ¥ï¼Œå¤šæ•°æå‡çš„æ˜¯ä½ åœ¨æŸ¥å¤æ‚bugæ—¶å€™æœ‰ä¸€è‡‚ä¹‹åŠ›ã€‚

**å°±åƒ**ä¼šæ±‰å­—å°±èƒ½å†™å‡ºè¯—è¯æ­Œèµ‹å—ï¼Ÿæ‡‚RGBå°±èƒ½ç»˜å‡ºå±±æ²³å¤§å·å—ï¼Ÿèƒ½è¹¦è·³å°±å¯ä»¥èˆå‡ºæ‘‡æ›³ç”Ÿå§¿å—ï¼Ÿé‚£éƒ½æ˜¯ä¸å¯èƒ½çš„ï¼Œä¸è¦æƒ³ç€å±è‚¡å›´å™¶å¸ƒå°±è¯´ä¼šæ­¦æœ¯ï¼

å¦‚æœçœŸçš„æƒ³æŠŠä»£ç å†™å¥½ï¼Œå°±è¦ä¸€ç‚¹ç‚¹ä»ç§¯ç´¯æ•°æ®ç»“æ„å’Œç®—æ³•é€»è¾‘(*ä¸åªæ˜¯æœºæ¢°å¼çš„åˆ·å‡ é“é¢˜å°±ç®—äº†ã€‚ä½ ä¸ç†è§£ä¸ºä»€ä¹ˆï¼Œåˆ·å†å¤šä¹Ÿåªæ˜¯å¾’åŠ³*)ï¼Œæ¥ä¸‹æ¥è¦åšçš„æ˜¯å¯¹è®¾è®¡æ¨¡å¼å’Œæ¶æ„è®¾è®¡çš„ç†è§£ï¼Œæœ€ç»ˆæ˜¯ä¸æ–­çš„è¿ç”¨å’Œæ€»ç»“ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä½ ä¼šæ¥è§¦åˆ°ä¸šåŠ¡ã€äº§å“ã€è¿è¥ï¼Œç¼–ç åªæ˜¯æœ€åçš„å…·ä½“å®ç°ï¼Œå¹¶ä¸æ˜¯å…¨æµç¨‹ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œä¸ç¼–ç ç›¸æ¯”æ›´é‡è¦çš„æ˜¯é€»è¾‘è®¾è®¡ã€‚

## äºŒã€é¢è¯•é¢˜

`è°¢é£æœºï¼Œå°è®°ï¼`ï¼Œè¿™æ¬¡æ”¾å‡ä¸€éæ’¸ä¸²ä¸€éè¢«Springï¼Œå˜¿å˜¿ï¼Œæ£€éªŒæˆæœé¢è¯•å»ï¼

**é¢è¯•å®˜**ï¼šé£æœºï¼Œä»Šå¤©å‡†å¤‡å’‹æ ·ï¼Œä¸Šæ¬¡é—®ä½ çš„éƒ½å­¦ä¼šäº†å—ï¼Ÿ

**è°¢é£æœº**ï¼š@Resource æ˜¯ JDK `javax.annotation.Resource` æä¾›çš„æ³¨è§£ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œå¦å¤–ä¹Ÿå­¦ä¹ äº†Beançš„æ³¨å…¥ã€‚

**é¢è¯•å®˜**ï¼šæŒºå¥½è®°ä½äº†ä¸€äº›ï¼Œé‚£ä½ åœ¨åš Bean æ³¨å…¥å­¦ä¹ çš„æ—¶å€™ï¼Œæœ‰æ³¨æ„åˆ° Spring IOC çš„ç‰¹æ€§å—ï¼Œä½ éƒ½ç”¨åˆ°äº†ä»€ä¹ˆï¼Ÿ

**è°¢é£æœº**ï¼šå—¯ï¼Œç”¨åˆ° Bean çš„é…ç½®ã€BeanDefinitionRegistryPostProcessor å¯¹ Bean çš„å®šä¹‰ã€è¿˜æœ‰ FactoryBean

**é¢è¯•å®˜**ï¼šå¥½ï¼Œé‚£ä»Šå¤©å†å’Œä½ èŠèŠï¼Œaliasã€autowireã€depends-onã€factory-methodã€lookup-methodç­‰ï¼Œå®è·µéªŒè¯ä¸‹çœ‹çœ‹å®ƒä»¬æ˜¯æ€ä¹ˆåº”ç”¨çš„ã€‚

## ä¸‰ã€SpringIOC ç‰¹æ€§

IOC(Inversion of Control)ï¼Œæ§åˆ¶åè½¬çš„æ ¸å¿ƒæ€æƒ³åœ¨äºï¼Œèµ„æºçš„ä½¿ç”¨ä¸ç”±ä½¿ç”¨å„è‡ªç®¡ç†ï¼Œè€Œæ˜¯äº¤ç»™ä¸ä½¿ç”¨èµ„æºçš„ç¬¬ä¸‰æ–¹è¿›è¡Œç®¡ç†ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯èµ„æºæ˜¯é›†ä¸­ç®¡ç†çš„ï¼Œå¯é…ç½®ã€æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿé™ä½äº†åŒæ–¹çš„ä¾èµ–åº¦åšåˆ°äº†ä½è€¦åˆã€‚

>æ—©åœ¨1988å¹´ï¼ŒRalph E. Johnson & Brian Footeåœ¨è®ºæ–‡ã€ŠDesigning Reusable Classesã€‹
>
>One important characteristic of a framework is that the methods defined by the user to tailor the framework will often be called from within the framework itself, rather than from the user's application code.
>The framework often plays the role of the main program in coordinating and sequencing application activity.
>This inversion of control gives frameworks the power to serve as extensible skeletons. The methods supplied by the user tailor the generic algorithms defined in the framework for a particular application.

æ¥ä¸‹æ¥å°±ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ IOC çš„ä¸€äº›æ ¸å¿ƒç‰¹æ€§ï¼Œå› ä¸ºè¿™äº›å†…å®¹ä¸ä»…æ˜¯é¢è¯•è€ƒç‚¹ï¼Œä¹Ÿæ˜¯åœ¨å¼€å‘ä¸­é—´ä»¶æˆ–è€…å°ç»„ä»¶æ—¶éœ€è¦ç”¨åˆ°çš„åŠŸèƒ½ç±»ï¼Œæ¦‚æ‹¬å¦‚ä¸‹ï¼š

![](https://bugstack.cn/assets/images/2020/interview/interview-29-1.png)

### 1. xml é…ç½®

#### 1.1 alias

**æµ‹è¯•ç±»**

```java
public class UserService {

    private UserDao userDao;

    public UserService() {
        System.out.println("æˆ‘è¢«åˆå§‹åŒ–äº†ï¼ŒUserService");
    }

    // ...get/set

}
```

**xmlé…ç½®**

```xml
<bean id="userService" class="org.itstack.interview.UserService"/>
<!-- èµ·ä¸ªåˆ«å -->
<alias name="userService" alias="userService-alias01"/>
<!-- åˆ«åçš„åˆ«å -->
<alias name="userService-alias01" alias="userService-alias02"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_alias() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-alias.xml");
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean("userService"));
    logger.info("è·å– Bean é€šè¿‡åˆ«åï¼š{}", beanFactory.getBean("userService-alias01"));
    logger.info("è·å– Bean é€šè¿‡åˆ«åçš„åˆ«åï¼š{}", beanFactory.getBean("userService-alias02"));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:01:29.872 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserService@2a40cd94
23:01:29.872 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean 'userService'
23:01:29.872 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Bean é€šè¿‡åˆ«åï¼šorg.itstack.interview.UserService@2a40cd94
23:01:29.872 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean 'userService'
23:01:29.872 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Bean é€šè¿‡åˆ«åçš„åˆ«åï¼šorg.itstack.interview.UserService@2a40cd94
```

---

- **ç›®çš„**ï¼šç”¨äºç»™ Bean èµ·åˆ«å
- **ä½¿ç”¨**ï¼šåœ¨ xml é…ç½®é‡Œæˆ‘ä»¬å¯ä»¥ç»™ä¸€ä¸ª Bean èµ·ä¸ªåˆ«åï¼Œè¿˜å¯ä»¥ç»™åˆ«åèµ·ä¸€ä¸ªæ–°çš„åˆ«åã€‚

#### 1.2 autowire

**æµ‹è¯•ç±»**

```java
public class UserDao {
    public UserDao() {
        System.out.println("æˆ‘è¢«åˆå§‹åŒ–äº†ï¼ŒUserDao");
    }
}
```

**xmlé…ç½®**

```xml
<bean id="userDao" class="org.itstack.interview.UserDao"/>

<!-- æ‰‹åŠ¨é…ç½®ä¾èµ– -->
<bean id="userService-by-property" class="org.itstack.interview.UserService">
    <property name="userDao" ref="userDao"/>
</bean>

<!-- è‡ªåŠ¨é…ç½®ä¾èµ– -->
<bean id="userService-by-autowire" class="org.itstack.interview.UserService" autowire="byName"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_autowire() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-autowire.xml");
    logger.info("è·å– Bean by æ‰‹åŠ¨é…ç½®ä¾èµ–ï¼š{}", beanFactory.getBean("userService-by-property"));
    logger.info("è·å– Bean by è‡ªåŠ¨é…ç½®ä¾èµ–ï¼š{}", beanFactory.getBean("userService-by-autowire"));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:05:55.501 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Bean by æ‰‹åŠ¨é…ç½®ä¾èµ–ï¼šorg.itstack.interview.UserService@679b62af
23:05:55.501 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean 'userService-by-autowire'
23:05:55.501 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Bean by è‡ªåŠ¨é…ç½®ä¾èµ–ï¼šorg.itstack.interview.UserService@5cdd8682
```

---

- **ç›®çš„**ï¼šautowire ç”¨äºæŠŠç±»ä¸­çš„å±æ€§æ³¨å…¥äº¤ç»™ Spring ç®¡ç†
- **ä½¿ç”¨**ï¼šåœ¨ xml é…ç½®ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼åˆ†åˆ«æ˜¯ï¼šæ‰‹åŠ¨é…ç½®ä¾èµ–ã€è‡ªåŠ¨é…ç½®ä¾èµ–ï¼Œæ‰‹åŠ¨çš„å¤§å®¶åŸºæœ¬å¾ˆå¸¸ç”¨ï¼Œè‡ªåŠ¨çš„é…ç½®ä¸€èˆ¬å¯èƒ½æ›´å¤šçš„å¯¹äºæ³¨è§£çš„ä½¿ç”¨ã€‚å…¶å®è¿™é‡Œçš„ autowire å’Œæ³¨è§£æœ‰ä¸€æ ·çš„ä½œç”¨ï¼Œautowire å‡ ä¸ªå¯é€‰é¡¹ï¼ŒbyNameã€byTypeã€constructor ç­‰ã€‚

#### 1.3 factory-method

**æµ‹è¯•ç±»**

```java
public class StaticFactoryBean {

    static public UserDao getUserDaoByStatic(){
        return new UserDao();
    }

}
```

**xmlé…ç½®**

```xml
<bean id="staticFactory-method" class="org.itstack.interview.StaticFactoryBean" factory-method="getUserDaoByStatic"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_factory_method() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-factory-method.xml");
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean("staticFactory-method"));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:15:28.950 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserDao@588df31b
23:15:28.950 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Returning cached instance of singleton bean 'staticFactory-bean'
```

---

- **ç›®çš„**ï¼šæ ‡è¯†é™æ€å·¥å‚çš„å·¥å‚æ–¹æ³•(å·¥å‚æ–¹æ³•æ˜¯é™æ€çš„)
- **ä½¿ç”¨**ï¼šæ ¸å¿ƒåœ¨äº xml é…ç½®ä¸­æ·»åŠ  `factory-method="getUserDaoByStatic"`ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨åˆå§‹åŒ–æ—¶å€™è°ƒç”¨å¯¹åº”é™æ€æ–¹æ³•çš„å®ä¾‹åŒ–å†…å®¹ã€‚

#### 1.4 factory-bean

**æµ‹è¯•ç±»**

```java
public class StaticFactoryBean {
    public UserDao getUserDao(){
        return new UserDao();
    }
}
```

**xmlé…ç½®**

```xml
<bean id="staticFactory" class="org.itstack.interview.StaticFactoryBean"/>
<bean id="staticFactory-bean" factory-bean="staticFactory" factory-method="getUserDao"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_factory_bean_method() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-factory-method.xml");
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean("staticFactory-bean"));
}
```

**æµ‹è¯•ç»“æœ**

```java
23:15:28.950 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserDao@33b37288
```

---

- **ç›®çš„**ï¼šfactory-beanï¼Œå®ä¾‹åŒ–å·¥å‚ç±»
- **ä½¿ç”¨**ï¼šfactory-beanã€factory-method éœ€è¦é…åˆä½¿ç”¨ï¼Œ`factory-method="getUserDao"` è°ƒç”¨çš„æ˜¯å¯¹åº”çš„è´¹é™æ€æ–¹æ³•è¿”å›å®ä¾‹åŒ–ç»“æœã€‚

#### 1.5 depends-on

**xmlé…ç½®**

```xml
<bean id="userService" class="org.itstack.interview.UserService" depends-on="userDao"/>
<bean id="userDao" class="org.itstack.interview.UserDao"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_depends_on() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-depends-on.xml");
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean(UserService.class, "userService").getUserDao());
}
```

**æµ‹è¯•ç»“æœ**

```java
æˆ‘è¢«åˆå§‹åŒ–äº†ï¼ŒUserDao
æˆ‘è¢«åˆå§‹åŒ–äº†ï¼ŒUserService
23:24:14.678 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserDao@45afc369
```

---

- **ç›®çš„**ï¼šå¤„ç†ä¾èµ–åˆå§‹åŒ–é¡ºåºé—®é¢˜
- **ä½¿ç”¨**ï¼šå¦‚æœä¸ä½¿ç”¨ `depends-on="userDao"`ï¼Œé‚£ä¹ˆæŒ‰ç…§ Spring çš„é…ç½®æœ€å…ˆåˆå§‹åŒ–çš„æ˜¯ `UserService`ï¼Œå½“ä½ æœ‰éœ€è¦å¤„ç†åˆå§‹åŒ–ä¾èµ–æ—¶åˆ™éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªé…ç½®ã€‚

#### 1.6 lookup-method & ApplicationContextAware

**æµ‹è¯•ç±»**

```java
public class UserDaoProvider implements ApplicationContextAware {

    private ApplicationContext applicationContext;

    public UserDao getUserDao() {
        return applicationContext.getBean("userDao", UserDao.class);
    }

    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }

}
```

**xmlé…ç½®**

```xml
<bean id="userDao" class="org.itstack.interview.UserDao" scope="prototype"/>
<bean id="provider" class="org.itstack.interview.UserDaoProvider"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_lookup_method() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-lookup-method.xml");
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean(UserDaoProvider.class, "provider").getUserDao());
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean(UserDaoProvider.class, "provider").getUserDao());
}
```

**æµ‹è¯•ç»“æœ**

```java
æˆ‘è¢«åˆå§‹åŒ–äº†ï¼ŒUserDao
16:29:25.813 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Finished creating instance of bean 'userDao'
16:29:25.813 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserDao@1188e820
16:29:25.813 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Creating instance of bean 'userDao'
æˆ‘è¢«åˆå§‹åŒ–äº†ï¼ŒUserDao
16:29:25.814 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Finished creating instance of bean 'userDao'
16:29:25.814 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserDao@2f490758
```

---

- **ç›®çš„**ï¼šè·å–å•ä¾‹ä¸‹çš„åŸå‹æ¨¡å¼ï¼Œæ¯æ¬¡è·å–éƒ½è¦æœ‰æ–°çš„å¯¹è±¡äº§ç”Ÿã€‚
- **ä½¿ç”¨**ï¼šå…¶å®æ ¸å¿ƒåœ¨äº ApplicationContextAware çš„ä½¿ç”¨å’Œ `scope="prototype"` é…ç½®ï¼ŒSpring å†…éƒ¨å®ç°ä¸ºä½¿ç”¨ Cglib æ–¹æ³•ï¼Œé‡æ–°ç”Ÿæˆå­ç±»ï¼Œé‡å†™é…ç½®çš„æ–¹æ³•å’Œè¿”å›å¯¹è±¡ï¼Œè¾¾åˆ°åŠ¨æ€æ”¹å˜çš„æ•ˆæœã€‚

### 2. æ¥å£ç±»

#### 2.1 FactoryBean

**æµ‹è¯•ç±»**

```java
public class MyFactoryBean implements FactoryBean<UserDao> {

    @Override
    public UserDao getObject() throws Exception {
        return new UserDao();
    }

    @Override
    public Class<?> getObjectType() {
        return UserDao.class;
    }

    @Override
    public boolean isSingleton() {
        return true;
    }
    
}
```

**xmlé…ç½®**

```xml
<bean id="userDao" class="org.itstack.interview.MyFactoryBean"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_factory_bean() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-factory-bean.xml");
    logger.info("è·å– Beanï¼š{}", beanFactory.getBean("userDao"));
}
```

**æµ‹è¯•ç»“æœ**

```java  
23:36:19.339 [main] INFO  org.itstack.interview.test.ApiTest - è·å– Beanï¼šorg.itstack.interview.UserDao@3bd94634
```

---

- **ç›®çš„**ï¼šç”¨äºç”Ÿæˆ Bean çš„ Beanï¼Œå« FactoryBean
- **ä½¿ç”¨**ï¼šå…¶å®è¿™ä¸ªä½¿ç”¨åœ¨ä¸Šä¸€ç« èŠ‚å…³äº [Bean å¦‚ä½•æ³¨å…¥åˆ° Spring](https://bugstack.cn/interview/2021/03/30/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC28%E7%AF%87-%E4%BD%A0%E8%AF%B4-%E6%80%8E%E4%B9%88%E6%8A%8ABean%E5%A1%9E%E5%88%B0Spring%E5%AE%B9%E5%99%A8.html) å·²ç»æåˆ°è¿‡ï¼Œåœ¨ä¸€äº›ORMæ¡†æ¶ã€RPC-Starterç­‰éƒ½æœ‰æ‰€åº”ç”¨ã€‚

#### 2.2 BeanPostProcessor

**æµ‹è¯•ç±»**

```java
public class MyBeanPostProcessor implements BeanPostProcessor {

    @Override
    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("åˆå§‹åŒ–å‰ï¼š" + beanName);
        return bean;
    }

    @Override
    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        System.out.println("åˆå§‹åŒ–åï¼š" + beanName);
        return bean;
    }
    
}
```

**xmlé…ç½®**

```xml
<bean id="beanPostProcessor" class="org.itstack.interview.MyBeanPostProcessor"/>
<bean id="userDao" class="org.itstack.interview.UserDao"/>
```

**å•å…ƒæµ‹è¯•**

```java
@Test
public void test_bean_post_processor() {
    BeanFactory beanFactory = new ClassPathXmlApplicationContext("spring-config-bean-post-processor.xml");
}
```

**æµ‹è¯•ç»“æœ**

```java  
åˆå§‹åŒ–å‰ï¼šuserDao
åˆå§‹åŒ–åï¼šuserDao
16:38:32.686 [main] DEBUG o.s.b.f.s.DefaultListableBeanFactory - Finished creating instance of bean 'userDao'
```

---

- **ç›®çš„**ï¼šæ‹¿åˆ° Bean å¯¹è±¡åˆå§‹åŒ–å‰åçš„åŠ¨ä½œï¼Œåšç›¸åº”çš„å¤„ç†
- **ä½¿ç”¨**ï¼šBeanPostProcessor æ˜¯ Spring æ¡†æ¶çš„æ‰©å±•æ¥å£ç±»ï¼Œé€šè¿‡å¯¹è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œå°±å¯ä»¥åœ¨ Bean å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­åšç›¸å…³çš„åŠ¨ä½œï¼Œæ¯”å¦‚æ‹¦æˆªä»¥åå‘å¸ƒåˆ°æ³¨å†Œä¸­å¿ƒç­‰ã€‚AOP çš„æ“ä½œä¹Ÿæ˜¯é€šè¿‡ BeanPostProcessor å’Œ IOC å®¹å™¨å»ºç«‹èµ·è”ç³»ã€‚

#### 2.3 BeanFactoryAware

**æµ‹è¯•ç±»**

```java
public class MyBeanFactoryAware implements BeanFactoryAware {
    @Override
    public void setBeanFactory(BeanFactory beanFactory) throws BeansException {
        
    }
}
```

---

- **ç›®çš„**ï¼šç”¨äºè·å–è¿è¡Œæ—¶ Bean çš„é…ç½®ä¿¡æ¯
- **ä½¿ç”¨**ï¼šBeanFactoryAware çš„å®ç°ç±»å¯ä»¥æ‹¿åˆ° beanFactoryï¼Œä¹Ÿå°±è·å–åˆ°äº†beançš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ­¤æ—¶ä½ æƒ³è·å–ä¸€äº›å¯¹è±¡çš„å±æ€§å°±éå¸¸å®¹æ˜“äº†ã€‚

## å››ã€æ€»ç»“

- ä»¥ä¸Šæˆ‘ä»¬ä»‹ç»äº† Spring IOC çš„å¸¸ç”¨é…ç½®ç‰¹æ€§å’Œæ¥å£ï¼Œè™½ç„¶ç°åœ¨å¤§å®¶å¯èƒ½å·²ç»å¾ˆå°‘ä¼šä½¿ç”¨ xml é…ç½®å¯¹è±¡ï¼ŒåŸºæœ¬éƒ½æ˜¯æ³¨è§£çš„æ–¹å¼ã€‚ä½†åœ¨è¿™äº›æ³¨è§£çš„èƒŒåä¾ç„¶ä¼šæœ‰ç›¸åº”çš„é€šç”¨æ ¸å¿ƒåŸç†å®ç°ï¼Œåªæœ‰æŠŠè¿™éƒ¨åˆ†çŸ¥è¯†æ€»ç»“æ¸…æ¥šå¹¶å­¦ä¹ æºç ï¼Œæ‰èƒ½æ›´å¥½çš„ç†è§£æ³¨è§£çš„ä½¿ç”¨æ˜¯å¦‚ä½•å¤„ç†è¿™äº›é…ç½®çš„ã€‚
- å…³äºæ¥å£çš„ç±»ä½¿ç”¨ï¼ŒFactoryBeanã€BeanPostProcessorã€BeanFactoryAwareã€ApplicationContextAwareï¼Œåœ¨æ—¥å¸¸çš„ä¸šåŠ¡æµç¨‹å¼€å‘ä¸­å‡ ä¹æ¥è§¦ä¸åˆ°ï¼Œä½†å¦‚æœè¦åšä¸€äº›æ ¸å¿ƒçš„ç»„ä»¶è®¾è®¡æˆ–è€…æ˜¯ä¸­é—´ä»¶çš„å¼€å‘ï¼Œå°±ä¼šä½¿ç”¨çš„éå¸¸é¢‘ç¹ã€‚å¦‚æœå¯¹è¿™éƒ¨åˆ†çŸ¥è¯†çš„è¿ç”¨ä¸äº†è§£ï¼Œå¯ä»¥å‚è€ƒï¼š[ã€ŠSpringBoot ä¸­é—´ä»¶è®¾è®¡å’Œå¼€å‘ã€‹](https://bugstack.cn/itstack-ark-middleware/2021/03/31/SpringBoot-%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%BC%80%E5%8F%91-%E4%B8%93%E6%A0%8F%E5%B0%8F%E5%86%8C%E4%B8%8A%E7%BA%BF%E5%95%A6.html)
- åç»­ä¼šå›´ç»•è¿™äº›çŸ¥è¯†ç‚¹æ¥ç»™å¤§å®¶ä»‹ç»ä¸€äº›æºç çš„å­¦ä¹ ä»¥åŠåº”ç”¨å±‚çš„å¤„ç†ï¼ŒBeançš„åˆ›å»ºã€å¾ªç¯ä¾èµ–çš„ä¸‰çº§ç¼“å­˜è§£å†³æ–¹æ¡ˆç­‰ã€‚ä¹Ÿå¸Œæœ›å¤§å®¶åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­è¦å¤šæ€»ç»“ã€æ€è€ƒã€è®°å½•ï¼Œä¸€ç‚¹ç‚¹çš„æŠŠçŸ¥è¯†æ ˆå»ºè®¾å®Œæ•´ã€‚

## äº”ã€ç³»åˆ—æ¨è

- [å°ä¼™ä¼´ç¾å›¢ä¸€é¢çš„åˆ†äº«å’Œåˆ†æ](https://bugstack.cn/interview/2021/03/07/%E9%9D%A2%E8%AF%95%E7%8E%B0%E5%9C%BA-%E5%B0%8F%E4%BC%99%E4%BC%B4%E7%BE%8E%E5%9B%A2%E4%B8%80%E9%9D%A2%E7%9A%84%E5%88%86%E4%BA%AB%E5%92%8C%E5%88%86%E6%9E%90-%E5%90%AB%E8%A7%A3%E7%AD%94.html)
- [ä½ è¯´ï¼Œæ€ä¹ˆæŠŠBeanå¡åˆ°Springå®¹å™¨ï¼Ÿ](https://bugstack.cn/interview/2021/03/30/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC28%E7%AF%87-%E4%BD%A0%E8%AF%B4-%E6%80%8E%E4%B9%88%E6%8A%8ABean%E5%A1%9E%E5%88%B0Spring%E5%AE%B9%E5%99%A8.html)
- [é™¤äº†JDKã€CGLIBï¼Œè¿˜æœ‰3ç§ç±»ä»£ç†æ–¹å¼ï¼Ÿé¢è¯•åˆå¡ä½ï¼](https://bugstack.cn/interview/2020/10/14/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC13%E7%AF%87-%E9%99%A4%E4%BA%86JDK-CGLIB-%E8%BF%98%E6%9C%893%E7%A7%8D%E7%B1%BB%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F-%E9%9D%A2%E8%AF%95%E5%8F%88%E5%8D%A1%E4%BD%8F.html)
- [åŠå¹´æ‹›è˜ç­›é€‰äº†400+ä»½ç®€å†ï¼Œå‘Šè¯‰ä½ æ€ä¹ˆå†™å®¹æ˜“è¢«æ’©ï¼](https://bugstack.cn/itstack-code-life/2021/02/24/%E5%8D%8A%E5%B9%B4%E7%AD%9B%E9%80%89%E4%BA%86400+%E4%BB%BD%E7%AE%80%E5%8E%86-%E5%91%8A%E8%AF%89%E4%BD%A0%E6%80%8E%E4%B9%88%E5%86%99%E4%BC%9A%E8%A2%AB%E6%92%A9.html)
- [SpringBoot ä¸­é—´ä»¶è®¾è®¡å’Œå¼€å‘](https://bugstack.cn/itstack-ark-middleware/2021/03/31/SpringBoot-%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%BC%80%E5%8F%91-%E4%B8%93%E6%A0%8F%E5%B0%8F%E5%86%8C%E4%B8%8A%E7%BA%BF%E5%95%A6.html)
