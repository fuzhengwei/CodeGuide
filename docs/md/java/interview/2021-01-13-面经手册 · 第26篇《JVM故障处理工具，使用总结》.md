---
layout: post
category: interview
title: é¢ç»æ‰‹å†Œ Â· ç¬¬26ç¯‡ã€ŠJVMæ•…éšœå¤„ç†å·¥å…·ï¼Œä½¿ç”¨æ€»ç»“ã€‹
tagline: by å°å‚…å“¥
tag: [java,interview]
excerpt: ç”¨éƒ½ç”¨ä¸åˆ°æ€ä¹ˆå­¦ï¼Ÿæ²¡æœ‰åœºæ™¯ã€æ²¡æœ‰è¯‰æ±‚ï¼Œæ€ä¹ˆå­¦ä¹ è¿™äº›ä¼¼ä¹ç”¨ä¸ä¸ŠçŸ¥è¯†ç‚¹ã€‚å…¶å®æœ€å¥½çš„æ–¹å¼å°±æ˜¯å½’çº³ã€æ•´ç†ã€å®è·µã€è¾“å‡ºï¼Œä¸€å¥—ç»„åˆæ‹³ä¸‹æ¥ï¼Œä½ å°±æŒæ¡äº†è¿™ä¸ªç³»åˆ—çš„çŸ¥è¯†äº†ã€‚
lock: need
---

# é¢ç»æ‰‹å†Œ Â· ç¬¬26ç¯‡ã€ŠJVMæ•…éšœå¤„ç†å·¥å…·ï¼Œä½¿ç”¨æ€»ç»“ã€‹

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`ç”¨éƒ½ç”¨ä¸åˆ°æ€ä¹ˆå­¦ï¼Ÿ`

æ²¡æœ‰åœºæ™¯ã€æ²¡æœ‰è¯‰æ±‚ï¼Œæ€ä¹ˆå­¦ä¹ è¿™äº›ä¼¼ä¹ç”¨ä¸ä¸ŠçŸ¥è¯†ç‚¹ã€‚

å…¶å®æœ€å¥½çš„æ–¹å¼å°±æ˜¯å½’çº³ã€æ•´ç†ã€å®è·µã€è¾“å‡ºï¼Œä¸€å¥—ç»„åˆæ‹³ä¸‹æ¥ï¼Œä½ å°±æŒæ¡äº†è¿™ä¸ªç³»åˆ—çš„çŸ¥è¯†äº†ã€‚

ä½†åœ¨å½“å‰é˜¶æ®µå¯èƒ½çœŸçš„ç”¨ä¸ä¸Šï¼ŒJVMæ˜¯ä¸€ä¸ªç¨³å®šæœåŠ¡ï¼Œå“ªèƒ½å¤©å¤©å‡ºé—®é¢˜ï¼Œå“ªéœ€è¦ä½ è€æ’æŸ¥ã€‚`åˆä¸æ˜¯åƒä½ å†™çš„ä»£ç é‚£æ ·ï¼`ï¼Œå¯æ˜¯çŸ¥è¯†çš„å­¦ä¹ å°±æ˜¯æŠŠä½ å«åŸºåˆ°æ›´é«˜å±‚æ¬¡åï¼Œæ‰æœ‰æœºä¼šæ¥è§¦æ›´æœ‰æ„æ€çš„å·¥ä½œå’ŒæŠ€æœ¯åˆ›æ–°ã€‚å¦‚æœåªæ˜¯å•çº¯çš„å­¦å‡ ä¸ªæŒ‡ä»¤ï¼Œå…¶å®å¹¶æ²¡æœ‰å¤šæœ‰æ„æ€ã€‚ä½†è®©ä½ å®Œæˆä¸€å¥—å…¨é“¾è·¯ç›‘æ§ï¼Œé‡Œé¢éœ€è¦å«æœ‰ä¸€æ¬¡æ–¹æ³•è°ƒç”¨çš„æ•´ä½“è€—æ—¶ã€æ‰§è¡Œè·¯å¾„ã€å‚æ•°ä¿¡æ¯ã€å¼‚å¸¸ç»“æœã€GCæ¬¡æ•°ã€å †æ ˆæ•°æ®ã€åˆ†ä»£å†…å®¹ç­‰ç­‰çš„æ—¶å€™ï¼Œé‚£ä¹ˆä½ çš„çŸ¥è¯†å‚¨å¤‡å¤Ÿå¼€å‘ä¸€ä¸ªè¿™æ ·çš„ç³»ç»Ÿå—ï¼Ÿ

å¥½ï¼Œå…ˆä¸Šå›¾çœ‹çœ‹æœ¬æ–‡è¦è®²å•¥ï¼Œå†è·Ÿç€å°å‚…å“¥çš„æ­¥ä¼å¾€ä¸‹èµ°ã€‚

![JVM æ•…éšœå¤„ç†å·¥å…·](https://bugstack.cn/assets/images/2020/interview/interview-26-0.png)

## äºŒã€é¢è¯•é¢˜

`è°¢é£æœºï¼Œå°è®°ï¼`ï¼Œå‘¨æœ«ä¼‘æ¯åœ¨å®¶æ— èŠï¼ŒæŠŠå·²ç»ä¸Šç°äº†çš„JVMè™šæ‹Ÿæœºå­¦ä¹ ç¿»å‡ºæ¥ã€‚

**è°¢é£æœº**ï¼šå‘±...å‘±...ï¼Œå–‚å¤§å“¥ï¼Œè¿™ä¸ªï¼Œè¿™ä¸ªJVMè™šæ‹Ÿæœºçœ‹å•¥å‘€ã€‚

**é¢è¯•å®˜**ï¼šçœ‹å•¥ï¼Ÿä¸çŸ¥é“ä»å“ªå¼€å§‹ï¼Ÿå—¯ï¼Œé‚£ä½ ä»é—®é¢˜ç‚¹ä¸‹æ‰‹ï¼

**è°¢é£æœº**ï¼šå•¥é—®é¢˜ç‚¹å‘¢ï¼Œæˆ‘å°±æ˜¯ä¸çŸ¥é“è‡ªå·±ä¸ä¼šå•¥ï¼Œä¹Ÿä¸çŸ¥é“é—®ä½ å•¥ã€‚

**é¢è¯•å®˜**ï¼šå•Šï¼é‚£æˆ‘é—®ä½ ä¸ªï¼Œæ€ä¹ˆé€šè¿‡JVMæ•…éšœå¤„ç†å·¥å…·ï¼ŒæŸ¥çœ‹JVMå¯åŠ¨æ—¶å‚æ•°éƒ½é…ç½®äº†ä»€ä¹ˆå‘¢ï¼Ÿ

**è°¢é£æœº**ï¼šè¿™ä¸ªï¼ï¼Ÿä¸é“å‘€ï¼

**é¢è¯•å®˜**ï¼šé‚£ä½ ç†Ÿæ‚‰çš„ç›‘æ§æŒ‡ä»¤éƒ½æœ‰å•¥ï¼Œå¦‚æœé—®ä½ å †å†…å­˜ç»Ÿè®¡å¦‚ä½•ç»Ÿè®¡ï¼Œä½ å¯çŸ¥æ™“ï¼ï¼Ÿ

**è°¢é£æœº**ï¼šä¹Ÿä¸çŸ¥é“ï¼Œå“ˆå“ˆå“ˆï¼Œå¥½åƒçŸ¥é“è¦å»çœ‹å•¥äº†ï¼

**é¢è¯•å®˜**ï¼šå»å§ï¼Œå¸¦ç€é—®é¢˜çœ‹ï¼Œçœ‹å®Œæ•´ç†å‡ºæ¥ï¼

## ä¸‰ã€åŸºç¡€æ•…éšœå¤„ç†å·¥å…·

### 1. jps è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µ

jpsï¼ˆJVM Process Status Toolï¼‰ï¼Œå®ƒçš„åŠŸèƒ½ä¸pså‘½ä»¤ç±»ä¼¼ï¼Œå¯ä»¥åˆ—å‡ºæ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œå¹¶æ˜¾ç¤ºè™šæ‹Ÿæœºæ‰§è¡Œä¸»ç±»ï¼ˆMain Classï¼Œmain()å‡½æ•°æ‰€åœ¨çš„ç±»ï¼‰åç§°ä»¥åŠè¿™äº›è¿›ç¨‹çš„æœ¬åœ°è™šæ‹Ÿæœºå”¯ä¸€IDï¼ˆLocal Virtual Machine Identifier,LVMIDï¼‰ï¼Œç±»ä¼¼äº ps -ef | grep java çš„åŠŸèƒ½ã€‚

è¿™å°å®¶ä¼™è™½ç„¶ä¸å¤§ï¼ŒåŠŸèƒ½åˆå•ä¸€ã€‚ä½†å¯ä»¥è¯´åŸºæœ¬ä½ ç”¨å…¶ä»–å‘½ä»¤éƒ½å¾—å…ˆç”¨å®ƒï¼Œæ¥æŸ¥è¯¢åˆ°LVMIDæ¥ç¡®å®šè¦ç›‘æ§çš„æ˜¯å“ªä¸ªè™šæ‹Ÿæœºè¿›ç¨‹ã€‚

**å‘½ä»¤æ ¼å¼**

`jps [ options ] [ hostid ]`

- optionsï¼šé€‰é¡¹ã€å‚æ•°ï¼Œä¸åŒçš„å‚æ•°å¯ä»¥è¾“å‡ºéœ€è¦çš„ä¿¡æ¯
- hostidï¼šè¿œç¨‹æŸ¥çœ‹

**é€‰é¡¹åˆ—è¡¨**

| é€‰é¡¹ | æè¿°                                           |
| ---- | ---------------------------------------------- |
| -q   | åªè¾“å‡ºè¿›ç¨‹IDï¼Œå¿½ç•¥ä¸»ç±»ä¿¡æ¯                     |
| -l   | è¾“å‡ºä¸»ç±»å…¨åï¼Œæˆ–è€…æ‰§è¡ŒJARåŒ…åˆ™è¾“å‡ºè·¯å¾„          |
| -m   | è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶ä¼ é€’ç»™ä¸»ç±»main()å‡½æ•°çš„å‚æ•° |
| -v   | è¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶çš„JVMå‚æ•°                  |


#### 1.1 jps -qï¼Œåªåˆ—å‡ºè¿›ç¨‹ID

```java
E:\itstack\git\github.com\interview>jps -q
104928
111552
26852
96276
59000
8460
76188
```

#### 1.2 jps -lï¼Œè¾“å‡ºå½“å‰è¿è¡Œç±»å…¨ç§°

```java
E:\itstack\git\github.com\interview>jps -l
111552 org/netbeans/Main
26852
96276 org.jetbrains.jps.cmdline.Launcher
59000
62184 sun.tools.jps.Jps
8460 org/netbeans/Main
76188 sun.tools.jstatd.Jstatd
```

- ç”¨è¿™ä¸ªå‘½ä»¤è¾“å‡ºçš„å†…å®¹å°±æ¸…æ™°å¤šäº†ï¼Œ`-l` ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„ä¸€ä¸ªå‚æ•°é€‰é¡¹ã€‚

#### 1.3 jps -mï¼Œåˆ—å‡ºä¼ ç»™main()å‡½æ•°çš„å‚æ•°

```java
E:\itstack\git\github.com\interview>jps -m
111552 Main --branding visualvm --cachedir C:\Users\xiaofuge\AppData\Local\VisualVM\Cache/8u131 --openid 3041391569375200
26852
96276 Launcher C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/plugins/java/lib/javac2.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/plugins/java/lib/aether-api-1.1.0.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/lib/jna-platform.jar;C:/Program Fi
les/JetBrains/IntelliJ IDEA 2019.3.1/lib/guava-27.1-jre.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/lib/httpclient-4.5.10.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/lib/forms-1.1-preview.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/plu
gins/java/lib/aether-connector-basic-1.1.0.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/plugins/java/lib/maven-model-builder-3.3.9.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/lib/jps-model.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/plu
gins/java/lib/maven-model-3.3.9.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/plugins/java/lib/aether-impl-1.1.0.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2019.3.1/lib/gson-2.8.5.jar;C:/Program File
59000
16844 Jps -m
8460 Main --branding visualvm --cachedir C:\Users\xiaofuge\AppData\Local\VisualVM\Cache/8u131 --openid 3041414336579200
76188 Jstatd
```

#### 1.4 jps -vï¼Œè¾“å‡ºè™šæ‹Ÿæœºè¿›ç¨‹å¯åŠ¨æ—¶JVMå‚æ•°[-Xms24m -Xmx256m]

```java
E:\itstack\git\github.com\interview>jps -v
111552 Main -Xms24m -Xmx256m -Dsun.jvmstat.perdata.syncWaitMs=10000 -Dsun.java2d.noddraw=true -Dsun.java2d.d3d=false -Dnetbeans.keyring.no.master=true -Dplugin.manager.install.global=false --add-exports=java.desktop/sun.awt=ALL-UNNAMED --add-exports=jdk.jvmstat/sun
.jvmstat.monitor.event=ALL-UNNAMED --add-exports=jdk.jvmstat/sun.jvmstat.monitor=ALL-UNNAMED --add-exports=java.desktop/sun.swing=ALL-UNNAMED --add-exports=jdk.attach/sun.tools.attach=ALL-UNNAMED --add-modules=java.activation -XX:+IgnoreUnrecognizedVMOptions -Djdk.
home=C:/Program Files/Java/jdk1.8.0_161 -Dnetbeans.home=C:\Program Files\Java\jdk1.8.0_161\lib\visualvm\platform -Dnetbeans.user=C:\Users\xiaofuge1\AppData\Roaming\VisualVM\8u131 -Dnetbeans.default_userdir_root=C:\Users\xiaofuge1\AppData\Roaming\VisualVM -XX:+H
eapDumpOnOutOfMemoryError -XX:HeapDumpPath=C:\Users\xiaofuge1\AppData\Roaming\VisualVM\8u131\var\log\heapdump.hprof -Dsun.awt.keepWorkingSetOnMinimize=true -Dnetbeans.dirs=C:\Program Files\Java\jdk1.8.0_161\lib\visualvm\visualvm;C:\Program
59000  -Dfile.encoding=UTF-8 -Xms128m -Xmx1024m -XX:MaxPermSize=256m
76188 Jstatd -Denv.class.path=.;C:\Program Files\Java\jre1.8.0_161\lib;C:\Program Files\Java\jre1.8.0_161\lib\tool.jar; -Dapplication.home=C:\Program Files\Java\jdk1.8.0_161 -Xms8m -Djava.security.policy=jstatd.all.policy
```

#### 1.5 jps -lv 127.0.0.1ï¼Œè¾“å‡ºè¿œç¨‹æœºå™¨ä¿¡æ¯

jps é“¾æ¥è¿œç¨‹è¾“å‡ºJVMä¿¡æ¯ï¼Œéœ€è¦æ³¨å†ŒRMIï¼Œå¦åˆ™ä¼šæŠ¥é”™ `RMI Registry not available at 127.0.0.1`ã€‚

æ³¨å†ŒRMIå¼€å¯ jstatd åœ¨ä½ çš„ `C:\Program Files\Java\jdk1.8.0_161\bin` ç›®å½•ä¸‹æ·»åŠ åç§°ä¸º `jstatd.all.policy` çš„æ–‡ä»¶ã€‚*æ— å…¶ä»–åç¼€*

**jstatd.all.policy** æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```java
grant codebase "file:${java.home}/../lib/tools.jar" {
   permission java.security.AllPermission;
};
```

æ·»åŠ å¥½é…ç½®æ–‡ä»¶åï¼Œåœ¨ bin ç›®å½•ä¸‹æ³¨å†Œæ·»åŠ çš„ `jstatd.all.policy` æ–‡ä»¶ï¼š`C:\Program Files\Java\jdk1.8.0_161\bin>jstatd -J-Djava.security.policy=jstatd.all.policy`

é¡ºåˆ©çš„è¯ç°åœ¨å°±å¯ä»¥æŸ¥çœ‹åŸåˆ›æœºå™¨JVMä¿¡æ¯äº†ï¼Œå¦‚ä¸‹ï¼š

```java
E:\itstack\git\github.com\interview>jps -l 127.0.0.1
111552 org/netbeans/Main
26852
96276 org.jetbrains.jps.cmdline.Launcher
36056 sun.tools.jps.Jps
59000
8460 org/netbeans/Main
76188 sun.tools.jstatd.Jstatd
```

- ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ jps çš„é€‰é¡¹å‚æ•°ï¼Œæ¯”å¦‚ï¼š`jps -lm 127.0.0.1`

### 2. jcmd è™šæ‹Ÿæœºè¯Šæ–­å‘½ä»¤

jcmdï¼Œæ˜¯ä»jdk1.7å¼€å§‹æ–°å‘å¸ƒçš„ JVM ç›¸å…³ä¿¡æ¯è¯Šæ–­å·¥å…·ï¼Œå¯ä»¥ç”¨å®ƒæ¥å¯¼å‡ºå †å’Œçº¿ç¨‹ä¿¡æ¯ã€æŸ¥çœ‹Javaè¿›ç¨‹ã€æ‰§è¡ŒGCã€è¿˜å¯ä»¥è¿›è¡Œé‡‡æ ·åˆ†æï¼ˆjmc å·¥å…·çš„é£è¡Œè®°å½•å™¨ï¼‰ã€‚æ³¨æ„å…¶ä½¿ç”¨æ¡ä»¶æ˜¯åªèƒ½åœ¨è¢«è¯Šæ–­çš„JVMåŒå°severä¸Šï¼Œå¹¶ä¸”å…·æœ‰ç›¸åŒçš„ç”¨æˆ·å’Œç»„(user and group).

**å‘½ä»¤æ ¼å¼**

`jcmd <pid | main class> <command ...|PerfCounter.print|-f file>`

- pidï¼Œæ¥æ”¶è¯Šæ–­å‘½ä»¤è¯·æ±‚çš„è¿›ç¨‹ID
  - main classï¼Œæ¥æ”¶è¯Šæ–­å‘½ä»¤è¯·æ±‚çš„è¿›ç¨‹mainç±»ã€‚
- commandï¼Œæ¥æ”¶è¯Šæ–­å‘½ä»¤è¯·æ±‚çš„è¿›ç¨‹mainç±»ã€‚
- PerfCounter.printï¼Œæ‰“å°ç›®æ ‡ Java è¿›ç¨‹ä¸Šå¯ç”¨çš„æ€§èƒ½è®¡æ•°å™¨ã€‚
- -f fileï¼Œä»æ–‡ä»¶fileä¸­è¯»å–å‘½ä»¤ï¼Œç„¶ååœ¨ç›®æ ‡Javaè¿›ç¨‹ä¸Šè°ƒç”¨è¿™äº›å‘½ä»¤ã€‚
- -lï¼ŒæŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹åˆ—è¡¨ä¿¡æ¯ã€‚
- -hã€-helpï¼ŒæŸ¥çœ‹å¸®åŠ©ä¿¡æ¯ã€‚

#### 2.1 jcmd pid VM.flagsï¼ŒæŸ¥çœ‹JVMå¯åŠ¨å‚æ•°

```java
E:\itstack\git\github.com\interview>jcmd 111552 VM.flags
111552:
-XX:CICompilerCount=4 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=C:\Users\xiaofuge1\AppData\Roaming\VisualVM\8u131\var\log\heapdump.hprof -XX:+IgnoreUnrecognizedVMOptions -XX:InitialHeapSize=25165824 -XX:MaxHeapSize=268435456 -XX:MaxNewSize=89128960 -XX:Min
HeapDeltaBytes=524288 -XX:NewSize=8388608 -XX:OldSize=16777216 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-UseLargePagesIndividualAllocation -XX:+UseParallelGC
```

#### 2.2 jcmd pid VM.uptimeï¼ŒæŸ¥çœ‹JVMè¿è¡Œæ—¶é•¿

```java
E:\itstack\git\github.com\interview>jcmd 111552 VM.uptime
111552:
583248.912 s
```

#### 2.3 jcmd pid PerfCounter.printï¼ŒæŸ¥çœ‹JVMæ€§èƒ½ç›¸å…³å‚æ•°

```java
E:\itstack\git\github.com\interview>jcmd 111552 PerfCounter.print
111552:
java.ci.totalTime=56082522
java.cls.loadedClasses=5835
java.cls.sharedLoadedClasses=0
java.cls.sharedUnloadedClasses=0
java.cls.unloadedClasses=37
...
```

#### 2.4 jcmd pid GC.class_histogramï¼ŒæŸ¥çœ‹ç³»ç»Ÿä¸­ç±»çš„ç»Ÿè®¡ä¿¡æ¯

```java
E:\itstack\git\github.com\interview>jcmd 111552 GC.class_histogram
111552:

 num     #instances         #bytes  class name
----------------------------------------------
   1:         50543        3775720  [C
   2:          3443        2428248  [I
   3:         50138        1203312  java.lang.String
   4:         25351         811232  java.util.HashMap$Node
   5:          6263         712208  java.lang.Class
   6:          3134         674896  [B
   7:          6687         401056  [Ljava.lang.Object;
   8:          2468         335832  [Ljava.util.HashMap$Node;
```

#### 2.5 jcmd pid Thread.printï¼ŒæŸ¥çœ‹çº¿ç¨‹å †æ ˆä¿¡æ¯

```java
E:\itstack\git\github.com\interview>jcmd 111552 Thread.print
111552:
2021-01-10 23:31:13
Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.161-b12 mixed mode):

"Computes values in handlers" #52 daemon prio=5 os_prio=0 tid=0x0000000019839000 nid=0x16014 waiting for monitor entry [0x0000000026bce000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at com.sun.tools.visualvm.core.model.ModelFactory.getModel(ModelFactory.java:76)
        - waiting to lock <0x00000000f095bcf8> (a com.sun.tools.visualvm.jvmstat.application.JvmstatApplication)
        at com.sun.tools.visualvm.application.jvm.JvmFactory.getJVMFor(JvmFactory.java:45)
        at com.sun.tools.visualvm.application.options.Open.openApplication(Open.java:108)
        at com.sun.tools.visualvm.application.options.Open.process(Open.java:93)
        at org.netbeans.spi.sendopts.Option$1.process(Option.java:348)
        at org.netbeans.api.sendopts.CommandLine.process(CommandLine.java:278)
        at org.netbeans.modules.sendopts.HandlerImpl.execute(HandlerImpl.java:23)
        at org.netbeans.modules.sendopts.Handler.cli(Handler.java:30)
        at org.netbeans.CLIHandler.notifyHandlers(CLIHandler.java:195)
        at org.netbeans.core.startup.CLICoreBridge.cli(CLICoreBridge.java:43)
        at org.netbeans.CLIHandler.notifyHandlers(CLIHandler.java:195)
        at org.netbeans.CLIHandler$Server$1ComputingAndNotifying.run(CLIHandler.java:1176)
```

#### 2.6 jcmd pid VM.system_propertiesï¼ŒæŸ¥çœ‹JVMç³»ç»Ÿå‚æ•°

```java
E:\itstack\git\github.com\interview>jcmd 111552 VM.system_properties
111552:
#Sun Jan 13 23:33:19 CST 2021
java.vendor=Oracle Corporation
netbeans.user=C\:\\Users\\xiaofuge1\\AppData\\Roaming\\VisualVM\\8u131
sun.java.launcher=SUN_STANDARD
sun.management.compiler=HotSpot 64-Bit Tiered Compilers
netbeans.autoupdate.version=1.23
os.name=Windows 10
```

#### 2.7 jcmd pid GC.heap_dump è·¯å¾„ï¼Œå¯¼å‡ºheap dumpæ–‡ä»¶

```java
E:\itstack\git\github.com\interview>jcmd 111552 GC.heap_dump C:\Users\xiaofuge1\Desktop\_dump_0110
111552:
Heap dump file created
```

- å¯¼å‡ºçš„æ–‡ä»¶éœ€è¦é…åˆ jvisualvm æŸ¥çœ‹

#### 2.8 jcmd pid helpï¼Œåˆ—å‡ºå¯æ‰§è¡Œæ“ä½œ

```java
E:\itstack\git\github.com\interview>jcmd 111552 help
111552:
The following commands are available:
JFR.stop
JFR.start
JFR.dump
JFR.check
```

#### 2.9 jcmd pid help JFR.stopï¼ŒæŸ¥çœ‹å‘½ä»¤ä½¿ç”¨

```java
E:\itstack\git\github.com\interview>jcmd 111552 help JFR.stop
111552:
JFR.stop
Stops a JFR recording

Impact: Low

Permission: java.lang.management.ManagementPermission(monitor)

Syntax : JFR.stop [options]

Options: (options must be specified using the <key> or <key>=<value> syntax)
        name : [optional] Recording name,.e.g \"My Recording\" (STRING, no default value)
        recording : [optional] Recording number, see JFR.check for a list of available recordings (JLONG, -1)
        discard : [optional] Skip writing data to previously specified file (if any) (BOOLEAN, false)
        filename : [optional] Copy recording data to file, e.g. \"C:\Users\user\My Recording.jfr\" (STRING, no default value)
        compress : [optional] GZip-compress "filename" destination (BOOLEAN, false)
```

### 3. jinfo Javaé…ç½®ä¿¡æ¯å·¥å…·

jinfoï¼ˆConfiguration Info for Javaï¼‰ï¼Œå®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´JVMçš„å„é¡¹å‚æ•°ã€‚

åœ¨ä¸Šé¢è®²åˆ° `jps -v` æŒ‡ä»¤æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæŠŠè™šæ‹Ÿæœºå¯åŠ¨æ—¶æ˜¾å¼çš„å‚æ•°åˆ—è¡¨éƒ½æ‰“å°å‡ºæ¥äº†ï¼Œä½†å¦‚æœæƒ³æ›´åŠ æ¸…æ™°çš„çœ‹å…·ä½“çš„ä¸€ä¸ªå‚æ•°æˆ–è€…æƒ³çŸ¥é“æœªè¢«æ˜¾å¼æŒ‡å®šçš„å‚æ•°æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ jinfo -flag æ¥æŸ¥è¯¢äº†ã€‚

**å‘½ä»¤æ ¼å¼**

`jinfo [ option ] pid`

**ä½¿ç”¨æ–¹å¼**

```java
E:\itstack\git\github.com\interview>jinfo -flag MetaspaceSize 111552
-XX:MetaspaceSize=21807104

E:\itstack\git\github.com\interview>jinfo -flag MaxMetaspaceSize 111552
-XX:MaxMetaspaceSize=18446744073709486080

E:\itstack\git\github.com\interview>jinfo -flag HeapDumpPath 111552
-XX:HeapDumpPath=C:\Users\xiaofuge\AppData\Roaming\VisualVM\8u131\var\log\heapdump.hprof
```

- å„ç§JVMå‚æ•°ä½ éƒ½å¯ä»¥å»æŸ¥è¯¢ï¼Œè¿™æ ·æ›´åŠ æ–¹ä¾¿çš„åªæŠŠä½ è¦çš„æ˜¾ç¤ºå‡ºæ¥ã€‚

### 4. jstat æ”¶é›†è™šæ‹Ÿæœºè¿è¡Œæ•°æ®

jstatï¼ˆJVM Statistics Monitoring Toolï¼‰ï¼Œç”¨äºç›‘è§†è™šæ‹Ÿæœºå„ç§è¿è¡ŒçŠ¶æ€ä¿¡æ¯ã€‚å®ƒå¯ä»¥æŸ¥çœ‹æœ¬åœ°æˆ–è€…è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ä¸­ï¼Œç±»åŠ è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€å³æ—¶ç¼–è¯‘ç­‰è¿è¡Œæ—¶æ•°æ®ã€‚

**å‘½ä»¤æ ¼å¼**

`jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]
`

- vmidï¼šå¦‚æœæ˜¯æŸ¥çœ‹è¿œç¨‹æœºå™¨ï¼Œéœ€è¦æŒ‰ç…§æ­¤æ ¼å¼ï¼š`[protocol:][//]lvmid[@hostname[:port]/servername]`
- intervalå’Œcountï¼Œè¡¨ç¤ºæŸ¥è¯¢é—´éš”å’Œæ¬¡æ•°ï¼Œæ¯”å¦‚æ¯éš”1000æ¯«ç§’æŸ¥è¯¢ä¸€æ¬¡è¿›ç¨‹IDçš„gcæ”¶é›†æƒ…å†µï¼Œæ¯æ¬¡æŸ¥è¯¢5æ¬¡ã€‚`jstat -gc 111552 1000 5`

**é€‰é¡¹åˆ—è¡¨**

| é€‰é¡¹              | æè¿°                                                         |
| ----------------- | ------------------------------------------------------------ |
| -class            | ç›‘è§†ç±»åŠ è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—è´¹æ—¶é•¿             |
| -gc               | ç›‘è§† Java å †æƒ…å†µï¼ŒåŒ…æ‹¬EdenåŒºã€2ä¸ª SurvivoråŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£æˆ–è€…jdk1.8å…ƒç©ºé—´ç­‰ï¼Œå®¹é‡ã€å·²ç”¨ç©ºé—´ã€åƒåœ¾æ”¶é›†æ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ |
| -gccapacity       | ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ä¸€è‡´ï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨ Java å †å„ä¸ªåŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ |
| -gcutil           | ç›‘è§†å†…å®¹ä¸-gcåŸºæœ¬ç›¸åŒï¼Œä½†è¾“å‡ºä¸»è¦å…³æ³¨å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯” |
| -gccause          | ä¸ -gcutil åŠŸèƒ½ä¸€æ ·ï¼Œä½†æ˜¯ä¼šé¢å¤–è¾“å‡ºå¯¼è‡´ä¸Šä¸€æ¬¡åƒåœ¾æ”¶é›†äº§ç”Ÿçš„åŸå›  |
| -gcnew            | ç›‘è§†æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†æƒ…å†µ                                       |
| -gcnewcapacity    | ç›‘è§†å†…å®¹ä¸ -gcnew åŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ |
| -gcold            | ç›‘è§†è€å¹´ä»£åƒåœ¾æ”¶é›†æƒ…å†µ                                       |
| -gcoldcapacity    | ç›‘è§†å†…å®¹ä¸ -gcold åŸºæœ¬ç›¸åŒï¼Œè¾“å‡ºä¸»è¦å…³æ³¨ä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ |
| -compiler         | è¾“å‡ºå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘è¿‡çš„æ–¹æ³•ã€è€—æ—¶ç­‰ä¿¡æ¯                       |
| -printcompilation | è¾“å‡ºå·²ç»è¢«å³æ—¶ç¼–è¯‘çš„æ–¹æ³•                                     |
| -gcpermcapacity   | jdk1.7 åŠä»¥ä¸‹ï¼Œæ°¸ä¹…ä»£ç©ºé—´ç»Ÿè®¡                                |
| -gcmetacapacity   | jdk1.8ï¼Œå…ƒç©ºé—´ç»Ÿè®¡                                           |

- jstat çš„ç›‘è§†é€‰é¡¹è¿˜æ˜¯éå¸¸å¤šçš„ï¼Œä½†æœ€å¸¸ç”¨çš„ä¸»è¦æœ‰ä¸Šé¢è¿™äº›ã€‚

#### 4.01 jstat -classï¼Œç±»åŠ è½½ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -class 111552
Loaded  Bytes  Unloaded  Bytes     Time
  5835 12059.6       37    53.5       3.88
```

- Loadedï¼ŒåŠ è½½classçš„æ•°é‡
- Bytesï¼šæ‰€å ç”¨ç©ºé—´å¤§å°
- Unloadedï¼šæœªåŠ è½½æ•°é‡
- Bytesï¼šæœªåŠ è½½å ç”¨ç©ºé—´
- Timeï¼šæ—¶é—´

#### 4.02 jstat -compilerï¼Œç¼–è¯‘ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -compiler 111552
Compiled Failed Invalid   Time   FailedType FailedMethod
    3642      0       0     5.61          0
```

- Compiledï¼šç¼–è¯‘æ•°é‡
- Failedï¼šå¤±è´¥æ•°é‡
- Invalidï¼šä¸å¯ç”¨æ•°é‡
- Timeï¼šæ—¶é—´
- FailedTypeï¼šå¤±è´¥ç±»å‹
- FailedMethodï¼šå¤±è´¥æ–¹æ³•

#### 4.03 jstat -gcï¼Œåƒåœ¾å›æ”¶ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gc 111552
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
1024.0 512.0   0.0    0.0   77312.0    35.1    39424.0    13622.9   37120.0 34423.3 5376.0 4579.4     60    0.649  52      3.130    3.779
```

- S0Cã€S1Cï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¹¸å­˜åŒºå¤§å°
- S0Uã€S1Uï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå¹¸å­˜åŒºä½¿ç”¨å¤§å°
- ECã€EUï¼Œä¼Šç”¸å›­çš„å¤§å°å’Œä½¿ç”¨
- OCã€OUï¼Œè€å¹´ä»£çš„å¤§å°å’Œä½¿ç”¨
- MCã€MUï¼Œæ–¹æ³•åŒºçš„å¤§å°å’Œä½¿ç”¨
- CCSCã€CCSUï¼Œå‹ç¼©ç±»ç©ºé—´å¤§å°å’Œä½¿ç”¨
- YGCã€YGCTï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°å’Œè€—æ—¶
- FGCã€FGCTï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°å’Œè€—æ—¶
- GCTï¼Œåƒåœ¾å›æ”¶æ€»è€—æ—¶

#### 4.04 jstat -gccapacityï¼Œå †å†…å­˜ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gccapacity 111552
 NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC
  8192.0  87040.0  80384.0 1024.0  512.0  77312.0    16384.0   175104.0    39424.0    39424.0      0.0 1081344.0  37120.0      0.0 1048576.0   5376.0     60    52
```

- NGCMNã€NGCMXï¼Œæ–°ç”Ÿä»£æœ€å°å’Œæœ€å¤§å®¹é‡
- NGCï¼Œå½“å‰æ–°ç”Ÿä»£å®¹é‡
- S0Cã€S1Cï¼Œç¬¬ä¸€å’Œç¬¬äºŒå¹¸å­˜åŒºå¤§å°
- ECï¼Œä¼Šç”¸å›­åŒºçš„å¤§å°
- OGCMNã€OGCMXï¼Œè€å¹´ä»£æœ€å°å’Œæœ€å¤§å®¹é‡
- OGCã€OCï¼Œå½“å‰è€å¹´ä»£å¤§å°
- MCMNã€MCMXï¼Œå…ƒæ•°æ®ç©ºé—´æœ€å°å’Œæœ€å¤§å®¹é‡
- MCï¼Œå½“å‰å…ƒç©ºé—´å¤§å°
- CCSMNã€CCSMXï¼Œå‹ç¼©ç±»æœ€å°å’Œæœ€å¤§ç©ºé—´
- YGCï¼Œå¹´è½»ä»£GCæ¬¡æ•°
- FGCï¼Œè€å¹´ä»£GCæ¬¡æ•°

#### 4.05 jstat -gcnewcapacityï¼Œæ–°ç”Ÿä»£å†…å­˜ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gcnewcapacity 111552
  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC
    8192.0    87040.0    80384.0  28672.0   1024.0  28672.0    512.0    86016.0    77312.0    60    52
```

- NGCMNã€NGCMXï¼Œæ–°ç”Ÿä»£æœ€å°å’Œæœ€å¤§å®¹é‡
- NGCï¼Œå½“å‰æ–°ç”Ÿä»£å®¹é‡
- S0CMXï¼Œæœ€å¤§å¹¸å­˜0åŒºå¤§å°
- S0Cï¼Œå½“å‰å¹¸å­˜0åŒºå¤§å°
- S1CMXï¼Œæœ€å¤§å¹¸å­˜1åŒºå¤§å°
- S1Cï¼Œå½“å‰å¹¸å­˜1åŒºå¤§å°
- ECMXï¼Œæœ€å¤§ä¼Šç”¸å›­åŒºå¤§å°
- ECï¼Œå½“å‰ä¼Šç”¸å›­åŒºå¤§å°
- YGCï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCï¼Œè€å¹´ä»£å›æ”¶æ¬¡æ•°

#### 4.06 jstat -gcnewï¼Œæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gcnew 111552
 S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT
1024.0  512.0    0.0    0.0  3  15  512.0  77312.0     70.2     60    0.649
```

- S0Cã€S1Cï¼Œç¬¬ä¸€å’Œç¬¬äºŒå¹¸å­˜åŒºå¤§å°
- S0Uã€S1Uï¼Œç¬¬ä¸€å’Œç¬¬äºŒå¹¸å­˜åŒºä½¿ç”¨
- TTï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æ¬¡æ•°
- MTTï¼Œå¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æœ€å¤§æ¬¡æ•°
- DSSï¼šæœŸæœ›çš„å¹¸å­˜åŒºå¤§å°
- ECï¼Œä¼Šç”¸å›­åŒºçš„å¤§å°
- EUï¼Œä¼Šç”¸å›­åŒºçš„ä½¿ç”¨
- YGCï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- YGCTï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´

#### 4.07 jstat -gcoldï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gcold 111552
   MC       MU      CCSC     CCSU       OC          OU       YGC    FGC    FGCT     GCT
 37120.0  34423.3   5376.0   4579.4     39424.0     13622.9     60    52    3.130    3.779
```

- MCã€MUï¼Œæ–¹æ³•åŒºçš„å¤§å°å’Œä½¿ç”¨
- CCSCã€CCSUï¼Œå‹ç¼©ç±»ç©ºé—´å¤§å°å’Œä½¿ç”¨
- OCã€OUï¼Œè€å¹´ä»£å¤§å°å’Œä½¿ç”¨
- YGCï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCTï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶è€—æ—¶
- GCTï¼Œåƒåœ¾å›æ”¶æ€»è€—æ—¶

#### 4.08 jstat -gcoldcapacityï¼Œè€å¹´ä»£å†…å­˜ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gcoldcapacity 111552
   OGCMN       OGCMX        OGC         OC       YGC   FGC    FGCT     GCT
    16384.0    175104.0     39424.0     39424.0    60    52    3.130    3.779
```

- OGCMNã€OGCMXï¼Œè€å¹´ä»£æœ€å°å’Œæœ€å¤§å®¹é‡
- OGCï¼Œå½“å‰è€å¹´ä»£å¤§å°
- OCï¼Œè€å¹´ä»£å¤§å°
- YGCï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCTï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶è€—æ—¶
- GCTï¼Œåƒåœ¾å›æ”¶æ¶ˆè€—æ€»è€—æ—¶

#### 4.09 jstat -gcmetacapacityï¼Œå…ƒç©ºé—´ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gcmetacapacity 111552
   MCMN       MCMX        MC       CCSMN      CCSMX       CCSC     YGC   FGC    FGCT     GCT
       0.0  1081344.0    37120.0        0.0  1048576.0     5376.0    60    52    3.130    3.779
```

- MCMNã€MCMXï¼Œå…ƒç©ºé—´æœ€å°å’Œæœ€å¤§å®¹é‡
- MCï¼Œå½“å‰å…ƒæ•°æ®ç©ºé—´å¤§å°
- CCSMNã€CCSMXï¼Œå‹ç¼©ç±»æœ€å°å’Œæœ€å¤§ç©ºé—´
- CCSCï¼Œå‹ç¼©ç±»ç©ºé—´å¤§å°
- YGCï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCTï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶è€—æ—¶
- GCTï¼Œåƒåœ¾å›æ”¶æ¶ˆè€—æ€»è€—æ—¶

#### 4.10 jstat -gcutilï¼Œåƒåœ¾å›æ”¶ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -gcutil 111552
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT
  0.00   0.00   0.09  34.55  92.74  85.18     60    0.649    52    3.130    3.779
```

- S0ã€S1ã€å¹¸å­˜1åŒºå’Œ2åŒºï¼Œå½“å‰ä½¿ç”¨å æ¯”
- Eï¼Œä¼Šç”¸å›­åŒºä½¿ç”¨å æ¯”
- Oï¼Œè€å¹´ä»£åŒºä½¿ç”¨å æ¯”
- Mï¼Œå…ƒæ•°æ®åŒºä½¿ç”¨å æ¯”
- CCSï¼Œå‹ç¼©ç±»ä½¿ç”¨å æ¯”
- YGCï¼Œå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°
- FGCTï¼Œè€å¹´ä»£åƒåœ¾å›æ”¶è€—æ—¶
- GCTï¼Œåƒåœ¾å›æ”¶æ¶ˆè€—æ€»è€—æ—¶

#### 4.11 jstat -printcompilationï¼ŒJVMç¼–è¯‘æ–¹æ³•ç»Ÿè®¡

```java
E:\itstack\git\github.com\interview>jstat -printcompilation 111552
Compiled  Size  Type Method
    3642      9    1 java/io/BufferedWriter min
```

- Compiledï¼šæœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„æ•°é‡
- Sizeï¼šæœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„å­—èŠ‚ç æ•°é‡
- Typeï¼šæœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„ç¼–è¯‘ç±»å‹
- Methodï¼šæ–¹æ³•åæ ‡è¯†

### 5. jmap å†…å­˜æ˜ å°„å·¥å…·

jmapï¼ˆMemory Map for Javaï¼‰ï¼Œç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆheapdumpæ–‡ä»¶ï¼‰ã€‚

jmap çš„ä½œç”¨é™¤äº†è·å–å †è½¬å‚¨å¿«ç…§ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ–¹æ³•åŒºçš„è¯¦ç»†ä¿¡æ¯ã€‚

**å‘½ä»¤æ ¼å¼**

`jmap [ option ] pid`

- optionï¼šé€‰é¡¹å‚æ•°
- pidï¼šéœ€è¦æ‰“å°é…ç½®ä¿¡æ¯çš„è¿›ç¨‹ID
- executableï¼šäº§ç”Ÿæ ¸å¿ƒdumpçš„Javaå¯æ‰§è¡Œæ–‡ä»¶
- coreï¼šéœ€è¦æ‰“å°é…ç½®ä¿¡æ¯çš„æ ¸å¿ƒæ–‡ä»¶
- server-idï¼šå¯é€‰çš„å”¯ä¸€idï¼Œå¦‚æœç›¸åŒçš„è¿œç¨‹ä¸»æœºä¸Šè¿è¡Œäº†å¤šå°è°ƒè¯•æœåŠ¡å™¨ï¼Œç”¨æ­¤é€‰é¡¹å‚æ•°æ ‡è¯†æœåŠ¡å™¨
- remote server IP or hostnameï¼š è¿œç¨‹è°ƒè¯•æœåŠ¡å™¨çš„IPåœ°å€æˆ–ä¸»æœºå

**é€‰é¡¹åˆ—è¡¨**

| é€‰é¡¹           | æè¿°                                                         |
| -------------- | ------------------------------------------------------------ |
| -dump          | ç”Ÿæˆ Java å †è½¬å‚¨å¿«ç…§ã€‚                                       |
| -finalizerinfo | æ˜¾ç¤ºåœ¨F-Queueä¸­ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeæ–¹æ³•çš„å¯¹è±¡ã€‚Linuxå¹³å° |
| -heap          | æ˜¾ç¤º Java å †è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šç”¨äº†å“ªç§å›æ”¶å™¨ã€å‚æ•°é…ç½®ã€åˆ†ä»£æƒ…å†µã€‚Linuxå¹³å° |
| -histo         | æ˜¾ç¤ºå †ä¸­å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡             |
| -permstat      | æ˜¾ç¤ºæ°¸ä¹…ä»£å†…å­˜çŠ¶æ€ï¼Œjdk1.7ï¼Œæ°¸ä¹…ä»£                           |
| -F             | å½“è™šæ‹Ÿæœºè¿›ç¨‹å¯¹ -dump é€‰é¡¹æ²¡æœ‰å“åº”å¼ï¼Œå¯ä»¥å¼ºåˆ¶ç”Ÿæˆå¿«ç…§ã€‚Linuxå¹³å° |


#### 5.1 jmapï¼Œæ‰“å°å…±äº«å¯¹è±¡æ˜ å°„

```java
E:\itstack\git\github.com\interview>jmap 111552
Attaching to process ID 111552, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.161-b12
0x000000005b4a0000      1632K   C:\Program Files\Java\jdk1.8.0_161\jre\bin\awt.dll
0x000000005b8c0000      264K    C:\Program Files\Java\jdk1.8.0_161\jre\bin\t2k.dll
0x000000005b910000      284K    C:\Program Files\Java\jdk1.8.0_161\jre\bin\fontmanager.dll
0x000000005b960000      224K    C:\Program Files\Java\jdk1.8.0_161\jre\bin\splashscreen.dll
0x000000005b9a0000      68K     C:\Program Files\Java\jdk1.8.0_161\jre\bin\nio.dll
```

#### 5.2 jmap -heapï¼Œå †è¯¦ç»†ä¿¡æ¯

```java
E:\itstack\git\github.com\interview>jmap -heap 111552
Attaching to process ID 111552, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.161-b12

using thread-local object allocation.
Parallel GC with 8 thread(s)

Heap Configuration:
   MinHeapFreeRatio         = 0
   MaxHeapFreeRatio         = 100
   MaxHeapSize              = 268435456 (256.0MB)
   NewSize                  = 8388608 (8.0MB)
   MaxNewSize               = 89128960 (85.0MB)
   OldSize                  = 16777216 (16.0MB)
   NewRatio                 = 2
   SurvivorRatio            = 8
   MetaspaceSize            = 21807104 (20.796875MB)
   CompressedClassSpaceSize = 1073741824 (1024.0MB)
   MaxMetaspaceSize         = 17592186044415 MB
   G1HeapRegionSize         = 0 (0.0MB)
```

#### 5.3 jmap -clstatsï¼Œæ‰“å°åŠ è½½ç±»

```java
E:\itstack\git\github.com\interview> jmap -clstats 111552
Attaching to process ID 111552, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.161-b12
finding class loader instances ..done.
computing per loader stat ..done.
please wait.. computing liveness.................................................................liveness analysis may be inaccurate ...
class_loader    classes bytes   parent_loader   alive?  type

<bootstrap>     3779    6880779   null          live    <internal>
0x00000000f03853b8      57      132574  0x00000000f031aac8      live    org/netbeans/StandardModule$OneModuleClassLoader@0x00000001001684f0
0x00000000f01b9b98      0       0       0x00000000f031aac8      live    org/netbeans/StandardModule$OneModuleClassLoader@0x00000001001684f0
0x00000000f005b280      0       0       0x00000000f031aac8      live    java/util/ResourceBundle$RBClassLoader@0x00000001000c6ae0
0x00000000f01dfa98      0       0       0x00000000f031aac8      live    org/netbeans/StandardModule$OneModuleClassLoader@0x00000001001684f0
0x00000000f01ec518      79      252894  0x00000000f031aac8      live    org/netbeans/StandardModule$OneModuleClassLoader@0x00000001001684f0
```

#### 5.4 jmap -dumpï¼Œå †è½¬å‚¨æ–‡ä»¶

```java
E:\itstack\git\github.com\interview>jmap -dump:live,format=b,file=C:/Users/xiaofuge/Desktop/heap.bin 111552
Dumping heap to C:\Users\xiaofuge\Desktop\heap.bin ...
Heap dump file created
```

### 6. jhat å †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·

jhatï¼ˆJVM Heap Analysis Toolï¼‰ï¼Œä¸jmapé…åˆä½¿ç”¨ï¼Œç”¨äºåˆ†æjmapç”Ÿæˆçš„å †è½¬å‚¨å¿«ç…§ã€‚

jhatå†…ç½®äº†ä¸€ä¸ªå°å‹çš„http/webæœåŠ¡å™¨ï¼Œå¯ä»¥æŠŠå †è½¬å‚¨å¿«ç…§åˆ†æçš„ç»“æœï¼Œå±•ç¤ºåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚ä¸è¿‡ç”¨é€”ä¸å¤§ï¼ŒåŸºæœ¬å¤§å®¶éƒ½ä¼šä½¿ç”¨å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ã€‚

**å‘½ä»¤æ ¼å¼**

`jhat [-stack <bool>] [-refs <bool>] [-port <port>] [-baseline <file>] [-debug <int>] [-version] [-h|-help] <file>
`

**å‘½ä»¤ä½¿ç”¨**

```java
E:\itstack\git\github.com\interview>jhat -port 8090 C:/Users/xiaofuge1/Desktop/heap.bin
Reading from C:/Users/xiaofuge1/Desktop/heap.bin...
Dump file created Wed Jan 13 16:53:47 CST 2021
Snapshot read, resolving...
Resolving 246455 objects...
Chasing references, expect 49 dots.................................................
Eliminating duplicate references.................................................
Snapshot resolved.
Started HTTP server on port 8090
Server is ready.
```

**http://localhost:8090/**

![jhat -port 8090](https://bugstack.cn/assets/images/2020/interview/interview-26-1.png)

### 7. jstack Javaå †æ ˆè·Ÿè¸ªå·¥å…·

jstackï¼ˆStack Trace for Javaï¼‰ï¼Œç”¨äºç”Ÿæˆè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆthreaddumpã€javacoreï¼‰ã€‚

çº¿ç¨‹å¿«ç…§å°±æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ç›®çš„é€šå¸¸æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚ï¼šçº¿ç¨‹æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºè€—æ—¶è¾ƒé•¿å¯¼è‡´æŒ‚èµ·ç­‰ã€‚

çº¿ç¨‹å‡ºç°å¬é¡¿æ—¶é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥è·å¾—æ²¡æœ‰å“åº”çš„çº¿ç¨‹åœ¨æä»€ä¹ˆé¬¼ã€‚

**å‘½ä»¤æ ¼å¼**

```java
jstack [ option ] vmid
```

**é€‰é¡¹å‚æ•°**

| é€‰é¡¹ | æè¿°                                          |
| ---- | --------------------------------------------- |
| -F   | å½“æ­£å¸¸è¾“å‡ºçš„è¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ  |
| -l   | é™¤äº†å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯              |
| -m   | å¦‚æœè°ƒç”¨çš„æ˜¯æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºc/c++çš„å †æ ˆ |

**å‘½ä»¤ä½¿ç”¨**

```java
E:\itstack\git\github.com\interview>jstack 111552
2021-01-10 23:15:03
Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.161-b12 mixed mode):

"Inactive RequestProcessor thread [Was:StdErr Flush/org.netbeans.core.startup.logging.PrintStreamLogger]" #59 daemon prio=1 os_prio=-2 tid=0x000000001983a800 nid=0x688 in Object.wait() [0x0000000017fbf000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
        at java.lang.Object.wait(Native Method)
        at org.openide.util.RequestProcessor$Processor.run(RequestProcessor.java:1939)
        - locked <0x00000000fab31d88> (a java.lang.Object)
```

- åœ¨éªŒè¯ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°è¯•å†™ä¸€ä¸ªæ­»å¾ªç¯çš„çº¿ç¨‹ï¼Œä¹‹åé€šè¿‡jstackæŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ã€‚

## å››ã€å¯è§†åŒ–æ•…éšœå¤„ç†å·¥å…·

### 1. jconsoleï¼ŒJavaç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°

JConsoleï¼ˆ Java Monitoring and Management Consoleï¼‰ï¼Œæ˜¯ä¸€æ¬¾åŸºäºJMXï¼ˆ Java Manage-ment
Extensionsï¼‰ çš„å¯è§†åŒ–ç›‘è§†ç®¡ç†å·¥å…·ã€‚ 

å®ƒçš„åŠŸèƒ½ä¸»è¦æ˜¯å¯¹ç³»ç»Ÿè¿›è¡Œæ”¶é›†å’Œå‚æ•°è°ƒæ•´ï¼Œä¸ä»…å¯ä»¥åœ¨è™šæ‹Ÿæœºæœ¬èº«ç®¡ç†è¿˜å¯ä»¥å¼€å‘åœ¨è½¯ä»¶ä¸Šï¼Œæ˜¯å¼€æ”¾çš„æœåŠ¡ï¼Œæœ‰ç›¸åº”çš„ä»£ç APIè°ƒç”¨ã€‚

**JConsole å¯åŠ¨**

![JConsole å¯åŠ¨](https://bugstack.cn/assets/images/2020/interview/interview-26-2.png)

**JConsole ä½¿ç”¨**

![JConsole ä½¿ç”¨](https://bugstack.cn/assets/images/2020/interview/interview-26-3.png)

### 2. VisualVMï¼Œå¤šåˆæ•…éšœå¤„ç†å·¥å…·

VisualVMï¼ˆ All-in-One Java Troubleshooting Toolï¼‰ï¼Œæ˜¯åŠŸèƒ½æœ€å¼ºå¤§çš„è¿è¡Œç›‘è§†å’Œæ•…éšœå¤„ç†å·¥å…·ä¹‹ä¸€ã€‚

å®ƒé™¤äº†å¸¸è§„çš„è¿è¡Œç›‘è§†ã€æ•…éšœå¤„ç†å¤–ï¼Œè¿˜å¯ä»¥åšæ€§èƒ½åˆ†æç­‰å·¥ä½œã€‚å› ä¸ºå®ƒçš„é€šç”¨æ€§å¾ˆå¼ºï¼Œå¯¹åº”ç”¨ç¨‹åºå½±å“è¾ƒå°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ¥å…¥åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

**VisualVM IDEAå®‰è£…**

![VisualVM IDEAå®‰è£…](https://bugstack.cn/assets/images/2020/interview/interview-26-4.png)

**VisualVM ä½¿ç”¨**

```java
public static void main(String[] args) throws InterruptedException {
    
    Thread.sleep(5000);
    ClassLoadingMXBean loadingBean = ManagementFactory.getClassLoadingMXBean();
    while (true) {
        Enhancer enhancer = new Enhancer();
        enhancer.setSuperclass(MetaSpaceOomMock.class);
        enhancer.setCallbackTypes(new Class[]{Dispatcher.class, MethodInterceptor.class});
        enhancer.setCallbackFilter(new CallbackFilter() {
            @Override
            public int accept(Method method) {
                return 1;
            }
            @Override
            public boolean equals(Object obj) {
                return super.equals(obj);
            }
        });
        System.out.println(enhancer.createClass().getName() + loadingBean.getTotalLoadedClassCount() + loadingBean.getLoadedClassCount() + loadingBean.getUnloadedClassCount());
    }
}
```

**è®°å¾—è°ƒæ•´å…ƒç©ºé—´å¤§å°**

```java
-XX:MetaspaceSize=8m
-XX:MaxMetaspaceSize=80m
-Djava.rmi.server.hostname=127.0.0.1
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=7397
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
```

- æˆ‘ä»¬å°±ç›‘æµ‹è¿™æ®µè®©å…ƒç©ºé—´æº¢å‡ºçš„ä»£ç ï¼Œ`java.lang.OutOfMemoryError: Metaspace`

**ç›‘æ§ç»“æœ**

![VisualVMï¼Œç›‘æ§ç»“æœ](https://bugstack.cn/assets/images/2020/interview/interview-26-5.png)

## äº”ã€æ€»ç»“

- æœ¬æ–‡ä¹Ÿæ˜¯å°å‚…å“¥åœ¨å­¦ä¹ ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªæ€»ç»“ï¼Œè¿™é‡ŒåŒ…æ‹¬äº†å¾ˆå¤šå¸¸ç”¨çš„æŒ‡ä»¤ï¼Œé€šè¿‡è¿™äº›æŒ‡ä»¤çš„å­¦ä¹ æˆ‘ä»¬ä¹Ÿå¤§æ¦‚ä¼šçŸ¥é“JVMéƒ½ç»™æˆ‘ä»¬æä¾›äº†ä»€ä¹ˆæ ·çš„ç›‘æ§ä¿¡æ¯ã€‚
- å…¶å®å®é™…çš„ä¸šåŠ¡ä½¿ç”¨ä¸­å¾ˆå°‘é€šè¿‡æŒ‡ä»¤å»ç›‘æ§JVMè€Œæ˜¯æœ‰ä¸€æ•´å¥—çš„éå…¥ä¾µå…¨é“¾è·¯ç›‘æ§ï¼Œåœ¨ç›‘æ§æœåŠ¡é‡Œä¸ä¹‹æ–¹æ³•è°ƒç”¨æ—¶çš„JVMä¸€å¹¶ç›‘æ§ï¼Œå¯ä»¥è®©ç ”å‘äººå‘˜æ›´å¿«é€Ÿçš„æ’æŸ¥é—®é¢˜ã€‚ä½†è¿™äº›å·¥å…·çš„å®ç°ä¾ç„¶æ˜¯éœ€è¦è¿™äº›åŸºç¡€ï¼Œåœ¨æœ‰äº†åŸºç¡€çš„çŸ¥è¯†æŒæ¡åï¼Œå¯ä»¥æ›´å¥½å¤šä½¿ç”¨å·¥å…·ã€‚
- ç¼–ç¨‹æŠ€æœ¯ç±»çŸ¥è¯†çš„å­¦ä¹ ä¸€å®šè¦å®è·µéªŒè¯ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å¿˜è®°ï¼Œä¹Ÿå¾ˆéš¾æŒæ¡ã€‚å½“ä½ ç»è¿‡è‡ªå·±æ‰‹å¤šæ•²å‡ éä»¥åï¼Œå°±ä¼šæœ‰å®Œå…¨ä¸ä¸€æ ·çš„è®¤è¯†ã€‚å¥½äº†ï¼ŒåŠ æ²¹ï¼å¸Œæœ›æœ¬ç¯‡æ–‡ç« èƒ½ä¸ºä½ çš„è–ªèµ„é¼“é¼“åŠ²ï¼

## å…­ã€ç³»åˆ—æ¨è

- [ä¸ºäº†ææ¸…æ¥šç±»åŠ è½½ï¼Œç«Ÿç„¶æ‰‹æ’¸JVMï¼](https://bugstack.cn/interview/2020/12/30/é¢ç»æ‰‹å†Œ-ç¬¬24ç¯‡-ä¸ºäº†ææ¸…æ¥šç±»åŠ è½½-ç«Ÿç„¶æ‰‹æ’¸JVM.html)
- [JVMå†…å­˜æ¨¡å‹æ€»ç»“ï¼Œæœ‰å„ç‰ˆæœ¬JDKå¯¹æ¯”ã€æœ‰å…ƒç©ºé—´OOMç›‘æ§æ¡ˆä¾‹ã€æœ‰Javaç‰ˆè™šæ‹Ÿæœºï¼Œç»¼åˆå­¦ä¹ æ›´å®¹æ˜“ï¼](https://bugstack.cn/interview/2021/01/06/é¢ç»æ‰‹å†Œ-ç¬¬25ç¯‡-JVMå†…å­˜æ¨¡å‹æ€»ç»“-æœ‰å„ç‰ˆæœ¬JDKå¯¹æ¯”-æœ‰å…ƒç©ºé—´OOMç›‘æ§æ¡ˆä¾‹-æœ‰Javaç‰ˆè™šæ‹Ÿæœº-ç»¼åˆå­¦ä¹ æ›´å®¹æ˜“.html)
- [HashMapæ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ](https://bugstack.cn/interview/2020/08/07/é¢ç»æ‰‹å†Œ-ç¬¬3ç¯‡-HashMapæ ¸å¿ƒçŸ¥è¯†-æ‰°åŠ¨å‡½æ•°-è´Ÿè½½å› å­-æ‰©å®¹é“¾è¡¨æ‹†åˆ†-æ·±åº¦å­¦ä¹ .html)
- [è®¤çŸ¥è‡ªå·±çš„æŠ€æœ¯æ ˆç›²åŒº](https://bugstack.cn/interview/2020/07/30/é¢ç»æ‰‹å†Œ-ç¬¬1ç¯‡-è®¤çŸ¥è‡ªå·±çš„æŠ€æœ¯æ ˆç›²åŒº.html)
- [çº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨ï¼Œä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§](https://bugstack.cn/interview/2020/12/16/é¢ç»æ‰‹å†Œ-ç¬¬22ç¯‡-çº¿ç¨‹æ± çš„ä»‹ç»å’Œä½¿ç”¨-ä»¥åŠåŸºäºjvmtiè®¾è®¡éå…¥ä¾µç›‘æ§.html)
