---
layout: post
category: interview
title: é¢ç»æ‰‹å†Œ Â· ç¬¬2ç¯‡ã€Šæ•°æ®ç»“æ„ï¼ŒHashCodeä¸ºä»€ä¹ˆä½¿ç”¨31ä½œä¸ºä¹˜æ•°ï¼Ÿã€‹
tagline: by å°å‚…å“¥
tag: [java,interview]
excerpt: Why does Java's hashCode() in String use 31 as a multiplier? è¿™æ˜¯ä¸€ä¸ªç»å…¸é—®é¢˜ï¼Œä¹Ÿæ˜¯å¯¹æ•°æ®ç»“æ„æ•£åˆ—è¡¨å­¦ä¹ çš„æœ€ä½³æ–¹å¼ã€‚çœ‹è¿‡è¿™ç¯‡æ–‡ç« ä¹‹åä½ ä¼šå½»åº•äº†è§£hashcodeå¦‚ä½•æ•£åˆ—ï¼Œå¥‡è´¨æ•°31åˆ°åº•å‘æŒ¥äº†æ€æ ·çš„ä½œç”¨ã€‚
lock: need
---

# é¢ç»æ‰‹å†Œ Â· ç¬¬2ç¯‡ã€Šæ•°æ®ç»“æ„ï¼ŒHashCodeä¸ºä»€ä¹ˆä½¿ç”¨31ä½œä¸ºä¹˜æ•°ï¼Ÿã€‹

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

åœ¨é¢ç»æ‰‹å†Œçš„å‰ä¸¤ç¯‡ä»‹ç»äº†[**ã€Šé¢è¯•å®˜éƒ½é—®æˆ‘å•¥ã€‹**](https://bugstack.cn/interview/2020/07/28/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E5%BC%80%E7%AF%87-%E9%9D%A2%E8%AF%95%E5%AE%98%E9%83%BD%E9%97%AE%E6%88%91%E5%95%A5.html)å’Œ[**ã€Šè®¤çŸ¥è‡ªå·±çš„æŠ€æœ¯æ ˆç›²åŒºã€‹**](https://bugstack.cn/interview/2020/07/30/%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C-%E7%AC%AC1%E7%AF%87-%E8%AE%A4%E7%9F%A5%E8%87%AA%E5%B7%B1%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88%E7%9B%B2%E5%8C%BA.html)ï¼Œè¿™ä¸¤ç¯‡å†…å®¹ä¸»è¦ä¸ºäº†è¯´æ˜é¢è¯•è¿‡ç¨‹çš„è€ƒæŸ¥èŒƒå›´ï¼ŒåŒ…æ‹¬ä¸ªäººçš„è‡ªæˆ‘ä»‹ç»ã€æŠ€æœ¯æ ˆç§¯ç´¯ã€é¡¹ç›®ç»éªŒç­‰ï¼Œä»¥åŠåœ¨æŠ€æœ¯æ ˆç›²åŒºç¯‡ç« ä¸­ä»‹ç»äº†ä¸€ä¸ªæ•´å¥—æŠ€æœ¯æ ˆåœ¨ç³»ç»Ÿæ¶æ„ç”¨çš„åº”ç”¨ï¼Œä»¥æ­¤å…¨æ–¹é¢çš„æ‰«æè‡ªå·±æœ‰å“ªäº›ç›²åŒºè¿˜éœ€è¦è¡¥å……ã€‚è€Œæ¥ä¸‹æ¥çš„ç« èŠ‚ä¼šä»¥å„ä¸ªç³»åˆ—çš„æŠ€æœ¯æ ˆä¸­é‡åˆ°çš„é¢è¯•é¢˜ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œè®²è§£æŠ€æœ¯è¦ç‚¹ï¼Œäº†è§£æŠ€æœ¯åŸç†ï¼ŒåŒ…æ‹¬ï¼›æ•°æ®ç»“æ„ã€æ•°æ®ç®—æ³•ã€æŠ€æœ¯æ ˆã€æ¡†æ¶ç­‰è¿›è¡Œé€æ­¥å±•å¼€å­¦ä¹ ã€‚

åœ¨è¿›å…¥æ•°æ®ç»“æ„ç« èŠ‚è®²è§£ä¹‹å‰å¯ä»¥å…ˆäº†è§£ä¸‹ï¼Œæ•°æ®ç»“æ„éƒ½æœ‰å“ªäº›ï¼ŒåŸºæœ¬å¯ä»¥åŒ…æ‹¬ï¼›`æ•°ç»„(Array)`ã€`æ ˆ(Stack)`ã€`é˜Ÿåˆ—(Queue)`ã€`é“¾è¡¨(LinkList)`ã€`æ ‘(Tree)`ã€`æ•£åˆ—è¡¨(Hash)`ã€`å †(Heap)`ã€`å›¾(Graph)`ã€‚

è€Œæœ¬æ–‡ä¸»è¦è®²è§£çš„å°±æ˜¯ä¸æ•£åˆ—è¡¨ç›¸å…³çš„`HashCode`ï¼Œæœ¬æ¥æƒ³å…ˆè®²`HashMap`ï¼Œä½†éšç€æ•´ç†èµ„æ–™å‘ç°ä¸`HashMap`çš„å®ç°ä¸­ï¼Œ`HashCode`çš„æ•£åˆ—å äº†å¾ˆé‡è¦çš„ä¸€è®¾è®¡æ€è·¯ï¼Œæ‰€ä»¥æœ€å¥½æŠŠè¿™éƒ¨åˆ†çŸ¥è¯†è¡¥å…¨ï¼Œå†å¾€ä¸‹è®²è§£ã€‚

## äºŒã€é¢è¯•é¢˜

è¯´åˆ°HashCodeçš„é¢è¯•é¢˜ï¼Œå¯èƒ½è¿™æ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„äº†ã€‚å…¶ä»–è€ƒç‚¹ï¼›æ€ä¹ˆå®ç°æ•£åˆ—ã€è®¡ç®—é€»è¾‘ç­‰ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™é“é¢˜çš„å­¦ä¹ äº†è§£ç›¸å…³çŸ¥è¯†ã€‚

**Why does Java's hashCode() in String use 31 as a multiplier?**

![](https://bugstack.cn/assets/images/2020/interview/interview-3-01.png)

**è¿™ä¸ªé—®é¢˜å…¶å®â˜æŒ‡çš„å°±æ˜¯ï¼ŒhashCodeçš„è®¡ç®—é€»è¾‘ä¸­ï¼Œä¸ºä»€ä¹ˆæ˜¯31ä½œä¸ºä¹˜æ•°ã€‚**

![](https://bugstack.cn/assets/images/2020/interview/interview-3-02.png)

## ä¸‰ã€èµ„æºä¸‹è½½

æœ¬æ–‡è®²è§£çš„è¿‡ç¨‹ä¸­æ¶‰åŠéƒ¨åˆ†æºç ç­‰èµ„æºï¼Œå¯ä»¥é€šè¿‡å…³æ³¨å…¬ä¼—å·ï¼š[`bugstackè™«æ´æ ˆ`](https://bugstack.cn/assets/images/qrcode.png)ï¼Œå›å¤ä¸‹è½½è¿›è¡Œè·å–{*å›å¤ä¸‹è½½åæ‰“å¼€è·å¾—çš„é“¾æ¥ï¼Œæ‰¾åˆ°ç¼–å·IDï¼š19*}ï¼ŒåŒ…æ‹¬ï¼›

1. HashCode æºç æµ‹è¯•éªŒè¯å·¥ç¨‹ï¼Œ`interview-03`
2. **103976ä¸ªè‹±è¯­å•è¯åº“.txt**ï¼ŒéªŒè¯HashCodeå€¼
3. **HashCodeæ•£åˆ—åˆ†å¸ƒ.xlsx**ï¼Œæ•£åˆ—å’Œç¢°æ’å›¾è¡¨

## å››ã€æºç è®²è§£

### 1. å›ºå®šä¹˜ç§¯31åœ¨è¿™ç”¨åˆ°äº†

```java
// è·å–hashCode "abc".hashCode();
public int hashCode() {
    int h = hash;
    if (h == 0 && value.length > 0) {
        char val[] = value;
        for (int i = 0; i < value.length; i++) {
            h = 31 * h + val[i];
        }
        hash = h;
    }
    return h;
}
```

åœ¨è·å–`hashCode`çš„æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªå›ºå®šå€¼`31`ï¼Œåœ¨forå¾ªç¯æ¯æ¬¡æ‰§è¡Œæ—¶è¿›è¡Œä¹˜ç§¯è®¡ç®—ï¼Œå¾ªç¯åçš„å…¬å¼å¦‚ä¸‹ï¼›
`s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]`

**é‚£ä¹ˆè¿™é‡Œä¸ºä»€ä¹ˆé€‰æ‹©31ä½œä¸ºä¹˜ç§¯å€¼å‘¢ï¼Ÿ**

### 2. æ¥è‡ªstackoverflowçš„å›ç­”

åœ¨`stackoverflow`å…³äºä¸ºä»€ä¹ˆé€‰æ‹©31ä½œä¸ºå›ºå®šä¹˜ç§¯å€¼ï¼Œæœ‰ä¸€ç¯‡è®¨è®ºæ–‡ç« ï¼Œ[Why does Java's hashCode() in String use 31 as a multiplier?](https://stackoverflow.com/questions/299304/why-does-javas-hashcode-in-string-use-31-as-a-multiplier) è¿™æ˜¯ä¸€ä¸ªæ—¶é—´æ¯”è¾ƒä¹…çš„é—®é¢˜äº†ï¼Œæ‘˜å–ä¸¤ä¸ªå›ç­”ç‚¹èµæœ€å¤šçš„ï¼›

**413ä¸ªèµğŸ‘çš„å›ç­”**

æœ€å¤šçš„è¿™ä¸ªå›ç­”æ˜¯æ¥è‡ªã€ŠEffective Javaã€‹çš„å†…å®¹ï¼›

```java
The value 31 was chosen because it is an odd prime. If it were even and the multiplication overflowed, information would be lost, as multiplication by 2 is equivalent to shifting. The advantage of using a prime is less clear, but it is traditional. A nice property of 31 is that the multiplication can be replaced by a shift and a subtraction for better performance: 31 * i == (i << 5) - i. Modern VMs do this sort of optimization automatically.
```

è¿™æ®µå†…å®¹ä¸»è¦é˜è¿°çš„è§‚ç‚¹åŒ…æ‹¬ï¼›
1. 31 æ˜¯ä¸€ä¸ªå¥‡è´¨æ•°ï¼Œå¦‚æœé€‰æ‹©å¶æ•°ä¼šå¯¼è‡´ä¹˜ç§¯è¿ç®—æ—¶æ•°æ®æº¢å‡ºã€‚
2. å¦å¤–åœ¨äºŒè¿›åˆ¶ä¸­ï¼Œ2ä¸ª5æ¬¡æ–¹æ˜¯32ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯ `31 * i == (i << 5) - i`ã€‚è¿™ä¸»è¦æ˜¯è¯´ä¹˜ç§¯è¿ç®—å¯ä»¥ä½¿ç”¨ä½ç§»æå‡æ€§èƒ½ï¼ŒåŒæ—¶ç›®å‰çš„JVMè™šæ‹Ÿæœºä¹Ÿä¼šè‡ªåŠ¨æ”¯æŒæ­¤ç±»çš„ä¼˜åŒ–ã€‚

**80ä¸ªèµğŸ‘çš„å›ç­”**

```java
As Goodrich and Tamassia point out, If you take over 50,000 English words (formed as the union of the word lists provided in two variants of Unix), using the constants 31, 33, 37, 39, and 41 will produce less than 7 collisions in each case. Knowing this, it should come as no surprise that many Java implementations choose one of these constants.
```

- è¿™ä¸ªå›ç­”å°±å¾ˆæœ‰å®æˆ˜æ„ä¹‰äº†ï¼Œå‘Šè¯‰ä½ ç”¨è¶…è¿‡5ä¸‡ä¸ªå•è¯è®¡ç®—hashCodeï¼Œè¿™ä¸ªhashCodeçš„è¿ç®—ä½¿ç”¨31ã€33ã€37ã€39å’Œ41ä½œä¸ºä¹˜ç§¯ï¼Œå¾—åˆ°çš„ç¢°æ’ç»“æœï¼Œ31è¢«ä½¿ç”¨å°±å¾ˆæ­£å¸¸äº†ã€‚
- **ä»–è¿™å¥è¯å°±å°±å¯ä»¥ä½œä¸ºæˆ‘ä»¬å®è·µçš„æŒ‡å‘äº†ã€‚**

### 3. Hashå€¼ç¢°æ’æ¦‚ç‡ç»Ÿè®¡

æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…å¹¶ä¸éš¾ï¼Œåªæ˜¯æ ¹æ®`stackoverflow`çš„å›ç­”ï¼Œç»Ÿè®¡å‡ºä¸åŒçš„ä¹˜ç§¯æ•°å¯¹10ä¸‡ä¸ªå•è¯çš„hashè®¡ç®—ç»“æœã€‚*10ä¸ªå•è¯è¡¨å·²æä¾›ï¼Œå¯ä»¥é€šè¿‡å…³æ³¨å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆè¿›è¡Œä¸‹è½½*

#### 3.1 è¯»å–å•è¯å­—å…¸è¡¨

```java
1	a	"n.(A)As æˆ– A's  å®‰(ampere(a) art.ä¸€;n.å­—æ¯A /[å†›] Analog.Digital,æ¨¡æ‹Ÿ/æ•°å­— /(=account of) å¸ä¸Š"
2	aaal	American Academy of Arts and Letters ç¾å›½è‰ºæœ¯å’Œæ–‡å­¦å­¦ä¼š
3	aachen	 äºšç›[å¾·æ„å¿—è”é‚¦å…±å’Œå›½è¥¿éƒ¨åŸå¸‚]
4	aacs	Airways and Air Communications Service (ç¾å›½)èˆªè·¯ä¸èˆªç©ºé€šè®¯è”ç»œå¤„
5	aah	" [å†›]Armored Artillery Howitzer,è£…ç”²æ¦´å¼¹ç‚®;[å†›]Advanced Attack Helicopter,å…ˆè¿›æ”»å‡»ç›´å‡æœº"
6	aal	"ATM Adaptation Layer,ATMé€‚åº”å±‚"
7	aapamoor	"n.[ç”Ÿ]ä¸˜æ³½,é«˜ä½ä½é•¶åµŒæ²¼æ³½"
```

- å•è¯è¡¨çš„æ–‡ä»¶æ ¼å¼å¦‚ä¸Šï¼Œå¯ä»¥è‡ªè¡Œè§£æ
- è¯»å–æ–‡ä»¶çš„ä»£ç æ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œä¸å±•ç¤ºäº†ï¼Œå¯ä»¥é€šè¿‡`èµ„æºä¸‹è½½`è¿›è¡Œè·å–

#### 3.2 Hashè®¡ç®—å‡½æ•°

```java
public static Integer hashCode(String str, Integer multiplier) {
    int hash = 0;
    for (int i = 0; i < str.length(); i++) {
        hash = multiplier * hash + str.charAt(i);
    }
    return hash;
}
```

- è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä¸åŸhashå‡½æ•°å¯¹æ¯”åªæ˜¯æ›¿æ¢äº†å¯å˜å‚æ•°ï¼Œç”¨äºæˆ‘ä»¬ç»Ÿè®¡ä¸åŒä¹˜ç§¯æ•°çš„è®¡ç®—ç»“æœã€‚

#### 3.3 Hashç¢°æ’æ¦‚ç‡è®¡ç®—

æƒ³è®¡ç®—ç¢°æ’å¾ˆç®€å•ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—é‚£äº›å‡ºç°ç›¸åŒå“ˆå¸Œå€¼çš„æ•°é‡ï¼Œè®¡ç®—å‡ºç¢°æ’æ€»é‡å³å¯ã€‚è¿™é‡Œçš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥ä½¿ç”¨`set`ã€`map`ä¹Ÿå¯ä»¥ä½¿ç”¨`java8`çš„`stream`æµç»Ÿè®¡`distinct`ã€‚

```java
private static RateInfo hashCollisionRate(Integer multiplier, List<Integer> hashCodeList) {
    int maxHash = hashCodeList.stream().max(Integer::compareTo).get();
    int minHash = hashCodeList.stream().min(Integer::compareTo).get();
    int collisionCount = (int) (hashCodeList.size() - hashCodeList.stream().distinct().count());
    double collisionRate = (collisionCount * 1.0) / hashCodeList.size();
    return new RateInfo(maxHash, minHash, multiplier, collisionCount, collisionRate);
}
```

- è¿™é‡Œè®°å½•äº†æœ€å¤§hashå’Œæœ€å°hashå€¼ï¼Œä»¥åŠæœ€ç»ˆè¿”å›ç¢°æ’æ•°é‡çš„ç»Ÿè®¡ç»“æœã€‚

#### 3.4 å•å…ƒæµ‹è¯•

```java
@Before
public void before() {
    "abc".hashCode();
    // è¯»å–æ–‡ä»¶ï¼Œ103976ä¸ªè‹±è¯­å•è¯åº“.txt
    words = FileUtil.readWordList("E:/itstack/git/github.com/interview/interview-01/103976ä¸ªè‹±è¯­å•è¯åº“.txt");
}

@Test
public void test_collisionRate() {
    List<RateInfo> rateInfoList = HashCode.collisionRateList(words, 2, 3, 5, 7, 17, 31, 32, 33, 39, 41, 199);
    for (RateInfo rate : rateInfoList) {
        System.out.println(String.format("ä¹˜æ•° = %4d, æœ€å°Hash = %11d, æœ€å¤§Hash = %10d, ç¢°æ’æ•°é‡ =%6d, ç¢°æ’æ¦‚ç‡ = %.4f%%", rate.getMultiplier(), rate.getMinHash(), rate.getMaxHash(), rate.getCollisionCount(), rate.getCollisionRate() * 100));
    }
}
```

- ä»¥ä¸Šå…ˆè®¾å®šè¯»å–è‹±æ–‡å•è¯è¡¨ä¸­çš„10ä¸ªå•è¯ï¼Œä¹‹ååšhashè®¡ç®—ã€‚
- åœ¨hashè®¡ç®—ä¸­æŠŠå•è¯è¡¨ä¼ é€’è¿›å»ï¼ŒåŒæ—¶è¿˜æœ‰ä¹˜ç§¯æ•°ï¼›`2, 3, 5, 7, 17, 31, 32, 33, 39, 41, 199`ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªlistç»“æœå¹¶è¾“å‡ºã€‚
- è¿™é‡Œä¸»è¦éªŒè¯åŒä¸€æ‰¹å•è¯ï¼Œå¯¹äºä¸åŒä¹˜ç§¯æ•°ä¼šæœ‰æ€ä¹ˆæ ·çš„hashç¢°æ’ç»“æœã€‚

**æµ‹è¯•ç»“æœ**

```java
å•è¯æ•°é‡ï¼š103976
ä¹˜æ•° =    2, æœ€å°Hash =          97, æœ€å¤§Hash = 1842581979, ç¢°æ’æ•°é‡ = 60382, ç¢°æ’æ¦‚ç‡ = 58.0730%
ä¹˜æ•° =    3, æœ€å°Hash = -2147308825, æœ€å¤§Hash = 2146995420, ç¢°æ’æ•°é‡ = 24300, ç¢°æ’æ¦‚ç‡ = 23.3708%
ä¹˜æ•° =    5, æœ€å°Hash = -2147091606, æœ€å¤§Hash = 2147227581, ç¢°æ’æ•°é‡ =  7994, ç¢°æ’æ¦‚ç‡ = 7.6883%
ä¹˜æ•° =    7, æœ€å°Hash = -2147431389, æœ€å¤§Hash = 2147226363, ç¢°æ’æ•°é‡ =  3826, ç¢°æ’æ¦‚ç‡ = 3.6797%
ä¹˜æ•° =   17, æœ€å°Hash = -2147238638, æœ€å¤§Hash = 2147101452, ç¢°æ’æ•°é‡ =   576, ç¢°æ’æ¦‚ç‡ = 0.5540%
ä¹˜æ•° =   31, æœ€å°Hash = -2147461248, æœ€å¤§Hash = 2147444544, ç¢°æ’æ•°é‡ =     2, ç¢°æ’æ¦‚ç‡ = 0.0019%
ä¹˜æ•° =   32, æœ€å°Hash = -2007883634, æœ€å¤§Hash = 2074238226, ç¢°æ’æ•°é‡ = 34947, ç¢°æ’æ¦‚ç‡ = 33.6106%
ä¹˜æ•° =   33, æœ€å°Hash = -2147469046, æœ€å¤§Hash = 2147378587, ç¢°æ’æ•°é‡ =     1, ç¢°æ’æ¦‚ç‡ = 0.0010%
ä¹˜æ•° =   39, æœ€å°Hash = -2147463635, æœ€å¤§Hash = 2147443239, ç¢°æ’æ•°é‡ =     0, ç¢°æ’æ¦‚ç‡ = 0.0000%
ä¹˜æ•° =   41, æœ€å°Hash = -2147423916, æœ€å¤§Hash = 2147441721, ç¢°æ’æ•°é‡ =     1, ç¢°æ’æ¦‚ç‡ = 0.0010%
ä¹˜æ•° =  199, æœ€å°Hash = -2147459902, æœ€å¤§Hash = 2147480320, ç¢°æ’æ•°é‡ =     0, ç¢°æ’æ¦‚ç‡ = 0.0000%

Process finished with exit code 0
```

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œhashç¢°æ’å›¾è¡¨](https://bugstack.cn/assets/images/2020/interview/interview-3-03.png)

ä»¥ä¸Šå°±æ˜¯ä¸åŒçš„ä¹˜æ•°ä¸‹çš„hashç¢°æ’ç»“æœå›¾æ ‡å±•ç¤ºï¼Œä»è¿™é‡Œå¯ä»¥çœ‹å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼›
1. ä¹˜æ•°æ˜¯2æ—¶ï¼Œhashçš„å–å€¼èŒƒå›´æ¯”è¾ƒå°ï¼ŒåŸºæœ¬æ˜¯å †ç§¯åˆ°ä¸€ä¸ªèŒƒå›´å†…äº†ï¼Œåé¢å†…å®¹ä¼šçœ‹åˆ°è¿™å—çš„å±•ç¤ºã€‚
2. ä¹˜æ•°æ˜¯3ã€5ã€7ã€17ç­‰ï¼Œéƒ½æœ‰è¾ƒå¤§çš„ç¢°æ’æ¦‚ç‡
3. **ä¹˜æ•°æ˜¯31çš„æ—¶å€™ï¼Œç¢°æ’çš„æ¦‚ç‡å·²ç»å¾ˆå°äº†ï¼ŒåŸºæœ¬ç¨³å®šã€‚**
4. é¡ºç€å¾€ä¸‹çœ‹ï¼Œä½ ä¼šå‘ç°199çš„ç¢°æ’æ¦‚ç‡æ›´å°ï¼Œè¿™å°±ç›¸å½“äºä¸€æ’å¥‡æ•°çš„èŒ…å‘é‡å¤šï¼Œè‡ªç„¶ä¼šå‡å°‘ç¢°æ’ã€‚**ä½†è¿™ä¸ªèŒƒå›´å€¼å·²ç»è¿œè¶…è¿‡intçš„å–å€¼èŒƒå›´äº†ï¼Œå¦‚æœç”¨æ­¤æ•°ä½œä¸ºä¹˜æ•°ï¼Œåˆè¿”å›intå€¼ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ä¿¡æ¯**ã€‚

### 4. Hashå€¼æ•£åˆ—åˆ†å¸ƒ

é™¤äº†ä»¥ä¸Šçœ‹åˆ°å“ˆå¸Œå€¼åœ¨ä¸åŒä¹˜æ•°çš„ä¸€ä¸ªç¢°æ’æ¦‚ç‡åï¼Œå…³äºæ•£åˆ—è¡¨ä¹Ÿå°±æ˜¯hashï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ï¼Œé‚£å°±æ˜¯è¦å°½å¯èƒ½çš„è®©æ•°æ®æ•£åˆ—åˆ†å¸ƒã€‚åªæœ‰è¿™æ ·æ‰èƒ½å‡å°‘hashç¢°æ’æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯åé¢ç« èŠ‚è¦è®²åˆ°çš„hashMapæºç ã€‚

é‚£ä¹ˆæ€ä¹ˆçœ‹æ•£åˆ—åˆ†å¸ƒå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬èƒ½æŠŠ10ä¸‡ä¸ªhashå€¼é“ºåˆ°å›¾è¡¨ä¸Šï¼Œå½¢æˆçš„ä¸€å¼ å›¾ï¼Œå°±å¯ä»¥çœ‹å‡ºæ•´ä¸ªæ•£åˆ—åˆ†å¸ƒã€‚ä½†æ˜¯è¿™æ ·çš„å›¾ä¼šæ¯”è¾ƒå¤§ï¼Œå½“æˆ‘ä»¬ç¼©å°çœ‹åï¼Œå°±æˆä¸€ä¸ªäº†å¤§é»‘ç‚¹ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬é‡‡å–åˆ†æ®µç»Ÿè®¡ï¼ŒæŠŠ2 ^ 32æ–¹åˆ†64ä¸ªæ ¼å­è¿›è¡Œå­˜æ”¾ï¼Œæ¯ä¸ªæ ¼å­éƒ½ä¼šæœ‰å¯¹åº”çš„æ•°é‡çš„hashå€¼ï¼Œæœ€ç»ˆæŠŠè¿™äº›æ•°æ®å±•ç¤ºåœ¨å›¾è¡¨ä¸Šã€‚

#### 4.1 å“ˆå¸Œå€¼åˆ†æ®µå­˜æ”¾

```java
public static Map<Integer, Integer> hashArea(List<Integer> hashCodeList) {
    Map<Integer, Integer> statistics = new LinkedHashMap<>();
    int start = 0;
    for (long i = 0x80000000; i <= 0x7fffffff; i += 67108864) {
        long min = i;
        long max = min + 67108864;
        // ç­›é€‰å‡ºæ¯ä¸ªæ ¼å­é‡Œçš„å“ˆå¸Œå€¼æ•°é‡ï¼Œjava8æµç»Ÿè®¡ï¼›https://bugstack.cn/itstack-demo-any/2019/12/10/%E6%9C%89%E7%82%B9%E5%B9%B2%E8%B4%A7-Jdk1.8%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%9E%E6%88%98%E7%AF%87(41%E4%B8%AA%E6%A1%88%E4%BE%8B).html
        int num = (int) hashCodeList.parallelStream().filter(x -> x >= min && x < max).count();
        statistics.put(start++, num);
    }
    return statistics;
```

- è¿™ä¸ªè¿‡ç¨‹ä¸»è¦ç»Ÿè®¡`int`å–å€¼èŒƒå›´å†…ï¼Œæ¯ä¸ªå“ˆå¸Œå€¼å­˜æ”¾åˆ°ä¸åŒæ ¼å­é‡Œçš„æ•°é‡ã€‚
- è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨äº†java8çš„æ–°ç‰¹æ€§è¯­æ³•ï¼Œç»Ÿè®¡èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚

#### 4.2 å•å…ƒæµ‹è¯•

```java
@Test
public void test_hashArea() {
    System.out.println(HashCode.hashArea(words, 2).values());
    System.out.println(HashCode.hashArea(words, 7).values());
    System.out.println(HashCode.hashArea(words, 31).values());
    System.out.println(HashCode.hashArea(words, 32).values());
    System.out.println(HashCode.hashArea(words, 199).values());
}
```

- è¿™é‡Œåˆ—å‡ºæˆ‘ä»¬è¦ç»Ÿè®¡çš„ä¹˜æ•°å€¼ï¼Œæ¯ä¸€ä¸ªä¹˜æ•°ä¸‹éƒ½ä¼šæœ‰å¯¹åº”çš„å“ˆå¸Œå€¼æ•°é‡æ±‡æ€»ï¼Œä¹Ÿå°±æ˜¯64ä¸ªæ ¼å­é‡Œçš„æ•°é‡ã€‚
- æœ€ç»ˆæŠŠè¿™äº›ç»Ÿè®¡å€¼æ”¾å…¥åˆ°excelä¸­è¿›è¡Œå›¾è¡¨åŒ–å±•ç¤ºã€‚

**ç»Ÿè®¡å›¾è¡¨**

![å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆï¼Œhashæ•£åˆ—è¡¨](https://bugstack.cn/assets/images/2020/interview/interview-3-04.png)

- ä»¥ä¸Šæ˜¯ä¸€ä¸ªå †ç§¯ç™¾åˆ†æ¯”ç»Ÿè®¡å›¾ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹æ–¹æ˜¯ä¸åŒä¹˜æ•°ä¸‹çš„ï¼Œæ¯ä¸ªæ ¼å­é‡Œçš„æ•°æ®ç»Ÿè®¡ã€‚
- é™¤äº†199ä¸èƒ½ç”¨ä»¥å¤–ï¼Œ31çš„æ•£åˆ—ç»“æœç›¸å¯¹æ¥è¯´æ¯”è¾ƒå‡åŒ€ã€‚

##### 4.2.1 ä¹˜æ•°2æ•£åˆ—

![](https://bugstack.cn/assets/images/2020/interview/interview-3-05.png)

- ä¹˜æ•°æ˜¯2çš„æ—¶å€™ï¼Œæ•£åˆ—çš„ç»“æœåŸºæœ¬éƒ½å †ç§¯åœ¨ä¸­é—´ï¼Œæ²¡æœ‰å¾ˆå¥½çš„æ•£åˆ—ã€‚

##### 4.2.2 ä¹˜æ•°31æ•£åˆ—

![](https://bugstack.cn/assets/images/2020/interview/interview-3-06.png)

- ä¹˜æ•°æ˜¯31çš„æ—¶å€™ï¼Œæ•£åˆ—çš„æ•ˆæœå°±éå¸¸æ˜æ˜¾äº†ï¼ŒåŸºæœ¬åœ¨æ¯ä¸ªèŒƒå›´éƒ½æœ‰æ•°æ®å­˜æ”¾ã€‚

##### 4.2.3 ä¹˜æ•°199æ•£åˆ—

![](https://bugstack.cn/assets/images/2020/interview/interview-3-07.png)

- ä¹˜æ•°æ˜¯199æ˜¯ä¸èƒ½ç”¨çš„æ•£åˆ—ç»“æœï¼Œä½†æ˜¯å®ƒçš„æ•°æ®æ˜¯æ›´åŠ åˆ†æ•£çš„ï¼Œä»å›¾ä¸Šèƒ½çœ‹åˆ°æœ‰ä¸¤ä¸ªå°å±±åŒ…ã€‚ä½†å› ä¸ºæ•°æ®åŒºé—´é—®é¢˜ä¼šæœ‰æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œæ‰€ä»¥ä¸èƒ½é€‰æ‹©ã€‚

**æ–‡ä¸­å¼•ç”¨**
- http://www.tianxiaobo.com/2018/01/18/String-hashCode-%E6%96%B9%E6%B3%95%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9%E6%95%B0%E5%AD%9731%E4%BD%9C%E4%B8%BA%E4%B9%98%E5%AD%90/
- https://stackoverflow.com/questions/299304/why-does-javas-hashcode-in-string-use-31-as-a-multiplier

## äº”ã€æ€»ç»“

- ä»¥ä¸Šä¸»è¦ä»‹ç»äº†hashCodeé€‰æ‹©31ä½œä¸ºä¹˜æ•°çš„ä¸»è¦åŸå› å’Œå®éªŒæ•°æ®éªŒè¯ï¼Œç®—æ˜¯ä¸€ä¸ªæ•£åˆ—çš„æ•°æ®ç»“æ„çš„æ¡ˆä¾‹è®²è§£ï¼Œåœ¨åç»­çš„ç±»ä¼¼æŠ€æœ¯ä¸­ï¼Œå°±å¯ä»¥è§£é‡Šå…¶ä»–çš„æºç è®¾è®¡æ€è·¯äº†ã€‚
- çœ‹è¿‡æœ¬æ–‡è‡³å°‘åº”è¯¥è®©ä½ å¯ä»¥ä»æ ¹æœ¬ä¸Šè§£é‡Šäº†hashCodeçš„è®¾è®¡ï¼Œå…³äºä»–çš„æ‰€æœ‰é—®é¢˜ä¹Ÿå°±ä¸éœ€è¦æ­»è®°ç¡¬èƒŒäº†ï¼Œå­¦ä¹ ç¼–ç¨‹å†…å®¹é™¤äº†æœ€å¼€å§‹çš„æ¨¡ä»¿åˆ°æ·±å…¥ä»¥åå°±éœ€è¦ä¸æ–­çš„ç ”ç©¶æ•°å­¦é€»è¾‘å’Œæ•°æ®ç»“æ„ã€‚
- æ–‡ä¸­å‚è€ƒäº†ä¼˜ç§€çš„hashCodeèµ„æ–™å’Œstackoverflowï¼Œå¹¶äº²è‡ªåšå®éªŒéªŒè¯ç»“æœï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ä¸‹è½½æœ¬æ–‡ä¸­èµ„æºå†…å®¹ï¼›è‹±æ–‡å­—å…¸ã€æºç ã€excelå›¾è¡¨ç­‰å†…å®¹ã€‚

