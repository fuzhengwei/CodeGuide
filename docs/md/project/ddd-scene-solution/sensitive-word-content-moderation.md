---
title: æ•æ„Ÿè¯å†…å®¹å®¡æ ¸
lock: need
---

# ã€å°åœºæ™¯è®­ç»ƒè¥ã€‘æ•æ„Ÿè¯å†…å®¹å®¡æ ¸ â€”â€” å¦‚æœä½ çš„è®ºå›è¢«äººä¹±ç•™è¨€æ€ä¹ˆåŠï¼Ÿ

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=580977065&bvid=BV1W64y1K7K4&cid=1399327344&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

å“ˆå–½ï¼Œå¤§å®¶å¥½æˆ‘æ˜¯æŠ€æœ¯UPä¸»å°å‚…å“¥ã€‚

å¸¸å¬åˆ°ä¸€å¥è¯ï¼šâ€ä½ å¾ˆéš¾èµšåˆ°ä½ è®¤çŸ¥ä»¥å¤–çš„é’±ğŸ’°â€œï¼Œå±ï¼ä¸æ˜¯å¾ˆéš¾ï¼Œæ˜¯å‹æ ¹èµšä¸åˆ°ã€‚ä½ ä»¥ä¸ºè¦æ˜¯ä½ åšä¹Ÿèƒ½åšï¼Œä½†å…¶å®é™¤äº†ä½ èƒ½çœ‹è§çš„ä»¥å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿éƒ½ä¸çŸ¥é“ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/article/project/chatgpt/chatgpt-extra-230905-01.png?raw=true" width="250px">
</div>

æˆ‘çœ‹è¿‡ä¸å°‘å°ä¼™ä¼´è‡ªå·±ä¸Šçº¿è¿‡å¸¦æœ‰è¯„è®ºåŠŸèƒ½çš„åšå®¢ï¼Œæˆ–æ˜¯èƒ½è¿›è¡Œé€šä¿¡çš„èŠå¤©å®¤ã€‚ä½†æœ€åéƒ½æ²¡è¿è¥å¤šä¹…å°±å…³åœäº†ï¼Œé™¤äº†èƒ½èŠ±é’±è§£å†³çš„æœåŠ¡å™¨æˆæœ¬ï¼Œè¿˜æœ‰æ˜¯è‡ªèº«çš„ç ”å‘çš„ç³»ç»Ÿæµç¨‹ä¸å¤Ÿå¥å…¨ã€‚å…¶ä¸­éå¸¸é‡è¦çš„ä¸€ç‚¹æ˜¯`èˆ†æƒ…æ•æ„Ÿå†…å®¹`çš„å®¡æ ¸ï¼Œå¦‚æœä½ åšè¿™ç±»åº”ç”¨çš„å¤„ç†ï¼Œä¸€å®šè¦å¯¹æ¥ä¸Šç›¸åº”çš„å†…å®¹å®‰å…¨å®¡æ ¸ã€‚

é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°å‚…å“¥å°±ç»™å¤§å®¶åˆ†äº«ä¸‹ï¼Œå¦‚ä½•å¯¹æ¥å†…å®¹å®‰å…¨å®¡æ ¸ï¼Œå¹¶åœ¨ DDD åˆ†å±‚ç»“æ„ä¸‹å®ç°ä¸€ä¸ªå¯¹åº”çš„è§„åˆ™è¿‡æ»¤æœåŠ¡ã€‚

>æ–‡æœ«æä¾›äº†ã€Œæ˜Ÿçƒï¼šç å†œä¼šé”ã€ğŸ§§ä¼˜æƒ åŠ å…¥æ–¹å¼ï¼Œä»¥åŠæœ¬èŠ‚è¯¾ç¨‹çš„ä»£ç åœ°å€ã€‚é¡¹ç›®æ¼”ç¤ºåœ°å€ï¼š[https://gaga.plus](https://gaga.plus)

## ä¸€ã€åœºæ™¯è¯´æ˜

åœ¨æœ¬èŠ‚å°å‚…å“¥ä¼šé€šè¿‡ DDD åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå¼€å‘å‡ºä¸€ä¸ªæ•æ„Ÿè¯ã€å†…å®¹å®‰å…¨å®¡æ ¸è¿‡æ»¤æ“ä½œçš„è§„åˆ™å¤„ç†å™¨ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹å¤§å®¶å¯ä»¥å­¦ä¹ åˆ° DDD åˆ†å±‚è°ƒç”¨æµç¨‹ã€è§„åˆ™æ¨¡å‹çš„æ­å»ºã€æ•æ„Ÿè¯å’Œå†…å®¹å®¡æ ¸çš„ä½¿ç”¨ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/article/project/ddd-scene-solution/xfg-dev-tech-content-moderation-01.png?raw=true" width="650px">
</div>

å¦‚å›¾ï¼Œä¸ŠåŠéƒ¨åˆ†æ˜¯ä¸šåŠ¡æµç¨‹ï¼Œä¸‹åŠéƒ¨åˆ†æ˜¯ DDD åˆ†å±‚ç»“æ„ä¸­çš„å®ç°ã€‚

1. ä¸šåŠ¡æµç¨‹ä¸Šï¼Œä»¥ç”¨æˆ·å‘é€çš„æäº¤ç»™æœåŠ¡ç«¯çš„å†…å®¹è¿›è¡Œå®¡æ ¸è¿‡æ»¤ï¼Œä¼˜å…ˆä½¿ç”¨æ•æ„Ÿè¯è¿›è¡Œæ›¿æ¢å•è¯ç»„ã€‚è¿‡æ»¤åè¿‡å†…å®¹å®¡æ ¸ï¼Œä¸€èˆ¬å„ä¸ªäº‘å¹³å°éƒ½æœ‰æä¾›å†…å®¹å®¡æ ¸çš„æ¥å£ï¼Œå¦‚ï¼›äº¬ä¸œäº‘ã€ç™¾åº¦äº‘ã€è…¾è®¯äº‘éƒ½æœ‰æä¾›ã€‚ä¸€èˆ¬ä»·æ ¼åœ¨ `0.0015 å…ƒ/æ¡`
2. ç³»ç»Ÿå®ç°ä¸Šï¼Œä»¥ DDD åˆ†å±‚æ¶æ„å®ç°ä¸€ä¸ªå†…å®¹å®¡æ ¸çš„æµç¨‹ã€‚app é…ç½®ç»„ä»¶å’Œå¯åŠ¨åº”ç”¨ã€trigger æä¾› http è°ƒç”¨ã€domain ç¼–å†™æ ¸å¿ƒé€»è¾‘å’Œæµç¨‹ã€infrastructure æä¾› dao çš„åŸºç¡€æ“ä½œã€‚

## äºŒã€å†…å®¹å®¡æ ¸ - SDK ä½¿ç”¨

ä¸€èˆ¬èˆ†æƒ…å†…å®¹å®¡æ ¸åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯é™æ€é…ç½®æ•°æ®çš„ SDK ç»„ä»¶ï¼Œä¹Ÿå«æ•æ„Ÿè¯è¿‡æ»¤ã€‚å¦å¤–ä¸€ç§æ˜¯å®æ—¶åŠ¨æ€çš„ç”±å„ä¸ªç¬¬ä¸‰æ–¹æä¾›çš„å†…å®¹å®¡æ ¸æ¥å£æœåŠ¡ã€‚è¿™ç±»çš„å°±æ˜¯å‰é¢æåˆ°çš„ï¼Œåœ¨å„ä¸ªäº‘å¹³å°éƒ½æœ‰æä¾›ã€‚

è¿™é‡Œå°å‚…å“¥å…ˆå¸¦ç€å¤§å®¶åšä¸‹æœ€åŸºæœ¬çš„è°ƒç”¨æ¡ˆä¾‹ï¼Œä¹‹åå†åŸºäº DDD å·¥ç¨‹å®ç°æ•´ä¸ªä»£ç å¼€å‘ã€‚

### 1. æ•æ„Ÿè¯

**åœ°å€**ï¼š[https://github.com/houbb/sensitive-word](https://github.com/houbb/sensitive-word) - å¼€æºçš„æ•æ„Ÿè¯åº“ç»„ä»¶

```pom
<dependency>
    <groupId>com.github.houbb</groupId>
    <artifactId>sensitive-word</artifactId>
    <version>0.8.0</version>
</dependency>
```

**æ¡ˆä¾‹ä»£ç **

```java
@Test
public void test_sensitive_word() {
    boolean contains = sensitiveWordBs.contains("å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤è‡­æ¯›è›‹ï¼Œè±†åŒ…çˆ±åƒç²‘ç²‘ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878");
    log.info("æ˜¯å¦è¢«æ•æ„Ÿè¯æ‹¦æˆªï¼š{}", contains);
}

@Test
public void test_sensitive_word_findAll() {
    List<String> list = sensitiveWordBs.findAll("å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤è‡­æ¯›è›‹ï¼Œè±†åŒ…çˆ±åƒç²‘ç²‘ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878");
    log.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(list));
}

@Test
public void test_sensitive_word_replace() {
    String replace = sensitiveWordBs.replace("å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤è‡­æ¯›è›‹ï¼Œè±†åŒ…çˆ±åƒç²‘ç²‘ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878");
    log.info("æµ‹è¯•ç»“æœï¼š{}", replace);
}
```

- æ•æ„Ÿè¯ç»„ä»¶æä¾›äº†å¤§é‡çš„é£é™©è¯è¿‡æ»¤ï¼ŒåŒæ—¶å¯ä»¥åŸºäºç»„ä»¶çš„æ–‡æ¡£å®Œæˆè‡ªå®šä¹‰æ•æ„Ÿè¯çš„å¢æ”¹åˆ å‡æ“ä½œã€‚`æœ¬æ–‡åœ¨å·¥ç¨‹ä¸­å·²æä¾›`
- æ•æ„Ÿè¯ç»„ä»¶æä¾›äº†åˆ¤æ–­ã€æŸ¥æ‰¾ã€è¿‡æ»¤æ“ä½œã€‚è¿˜æœ‰ä½ å¯ä»¥æŠŠæ£€æµ‹åˆ°çš„æ•æ„Ÿè¯æ›¿æ¢ä¸º `*` æˆ–è€…`ç©ºæ ¼`ã€‚

### 2. å†…å®¹å®¡æ ¸

- äº¬ä¸œäº‘ï¼š[https://www.jdcloud.com/cn/products/censor](https://www.jdcloud.com/cn/products/censor)
- ç™¾åº¦äº‘ï¼š[https://ai.baidu.com/censoring#/strategylist](https://ai.baidu.com/censoring#/strategylist)
- è…¾è®¯äº‘ï¼š[https://cloud.tencent.com/product/tms](https://cloud.tencent.com/product/tms)

è¿™é‡Œå°å‚…å“¥ä»¥å…¶ä¸­çš„ä¸€ä¸ªç™¾åº¦äº‘ä¸ºä¾‹ï¼Œä¸ºå¤§å®¶å±•ç¤ºå†…å®¹å®‰å…¨å®¡æ ¸çš„ä½¿ç”¨ã€‚

```pom
<!-- ç™¾åº¦å†…å®¹å®¡æ ¸ https://mvnrepository.com/artifact/com.baidu.aip/java-sdk -->
<dependency>
    <groupId>com.baidu.aip</groupId>
    <artifactId>java-sdk</artifactId>
    <version>4.16.17</version>
</dependency>
```

#### 2.1 é…ç½®åº”ç”¨

<div align="center">
    <img src="https://bugstack.cn/images/article/project/ddd-scene-solution/xfg-dev-tech-content-moderation-02.png?raw=true" width="650px">
</div>

- å…ˆé¢†å–å…è´¹çš„è°ƒç”¨æ¬¡æ•°ï¼Œä¹‹ååˆ›å»ºåº”ç”¨ã€‚åˆ›å»ºåº”ç”¨åå°±å¯ä»¥è·å¾—è¿æ¥ä¿¡æ¯ï¼›appidã€apikeyã€secretkey 
- å¦å¤–æ˜¯ç­–ç•¥é…ç½®ï¼Œå¦‚æœä½ åœ¨è¿‡æ»¤ä¸­ä¸éœ€è¦æ£€æµ‹ç”¨æˆ·å‘çš„åº”ç”¨è¥é”€ä¿¡æ¯ï¼Œé‚£ä¹ˆæ˜¯å¯ä»¥ä¸æ£€æµ‹çš„ã€‚

#### 2.2 æµ‹è¯•æœåŠ¡

```java
//è®¾ç½®APPID/AK/SK
public static final String APP_ID = "{APP_ID}";
public static final String API_KEY = "{API_KEY}";
public static final String SECRET_KEY = "{SECRET_KEY}";
private AipContentCensor client;

@Before
public void init() {
    client = new AipContentCensor(APP_ID, API_KEY, SECRET_KEY);
    // å¯é€‰ï¼šè®¾ç½®ç½‘ç»œè¿æ¥å‚æ•°
    client.setConnectionTimeoutInMillis(2000);
    client.setSocketTimeoutInMillis(60000);
}

@Test
public void test_textCensorUserDefined() throws JSONException {
    for (int i = 0; i < 1; i++) {
        JSONObject jsonObject = client.textCensorUserDefined("å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤è‡­æ¯›è›‹ï¼Œè±†åŒ…çˆ±åƒç²‘ç²‘ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878");
        if (!jsonObject.isNull("error_code")) {
            log.info("æµ‹è¯•ç»“æœï¼š{}", jsonObject.get("error_code"));
        } else {
            log.info("æµ‹è¯•ç»“æœï¼š{}", jsonObject.toString());
        }
    }
}
```

**æµ‹è¯•ç»“æœ**

```java
13:41:16.393 [main] INFO com.baidu.aip.client.BaseClient - get access_token success. current state: STATE_AIP_AUTH_OK
13:41:16.396 [main] DEBUG com.baidu.aip.client.BaseClient - current state after check priviledge: STATE_TRUE_AIP_USER
13:41:16.495 [main] INFO cn.bugstack.x.api.test.BaiduAipContentCensorTest - æµ‹è¯•ç»“æœï¼š{"conclusion":"åˆè§„","log_id":17046060767025067,"isHitMd5":false,"conclusionType":1}
```

- åº”ä¸ºè¿‡æ»¤æ‰äº†è¥é”€ä¿¡æ¯ï¼Œæ¯”å¦‚æ‰‹æœºå·ã€‚é‚£ä¹ˆå°±ä¼šè¿”å›`åˆè§„`

## ä¸‰ã€åº”ç”¨å®ç° - DDD æ¶æ„

åšäº†ä»¥ä¸Šçš„åŸºæœ¬è°ƒç”¨æ¡ˆä¾‹ä»¥åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨ç³»ç»Ÿä¸­æ€ä¹ˆè¿ç”¨è¿™äº›åŸºç¡€åŠŸèƒ½å®Œæˆä¸šåŠ¡è¯‰æ±‚ã€‚

### 1. å·¥ç¨‹ç»“æ„

<div align="center">
    <img src="https://bugstack.cn/images/article/project/ddd-scene-solution/xfg-dev-tech-content-moderation-03.png?raw=true" width="450px">
</div>

- docs ä¸‹æä¾›äº† docker å®‰è£… mysql ä»¥åŠåˆå§‹åŒ–æ•°æ®åº“é…ç½®çš„è„šæœ¬ã€‚å› ä¸ºæœ¬æ–‡çš„æ¡ˆä¾‹ï¼Œå¯ä»¥æ»¡è¶³ä½ åœ¨æ•°æ®åº“ä¸­å¢åŠ æ•æ„Ÿè¯é…ç½®ã€‚
- app æ˜¯åº”ç”¨çš„å¯åŠ¨å±‚ï¼Œå¦‚ä¸Šæˆ‘ä»¬æ‰€éœ€çš„æ•æ„Ÿè¯å’Œå†…å®¹å®¡æ ¸ï¼Œéƒ½åœ¨appå±‚ä¸‹é…ç½®å¯åŠ¨å¤„ç†ã€‚
- domain é¢†åŸŸå±‚é€šè¿‡ç­–ç•¥+å·¥å‚ï¼Œå®ç°è§„åˆ™è¿‡æ»¤æœåŠ¡ã€‚

### 2. æ•°æ®åº“è¡¨

<div align="center">
    <img src="https://bugstack.cn/images/article/project/ddd-scene-solution/xfg-dev-tech-content-moderation-04.png?raw=true" width="850px">
</div>

- åœ¨docs æä¾›äº†æ•°æ®åº“åˆå§‹åŒ–çš„è„šæœ¬è¯­å¥ï¼Œä½ å¯ä»¥å¯¼å…¥åˆ°è‡ªå·±çš„æ•°æ®åº“ï¼Œæˆ–è€…ä½¿ç”¨ docker è„šæœ¬å®‰è£…æµ‹è¯•ã€‚â€”â€” æ³¨æ„å·²ç»å®‰è£…è¿‡ mysql å ç”¨äº† 3306 ç«¯å£çš„è¯ï¼Œè®°å¾—ä¿®æ”¹ docker è„šæœ¬å®‰è£… mysql çš„ç«¯å£ã€‚
- é…ç½®åˆ°æ•°æ®åº“ä¸­çš„æ•æ„Ÿè¯æ–¹ä¾¿ç®¡ç†å’Œä½¿ç”¨ï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ redis åšä¸€å±‚ç¼“å­˜ã€‚

### 3. é…ç½®åŠ è½½

#### 3.1 æ•æ„Ÿè¯åˆå§‹åŒ–

```java
@Configuration
public class SensitiveWordConfig {

    @Bean
    public SensitiveWordBs sensitiveWordBs(IWordDeny wordDeny, IWordAllow wordAllow) {
        return SensitiveWordBs.newInstance()
                .wordDeny(wordDeny)
                .wordAllow(wordAllow)
                .ignoreCase(true)
                .ignoreWidth(true)
                .ignoreNumStyle(true)
                .ignoreChineseStyle(true)
                .ignoreEnglishStyle(true)
                .ignoreRepeat(false)
                .enableNumCheck(true)
                .enableEmailCheck(true)
                .enableUrlCheck(true)
                .enableWordCheck(true)
                .numCheckLen(1024)
                .init();
    }

    @Bean
    public IWordDeny wordDeny(ISensitiveWordDao sensitiveWordDao) {
        return new IWordDeny() {
            @Override
            public List<String> deny() {
                return sensitiveWordDao.queryValidSensitiveWordConfig("deny");
            }
        };
    }

    @Bean
    public IWordAllow wordAllow(ISensitiveWordDao sensitiveWordDao) {
        return new IWordAllow() {
            @Override
            public List<String> allow() {
                return sensitiveWordDao.queryValidSensitiveWordConfig("allow");
            }
        };
    }

}
```

- wordDenyã€wordAllow æ˜¯ä¸¤ä¸ªè‡ªå®šä¹‰çš„æ‹¦æˆªå’Œæ”¾è¡Œçš„æ•æ„Ÿè¯åˆ—è¡¨ï¼Œè¿™é‡Œå°å‚…å“¥è®¾è®¡ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ã€‚å¯ä»¥æ–¹ä¾¿åŠ¨æ€çš„ç»´æŠ¤ã€‚

#### 3.2 å†…å®¹å®‰å…¨åˆå§‹åŒ–

```yml
# å†…å®¹å®‰å…¨
baidu:
  aip:
    app_id: 46573000
    api_key: XKOalQOgDBUrvgLBplvu****
    secret_key: kwRh1bEhETYWpq9thzyySdFDPKUk****
```

- è‡ªå®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ç±» AipContentCensorConfigProperties

```java
@Bean
public AipContentCensor aipContentCensor(AipContentCensorConfigProperties properties) {
    AipContentCensor client = new AipContentCensor(properties.getApp_id(), properties.getApi_key(), properties.getSecret_key());
    client.setConnectionTimeoutInMillis(2000);
    client.setSocketTimeoutInMillis(60000);
    return client;
}
```

- è¿™é‡Œæˆ‘ä»¬æ¥ç»Ÿä¸€åˆ›å»º AipContentCensor å¯¹è±¡ï¼Œç”¨äºæœ‰éœ€è¦ä½¿ç”¨çš„åœ°æ–¹å¤„ç†å†…å®¹å®¡æ ¸ã€‚

### 4. è§„åˆ™å®ç°

**æºç ï¼š** `cn.bugstack.xfg.dev.tech.domain.service.IRuleLogicFilter`

```java
public interface IRuleLogicFilter {

    RuleActionEntity<RuleMatterEntity> filter(RuleMatterEntity ruleMatterEntity);

}
```

- å®šä¹‰ä¸€ä¸ªç»Ÿä¸€çš„è§„åˆ™è¿‡æ»¤æ¥å£

#### 4.1 æ•æ„Ÿè¯

```java
@Slf4j
@Component
@LogicStrategy(logicMode = DefaultLogicFactory.LogicModel.SENSITIVE_WORD)
public class SensitiveWordFilter implements IRuleLogicFilter {

    @Resource
    private SensitiveWordBs words;

    @Override
    public RuleActionEntity<RuleMatterEntity> filter(RuleMatterEntity ruleMatterEntity) {
        // æ•æ„Ÿè¯è¿‡æ»¤
        String content = ruleMatterEntity.getContent();
        String replace = words.replace(content);
        // è¿”å›ç»“æœ
        return RuleActionEntity.<RuleMatterEntity>builder()
                .type(LogicCheckTypeVO.SUCCESS)
                .data(RuleMatterEntity.builder().content(replace).build())
                .build();
    }

}
```

#### 4.2 å®‰å…¨å†…å®¹

```java
@Slf4j
@Component
@LogicStrategy(logicMode = DefaultLogicFactory.LogicModel.CONTENT_SECURITY)
public class ContentSecurityFilter implements IRuleLogicFilter {

    @Resource
    private AipContentCensor aipContentCensor;

    @Override
    public RuleActionEntity<RuleMatterEntity> filter(RuleMatterEntity ruleMatterEntity) {
        JSONObject jsonObject = aipContentCensor.textCensorUserDefined(ruleMatterEntity.getContent());
        if (!jsonObject.isNull("conclusion") && "ä¸åˆè§„".equals(jsonObject.get("conclusion"))) {
            return RuleActionEntity.<RuleMatterEntity>builder()
                    .type(LogicCheckTypeVO.REFUSE)
                    .data(RuleMatterEntity.builder().content("å†…å®¹ä¸åˆè§„").build())
                    .build();
        }
        // è¿”å›ç»“æœ
        return RuleActionEntity.<RuleMatterEntity>builder()
                .type(LogicCheckTypeVO.SUCCESS)
                .data(ruleMatterEntity)
                .build();
    }

}
```

### 5. å·¥å‚ä½¿ç”¨

```java
public class DefaultLogicFactory {

    public Map<String, IRuleLogicFilter> logicFilterMap = new ConcurrentHashMap<>();

    public DefaultLogicFactory(List<IRuleLogicFilter> logicFilters) {
        logicFilters.forEach(logic -> {
            LogicStrategy strategy = AnnotationUtils.findAnnotation(logic.getClass(), LogicStrategy.class);
            if (null != strategy) {
                logicFilterMap.put(strategy.logicMode().getCode(), logic);
            }
        });
    }

    public RuleActionEntity<RuleMatterEntity> doCheckLogic(RuleMatterEntity ruleMatterEntity, LogicModel... logics) {
        RuleActionEntity<RuleMatterEntity> entity = null;
        for (LogicModel model : logics) {
            entity = logicFilterMap.get(model.code).filter(ruleMatterEntity);
            if (!LogicCheckTypeVO.SUCCESS.equals(entity.getType())) return entity;
            ruleMatterEntity = entity.getData();
        }
        return entity != null ? entity :
                RuleActionEntity.<RuleMatterEntity>builder()
                        .type(LogicCheckTypeVO.SUCCESS)
                        .data(ruleMatterEntity)
                        .build();
    }
    
}    
```

- å®šä¹‰å‡ºè§„åˆ™çš„ä½¿ç”¨å·¥å‚ï¼Œé€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼æ³¨å…¥å·²ç»å®ç°äº†æ¥å£ IRuleLogicFilter çš„ N ä¸ªè§„åˆ™ï¼Œæ³¨å…¥åˆ° Map ä¸­ `Map<String, IRuleLogicFilter> logicFilterMap`
- doCheckLogic æ ¹æ®å…¥å‚æ¥è¿‡æ»¤éœ€è¦å¤„ç†çš„è§„åˆ™ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°æ¯è¿‡æ»¤ä¸€ä¸ªè§„åˆ™éƒ½ä¼šæŠŠå‚æ•°ç»§ç»­ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè§„åˆ™ç»§ç»­ç­›é€‰ã€‚`æœ‰ç‚¹åƒå±‚å±‚è¿‡ç­›å­çš„æ„Ÿè§‰`

## å››ã€æµ‹è¯•éªŒè¯

1. æµ‹è¯•å‰ç¡®ä¿å·²ç»åˆå§‹åŒ–äº†åº“è¡¨ `docs/dev-ops/sql/xfg-dev-tech-content-moderation.sql`
2. `application-dev.yml` é…ç½®ç™¾åº¦å†…å®¹å®‰å…¨å‚æ•°å’Œæ•°æ®åº“è¿æ¥å‚æ•°ã€‚

### 1. åŠŸèƒ½æµ‹è¯•

```java
@Slf4j
@RunWith(SpringRunner.class)
@SpringBootTest
public class RuleLogicTest {

    @Resource
    private DefaultLogicFactory defaultLogicFactory;

    @Test
    public void test() {
        RuleActionEntity<RuleMatterEntity> entity = defaultLogicFactory.doCheckLogic(
                RuleMatterEntity.builder().content("å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤è‡­æ¯›è›‹ï¼Œè±†åŒ…çˆ±åƒç²‘ç²‘ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878").build(),
                DefaultLogicFactory.LogicModel.SENSITIVE_WORD,
                DefaultLogicFactory.LogicModel.CONTENT_SECURITY
        );
        log.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(entity));
    }

}
```

**æµ‹è¯•ç»“æœ**

```java
24-01-07.14:17:16.988 [main            ] INFO  BaseClient             - get access_token success. current state: STATE_AIP_AUTH_OK
24-01-07.14:17:17.328 [main            ] INFO  RuleLogicTest          - æµ‹è¯•ç»“æœï¼š{"data":{"content":"å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤***ï¼Œè±†åŒ…çˆ±åƒ**ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878"},"type":"SUCCESS"}
```

### 2. æ¥å£æµ‹è¯•

```java
@RequestMapping(value = "sensitive/rule", method = RequestMethod.GET)
public String rule(String content) {
    try {
        log.info("å†…å®¹å®¡æ ¸å¼€å§‹ content: {}", content);
        RuleActionEntity<RuleMatterEntity> entity = defaultLogicFactory.doCheckLogic(RuleMatterEntity.builder().content(content).build(),
                DefaultLogicFactory.LogicModel.SENSITIVE_WORD,
                DefaultLogicFactory.LogicModel.CONTENT_SECURITY
        );
        log.info("å†…å®¹å®¡æ ¸å®Œæˆ content: {}", entity.getData());
        return JSON.toJSONString(entity);
    } catch (Exception e) {
        log.error("å†…å®¹å®¡æ ¸å¼‚å¸¸ content: {}", content, e);
        return "Err!";
    }
}
```

æ¥å£ï¼š`http://localhost:8091/api/v1/content/sensitive/rule?content=å°å‚…å“¥å–œæ¬¢çƒ§çƒ¤è‡­æ¯›è›‹ï¼Œè±†åŒ…çˆ±åƒç²‘ç²‘ï¼Œå¦‚æœæƒ³åƒè®¢è´­è¯·æ‰“ç”µè¯ï¼š13900901878`

<div align="center">
    <img src="https://bugstack.cn/images/article/project/ddd-scene-solution/xfg-dev-tech-content-moderation-05.png?raw=true" width="950px">
</div>

- é‚£ä¹ˆç°åœ¨å°±å¯ä»¥å¯¹å†…å®¹è¿›è¡Œå®¡æ ¸è¿‡æ»¤äº†ã€‚

## å…­ã€åŠ å…¥å­¦ä¹ 

**æ³¨æ„**ğŸ“¢ï¼Œæœ¬é¡¹ç›®ä¹Ÿåªæ˜¯ã€æ˜Ÿçƒï¼šç å†œä¼šé”ã€‘ä¼—å¤šé¡¹ç›®ä¸­çš„1ä¸ªï¼Œå…¶ä»–çš„é¡¹ç›®è¿˜åŒ…æ‹¬ï¼šå¤§è¥é”€å¹³å°ç³»ç»Ÿã€OpenAI å¤§æ¨¡å‹åº”ç”¨ã€APIç½‘å…³ã€LotteryæŠ½å¥–ã€IMé€šä¿¡ã€SpringBoot Starter ç»„ä»¶å¼€å‘ã€IDEA Plugin æ’ä»¶å¼€å‘ç­‰ï¼Œå¹¶è¿˜æœ‰å¼€æºé¡¹ç›®å­¦ä¹ ã€‚

å¦‚æœå¤§å®¶å¸Œæœ›é€šè¿‡åšæœ‰ä»·å€¼çš„ç¼–ç¨‹é¡¹ç›®ï¼Œæé«˜è‡ªå·±çš„ç¼–ç¨‹æ€ç»´å’Œç¼–ç èƒ½åŠ›ï¼Œå¯ä»¥åŠ å…¥å°å‚…å“¥çš„ã€æ˜Ÿçƒï¼šç å†œä¼šé”ã€‘ã€‚åŠ å…¥åè§£é”ğŸ”“æ‰€æœ‰å¾€æœŸé¡¹ç›®ï¼Œè¿˜å¯ä»¥å­¦ä¹ åç»­æ–°å¼€å‘çš„é¡¹ç›®ã€‚

æœ¬èŠ‚æ¡ˆä¾‹æºç ï¼š[https://gitcode.net/KnowledgePlanet/ddd-scene-solution/xfg-dev-tech-content-moderation](https://gitcode.net/KnowledgePlanet/ddd-scene-solution/xfg-dev-tech-content-moderation)

>[ğŸ§§åŠ å…¥å­¦ä¹ ](https://bugstack.cn/md/zsxq/other/join.html)

## ä¸ƒã€æ¨èé˜…è¯»

- [å•†å“ä¸‹å•æ”¯ä»˜åœºæ™¯ï¼ŒDDDè®¾è®¡å®ç°ã€Œæ”¯ä»˜å®æ²™ç®±ã€](https://bugstack.cn/md/project/ddd-scene-solution/alipay-sandbox.html)
- [MVC2DDD - æ¶æ„é‡æ„](https://bugstack.cn/md/road-map/mvc2ddd.html)
- [Mock å•å…ƒæµ‹è¯•&æ’ä»¶ç”Ÿæˆæµ‹è¯•ä»£ç ](https://bugstack.cn/md/road-map/mock.html)
- [ã€Šå¤§è¥é”€å¹³å°ç³»ç»Ÿã€‹â€”â€” å°å‚…å“¥ç¬¬8ä¸ªé¡¹ç›®ï¼Œå‰åç«¯ + Dev-Ops çš„å…¨æ ˆå¼ç»¼åˆç¼–ç¨‹å®æˆ˜DDDé¡¹ç›®ï¼](https://bugstack.cn/md/project/big-market/big-market.html)
