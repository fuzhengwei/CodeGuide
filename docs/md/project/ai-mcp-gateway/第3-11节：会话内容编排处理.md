---
title: 【更】第3-11节：会话内容编排处理
pay: https://t.zsxq.com/7Oceg
---

# 《AI MCP Gateway 网关服务系统》第3-11节：会话内容编排处理

作者：小傅哥
<br/>博客：[https://bugstack.cn](https://bugstack.cn)
<br/>视频：[https://t.zsxq.com/pxAAd](https://t.zsxq.com/pxAAd)

>沉淀、分享、成长，让自己和他人都能有所收获！😄

## 一、本章诉求

将目前在 MCP 网关服务接口管理（McpGatewayController）中的 handleMessage 下的逻辑代码，抽取到 case 进行编排处理，减轻 Controller 层的代码压力。

<div align="center">
	<img src="https://bugstack.cn/images/article/project/ai-mcp-gateway/ai-mcp-gateway-3-11-01.png" width="450px"/>
</div>

这里有一个设计思想，Controller 接口实现的控制器层，在处理复杂逻辑的时候，都会调用很多 Service 服务。无论这个服务是贫血模型的 mvc 架构，还是充血模型的 ddd 架构。那么为了减轻 Controller 的职责，不至于让一个 Controller 的代码逻辑过于繁重，因此引入了 case 编排层。上承接 Controller 层的出入参需求，下处理 domian 领域服务的编排处理。这一层甚至不需要额外的对象包，它可以承接 Controller 的 DTO 对象作为出入参，也可以使用领域层的对象。

## 二、流程设计

如图，会话消息处理流程设计；

<div align="center">
	<img src="https://bugstack.cn/images/article/project/ai-mcp-gateway/ai-mcp-gateway-3-11-02.png" width="950px"/>
</div>

- 首先，这部分的重点在于将原本的会话服务接口下的消息处理，直接调用 domain 领域层的部分，重构迁移到 case 层通过规则树的方式分摊 trigger 触发器下的 Controller 的压力。
- 之后，这部分的 case 编排和会话 Session 处理的架构设计方案是一致的，使用的是星球「码农会锁」扳手工程下的通用设计模式组件。这部分的设计，只要具备编码式的规则树结构，可以划分职责的方式完成节点的拆分，就都可以作为编排设计工具使用。