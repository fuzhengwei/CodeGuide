---
title: ç¬¬2ç« ï¼šæ•°ç»„
lock: need
---

# ã€ŠJava æ•°æ®ç»“æ„å’Œç®—æ³•ã€‹ç¬¬2ç« ï¼šæ•°ç»„

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/DIlTfiEHselk6yW19HplWQ](https://mp.weixin.qq.com/s/DIlTfiEHselk6yW19HplWQ)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`æ•°ç»„æ˜¯æ•°æ®ç»“æ„è¿˜æ˜¯æ•°æ®ç±»å‹ï¼Ÿ`

æ•°ç»„åªæ˜¯ä¸ªåç§°ï¼Œå®ƒå¯ä»¥æè¿°ä¸€ç»„æ“ä½œï¼Œä¹Ÿå¯ä»¥å‘½åè¿™ç»„æ“ä½œã€‚æ•°ç»„çš„æ•°æ®æ“ä½œï¼Œæ˜¯é€šè¿‡ idx->val çš„æ–¹å¼æ¥å¤„ç†ã€‚å®ƒä¸æ˜¯å…·ä½“è¦æ±‚å†…å­˜ä¸Šè¦å­˜å‚¨ç€è¿ç»­çš„æ•°æ®æ‰å«æ•°æ®ï¼Œè€Œæ˜¯è¯´ï¼Œé€šè¿‡è¿ç»­çš„ç´¢å¼• idxï¼Œä¹Ÿå¯ä»¥çº¿æ€§è®¿é—®ç›¸é‚»çš„æ•°æ®ã€‚

é‚£ä¹ˆå½“ä½ å®šä¹‰äº†æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œä¹Ÿå°±å®šä¹‰äº†æ•°æ®ç»“æ„ã€‚æ‰€ä»¥å®ƒä¹Ÿæ˜¯è¢«å½’ç±»ä¸ºæ•°æ®ç»“æ„ã€‚

## äºŒã€æ•°ç»„æ•°æ®ç»“æ„

æ•°ç»„ï¼ˆArrayï¼‰æ˜¯ä¸€ç§çº¿æ€§è¡¨æ•°æ®ç»“æ„ã€‚å®ƒç”¨ä¸€ç»„è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¥å­˜å‚¨ä¸€ç»„å…·æœ‰ç›¸åŒç±»å‹æ•°æ®çš„é›†åˆã€‚

![](https://bugstack.cn/images/article/algorithm/algorithms-220730-01.png)

æ•°ç»„çš„ç‰¹ç‚¹ï¼š
1. æ•°ç»„æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ é›†åˆï¼ˆint ä¸èƒ½å­˜æ”¾ doubleï¼‰
2. æ•°ç»„ä¸­å„å…ƒç´ çš„å­˜å‚¨æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œå®ƒä»¬åœ¨å†…å­˜ä¸­æŒ‰ç…§è¿™ä¸ªé¡ºåºè¿ç»­å­˜æ”¾åˆ°ä¸€èµ·ã€‚å†…å­˜åœ°å€è¿ç»­ã€‚
3. æ•°ç»„è·å–å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)

### 1. ä¸€ç»´æ•°ç»„

ä¸€ç»´æ•°ç»„æ˜¯æœ€å¸¸ç”¨çš„æ•°ç»„ï¼Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„çš„å˜ç§ä¹Ÿéƒ½æ˜¯ä»ä¸€ç»´æ•°ç»„æ¥çš„ã€‚ä¾‹å¦‚ HashMap çš„æ‹‰é“¾å¯»å€ç»“æ„ï¼ŒThreadLocal çš„å¼€æ”¾å¯»å€ç»“æ„ï¼Œéƒ½æ˜¯ä»ä¸€ç»´æ•°ç»„ä¸Šå®ç°çš„ã€‚

### 2. äºŒç»´æ•°ç»„

![äºŒç»´æ•°ç»„](https://bugstack.cn/images/article/algorithm/algorithms-220730-02.png)

äºŒç»´ä»¥åŠå¤šç»´æ•°ç»„ï¼Œåœ¨å¼€å‘åœºæ™¯ä¸­ä½¿ç”¨åˆ°çš„åˆ°ä¸æ˜¯ä¸å¤šï¼Œä¸è¿‡åœ¨ä¸€äº›ç®—æ³•é€»è¾‘ï¼Œæ•°å­¦è®¡ç®—ä¸­åˆ°æ˜¯å¯ä»¥ä½¿ç”¨ã€‚

## ä¸‰ã€å®ç°æ•°ç»„åˆ—è¡¨

åœ¨ Java çš„æºç ä¸­ï¼Œæ•°ç»„æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¾ˆå¤šå…¶ä»–æ•°æ®ç»“æ„ä¹Ÿéƒ½æœ‰æ•°ç»„çš„å½±å­ã€‚åœ¨ä¸€äº›æ•°æ®å­˜æ”¾å’Œä½¿ç”¨çš„åœºæ™¯ä¸­ï¼ŒåŸºæœ¬ä¹Ÿéƒ½æ˜¯ä½¿ç”¨ ArrayList è€Œä¸æ˜¯ LinkedListï¼Œå…·ä½“æ€§èƒ½åˆ†æå‚è€ƒï¼š[LinkedListæ’å…¥é€Ÿåº¦æ¯”ArrayListå¿«ï¼Ÿä½ ç¡®å®šå—ï¼Ÿ](https://bugstack.cn/md/java/interview/2020-08-30-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C%20%C2%B7%20%E7%AC%AC8%E7%AF%87%E3%80%8ALinkedList%E6%8F%92%E5%85%A5%E9%80%9F%E5%BA%A6%E6%AF%94ArrayList%E5%BF%AB%EF%BC%9F%E4%BD%A0%E7%A1%AE%E5%AE%9A%E5%90%97%EF%BC%9F%E3%80%8B.html)

é‚£ä¹ˆæœ¬ç« èŠ‚æˆ‘ä»¬å°±å€Ÿç€æ•°ç»„ç»“æ„çš„å­¦ä¹ ï¼Œå®ç°ä¸€ä¸ªç®€å•çš„ ArrayListï¼Œè®©ä½¿ç”¨ Java çš„è¯»è€…æ—¢èƒ½äº†è§£å­¦ä¹ æ•°æ®ç»“æ„ï¼Œä¹Ÿèƒ½äº†è§£åˆ° Java æºç å®ç°ã€‚

- æºç åœ°å€ï¼š[https://github.com/fuzhengwei/java-algorithms](https://github.com/fuzhengwei/java-algorithms) - `Java ç®—æ³•ä¸æ•°æ®ç»“æ„`
- æœ¬ç« æºç ï¼š[https://github.com/fuzhengwei/java-algorithms/blob/main/data-structures/src/main/java/cn/bugstack/algorithms/data/array/ArrayList.java](https://github.com/fuzhengwei/java-algorithms/blob/main/data-structures/src/main/java/cn/bugstack/algorithms/data/array/ArrayList.java)

### 1. åŸºæœ¬è®¾è®¡

æ•°ç»„æ˜¯ä¸€ä¸ªå›ºå®šçš„ã€è¿ç»­çš„ã€çº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆæƒ³æŠŠå®ƒä½œä¸ºä¸€ä¸ªè‡ªåŠ¨æ‰©å±•å®¹é‡çš„æ•°ç»„åˆ—è¡¨ï¼Œåˆ™éœ€è¦åšä¸€äº›æ‰©å±•ã€‚

```java
/**
 * é»˜è®¤åˆå§‹åŒ–ç©ºé—´
 */
private static final int DEFAULT_CAPACITY = 10;
/**
 * ç©ºå…ƒç´ 
 */
private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
/**
 * ArrayList å…ƒç´ æ•°ç»„ç¼“å­˜åŒº
 */
transient Object[] elementData;
```

1. åˆå§‹åŒ– ArrayList é˜¶æ®µï¼Œå¦‚æœä¸æŒ‡å®šå¤§å°ï¼Œé»˜è®¤ä¼šåˆå§‹åŒ–ä¸€ä¸ªç©ºçš„å…ƒç´ ã€‚è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰é»˜è®¤é•¿åº¦çš„ã€‚
2. é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ç»™åˆå§‹åŒ–çš„é•¿åº¦å‘¢ï¼Ÿæ˜¯åœ¨é¦–æ¬¡æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå› ä¸ºæ‰€æœ‰çš„æ·»åŠ å…ƒç´ æ“ä½œï¼Œä¹Ÿéƒ½æ˜¯éœ€è¦åˆ¤æ–­å®¹é‡ï¼Œä»¥åŠæ˜¯å¦æ‰©å®¹çš„ã€‚é‚£ä¹ˆåœ¨ add æ·»åŠ å…ƒç´ æ—¶ç»Ÿä¸€å®Œæˆè¿™ä¸ªäº‹æƒ…ï¼Œè¿˜æ˜¯æ¯”è¾ƒå¥½å¤„ç†çš„ã€‚
3. ä¹‹åå°±æ˜¯éšç€å…ƒç´ çš„æ·»åŠ ï¼Œå®¹é‡æ˜¯ä¼šä¸è¶³çš„ã€‚å½“å®¹é‡ä¸è¶³çš„æ˜¯ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œã€‚åŒæ—¶è¿˜å¾—éœ€è¦æŠŠæ—§æ•°æ®è¿ç§»åˆ°æ–°çš„æ•°ç»„ä¸Šã€‚*æ‰€ä»¥æ•°æ®çš„è¿ç§»ç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œ*

### 2. æ·»åŠ å…ƒç´ 

![](https://bugstack.cn/images/article/algorithm/algorithms-220730-03.png)

```java
public boolean add(E e) {
    // ç¡®ä¿å†…éƒ¨å®¹é‡
    int minCapacity = size + 1;
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }
    // åˆ¤æ–­æ‰©å®¹æ“ä½œ
    if (minCapacity - elementData.length > 0) {
        int oldCapacity = elementData.length;
        int newCapacity = oldCapacity + (oldCapacity >> 1);
        if (newCapacity - minCapacity < 0) {
            newCapacity = minCapacity;
        }
        elementData = Arrays.copyOf(elementData, newCapacity);
    }
    // æ·»åŠ å…ƒç´ 
    elementData[size++] = e;
    return true;
}
```

**è¿™æ˜¯ä¸€ä»½ç®€åŒ–åçš„ ArrayList#add æ“ä½œ**

1. åˆ¤æ–­å½“å‰å®¹é‡ä¸åˆå§‹åŒ–å®¹é‡ï¼Œä½¿ç”¨ Math.max å‡½æ•°å–æœ€å¤§å€¼æœ€ä¸ºæœ€å°åˆå§‹åŒ–ç©ºé—´ã€‚
2. æ¥ä¸‹æ¥æ˜¯åˆ¤æ–­ minCapacity å’Œå…ƒç´ çš„æ•°é‡ï¼Œæ˜¯å¦è¾¾åˆ°äº†æ‰©å®¹ã€‚é¦–æ¬¡åˆ›å»º ArrayList æ˜¯ä¸€å®šä¼šæ‰©å®¹çš„ï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ– DEFAULT_CAPACITY = 10 çš„å®¹é‡ã€‚
3. Arrays.copyOf å®é™…ä¸Šæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºé—´æ•°ç»„ï¼Œä¹‹åè°ƒç”¨çš„ System.arraycopy è¿ç§»åˆ°æ–°åˆ›å»ºçš„æ•°ç»„ä¸Šã€‚è¿™æ ·åç»­æ‰€æœ‰çš„æ‰©å®¹æ“ä½œï¼Œä¹Ÿå°±éƒ½ä¿æŒç»Ÿä¸€äº†ã€‚
4. ArrayList æ‰©å®¹å®Œæˆåï¼Œå°±æ˜¯ä½¿ç”¨ elementData[size++] = e; æ·»åŠ å…ƒç´ æ“ä½œäº†ã€‚

### 3. ç§»é™¤å…ƒç´ 

ArrayList çš„é‡ç‚¹ç¦»ä¸å¼€å¯¹ System.arraycopy çš„ä½¿ç”¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ ä»åŸæ•°ç»„çš„ç‰¹å®šä½ç½®ï¼Œè¿ç§»åˆ°æ–°æ•°ç»„çš„æŒ‡å®šä½ç½®å’Œè¿ç§»æ•°é‡ã€‚å¦‚å›¾ 2-5 æ‰€ç¤ºï¼Œæ•°æ®è¿ç§» *æµ‹è¯•ä»£ç åœ¨ java-algorithms*

![å›¾ 2-5](https://bugstack.cn/images/article/algorithm/algorithms-220730-05.png)

**åˆ é™¤å…ƒç´ **

```java
public E remove(int index) {
    E oldValue = (E) elementData[index];
    int numMoved = size - index - 1;
    if (numMoved > 0) {
        // ä»åŸå§‹æ•°ç»„çš„æŸä¸ªä½ç½®ï¼Œæ‹·è´åˆ°ç›®æ ‡å¯¹è±¡çš„æŸä¸ªä½ç½®å¼€å§‹ånä¸ªå…ƒç´ 
        System.arraycopy(elementData, index + 1, elementData, index, numMoved);
    }
    elementData[--size] = null; // clear to let GC do its work
    return oldValue;
}
```

- ArrayList çš„å…ƒç´ åˆ é™¤ï¼Œå°±æ˜¯åœ¨ç¡®å®šå‡ºå…ƒç´ ä½ç½®åï¼Œä½¿ç”¨ System.arraycopy æ‹·è´æ•°æ®æ–¹å¼ç§»åŠ¨æ•°æ®ï¼ŒæŠŠéœ€è¦åˆ é™¤çš„å…ƒç´ ä½ç½®è¦†ç›–æ‰ã€‚
- æ­¤å¤–å®ƒè¿˜ä¼šæŠŠå·²ç»åˆ é™¤çš„å…ƒç´ è®¾ç½®ä¸º null ä¸€æ–¹é¢è®©æˆ‘ä»¬ä¸ä¼šåœ¨è¯»å–åˆ°è¿™ä¸ªå…ƒç´ ï¼Œå¦å¤–ä¸€æ–¹é¢ä¹Ÿæ˜¯ä¸ºäº† GC

### 4. è·å–å…ƒç´ 

```java
public E get(int index) {
    return (E) elementData[index];
}
@Override
public String toString() {
    return "ArrayList{" +
            "elementData=" + Arrays.toString(elementData) +
            ", size=" + size +
            '}';
}
```

- è·å–å…ƒç´ å°±æ¯”è¾ƒç®€å•äº†ï¼Œç›´æ¥ä» elementData ä½¿ç”¨ç´¢å¼•ç›´æ¥è·å–å³å¯ã€‚è¿™ä¸ªæ˜¯ä¸€ä¸ª O(1) æ“ä½œã€‚ä¹Ÿæ­£å› ä¸ºæœç´¢å…ƒç´ çš„ä¾¿æ·æ€§ï¼Œæ‰è®© ArrayList ä½¿ç”¨çš„é‚£ä¹ˆå¹¿æ³›ã€‚åŒæ—¶ä¸ºäº†å…¼å®¹å¯ä»¥é€šè¿‡å…ƒç´ æ¥è·å–æ•°æ®ï¼Œè€Œä¸æ˜¯ç›´æ¥é€šè¿‡ä¸‹æ ‡ï¼Œå¼•å‡ºäº† HashMap ä½¿ç”¨å“ˆå¸Œå€¼è®¡ç®—ä¸‹æ ‡çš„è®¡ç®—æ–¹å¼ï¼Œä¹Ÿå¼•å‡ºäº†æ–æ³¢é‚£å¥‘æ•£åˆ—ã€‚å®ƒä»¬çš„è®¾è®¡éƒ½æ˜¯åœ¨å°½å¯èƒ½å‡å°‘å…ƒç´ ç¢°æ’çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½ä½¿ç”¨è´´è¿‘ O(1) çš„æ—¶é—´å¤æ‚åº¦è·å–æ•°æ®ã€‚*è¿™äº›å†…å®¹çš„å­¦ä¹ å¯ä»¥é˜…è¯»å°å‚…å“¥çš„ã€ŠJavaé¢ç»æ‰‹å†Œã€‹ä¹Ÿå¯ä»¥éšç€æœ¬ç³»åˆ—ç« èŠ‚å†…å®¹çš„é“ºè®¾é€æ­¥è¦†ç›–åˆ°ç®—æ³•åè¿›è¡Œå­¦ä¹ *

## å››ã€æ•°ç»„åˆ—è¡¨æµ‹è¯•

```java
@Test
public void test_array_list() {
    cn.bugstack.algorithms.data.array.List<String> list = new ArrayList<>();
    list.add("01");
    list.add("02");
    list.add("03");
    list.add("04");
    list.add("05");
    list.add("06");
    list.add("07");
    list.add("08");
    list.add("09");
    list.add("10");
    list.add("11");
    list.add("12");
    
    System.out.println(list);
    
    list.remove(9);
    
    System.out.println(list);
}
```

**æµ‹è¯•ç»“æœ**

![](https://bugstack.cn/images/article/algorithm/algorithms-220730-06.png)

```java
ArrayList{elementData=[01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12, null, null, null], size=12}
ArrayList{elementData=[01, 02, 03, 04, 05, 06, 07, 08, 09, 11, 12, null, null, null, null], size=11}

Process finished with exit code 0
```

- æµ‹è¯•æ¡ˆä¾‹ä¸­åŒ…æ‹¬äº†åœ¨æˆ‘ä»¬è‡ªå·±å®ç°çš„ ArrayList ä¸­é¡ºåºæ·»åŠ å…ƒç´ ï¼Œé€æ­¥æµ‹è¯•æ‰©å®¹è¿ç§»å…ƒç´ ï¼Œä»¥åŠåˆ é™¤å…ƒç´ åæ•°æ®çš„è¿ç§»ã€‚
- æœ€ç»ˆçš„æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œä¸€å…±æœ‰12ä¸ªå…ƒç´ ï¼Œå…¶ä¸­idx=9çš„å…ƒç´ è¢«åˆ é™¤å‰åï¼Œå…ƒç´ çš„è¿ç§»å˜åŒ–ã€‚

## å…­ã€å¸¸è§é¢è¯•é—®é¢˜

1. æ•°æ®ç»“æ„ä¸­æœ‰å“ªäº›æ˜¯çº¿æ€§è¡¨æ•°æ®ç»“æ„ï¼Ÿ
2. æ•°ç»„çš„å…ƒç´ åˆ é™¤å’Œè·å–ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿ
3. ArrayList ä¸­é»˜è®¤çš„åˆå§‹åŒ–é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ
4. ArrayList ä¸­æ‰©å®¹çš„èŒƒå›´æ˜¯å¤šå¤§ä¸€æ¬¡ï¼Ÿ
5. ArrayList æ˜¯å¦‚ä½•å®Œæˆæ‰©å®¹çš„ï¼ŒSystem.arraycopy å„ä¸ªå…¥å‚çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

## ä¸ƒã€è¯»è€…ä½œä¸š

- [https://t.zsxq.com/05vVjaa6i](https://t.zsxq.com/05vVjaa6i)