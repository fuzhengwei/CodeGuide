---
title: ç¬¬4ç« ï¼šæ ˆ
lock: need
---

# ã€ŠJava æ•°æ®ç»“æ„å’Œç®—æ³•ã€‹ç¬¬4ç« ï¼šæ ˆ

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`å †æ ˆçš„å†å²`

å †æ ˆäº 1946 å¹´è¿›å…¥è®¡ç®—æœºç§‘å­¦æ–‡çŒ®ï¼Œå½“æ—¶å½“æ—¶ Alan M. Turing ä½¿ç”¨æœ¯è¯­â€œburyâ€å’Œâ€œunburyâ€ä½œä¸ºè°ƒç”¨å­ç¨‹åºå’Œä»å­ç¨‹åºè¿”å›çš„ä¸€ç§æ–¹å¼ã€‚1945 å¹´ï¼Œ Konrad Zuse çš„ Z4 ä¸­å·²ç»å®ç°äº†å­ç¨‹åºã€‚

æ…•å°¼é»‘å·¥ä¸šå¤§å­¦çš„ Klaus Samelson å’Œ Friedrich L. Bauer åœ¨ 1955 å¹´æå‡ºäº†å †æ ˆçš„æƒ³æ³•ï¼Œå¹¶äº 1957 å¹´ç”³è¯·äº†ä¸“åˆ©ã€‚1988 å¹´ 3 æœˆï¼Œå…¶ä¸­åœ¨è¨æ¢…å°”æ£®å»ä¸–æ—¶ï¼Œé²å°”å› å‘æ˜å †æ ˆåŸç†è€Œè·å¾—äº† IEEE è®¡ç®—æœºå…ˆé”‹å¥–ã€‚Charles Leonard Hamblin åœ¨ 1954 å¹´ä¸ŠåŠå¹´å’ŒWilhelm KÃ¤mmerer  [ de ] åœ¨ 1958 å¹´ç‹¬ç«‹å¼€å‘äº†ç±»ä¼¼çš„æ¦‚å¿µã€‚

## äºŒã€å †æ ˆæ•°æ®ç»“æ„

åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå †æ ˆæ˜¯ä¸€ç§æŠ½è±¡æ•°æ®ç±»å‹ï¼Œç”¨ä½œå…ƒç´ çš„é›†åˆï¼Œå…·æœ‰ä¸¤ä¸ªä¸»è¦çš„æ“ä½œï¼›

- PUSHï¼šå°†å…ƒç´ æ·»åŠ åˆ°é›†åˆ
- POPï¼šåˆ é™¤æœ€è¿‘æ·»åŠ ä½†å°šæœªåˆ é™¤çš„å…ƒç´ 

![](https://bugstack.cn/images/article/algorithm/algorithms-220817-01.png)

å †æ ˆæ˜¯ä¸€ç§ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰çš„çº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œæˆ–è€…æ›´æŠ½è±¡è¯´æ˜¯ä¸€ç§é¡ºåºé›†åˆï¼Œpush å’Œ pop æ“ä½œåªå‘ç”Ÿåœ¨ç»“æ„çš„ä¸€ç«¯ï¼Œç§°ä¸ºæ ˆé¡¶ã€‚è¿™ç§ç»“æ„å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»å †æ ˆé¡¶éƒ¨å–å‡ºä¸€ä¸ªé¡¹ç›®ï¼Œè€Œè¦åˆ°è¾¾å †æ ˆæ›´æ·±å¤„çš„ä¸€ä¸ªé¡¹ç›®å¯èƒ½éœ€è¦å…ˆå–å‡ºå¤šä¸ªå…¶ä»–é¡¹ç›®ã€‚ä¾‹å¦‚ï¼›æˆ‘ä»¬ç»å¸¸çœ‹åˆ°çš„æµè§ˆå™¨è®¿é—®è®°å½•ï¼Œæ€»æ˜¯æŠŠæœ€è¿‘è®°å½•å±•ç¤ºç»™ä½ ã€‚è¿˜åŒ…æ‹¬ï¼šä¸€æ‘ä¹¦ã€ä¸€å ç›˜å­ã€ä¸€è„‘ç“œå­ç”Ÿæ´»çäº‹ã€‚

## ä¸‰ã€å®ç°å †æ ˆç»“æ„

å½“ä½ çœŸçš„æœ‰åœºæ™¯éœ€è¦ä½¿ç”¨åè¿›å…ˆå‡ºå †æ ˆæ—¶ï¼Œä¸€å®šæ˜¯ä¸èƒ½ä½¿ç”¨ Java æä¾›çš„ Stack çš„ã€‚å› ä¸ºè¿™ä¸ªå·¥å…·ç±»æ˜¯åœ¨ JDK 1.0 é˜¶æ®µå¼€å‘çš„ï¼Œå®ç°çš„ç‰¹åˆ«ç²—ç³™ï¼ŒåŒ…æ‹¬åƒ synchronized é”ä¹Ÿæ˜¯ç›´æ¥åŠ åˆ°æ–¹æ³•ä¸Šã€‚åŒæ—¶ JDK Stack ç±»çš„æ³¨è§£ä¹Ÿæé†’ï¼Œä½¿ç”¨ ArrayDeque æ›¿ä»£ï¼›

![](https://bugstack.cn/images/article/algorithm/algorithms-220817-02.png)

- Deque æ¥å£åŠå…¶å®ç°æä¾›äº†ä¸€ç»„æ›´å®Œæ•´å’Œä¸€è‡´çš„ LIFO å †æ ˆæ“ä½œï¼Œåº”ä¼˜å…ˆä½¿ç”¨æ­¤ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬æœ¬ç« ä¹Ÿæ˜¯ä»¥ ArrayDeque ä¸ºåŸå‹åšä»£ç å®ç°ã€‚
- å½“å°å‚…å“¥å»ç¿»çœ‹ ArrayDeque æ—¶ï¼Œå‘ç°è¿™åˆæ˜¯ Doug Lea è€çˆ·å­çš„ä½œå“ï¼Œåªè¦æœ‰è¿™å¤§ç¥çš„å­˜åœ¨ï¼Œè¿™ä»½ä»£ç ä¸€å®šå¾ˆå¤šéªšæ“ä½œï¼

### 1.  ArrayDeque ä»‹ç»

ArrayDeque æ˜¯ä¸€ä¸ªåŸºäºæ•°ç»„å®ç°çš„å †æ ˆæ•°æ®ç»“æ„ï¼Œåœ¨æ•°æ®å­˜æ”¾æ—¶å…ƒç´ é€šè¿‡äºŒè¿›åˆ¶ä¸è¿ç®—è·å–å¯¹åº”çš„ç´¢å¼•å­˜æ”¾å…ƒç´ ã€‚å½“æ•°ç»„é•¿åº¦è¶…è¿‡åˆå§‹ç©ºé—´åï¼Œè¿›è¡Œ2çš„næ¬¡å¹‚å·¦ç§»ä¸€ä½æ‰©å®¹ï¼Œå¹¶å°†æ•°ç»„å†…å®¹çš„å…ƒç´ æŒ‰ç…§åˆ†åŠåˆ†åˆ«è¿›è¡Œè¿ç§»ã€‚*è¿™å—é€»è¾‘å¤šä¸€äº›ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹ä¼šä»¥æ­¤è¿›è¡Œè®²è§£ï¼ŒåŒæ—¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¯ä»¥åœ¨å°å‚…å“¥æä¾›çš„æºç ä¸­å®Œæˆæ–­ç‚¹è°ƒè¯•ï¼Œæ–¹ä¾¿å¿«é€ŸæŒæ¡ã€‚*

![](https://bugstack.cn/images/article/algorithm/algorithms-220817-03.png)

- å †æ ˆçš„æ•°æ®ç»“æ„æ˜¯ä»¥2çš„æ¬¡å¹‚è¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰©å®¹æ—¶å€™ä¸º2çš„å€æ•°ã€‚å®ƒä¹‹æ‰€è¿™æ ·æ˜¯å› ä¸ºä¿è¯äº†åœ¨åç»­è®¡ç®—å…ƒç´ ç´¢å¼•ä½ç½®æ—¶ï¼Œå¯ä»¥è¿›è¡Œä¸è¿ç®—ã€‚ä¹Ÿå°±è¯´ 2çš„næ¬¡å¹‚-1 å¾—åˆ°çš„å€¼æ˜¯ä¸€ä¸ª011111çš„èŒƒå›´ï¼Œåœ¨ä¸å…ƒç´ ç´¢å¼•ä½ç½®è®¡ç®—æ—¶å€™ï¼Œæ‰¾åˆ°ä¸¤ä¸ªå€¼ä¹‹é—´1çš„ä½ç½®å³å¯ã€‚
- æ•°æ®çš„å‹æ ˆï¼Œå‹æ¦¨æ˜¯ä¸€ä¸ªåœ¨æ•°ç»„ä¸­å€’æ”¾çš„æ–¹å¼ï¼Œé€šè¿‡ä¸è¿ç®—å¾—åˆ°ç´¢å¼•å€¼ã€‚å½“å‘ç”Ÿç©ºé—´ä¸è¶³æ—¶æ‰©å®¹è¿ç§»æ•°æ®ï¼Œä¼šæœ‰2æ¬¡æ“ä½œã€‚ä¸€æ¬¡æ˜¯ç©ºé—´çš„å‰åŠæ–­å¤åˆ¶ï¼Œå¦å¤–ä¸€æ¬¡æ˜¯ååŠæ®µå¤åˆ¶ã€‚
- æœ€ååœ¨æ•°æ®å¼¹å‡ºæ—¶ï¼ŒæŒ‰ç…§ç©ºé—´çš„å…ƒç´ æ•°é‡æ€»æ•°å¼€å§‹ï¼ŒåŒæ ·é€šè¿‡ä¸è¿ç®—è®¡ç®—ç´¢å¼•å€¼ã€‚æ°›å›´å¼¹å‡ºé˜Ÿåˆ—ä¸­æœªå‘ç”Ÿè¿ç§»çš„æ•°æ®ï¼Œå’Œå·²ç»å®Œå…¨è¿ç§»å¥½çš„æ•°æ®ã€‚*å‡¡æ˜¯è¿ç§»çš„æ•°æ®ï¼Œéƒ½æ˜¯ä¿è¯äº†ä¸€ä¸ªé¡ºåºã€‚*
- ç»¼ä¸Šä½ å¯èƒ½è¿˜ä¸æ˜¯å¾ˆç†è§£è¿™ä¸ªæ•°æ®ç»“æ„çš„ç²¾å¦™è®¾è®¡å’Œä½¿ç”¨ï¼Œæ¥ä¸‹æ¥å°å‚…å“¥å†å¸¦ç€ä½ ä»ä»£ç å®ç°çš„è§’åº¦æ¥çœ‹ä¸‹ã€‚

### 2. æ·»åŠ å…ƒç´ 

**æºç è¯¦è§**ï¼š`cn.bugstack.algorithms.data.stack.ArrayDeque#push`

```java
public void push(E e) {
    if (e == null)
        throw new NullPointerException();
    elements[head = (head - 1) & (elements.length - 1)] = e;
    logger.info("push.idx headï¼š{}", head);
    if (head == tail)
        doubleCapacity();
}
```

![](https://bugstack.cn/images/article/algorithm/algorithms-220817-04.png)

- push å…ƒç´ çš„è¿‡ç¨‹ç›¸å½“äºæ‰¾åˆ°åˆå§‹åŒ–æ•°ç»„é•¿åº¦çš„é˜Ÿå°¾ï¼Œå¦å¤–æ˜¯æ‰©å®¹åä»æ–°çš„é˜Ÿå°¾å¼€å§‹ä¾æ¬¡æ·»åŠ å…ƒç´ ã€‚æ­¤æ—¶ä¸ç”¨æ‹…å¿ƒå…ƒç´ çš„è¾“å‡ºï¼Œå› ä¸ºè¾“å‡ºæ—¶æ˜¯ä»æ‰©å®¹èµ·å§‹ç‚¹å¼€å§‹è¾“å‡ºå…ƒç´ ã€‚

### 3. æ‰©å®¹ç©ºé—´

**æºç è¯¦è§**ï¼š`cn.bugstack.algorithms.data.stack.ArrayDeque#doubleCapacity`

```java
private void doubleCapacity() {
    assert head == tail;
    int p = head;
    int n = elements.length;
    int r = n - p;
    int newCapacity = n << 1;
    if (newCapacity < 0)
        throw new IllegalStateException("Sorry, deque too big");
    Object[] a = new Object[newCapacity];
    /*
     * src      - æºæ•°ç»„
     * srcPos   â€“ æºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®
     * dest     - ç›®æ ‡æ•°ç»„
     * destPos  â€“ ç›®æ ‡æ•°æ®ä¸­çš„èµ·å§‹ä½ç½®
     * length   â€“ è¦å¤åˆ¶çš„æ•°ç»„å…ƒç´ çš„æ•°é‡
     */
    // ç¬¬ä¸€æ¬¡æ‹·è´å…ƒç´ ï¼š[2ã€1ã€4ã€3] å°†æ•°ç»„ä¸­çš„æ‰©å®¹åä¸€åŠå…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„0å¼€å§‹å¾€åçš„ä½ç½®ã€‚æ‹·è´4ã€3
    System.arraycopy(elements, p, a, 0, r);
    // ç¬¬äºŒæ¬¡æ‹·è´å…ƒç´ ï¼š[2ã€1ã€4ã€3] å°†æ•°ç»„ä¸­çš„å‰é¢ä¸€åŠæ•°é‡çš„å…ƒç´ ï¼Œæ‹·è´åˆ°æ–°æ•°ç»„åä¸€åŠå¼€å§‹çš„ä½ç½®å¾€åã€‚æ‹·è´2ã€1
    System.arraycopy(elements, 0, a, r, p);
    elements = a;
    head = 0;
    tail = n;
}
```

![](https://bugstack.cn/images/article/algorithm/algorithms-220817-05.png)

- ç©ºé—´æ‰©å®¹ä»¥2çš„å€æ•°è¿›è¡Œæ“ä½œï¼Œä»¥æ­¤ä¿è¯2çš„å¹‚ç­‰ã€‚
- System.arraycopy æ˜¯æ“ä½œæ•°æ®è¿ç§»çš„æœ¬åœ°æ–¹æ³•ï¼Œä»æºæ•°ç»„çš„æŸä¸ªæŒ‡å®šä½ç½®ï¼ŒæŠŠå…ƒç´ è¿ç§»åˆ°æ–°æ•°ç»„çš„æŒ‡å®šä½ç½®å’ŒæŒ‡å®šä¸ªæ•°ä¸ªå…ƒç´ ã€‚
- å¦å¤–æ˜¯æ•°æ®è¿ç§»ï¼Œä»¥ [2ã€1ã€4ã€3] ä¸¾ä¾‹ï¼›
  - ç¬¬ä¸€æ¬¡æ‹·è´å…ƒç´ ï¼š[2ã€1ã€4ã€3] å°†æ•°ç»„ä¸­çš„æ‰©å®¹åä¸€åŠå…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„0å¼€å§‹å¾€åçš„ä½ç½®ã€‚æ‹·è´4ã€3
  - ç¬¬äºŒæ¬¡æ‹·è´å…ƒç´ ï¼š[2ã€1ã€4ã€3] å°†æ•°ç»„ä¸­çš„å‰é¢ä¸€åŠæ•°é‡çš„å…ƒç´ ï¼Œæ‹·è´åˆ°æ–°æ•°ç»„åä¸€åŠå¼€å§‹çš„ä½ç½®å¾€åã€‚æ‹·è´2ã€1

### 4. å¼¹å‡ºå…ƒç´ 

**æºç è¯¦è§**ï¼š`cn.bugstack.algorithms.data.stack.ArrayDeque#pop`

```java
public E pop() {
    int h = head;
    @SuppressWarnings("unchecked")
    E result = (E) elements[h];
    if (result == null) {
        return null;
    }
    elements[h] = null;
    head = (h + 1) & (elements.length - 1);
    logger.info("pop.idx {} = {} & {}", head, Integer.toBinaryString(h + 1), Integer.toBinaryString(elements.length - 1));
    return result;
}
```

![](https://bugstack.cn/images/article/algorithm/algorithms-220817-06.png)

- æŒ‰ç…§ç´¢å¼•çš„è®¡ç®—ï¼Œä»¥æ­¤æ˜¯å¼¹å‡ºç´¢å¼•ä¸ºï¼š6ã€7ã€0ã€1ã€2ã€3ã€4 å¯¹åº”çš„å…ƒç´ ã€‚head çš„å€¼ä»æ‰©å®¹çš„é•¿åº¦æ·»åŠ å…ƒç´ åé€æ­¥å‡å°ï¼Œæ‰€ä»¥å½“å‰æœ€å¼€å§‹å¼¹å‡ºçš„å…ƒç´ æ˜¯6ç´¢å¼•å¯¹åº”çš„å€¼ã€‚*è¯»è€…å¯ä»¥å°è¯•åœ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œè¿›è¡ŒéªŒè¯*

## å››ã€å †æ ˆåŠŸèƒ½æµ‹è¯•

```java
@Test
public void test_stack() {
    Deque<Integer> deque = new ArrayDeque<>();
    deque.push(1);
    deque.push(2);
    deque.push(3);
    deque.push(4);
    deque.push(5);
    deque.push(6);
    deque.push(7);
    
    logger.info("å¼¹å‡ºå…ƒç´ ï¼š{}", deque.pop());
    logger.info("å¼¹å‡ºå…ƒç´ ï¼š{}", deque.pop());
    logger.info("å¼¹å‡ºå…ƒç´ ï¼š{}", deque.pop());
    logger.info("å¼¹å‡ºå…ƒç´ ï¼š{}", deque.pop());
    logger.info("å¼¹å‡ºå…ƒç´ ï¼š{}", deque.pop());
    logger.info("å¼¹å‡ºå…ƒç´ ï¼š{}", deque.pop());
}
```

**æµ‹è¯•ç»“æœ**

```java
07:09:49.407 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š1
07:09:49.412 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š0
07:09:49.412 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š3
07:09:49.412 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š2
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š7
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š6
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - push.idx headï¼š5
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - pop.idx 6 = 110 & 111
07:09:49.413 [main] INFO cn.bugstack.algorithms.test.AlgorithmsTest - å¼¹å‡ºå…ƒç´ ï¼š7
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - pop.idx 7 = 111 & 111
07:09:49.413 [main] INFO cn.bugstack.algorithms.test.AlgorithmsTest - å¼¹å‡ºå…ƒç´ ï¼š6
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - pop.idx 0 = 1000 & 111
07:09:49.413 [main] INFO cn.bugstack.algorithms.test.AlgorithmsTest - å¼¹å‡ºå…ƒç´ ï¼š5
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - pop.idx 1 = 1 & 111
07:09:49.413 [main] INFO cn.bugstack.algorithms.test.AlgorithmsTest - å¼¹å‡ºå…ƒç´ ï¼š4
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - pop.idx 2 = 10 & 111
07:09:49.413 [main] INFO cn.bugstack.algorithms.test.AlgorithmsTest - å¼¹å‡ºå…ƒç´ ï¼š3
07:09:49.413 [main] INFO cn.bugstack.algorithms.data.stack.ArrayDeque - pop.idx 3 = 11 & 111
07:09:49.413 [main] INFO cn.bugstack.algorithms.test.AlgorithmsTest - å¼¹å‡ºå…ƒç´ ï¼š2
```

- ä»æµ‹è¯•ç»“æœä¸­å¯ä»¥çœ‹åˆ°å°å‚…å“¥æ·»åŠ çš„æ—¥å¿—ï¼Œæ‰“å°å‡ºæ‰€åº”çš„æ·»åŠ å…ƒç´ ã€å¼¹å‡ºå…ƒç´ çš„è¿‡ç¨‹ã€‚è¯»è€…åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›é¢å¤–çš„æ—¥å¿—ä¿¡æ¯ã€‚
- `Integer.toBinaryString()` æ˜¯ä¸€ä¸ªç”¨äºæ‰“å°äºŒè¿›åˆ¶ç»“æœçš„æ“ä½œï¼Œæ–¹ä¾¿æŸ¥çœ‹äºŒè¿›åˆ¶çš„è®¡ç®—ã€‚

## äº”ã€å¸¸è§é¢è¯•é—®é¢˜

- å †æ ˆçš„ä½¿ç”¨åœºæ™¯ï¼Ÿ
- ä¸ºä»€ä¹ˆä¸æ˜¯ç”¨ Stack ç±»ï¼Ÿ
- ArrayDeque æ˜¯åŸºäºä»€ä¹ˆå®ç°çš„ï¼Ÿ
- ArrayDeque æ•°æ®ç»“æ„ä½¿ç”¨è¿‡ç¨‹å™è¿°ã€‚
- ArrayDeque ä¸ºä»€ä¹ˆè¦åˆå§‹åŒ–2çš„næ¬¡å¹‚ä¸ªé•¿åº¦ï¼Ÿ