---
title: åŸºäºGPT2è®­ç»ƒäº†ä¸€ä¸ªå‚»ç‹—æœºå™¨äºº
lock: need
---

# ã€éƒ¨ç½²æ•™ç¨‹ã€‘åŸºäºGPT2è®­ç»ƒäº†ä¸€ä¸ªå‚»ç‹—æœºå™¨äºº

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

é¦–å…ˆæˆ‘æƒ³å‘Šè¯‰ä½ ï¼Œä»äº‹ç¼–ç¨‹å¼€å‘è¿™ä¸€è¡Œï¼Œè¦å­¦ä¼šçš„æ˜¯**å­¦ä¹ çš„æ–¹å¼æ–¹æ³•**ã€‚æ–¹å‘å¯¹äº†ï¼Œæ‰èƒ½äº‹åŠåŠŸå€ã€‚è€Œæˆ‘è®¤ä¸ºæœ€å¿«ä¸”è¡Œä¹‹æœ‰æ•ˆçš„æŠ€æœ¯æŠ€èƒ½å­¦ä¹ ï¼Œå°±æ˜¯ä¸Šæ‰‹å®è·µã€‚å…ˆä¸è¦æå¤ªå¤šçš„ç†è®ºï¼Œä¹°å›æ¥çš„è‡ªè¡Œè½¦ä¸èƒ½ä¸Šæ¥å°±æ‹†ï¼Œå¾—å…ˆæƒ³åŠæ³•éª‘èµ·æ¥ã€‚

æ‰€ä»¥å°å‚…å“¥å°±æ˜¯è¿™æ ·ï¼Œå­¦ä¸œè¥¿å˜›ã€‚ä»¥ç›®æ ‡ä¸ºé©±åŠ¨ï¼Œæ­å»ºå¯è¿è¡Œæµ‹è¯•çš„æœ€å°å•å…ƒç‰ˆæœ¬ã€‚å› ä¸ºåº·å¨å®šå¾‹è¯´ï¼›é—®é¢˜è¶Šå°ï¼Œè¶Šå®¹æ˜“è¢«ç†è§£å’Œå¤„ç†ã€‚æ‰€ä»¥åœ¨æ¥è§¦ ChatGPT ä»¥åï¼Œæˆ‘æ—¶å¸¸éƒ½åœ¨æƒ³æ€ä¹ˆè‡ªå·±è®­ç»ƒå’Œéƒ¨ç½²ä¸€ä¸ªè¿™æ ·çš„èŠå¤©å¯¹è¯æ¨¡å‹ï¼Œå“ªæ€•æ˜¯å¾ˆå°‘çš„è®­ç»ƒæ•°æ®ï¼Œè®©æˆ‘æµ‹è¯•ä¹Ÿå¥½ã€‚**æ‰€ä»¥è¿™ä¸ªä¼šå–·äººçš„å‚»ç‹—æœºå™¨äººæ¥äº†ï¼**

## ä¸€ã€å‚»ç‹—æœºå™¨èŠå¤©

åœ¨åŸºäºå‰æ–‡å°å‚…å“¥[ã€Šæ­ä¸ªChatGPTç®—æ³•æ¨¡å‹ã€‹](https://bugstack.cn/md/algorithm/model/2023-02-12-chat-gpt.html)çš„å­¦ä¹ åŸºç¡€ä¹‹ä¸Šï¼Œä»¥ OpenAI å¼€æºçš„ GPT-2 å’Œç›¸å…³çš„ GPT2-chitchat æ¨¡å‹è®­ç»ƒä»£ç ï¼Œéƒ¨ç½²äº†è¿™ä¸ªä¼šå–·äººçš„å‚»ç‹—æœºå™¨äººã€‚ä½†ç”±äºè®­ç»ƒæ•°æ®çš„é—®é¢˜ï¼Œè¿™ä¸ªèŠå¤©æœºå™¨äººå¯¹èµ·è¯æ¥ï¼Œæ€»æ„Ÿè§‰**å¾ˆå˜æ€**ã€‚â€”â€” ä¸è¿‡ä¸å½±å“æˆ‘ä»¬åšç®—æ³•æ¨¡å‹è®­ç»ƒçš„å­¦ä¹ ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/article/algorithm/model/model-2-01.png?raw=true" width="650px">
    <div>æ­¤é¡µé¢ä¸ºå°å‚…å“¥æ‰€ç¼–ç¨‹çš„WEBç‰ˆèŠå¤©å¯¹è¯çª—å£</div>
</div>

- **è®¿é—®åœ°å€**ï¼š[http://120.48.169.252/](http://120.48.169.252/) - æœåŠ¡å™¨é…ç½®æœ‰é™ï¼Œä¸èƒ½æ‰¿è½½è¿‡å¤§çš„å¹¶å‘è®¿é—®ã€‚
- **è§†é¢‘æ¼”ç¤º**ï¼š[https://www.bilibili.com/video/BV1LG4y1P7bo](https://www.bilibili.com/video/BV1LG4y1P7bo) - ä¹Ÿå¯ä»¥é€šè¿‡Bç«™è§†é¢‘ï¼Œè§‚çœ‹GPT2æ¨¡å‹éƒ¨ç½²æ¼”ç¤ºã€‚

## äºŒã€åŸºç¡€é…ç½®ç¯å¢ƒ

OpenAI GPT2 çš„æ¨¡å‹è®­ç»ƒå’ŒæœåŠ¡ä½¿ç”¨ï¼Œéœ€è¦ç”¨åˆ° Pythonã€TensorFlow æœºå™¨å­¦ä¹ ç­‰ç›¸å…³é…ç½®ï¼Œå¹¶ä¸”è¿™äº›ç¯å¢ƒé—´æœ‰äº›ç‰ˆæœ¬ä¾èµ–ã€‚æ‰€ä»¥ä¸ºäº†é¡ºåˆ©è°ƒè¯•å°½å¯èƒ½å’Œæˆ‘ä¿æŒä¸€æ ·çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ å¯¹ç¯å¢ƒå®‰è£…æœ‰éš¾åº¦ï¼Œä¹Ÿå¯ä»¥æ‰¾å°å‚…å“¥å¸®å¿™ä¹°ä¸€å°äº‘æœåŠ¡å™¨ï¼Œä¹‹åæˆ‘æŠŠæˆ‘çš„ç¯å¢ƒé•œåƒåˆ°ä½ çš„æœåŠ¡å™¨ä¸Šå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚ä»¥ä¸‹æ˜¯æ‰€éœ€çš„åŸºæœ¬ç¯å¢ƒã€ä»£ç å’Œæ•°æ®ã€‚

- **ç³»ç»Ÿé…ç½®**ï¼šCentos 7.9 - `2æ ¸4GBå†…å­˜200Gç£ç›˜4Mbpså¸¦å®½çš„äº‘æœåŠ¡å™¨`
- **éƒ¨ç½²ç¯å¢ƒ**ï¼šPython3.7ã€ Transformers==4.2.0ã€pytorch==1.7.0
- **æ¨¡å‹ä»£ç **ï¼š[https://github.com/fuzhengwei/GPT2-chitchat](https://github.com/fuzhengwei/GPT2-chitchat) - æ­¤ä»£ç å·²å¼€æºï¼Œå«websocketé€šä¿¡é¡µé¢
- **æ¨¡å‹æ•°æ®**ï¼š[https://pan.baidu.com/s/1iEu_-Avy-JTRsO4aJNiRiA](https://pan.baidu.com/s/1iEu_-Avy-JTRsO4aJNiRiA) - `ju6m`

### 1 ç¯å¢ƒä¾èµ–

```java
yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel

yum install gcc -y

yum -y install libffi-devel

make

make altinstall 
```

### 2 Python 3.7

```java
cd ~

# 1.ä¸‹è½½Pythonå®‰è£…åŒ…
wget https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz

# 2.å°†å®‰è£…åŒ…ç§»åŠ¨åˆ°/usr/localæ–‡ä»¶å¤¹ä¸‹
mv Python-3.7.4.tgz /usr/local/

# 3.åœ¨localç›®å½•ä¸‹åˆ›å»ºPython3ç›®å½•
mkdir /usr/local/python3

# 4.è¿›å…¥çš„Pythonå®‰è£…åŒ…å‹ç¼©åŒ…æ‰€åœ¨çš„ç›®å½•
cd /usr/local/

# 5.è§£å‹å®‰è£…åŒ…
tar -xvf Python-3.7.4.tgz

# 6.è¿›å…¥è§£å‹åçš„ç›®å½•
cd /usr/local/Python-3.7.4/

# 7.é…ç½®å®‰è£…ç›®å½•
./configure --prefix=/usr/local/python3

# 8.ç¼–è¯‘æºç 
make

# 9.æ‰§è¡Œæºç å®‰è£…
make install

# 10.åˆ›å»ºè½¯è¿æ¥
ln -s /usr/local/python3/bin/python3  /usr/bin/python3

# 11. æµ‹è¯•
python3 -V
```

### 3. å®‰è£…pip3

```java
cd ~

# 1.ä¸‹è½½
wget https://bootstrap.pypa.io/get-pip.py

# 2.å®‰è£…ï¼›æ³¨æ„å’±ä»¬å®‰è£…äº† python3 æ‰€ä»¥æ˜¯ pyhton3 get-pip.py
python3 get-pip.py
  
# 3.æŸ¥æ‰¾pipå®‰è£…è·¯å¾„
find / -name pip
  
# 4.å°†pipæ·»åŠ åˆ°ç³»ç»Ÿå‘½ä»¤
ln -s  /usr/local/python/bin/pip /usr/bin/pip  
  
# 5.æµ‹è¯•
pip -V
  
# 6.æ›´æ¢æºï¼Œå¦‚æœä¸æ›´æ¢é‚£ä¹ˆä½¿ç”¨ pip ä¸‹è½½è½¯ä»¶ä¼šå¾ˆæ…¢
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
pip config set install.trusted-host mirrors.aliyun.com
pip config list
  
# pipå›½å†…é•œåƒæºï¼š

# é˜¿é‡Œäº‘â€ƒhttp://mirrors.aliyun.com/pypi/simple/
# ä¸­å›½ç§‘æŠ€å¤§å­¦ â€ƒhttps://pypi.mirrors.ustc.edu.cn/simple/
# è±†ç“£â€ƒhttp://pypi.douban.com/simple
# Pythonå®˜æ–¹â€ƒhttps://pypi.python.org/simple/
# v2exâ€ƒhttp://pypi.v2ex.com/simple/
# ä¸­å›½ç§‘å­¦é™¢ â€ƒhttp://pypi.mirrors.opencas.cn/simple/
# æ¸…åå¤§å­¦â€ƒhttps://pypi.tuna.tsinghua.edu.cn/simple/  
```

### 4. å®‰è£…git

```java
cd ~

# 1.å®‰è£…å‰é¦–å…ˆå¾—å®‰è£…ä¾èµ–ç¯å¢ƒ
yum install -y perl-devel

# 2.ä¸‹è½½æºç åŒ…åˆ° CentOS æœåŠ¡å™¨åè¿›è¡Œè§£å‹
tar -zxf git-2.9.5.tar.gz

cd git-2.9.5

# 3.æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘å®‰è£… 

./configure --prefix=/usr/local/git

make && make install

# 4.æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡
vim ~/.bashrc

export PATH="/usr/local/git/bin:$PATH"

# 5.ä½¿é…ç½®ç”Ÿæ•ˆ
source ~/.bashrc

# 6.æµ‹è¯•
git version
```

### 5. å®‰è£…å®å¡”

```java
yum install -y wget && wget -O install.sh https://download.bt.cn/install/install_6.0.sh && sh install.sh 12f2c1d72
```

1. å®‰è£…åç™»å½•å®å¡”æç¤ºçš„åœ°å€ï¼Œé»˜è®¤å®ƒä¼šä½¿ç”¨8888ç«¯å£ï¼Œå› æ­¤ä½ éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå¼€å¯8888ç«¯å£è®¿é—®æƒé™ã€‚
2. å®å¡”çš„å®‰è£…æ˜¯ä¸ºäº†åœ¨æœåŠ¡ç«¯éƒ¨ç½²ä¸€ä¸ªç½‘é¡µç‰ˆèŠå¤©ç•Œé¢ï¼Œä½¿ç”¨åˆ°äº† Nginx æœåŠ¡ã€‚è¿™é‡Œç”¨å®å¡”æ“ä½œæ›´åŠ å®¹æ˜“ã€‚

## ä¸‰ã€æ¨¡å‹è¿è¡Œç¯å¢ƒ

æ¨¡å‹è®­ç»ƒéœ€è¦ç”¨åˆ° transformers æœºå™¨å­¦ä¹ æœåŠ¡ï¼Œä»¥åŠ pytorchã€sklearn ç­‰ç»„ä»¶ï¼›ä»¥ä¸‹å†…å®¹éœ€è¦åˆ†åˆ«å®‰è£…ï¼›

```java
transformers==4.4.2
pytorch==1.7.0
sklearn
tqdm
numpy
scipy==1.2.1
```

### 1. transformers

```java
pip install transformers==4.4.2
```

### 2. pytorch

```java
pip install torch==1.7.0+cpu torchvision==0.8.1+cpu torchaudio===0.7.0 -f https://download.pytorch.org/whl/torch_stable.html
```

- è¿™ä¸ªtorchç‰ˆæœ¬+cpuä¸torchvision éœ€è¦åŒ¹é…ã€‚

### 3. å…¶ä»–å®‰è£…

å‰©ä½™çš„æŒ‰ç…§ä½¿ç”¨æŒ‡ä»¤ pip install å°±å¯ä»¥ï¼Œå¦å¤–åœ¨è¿è¡Œ GTP2-chitchat æ—¶ï¼Œå¦‚æœæç¤ºç¼ºå°‘äº†æŸäº›ç»„ä»¶ï¼Œç›´æ¥ä½¿ç”¨ pip æŒ‰ç…§å³å¯ã€‚

## å››ã€èŠå¤©é¡µé¢é…ç½®

è¿™é‡Œå…ˆæŠŠå°å‚…å“¥ç»™ä½ å‡†å¤‡å¥½çš„websocketé¡µé¢ä»£ç ï¼Œé€šè¿‡å®å¡”åˆ›å»ºç«™ç‚¹åéƒ¨ç½²èµ·æ¥ã€‚ä»£ç ï¼šhttps://github.com/fuzhengwei/GPT2-chitchat/tree/master/web

<div align="center">
    <img src="https://bugstack.cn/images/article/algorithm/model/model-2-02.png?raw=true" width="550px">
</div>

ä¹‹åé€šè¿‡æ‰“å¼€ä½ çš„å®å¡”åœ°å€ï¼Œåˆ›å»ºç«™ç‚¹å’Œä¸Šä¼ Webä»£ç ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/article/algorithm/model/model-2-03.png?raw=true" width="550px">
</div>

**æ³¨æ„**ï¼šç›®å‰çš„è¿™ä»½ä»£ç ä¸­è®¿é—®websocketçš„é…ç½®åœ¨index.jsä¸­ï¼Œä½ éœ€è¦ä¿®æ”¹æˆä½ çš„æœåŠ¡å™¨åœ°å€ã€‚

```java
if(!window.WebSocket){
	alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebSocketåè®®ï¼æ¨èä½¿ç”¨è°·æ­Œæµè§ˆå™¨è¿›è¡Œæµ‹è¯•ã€‚");
	return;
}
socket = new WebSocket("ws://120.48.169.252:7397");
```

## äº”ã€æ¨¡å‹è®­ç»ƒéƒ¨ç½²

### 1. ä¸‹è½½ä»£ç 

```java
cd /home

git clone https://github.com/fuzhengwei/GPT2-chitchat.git
```

ä½ éœ€è¦ä¿®æ”¹ä¸‹ interact.py ä»£ç ï¼Œå˜æ›´è¿™é‡Œæœ‰Websocket çš„ IPå’Œç«¯å£é…ç½®ï¼›

```java
async def start_server():
    try:
        async with websockets.serve(server, "192.168.0.4", 7397):
            print("Starting server at ws://localhost:7397")
            await asyncio.Future()  # run forever
    except OSError as e:
        print(f"Error starting server: {e}")
    except Exception as e:
        print(f"Unexpected error: {e}")
```

### 2. ä¸Šä¼ æ¨¡å‹

ä¸‹è½½æ¨¡å‹ï¼š[https://pan.baidu.com/s/1iEu_-Avy-JTRsO4aJNiRiA#list/path=%2F](https://pan.baidu.com/s/1iEu_-Avy-JTRsO4aJNiRiA#list/path=%2F) - å¯†ç ï¼šju6m

ä¸Šä¼ æ¨¡å‹ï¼šè¿™é‡Œä½ éœ€è¦åœ¨æœ¬æœºå®‰è£…ä¸€ä¸ª SFTP å·¥å…·ï¼Œæˆ–è€…ä½¿ç”¨ IntelliJ IDEA æä¾›çš„å·¥å…·è¿›è¡Œé“¾æ¥ã€‚é“¾æ¥åå°±å¯ä»¥æŠŠè§£å‹çš„æ¨¡å‹ä¸Šä¼ åˆ° /home/GPT2-chitchat/model ä¸‹ã€‚

```java
async def start_server():
    try:
        async with websockets.serve(server, "192.168.0.4", 7397):
            print("Starting server at ws://localhost:7397")
            await asyncio.Future()  # run forever
    except OSError as e:
        print(f"Error starting server: {e}")
    except Exception as e:
        print(f"Unexpected error: {e}")
```

ä¿®æ”¹è¿™éƒ¨åˆ†ä»£ç çš„IPå’Œç«¯å£ï¼Œä»¥åŠåœ¨äº‘æœåŠ¡ä¸Šå¼€å¯ 7397 çš„è®¿é—®æƒé™ã€‚å¦å¤–ä¸ºäº†å®‰å…¨èµ·è§ï¼Œå¯ä»¥åœ¨äº‘æœåŠ¡çš„é˜²ç«å¢™IPæ¥æºä¸­æˆæƒï¼Œåªæœ‰ä½ å½“å‰çš„å°æœºå™¨æ‰å¯ä»¥é“¾æ¥åˆ° websocket ä¸Šã€‚

### 3. å¯åŠ¨æœåŠ¡

è¿™é‡Œå°å‚…å“¥é€šè¿‡ mac nuoshell è¿æ¥å·¥å…·ï¼Œè¿›è¡Œæ¨¡å‹å¯åŠ¨ï¼›`æ¨¡å‹è·¯å¾„ï¼š/home/GPT2-chitchat/model/model_epoch40_50w`

```java
python3 interact.py --no_cuda --model_path /home/GPT2-chitchat/model/model_epoch40_50w
```

<div align="center">
    <img src="https://bugstack.cn/images/article/algorithm/model/model-2-04.png?raw=true" width="750px">
</div>
- å¯åŠ¨åå°±å¯ä»¥æŠŠä½ çš„ websocket é¡µé¢æ‰“å¼€äº†ï¼Œå®ƒä¼šè‡ªåŠ¨çš„é“¾æ¥åˆ°è¿™ä¸ª websocket æœåŠ¡ä¸Šã€‚
- å¦‚æœä½ è¿˜éœ€è¦ Socket æˆ–è€…å‘½ä»¤è¡Œçš„æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ interact.py ä»£ç è¿›è¡Œå¤„ç†ã€‚

---

ä»¥ä¸Šå°±æ˜¯æ•´ä¸ª GPT2-chitchat ä¸€ä¸ªé—²èŠæ¨¡å‹çš„éƒ¨ç½²ï¼Œä½ ä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ Docker éƒ¨ç½²ã€‚å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­å®åœ¨å¾ˆéš¾éƒ¨ç½²æˆåŠŸï¼Œä¹Ÿå¯ä»¥æ‰¾å°å‚…å“¥ä¹°äº‘æœåŠ¡ï¼Œè¿™æ ·æˆ‘å¯ä»¥ç›´æ¥æŠŠé•œåƒéƒ¨ç½²åˆ°ä½ çš„äº‘æœåŠ¡ä¸Šï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ã€‚