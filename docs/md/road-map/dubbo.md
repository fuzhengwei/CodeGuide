---
title: Dubbo
lock: need
---

# Dubbo ä½¿ç”¨æ•™ç¨‹å’ŒåŸç†åˆ†æ

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=828140981&bvid=BV1Sg4y1c7m4&cid=1190616538&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

æœ¬æ–‡çš„å®—æ—¨åœ¨äºé€šè¿‡ç®€å•å¹²å‡€å®è·µçš„æ–¹å¼æ•™ä¼šè¯»è€…ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨Dubboã€æ€ä¹ˆä½¿ç”¨Dubboã€Dubboé€šä¿¡çš„åŸç†æ˜¯ä»€ä¹ˆã€‚åœ¨å­¦ä¹ æœ¬æ–‡åï¼Œä½ å¯ä»¥é¿å¼€å¾ˆå¤šå…³äº Dubbo ä½¿ç”¨æ—¶çš„å‘ï¼Œä¹Ÿèƒ½æ›´æ¸…æ¥šè‡ªå·±çš„ç¼–ç æ˜¯åœ¨åšä»€ä¹ˆã€‚

æœ¬æ–‡æ¶‰åŠçš„å·¥ç¨‹ï¼š
- xfg-dev-tech-dubboï¼š[https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-dubbo](https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-dubbo)
- xfg-dev-tech-dubbo-testï¼š[https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-dubbo-test](https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-dubbo-test)

## ä¸€ã€ä¸ºä»€ä¹ˆä½¿ç”¨

éšç€äº’è”ç½‘åœºæ™¯ä¸­æ‰€è¦é¢å¯¹çš„ç”¨æˆ·è§„æ¨¡å’Œä½“é‡çš„å¢åŠ ï¼Œç³»ç»Ÿä¹Ÿéœ€è¦åšç›¸åº”çš„æ‹†åˆ†è®¾è®¡å’Œå®ç°ã€‚éšä¹‹è€Œæ¥çš„ï¼Œä»¥å‰çš„ä¸€å¥—ç³»ç»Ÿï¼Œç°åœ¨æˆäº†å¤šä¸ªå¾®æœåŠ¡ã€‚å¦‚ï¼šç”µå•†ç³»ç»Ÿï¼Œä»¥å‰å°±åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­å†™å°±å¯ä»¥äº†ï¼Œç°åœ¨éœ€è¦æ‹†åˆ†å‡ºï¼Œç”¨æˆ·ã€æ”¯ä»˜ã€å•†å“ã€é…é€ã€æ´»åŠ¨ã€é£æ§ç­‰å„ä¸ªæ¨¡å—ã€‚é‚£ä¹ˆè¿™äº›æ¨¡å—æ‹†åˆ†åï¼Œå¦‚ä½•é«˜æ•ˆçš„é€šä¿¡å‘¢ï¼Ÿ

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-dubbo-01.png?raw=true" width="650px">
</div>

- å…³äºé€šä¿¡ï¼Œå°±å¼•å…¥äº† RPC æ¡†æ¶ï¼Œè€Œ Dubbo å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªå®ç°æ–¹å¼ã€‚
- é‚£ä¸ºå•¥ç”¨ Dubbo å‘¢ï¼Ÿå…¶å®æ ¸å¿ƒé—®é¢˜å°±ä¸€ä¸ªï¼Œä¸ºäº†æé«˜é€šä¿¡æ•ˆç‡ã€‚å› ä¸º Dubbo çš„åº•å±‚é€šä¿¡æ˜¯ Socket è€Œä¸æ˜¯ HTTP æ‰€ä»¥é€šä¿¡çš„æ€§èƒ½ä¼šæ›´å¥½ã€‚åŒæ—¶ Dubbo åˆæœ‰åˆ†å¸ƒå¼çš„é«˜å¯ç”¨è®¾è®¡ï¼Œåœ¨ä¸€ç»„éƒ¨ç½²äº†äº¤æ˜“æœåŠ¡çš„å®ä¾‹å®•æœºåï¼Œä¼šè¢«ä»æ³¨å†Œä¸­å¿ƒæ‘˜é™¤ï¼Œä¹‹åæµé‡ä¼šæ‰“åˆ°å…¶ä»–æœåŠ¡ä¸Šã€‚

## äºŒã€è¦æ€ä¹ˆä½¿ç”¨

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-dubbo-02.png?raw=true" width="650px">
</div>

Dubbo çš„ä½¿ç”¨åˆ†ä¸º2æ–¹ï¼Œä¸€ä¸ªæ˜¯æ¥å£çš„æä¾›æ–¹ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æ¥å£çš„è°ƒç”¨æ–¹ã€‚æ¥å£çš„æä¾›æ–¹éœ€è¦æä¾›å‡ºè¢«è°ƒç”¨æ–¹ä½¿ç”¨æ¥å£çš„æè¿°æ€§ä¿¡æ¯ã€‚è¿™ä¸ªä¿¡æ¯åŒ…æ‹¬ï¼šæ¥å£åç§°ã€æ¥å£å…¥å‚ã€æ¥å£å‡ºå‚ï¼Œåªæœ‰è®©è°ƒç”¨æ–¹æ‹¿åˆ°è¿™äº›ä¿¡æ¯ä»¥åï¼Œå®ƒæ‰èƒ½ä¾æ‰˜äºè¿™æ ·çš„æ¥å£ä¿¡æ¯åšä¸€ä¸ªä»£ç†æ“ä½œï¼Œå¹¶åœ¨ä»£ç†ç±»ä¸­ä½¿ç”¨ Socket å®ŒæˆåŒæ–¹çš„ä¿¡æ¯äº¤äº’ã€‚

æ‰€ä»¥ä½ çœ‹ä¸Šå»è°ƒç”¨ RPC æ¥å£å¥½åƒå’Œä½¿ç”¨ HTTP ä¹Ÿæ²¡å•¥åŒºåˆ«ï¼Œæ— éå°±æ˜¯å¼•å…¥äº† POM é…ç½®ï¼Œä¹‹åå†é…ç½®äº†æ³¨è§£å°±å¯ä»¥ä½¿ç”¨äº†ã€‚ä½†å…¶å®ï¼Œå®ƒæ˜¯æŠŠä½ çš„ Jar å½“åšä»£ç†çš„å¿…è¦å‚æ•°ä½¿ç”¨äº†ã€‚**æœ¬æ–‡ä¹Ÿä¼šä»‹ç»ï¼Œå…·ä½“æ˜¯æ€ä¹ˆä»£ç†çš„**

## ä¸‰ã€ä½¿ç”¨çš„æ¡ˆä¾‹

å¯¹äºç¼–ç¨‹çš„å­¦ä¹ æ¥è¯´ï¼Œå…¶å®æœ€å¼€å§‹çš„é‚£ä¸€ä¸‹ï¼Œä¸æ˜¯ææ˜ç™½æ‰€æœ‰åŸç†ï¼Œè€Œæ˜¯å…ˆè®©è‡ªå·±å¯ä»¥çœ‹åˆ°è¿è¡Œå‡ºæ¥çš„æ•ˆæœã€‚å“ï¼Œä¹‹åå°±å»åˆ†æåŸç†ï¼Œè¿™æ ·ä¼šèˆ’æœçš„å¤šã€‚

æ‰€ä»¥å°å‚…å“¥è¿™é‡Œæä¾›äº†ä¸€å¥—ç®€å•çš„ Dubbo ä½¿ç”¨æ¡ˆä¾‹ï¼Œåªè¦ä½ æ»¡è¶³æœ€åŸºæœ¬çš„é…ç½®æ¡ä»¶ï¼Œå°±å¯ä»¥è¿è¡Œå‡ºæ•ˆæœï¼›
1. JDK 1.8
1. Maven 3.x - jdk1.8æ”¯æŒçš„å°±å¯ä»¥
2. Dubbo 3.1.4 - POM ä¸­å·²ç»é…ç½®ï¼Œä¸2.xæœ€å¤§çš„ä½¿ç”¨ä¸Šçš„åŒºåˆ«å°±æ˜¯ä¸€äº›æ³¨è§£çš„ä½¿ç”¨
3. Zookeeper 3.4.x - å¦‚æœä½ åªæ˜¯æŒ‰ç…§æœ¬æ–‡ä¸­çš„ç›´è¿æ¨¡å¼æµ‹è¯•ï¼Œé‚£ä¹ˆä¸å®‰è£… Zookeeper ä¹Ÿå¯ä»¥

### 1. æ¥å£æä¾›æ–¹

å·¥ç¨‹æ¡ˆä¾‹åˆ›å»ºç»“æ„ï¼Œé‡‡ç”¨çš„æ˜¯ DDD ç»“æ„ã€‚ä½†å’Œ DDD ä¸€ç‚¹å…³ç³»æ²¡æœ‰ã€‚å¦‚æœä½ å¯¹å·¥ç¨‹åˆ›å»ºæœ‰ç–‘æƒ‘ï¼Œå¯ä»¥å‚è€ƒ [ã€ŠJava ç®€æ˜æ•™ç¨‹ã€‹ä¹‹ DDD æ¶æ„](https://bugstack.cn/md/road-map/ddd.html)

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-dubbo-03.png?raw=true" width="750px">
</div>

#### 1.1 æ¥å£å®šä¹‰

**æºç **ï¼š`cn.bugstack.dev.tech.dubbo.api.IUserService`

```java
public interface IUserService {

    Response<UserResDTO> queryUserInfo(UserReqDTO reqDTO);

}
```

- æ¥å£å®šä¹‰å¹³å¹³æ— å¥‡ï¼Œä½†ç¬¬1ä¸ªå‘æš—è—ç„æœºï¼
- ä¹Ÿå°±æ˜¯ï¼Œæ‰€æœ‰çš„ Dubbo æ¥å£ï¼Œå‡ºå…¥å‚ï¼Œé»˜è®¤éƒ½éœ€è¦ç»§æ‰¿ Serializable æ¥å£ã€‚ä¹Ÿå°±æ˜¯ UserReqDTOã€UserResDTOã€Response è¿™3ä¸ªç±»ï¼Œéƒ½å¾—ç»§æ‰¿ Serializable åºåˆ—åŒ–æ¥å£ã€‚

#### 1.2 æ¥å£å®ç°

**æºç **ï¼š`cn.bugstack.dev.tech.dubbo.trigger.rpc.UserService`

```java
@Slf4j
@DubboService(version = "1.0.0")
public class UserService implements IUserService {

    @Override
    public Response<UserResDTO> queryUserInfo(UserReqDTO reqDTO) {
        log.info("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ userId: {} reqStr: {}", reqDTO.getUserId(), JSON.toJSONString(reqDTO));
        try {
            // 1. æ¨¡æ‹ŸæŸ¥è¯¢ã€ä½ å¯ä»¥ä»æ•°æ®åº“æˆ–è€…Redisç¼“å­˜è·å–æ•°æ®ã€‘
            UserResDTO resDTO = UserResDTO.builder()
                    .userId(reqDTO.getUserId())
                    .userName("å°å‚…å“¥")
                    .userAge(20)
                    .build();

            // 2. è¿”å›ç»“æœ
            return Response.<UserResDTO>builder()
                    .code(Constants.ResponseCode.SUCCESS.getCode())
                    .info(Constants.ResponseCode.SUCCESS.getInfo())
                    .data(resDTO).build();
        } catch (Exception e) {
            log.error("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¤±è´¥ userId: {} reqStr: {}", reqDTO.getUserId(), JSON.toJSONString(reqDTO), e);
            return Response.<UserResDTO>builder()
                    .code(Constants.ResponseCode.UN_ERROR.getCode())
                    .info(Constants.ResponseCode.UN_ERROR.getInfo())
                    .build();
        }
    }

}
```

- æ¥å£å®ç°å¹³å¹³æ— å¥‡ï¼Œä½†ç¬¬2ä¸ªå‘æš—è—ç„æœºï¼
- Dubbo çš„å®ç°æ¥å£ï¼Œéœ€è¦è¢« Dubbo è‡ªå·±ç®¡ç†ã€‚æ‰€ä»¥ Dubbo æä¾›äº† @DubboService æ³¨è§£ã€‚æœ‰äº›å°å¡æ‹‰ç±³ï¼Œä½¿ç”¨çš„æ˜¯ä¸æ˜¯ Spring çš„ @Service å‘€ï¼Ÿå°¤å…¶æ˜¯ä»¥å‰çš„ Dubbo ç‰ˆæœ¬ `2.7.*` å®ƒçš„æ³¨è§£ä¹Ÿæ˜¯ @Service ä¹Ÿä¸ç•™ç¥å°±ç”¨æˆäº† Spring çš„ @Serviceã€‚ä¸€ä¸ªå°bugï¼Œåˆè°ƒäº†ä¸€ä¸Šåˆã€‚

#### 1.3 å·¥ç¨‹é…ç½®

**application.yml**

```java
dubbo:
  application:
    name: xfg-dev-tech-dubbo
    version: 1.0.0
  registry:
    address: zookeeper://127.0.0.1:2181 # N/A - æ— zookeeperå¯é…ç½® N/A èµ°ç›´è¿æ¨¡å¼æµ‹è¯•
  protocol:
    name: dubbo
    port: 20881
  scan:
    base-packages: cn.bugstack.dev.tech.dubbo.api
```

- é…ç½®ä¿¡æ¯å¹³å¹³æ— å¥‡ï¼Œä½†ç¬¬3ä¸ªå‘æš—è—ç„æœºï¼
- base-packages æ‰«æçš„æ˜¯å“ªé‡Œé…ç½®äº† Dubbo çš„ API å…¥å£ï¼Œç»™å®ƒå…¥å£å°±è¡Œï¼Œå®ƒä¼šè‡ªå·±æ‰¾åˆ°å®ç°ç±»ã€‚ä½†ï¼ä½ è¦çŸ¥é“ Java çš„ Spring åº”ç”¨èƒ½æ‰«æåˆ°ï¼Œèƒ½è¢« Spring ç®¡ç†ï¼Œé‚£ä¹ˆ pom è¦**ç›´æ¥æˆ–è€…é—´æ¥**çš„å¼•å¯¼åˆ°å®šä¹‰äº† Dubbo çš„æ¨¡å—ã€‚
- å†æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒSpring åº”ç”¨å¼€å‘ï¼Œè®²ç©¶çº¦å®šå¤§äºé…ç½®ã€‚ä½  Application åº”ç”¨çš„åŒ…åï¼Œåº”è¯¥æ˜¯å¯ä»¥è¦†ç›–åˆ°å…¶ä»–åŒ…åçš„ã€‚æ¯”å¦‚ Application éƒ½é…ç½®åˆ° `cn.bugstack.dev.tech.dubbo.a.b.c.d.*` å»äº†ï¼Œå®ƒé»˜è®¤å°±æ‰«ä¸åˆ° `cn.bugstack.dev.tech.dubbo.api` äº†ã€‚ä¸€ä¸ªå°bugï¼Œä¸€ä¸‹åˆåˆè¿‡å»äº†ã€‚ 
- æ³¨æ„ï¼šaddressï¼šå¦‚æœé…ç½®çš„æ˜¯ N/A å°±æ˜¯ä¸èµ°ä»»ä½•æ³¨å†Œä¸­å¿ƒï¼Œå°±æ˜¯ä¸ªç›´è¿ï¼Œä¸»è¦ç”¨äºæœ¬åœ°éªŒè¯çš„ã€‚å¦‚æœä½ é…ç½®äº† zookeeper://127.0.0.1:2181 å°±éœ€è¦å…ˆå®‰è£…ä¸€ä¸ª zookeeper å¦å¤–ï¼Œå³ä½¿ä½ é…ç½®äº†æ³¨å†Œä¸­å¿ƒçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ç›´è¿æµ‹è¯•ã€‚

#### 1.4 åº”ç”¨æ„å»º

ä»¥ä¸Šä¿¡æ¯éƒ½å‡†å¤‡äº†ï¼Œä¸€ç¾¤å°å¡æ‹‰ç±³å¼€å§‹æ‰åˆ°ç¬¬4ä¸ªå‘é‡Œäº†ï¼

ä½ æœ‰2ä¸ªåº”ç”¨ï¼Œä¸€ä¸ªDubboæ¥å£æä¾›æ–¹ã€ä¸€ä¸ªDubboæ¥å£ä½¿ç”¨æ–¹ã€‚é‚£ä¹ˆä½ åœ¨ç»™ä½ å¦å¤–ä¸€ä¸ªåº”ç”¨ä½¿ç”¨æ¥å£çš„æ—¶å€™ï¼Œä½ åœ¨ InelliJ IDEA çš„ Maven ä¸­æ‰§è¡Œ Install äº†å—ï¼Ÿ

Install æ˜¯å¹²å•¥çš„ï¼Ÿå®ƒæ˜¯ä¸ºäº†è®©ä½ ä½¿ç”¨äº†åŒä¸€ä¸ªæœ¬åœ° Maven é…ç½®çš„åº”ç”¨ï¼Œå¯ä»¥å¼•å…¥åˆ°å¯¹æ–¹æä¾›çš„ Jar åŒ…ã€‚ä½  Install ä»¥åï¼Œè¿™ä¸ª Jar åŒ…å°±ä¼šè¿›å…¥åˆ°æœ¬åœ° Maven ä»“åº“äº†ã€‚å¦‚æœæ˜¯å…¬å¸é‡Œå¼€å‘ï¼Œä¼šæœ‰ä¸“é—¨çš„è‡ªå·±å®¶éƒ¨ç½²çš„ï¼Œç§æœ‰Mavenä¸­å¿ƒä»“åº“ï¼Œå°±å¯ä»¥é€šè¿‡ deploy æŠŠæœ¬åœ° Jar å‘å¸ƒä¸Šå»ï¼Œé‚£ä¹ˆå…¬å¸é‡Œçš„ä¼™ä¼´ï¼Œä¹Ÿå°±éƒ½å¯ä»¥å¼•ç”¨äº†ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-dubbo-04.png?raw=true" width="450px">
</div>

- ä½ è¦å…ˆç‚¹å‡» root ä¸‹çš„ install æ“ä½œï¼Œè¿™æ ·å°±ä¼šè‡ªåŠ¨æ„å»ºäº†ã€‚
- å¦‚æœä½ ç”µè„‘é…ç½®æœ‰ç‚¹ä½ï¼Œä¹Ÿä¼šå‡ºç°ä¸€äº›`æ°”äººæ€ªç›¸`ï¼Œæ¯”å¦‚å°±åˆ·ä¸è¿›å»ï¼Œinstall äº†ä¹Ÿå¼•ç”¨ä¸äº†ã€‚è®°å¾—è¦ clean æ¸…ç©ºä¸‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ° maven æ–‡ä»¶å¤¹å»æ¸…ç©ºã€‚

### 2. æ¥å£ä½¿ç”¨æ–¹

æœ‰äº›å°å¡æ‹‰ç±³è§‰å¾—å‰é¢çš„å‘éƒ½æ‰«å¹²å‡€äº†ï¼Œå°±å®Œäº‹äº†ã€‚æ²¡æœ‰æ¥ä¸‹æ¥è¿˜æœ‰å‘ï¼Œè®©ä½ ä¸€ææä¸€å¤©ï¼ŒåŠå¤œä¹Ÿç¡ä¸å¥½ã€‚

#### 2.1 POM å¼•å…¥

```xml
<dependency>
    <groupId>cn.bugstack</groupId>
    <artifactId>xfg-dev-tech-dubbo-api</artifactId>
    <version>1.0-SNAPSHOT</version>
</dependency>
```

- POM çš„é…ç½®ï¼Œå°±æ˜¯æŠŠ Jar åŒ…ç»™å¼•ç”¨è¿›æ¥ã€‚å› ä¸º Dubbo éœ€è¦æ ¹æ®è¿™ä¸ªæ¥å£ï¼Œåšä¸€ä¸ªä»£ç†æ“ä½œã€‚**ä¸å¼•å…¥ï¼Œä½ ä»£ç å°±çˆ†çº¢å•¦ï¼çˆ†çº¢å•¦ï¼ğŸŒ¶**

#### 2.2 æ¶ˆè´¹é…ç½®

**æºç **ï¼š`application.yml`

```java
dubbo:
  application:
    name: xfg-dev-tech-dubbo
    version: 1.0.0
  registry:
     address: zookeeper://127.0.0.1:2181
#    address: N/A
  protocol:
    name: dubbo
    port: 20881
```

- é…ç½®äº† zookeeper ä½ å°±ç”¨ç¬¬ä¸€ä¸ªï¼Œä»£ç ä¸­å¯¹åº” `@DubboReference(interfaceClass = IUserService.class, version = "1.0.0")`
- é…ç½®äº† N/A ä½ å°±ç”¨ç¬¬äºŒä¸ªï¼Œä»£ç ä¸­å¿…é¡»æŒ‡å®šç›´è¿ã€‚`@DubboReference(interfaceClass = IUserService.class, url = "dubbo://127.0.0.1:20881", version = "1.0.0")`

#### 2.3 ä»£ç é…ç½®

**æºç **ï¼š`cn.bugstack.dev.tech.dubbo.consumer.test.ApiTest`

```java
// ç›´è¿æ¨¡å¼ï¼›@DubboReference(interfaceClass = IUserService.class, url = "dubbo://127.0.0.1:20881", version = "1.0.0")
@DubboReference(interfaceClass = IUserService.class, version = "1.0.0")
private IUserService userService;

@Test
public void test_userService() {
    UserReqDTO reqDTO = UserReqDTO.builder().userId("10001").build();
    Response<UserResDTO> resDTO = userService.queryUserInfo(reqDTO);
    log.info("æµ‹è¯•ç»“æœ req: {} res: {}", JSON.toJSONString(reqDTO), JSON.toJSONString(resDTO));
}
```

**æµ‹è¯•ç»“æœ**

```java
2023-07-08 15:37:22.291  INFO 62481 --- [           main] c.b.d.tech.dubbo.consumer.test.ApiTest   : æµ‹è¯•ç»“æœ req: {"userId":"10001"} res: {"code":"0000","data":{"userAge":20,"userId":"10001","userName":"å°å‚…å“¥"},"info":"æˆåŠŸ"}
2023-07-08 15:37:22.324  INFO 62481 --- [tor-Framework-0] o.a.c.f.imps.CuratorFrameworkImpl        : backgroundOperationsLoop exiting
```

- å¦‚æœä¸å‡ºå•¥æ„å¤–ï¼Œåˆ°è¿™ä½ å°±å¯ä»¥ç›´æ¥å¯åŠ¨è¿è¡Œäº†ã€‚å¹¶çœ‹åˆ°æµ‹è¯•ç»“æœã€‚
- ä½†åˆ«å¿˜è®°äº†ï¼Œä½ å¯åŠ¨çš„æ—¶å€™ï¼Œéœ€è¦å…ˆå¯åŠ¨ xfg-dev-tech-dubbo è®©æ¥å£æä¾›æ–¹è·‘èµ·æ¥ã€‚

## å››ã€åŸç†çš„åˆ†æ

éƒ½è¯´ Jar æ˜¯æä¾›å¯æè¿°æ€§ä¿¡æ¯çš„ï¼Œå¯¹æ–¹æ‰èƒ½ä»£ç†è°ƒç”¨ã€‚é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹æ˜¯æ€ä¹ˆå¹²çš„å‘¢ï¼Œæ€»ä¸èƒ½ä¸€é—®è¿™ä¸ªï¼Œå°±è®©å°å¡æ‹‰ç±³ä»¬å»æ‰‹å†™ Dubbo å‘€ï¼æ‰€ä»¥å°å‚…å“¥ä¼šé€šè¿‡æœ€ç®€å•æ¨¡å‹ç»“æ„ï¼Œè®©ä½ äº†è§£è¿™ä¸ª Dubbo é€šä¿¡çš„åŸç†ï¼Œæ–¹ä¾¿å°å¡æ‹‰ç±³ä»¬ä¸Šæ‰‹ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/roadmap-dubbo-06.png?raw=true" width="850px">
</div>

- å¦‚æœæ‰€ç¤ºï¼Œæ¥å£ä½¿ç”¨æ–¹ï¼Œå¯¹æ¥å£è¿›è¡Œä»£ç†ã€‚ä»€ä¹ˆæ˜¯ä»£ç†å‘¢ï¼Œä»£ç†å°±æ˜¯ç”¨ä¸€ä¸ªåŒ…è£…çš„ç»“æ„ï¼Œä»£æ›¿åŸæœ‰çš„æ“ä½œã€‚åœ¨è¿™ä¸ªåŒ…è£…çš„ç»“æ„é‡Œï¼Œä½ å¯ä»¥è‡ªå·±æ‰©å±•å‡ºä»»æ„çš„æ–¹æ³•ã€‚
- é‚£ä¹ˆï¼Œè¿™é‡Œçš„ä»£ç†ã€‚å°±æ˜¯æ ¹æ®æ¥å£çš„ä¿¡æ¯ï¼Œåˆ›å»ºå‡ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œåœ¨ä»£ç†å¯¹è±¡ä¸­ï¼Œæä¾› Socket è¯·æ±‚ã€‚å½“è°ƒç”¨è¿™ä¸ªæ¥å£çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¯¹æ¥å£æä¾›æ–¹çš„ï¼Œå‘èµ· Socket è¯·æ±‚äº†ã€‚
- è€Œ Socket æ¥æ”¶æ–¹ï¼Œä¹Ÿå°±æ˜¯æ¥å£æä¾›æ–¹ã€‚ä»–æ”¶åˆ°ä¿¡æ¯ä»¥åï¼Œæ ¹æ®æ¥å£çš„æè¿°æ€§å†…å®¹ï¼Œè¿›è¡Œä¸€ä¸ªåå°„è°ƒç”¨ã€‚è¿™ä¸‹å°±æŠŠä¿¡æ¯ç»™è¯·æ±‚å‡ºæ¥ï¼Œä¹‹åå†é€šè¿‡ Socket è¿”å›å›å»å°±å¯ä»¥äº†ã€‚

å¥½ï¼Œæ ¸å¿ƒçš„åŸç†å°±è¿™ä¹ˆç‚¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»ä»£ç ä¸­çœ‹çœ‹ã€‚

### 1. æ¥å£åå°„ - æä¾›æ–¹

**æºç **ï¼š`cn.bugstack.dev.tech.dubbo.trigger.socket.RpcServerSocket`

```java
@Slf4j
@Service
public class RpcServerSocket implements Runnable {

    private ApplicationContext applicationContext;

    public RpcServerSocket(ApplicationContext applicationContext) {
        this.applicationContext = applicationContext;
        new Thread(this).start();
    }

    @Override
    public void run() {
        EventLoopGroup bossGroup = new NioEventLoopGroup();
        EventLoopGroup workerGroup = new NioEventLoopGroup();

        try {
            ServerBootstrap b = new ServerBootstrap();
            b.group(bossGroup, workerGroup)
                    .channel(NioServerSocketChannel.class)
                    .option(ChannelOption.SO_BACKLOG, 128)
                    .childHandler(new ChannelInitializer<SocketChannel>() {
                        @Override
                        public void initChannel(SocketChannel channel) {
                            channel.pipeline().addLast(new ObjectEncoder());
                            channel.pipeline().addLast(new ObjectDecoder(ClassResolvers.cacheDisabled(null)));
                            channel.pipeline().addLast(new SimpleChannelInboundHandler<Map<String, Object>>() {

                                @Override
                                protected void channelRead0(ChannelHandlerContext channelHandlerContext, Map<String, Object> request) throws Exception {
                                    // è§£æå‚æ•°
                                    Class<?> clazz = (Class<?>) request.get("clazz");
                                    String methodName = (String) request.get("methodName");
                                    Class<?>[] paramTypes = (Class<?>[]) request.get("paramTypes");
                                    Object[] args = (Object[]) request.get("args");

                                    // åå°„è°ƒç”¨
                                    Method method = clazz.getMethod(methodName, paramTypes);
                                    Object invoke = method.invoke(applicationContext.getBean(clazz), args);

                                    // å°è£…ç»“æœ
                                    Map<String, Object> response = new HashMap<>();
                                    response.put("data", invoke);

                                    log.info("RPC è¯·æ±‚è°ƒç”¨ clazz:{} methodName:{}, response:{}", clazz.getName(), methodName, JSON.toJSON(response));
                                    // å›å†™æ•°æ®
                                    channelHandlerContext.channel().writeAndFlush(response);
                                }
                            });
                        }
                    });

            ChannelFuture f = b.bind(22881).sync();
            f.channel().closeFuture().sync();
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }

}
```

è¿™æ®µä»£ç ä¸»è¦æä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼š
1. Netty Socket å¯åŠ¨ä¸€ä¸ªæœåŠ¡ç«¯ã€‚
2. æ³¨å…¥ ApplicationContext applicationContext ç”¨äºåœ¨æ¥æ”¶åˆ°è¯·æ±‚æ¥å£ä¿¡æ¯åï¼Œè·å–å¯¹åº”çš„ Bean å¯¹è±¡ã€‚
3. æ ¹æ®è¯·æ±‚æ¥çš„ Bean å¯¹è±¡ï¼Œä»¥åŠå‚æ•°çš„å¿…è¦ä¿¡æ¯ã€‚è¿›è¡Œæ¥å£çš„åå°„è°ƒç”¨ã€‚
4. æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æŠŠæ¥å£åå°„è¯·æ±‚çš„ä¿¡æ¯ï¼Œå†é€šè¿‡ Socket è¿”å›å›å»ã€‚

### 2. æ¥å£ä»£ç† - è°ƒç”¨æ–¹

æ‰“å¼€å·¥ç¨‹ï¼š[xfg-dev-tech-dubbo-test](https://gitcode.net/KnowledgePlanet/road-map/xfg-dev-tech-dubbo-test)

**æºç **ï¼š`cn.bugstack.dev.tech.dubbo.consumer.config.RPCProxyBeanFactory`

```java
@Slf4j
@Component("rpcProxyBeanFactory")
public class RPCProxyBeanFactory implements FactoryBean<IUserService>, Runnable {

    private Channel channel;

    // ç¼“å­˜æ•°æ®ï¼Œå®é™…RPCä¼šå¯¹æ¯æ¬¡çš„è°ƒç”¨ç”Ÿæˆä¸€ä¸ªIDæ¥æ ‡è®°è·å–
    private Object responseCache;

    public RPCProxyBeanFactory() throws InterruptedException {
        new Thread(this).start();
        while (null == channel) {
            Thread.sleep(150);
            log.info("Rpc Socket é“¾æ¥ç­‰å¾…...");
        }
    }

    @Override
    public IUserService getObject() throws Exception {

        ClassLoader classLoader = Thread.currentThread().getContextClassLoader();
        Class<?>[] classes = {IUserService.class};
        InvocationHandler handler = new InvocationHandler() {
            @Override
            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {

                if (Object.class.equals(method.getDeclaringClass())) {
                    return method.invoke(this, args);
                }

                Map<String, Object> request = new HashMap<>();
                request.put("clazz", IUserService.class);
                request.put("methodName", method.getName());
                request.put("paramTypes", method.getParameterTypes());
                request.put("args", args);

                channel.writeAndFlush(request);

                // æ¨¡æ‹Ÿè¶…æ—¶ç­‰å¾…ï¼Œä¸€èˆ¬RPCæ¥å£è¯·æ±‚ï¼Œéƒ½æœ‰ä¸€ä¸ªè¶…æ—¶ç­‰å¾…æ—¶é•¿ã€‚
                Thread.sleep(350);

                return responseCache;
            }
        };

        return (IUserService) Proxy.newProxyInstance(classLoader, classes, handler);
    }

    @Override
    public Class<?> getObjectType() {
        return IUserService.class;
    }

    @Override
    public void run() {
        EventLoopGroup workerGroup = new NioEventLoopGroup();
        try {
            Bootstrap b = new Bootstrap();
            b.group(workerGroup)
                    .channel(NioSocketChannel.class)
                    .option(ChannelOption.AUTO_READ, true)
                    .handler(new ChannelInitializer<SocketChannel>() {

                        @Override
                        protected void initChannel(SocketChannel channel) throws Exception {
                            channel.pipeline().addLast(new ObjectEncoder());
                            channel.pipeline().addLast(new ObjectDecoder(ClassResolvers.cacheDisabled(null)));
                            channel.pipeline().addLast(new SimpleChannelInboundHandler<Map<String, Object>>() {

                                @Override
                                protected void channelRead0(ChannelHandlerContext channelHandlerContext, Map<String, Object> data) throws Exception {
                                    responseCache = data.get("data");
                                }
                            });
                        }
                    });
            ChannelFuture channelFuture = b.connect("127.0.0.1", 22881).syncUninterruptibly();
            this.channel = channelFuture.channel();
            channelFuture.channel().closeFuture().syncUninterruptibly();
        } finally {
            workerGroup.shutdownGracefully();
        }
    }

}
```

è¿™æ®µä»£ç ä¸»è¦æä¾›çš„åŠŸèƒ½åŒ…æ‹¬ï¼š
1. å®ç°  `FactoryBean<IUserService>` ä¸ºçš„æ˜¯æŠŠè¿™æ ·ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œäº¤ç»™ Spring å®¹å™¨ç®¡ç†ã€‚
2. å®ç° Runnable æ¥å£ï¼Œå¹¶åœ¨æ¥å£ä¸­ï¼Œåˆ›å»º Netty çš„ Socket å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¸­æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼Œå¹¶ä¸´æ—¶å­˜æ”¾åˆ°ç¼“å­˜ä¸­ã€‚**æ³¨æ„ Dubbo ä¸­è¿™å—çš„å¤„ç†ä¼šå¤æ‚ä¸€äº›ï¼Œä»¥åŠè¯·æ±‚åŒæ­¥å“åº”é€šä¿¡ï¼Œè¿™æ ·æ‰èƒ½æŠŠå„ä¸ªæ¥å£çš„è°ƒåŠ¨è®°å½•ä¸‹æ¥**
3. `getObject()` å¯¹è±¡ä¸­ï¼Œæä¾›ä»£ç†æ“ä½œã€‚ä»£ç†é‡Œï¼Œå°±å¯ä»¥è‡ªå·±æƒ³å’‹æå’‹æäº†ã€‚è€Œ Dubbo ä¹Ÿæ˜¯åœ¨ä»£ç†é‡Œï¼Œæä¾›äº†å¦‚æ­¤çš„æ“ä½œï¼Œå¯¹æ¥å£æä¾›æ–¹å‘é€è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶åœ¨è¶…æ—¶æ—¶é—´å†…è¿”å›æ¥å£ä¿¡æ¯ã€‚å› ä¸ºåå°„è°ƒç”¨ï¼Œéœ€è¦ä½ `æä¾›ç±»`ã€`æ–¹æ³•`ã€`å…¥å‚ç±»å‹`ã€`å…¥å‚å†…å®¹`ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠè¿™äº›ä¿¡æ¯ä¼ é€’ç»™æ¥å£æä¾›æ–¹ã€‚

### 3. æœåŠ¡æµ‹è¯• - æ¶ˆè´¹éªŒè¯

- å¯åŠ¨ xfg-dev-tech-dubbo
- æµ‹è¯• xfg-dev-tech-dubbo-test

```java
@Resource(name = "rpcProxyBeanFactory")
private IUserService proxyUserService;

@Test
public void test_proxyUserService(){
    UserReqDTO reqDTO = UserReqDTO.builder().userId("10001").build();
    Response<UserResDTO> resDTO = proxyUserService.queryUserInfo(reqDTO);
    log.info("æµ‹è¯•ç»“æœ req: {} res: {}", JSON.toJSONString(reqDTO), JSON.toJSONString(resDTO));
}
```

**æµ‹è¯•ç»“æœ**

```java
2023-07-08 16:14:51.322  INFO 74498 --- [           main] c.b.d.tech.dubbo.consumer.test.ApiTest   : æµ‹è¯•ç»“æœ req: {"userId":"10001"} res: {"code":"0000","data":{"userAge":20,"userId":"10001","userName":"å°å‚…å“¥"},"info":"æˆåŠŸ"}
```

- è¿™é‡Œæˆ‘ä»¬ç»™ IUserService æ³¨å…¥ä¸€ä¸ªè‡ªå·±ä»£ç†å¥½çš„å¯¹è±¡ï¼Œä¹‹åå°±å¯ä»¥è°ƒç”¨éªŒè¯äº†ã€‚
- å¥½å•¦ï¼Œåˆ°è¿™æˆ‘ä»¬å°±æŠŠå…³äº Dubbo çš„äº‹äº¤ä»£æ˜ç™½äº†ï¼Œä»¥ä¸Šå†…å®¹è¾ƒå¤šã€‚å°å¡æ‹‰ç±³éœ€è¦ç»†ç»†çš„å“å‘³å¸æ”¶ï¼
