---
title: AREX - æµé‡å½•åˆ¶&å›æ”¾
lock: need
---

# AREX - æµé‡å½•åˆ¶&å›æ”¾

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æŠ€æœ¯UPä¸»å°å‚…å“¥ã€‚

åœ¨äº’è”ç½‘å¤§å‚åº”ç”¨ç³»ç»Ÿå¼€å‘ä¸­ï¼Œæœ‰ä¸€é¡¹éå¸¸é‡è¦çš„æŠ€æœ¯æ‰‹æ®µï¼Œä¿è¯æ–°è¿­ä»£åŠŸèƒ½çš„å¯é æ€§ã€‚è™½ç„¶ï¼Œè¿™åƒæŠ€æœ¯ä¹Ÿä¸æ˜¯â€œé“¶å¼¹ï¼ˆå•¥éƒ½èƒ½æå®šï¼‰â€ï¼Œä½†ç¼ºå°‘è¿™é¡¹æŠ€æœ¯ï¼Œå¯¹äºæå…¶å¤æ‚çš„ä¸šåŠ¡åœºæ™¯æ–°ä¸Šçº¿åŠŸèƒ½ï¼Œæ€»æ„Ÿè§‰å¿ƒé‡Œæ²¡åº•ï¼â€”â€” å®ƒå°±æ˜¯`æµé‡å½•åˆ¶`å’Œ`æµé‡å›æ”¾`ï¼

<div align="center">
    <img src="https://bugstack.cn/images/article/zsxq/student-learn-01.gif" width="150px">
</div>

**å¦‚ä½•ä¿è¯ç³»ç»Ÿçš„å¯é æ€§ï¼Ÿ**

äº’è”ç½‘å¤§å‚tocåœºæ™¯ï¼Œéå¸¸é‡è§†äº¤ä»˜çš„å¯é æ€§ï¼Œç”šè‡³å¤§äºäº¤ä»˜çš„æ•ˆç‡æ€§ã€‚æ‰€ä»¥ï¼Œåœ¨æ•´ä¸ªç ”å‘å£°æ˜å‘¨æœŸè¿‡ç¨‹ä¸­ï¼Œè¦æœ‰ PRD è¯„å®¡ã€ç ”å‘è®¾è®¡ä»£ç ã€ä»£ç è¯„å®¡ã€ä»£ç åˆ†æ”¯åˆå¹¶è¯„å®¡ï¼Œä»¥åŠåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¿˜æœ‰æµ‹è¯•äººå‘˜è¿›è¡Œå…¨æµç¨‹çš„éªŒè¯ã€‚

ä½†å³ä½¿è¿™æ ·ï¼Œé¢å¯¹ç»å†äº†æ•°åå¹´è¿­ä»£çš„ç³»ç»Ÿï¼Œå•å·¥ç¨‹ç”šè‡³å‡ åä¸‡è¡Œä»£ç ï¼Œæå…¶å¤æ‚çš„ä¸šåŠ¡ç³»ç»Ÿæµç¨‹ï¼Œæµ‹è¯•ä¹Ÿæ˜¯å¯èƒ½ä¼šå‡ºç°ç–æ¼ã€‚è¿™ç§ç–æ¼å¦‚ï¼Œè™½ç„¶éæœ¬æ¬¡éœ€æ±‚è¿­ä»£çš„åœºæ™¯ï¼Œä½†æ˜¯å…¶ä»–ä¸šåŠ¡åœºæ™¯å› å½“å‰ç³»ç»Ÿçš„ä¸€ä¸ªæšä¸¾ï¼Œä¸€ä¸ªå‚æ•°çš„å˜åŠ¨ï¼Œéƒ½ä¼šå½±å“åˆ°æ•°åæ¡ä¸šåŠ¡ã€‚å“ªæ€•ä¸æ˜¯ä»£ç å˜åŠ¨ï¼Œä»…ä»…æ˜¯é‡æ„äº†å°éƒ¨åˆ†ä»£ç å—ï¼Œè°ƒæ•´äº†å‰åé¡ºåºï¼Œå½“å‰ä¸šåŠ¡æ— å½±å“ï¼Œä½†ç¡®å½±å“äº†æŸæ¬¡å…¶ä»–ä»»åŠ¡çš„è·‘æ‰¹ç»“æœï¼

ä¸€æ¬¡äº‹æ•…ï¼Œå¯èƒ½æ˜¯æ‰£ç»©æ•ˆå’Œå¹´ç»ˆå¥–ï¼Œä¹Ÿå¯èƒ½æ˜¯å½±å“æ™‹å‡æåï¼Œè¿˜å¯èƒ½æ˜¯ç›´æ¥æ¯•ä¸šğŸ“å•¦ï¼æ‰€ä»¥ï¼Œåœ¨äº’è”ç½‘å¤§å‚ç­ç»„ğŸ§±æ¬ç –ï¼Œä¼šå­¦åˆ°å¾ˆå¤šé«˜çº§æŠ€å·§ï¼Œæ¥ä¿è¯ç³»ç»Ÿçš„å¯é æ€§ã€‚

>å…³æ³¨å°å‚…å“¥ [bugstack.cn](https://bugstack.c) åšå®¢ï¼Œç¼–ç¨‹è·¯ä¹¦ï¼Œå¯ä»¥å­¦ä¹ åˆ°éå¸¸å¤šçš„äº’è”ç½‘ä¼ä¸šä½¿ç”¨æŠ€èƒ½ï¼Œè¡¥å…¨è‡ªå·±çš„çŸ­æ¿ï¼å¦‚ï¼›ç³»ç»Ÿæ¶æ„ã€å¼€å‘ç¯å¢ƒã€å¼€å‘æŠ€æœ¯ã€æˆæƒæ¡†æ¶ã€å¸¸ç”¨ç±»åº“ã€å·¥ç¨‹æµ‹è¯•ã€è´¨é‡ç›‘æ§ã€å‘å¸ƒéƒ¨ç½²ç­‰ã€‚

## ä¸€ã€è¯´è¯´æ¦‚å¿µ

å…¶å®ç®€å•æ¥è®²ï¼Œæµé‡å½•åˆ¶ï¼Œæ ¸å¿ƒçš„æœ¬è´¨å°±æ˜¯æŠŠçº¿ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œåœ¨æœ‰æµé‡è¯·æ±‚åˆ°æœåŠ¡æ¥å£åï¼ŒæŠŠè¯·æ±‚æ¥å£çš„å…¥å‚å’Œæ‰§è¡Œçš„ç»“æœï¼Œéƒ½ä¿å­˜ä¸‹æ¥ã€‚ä¹‹åæµé‡å›æ”¾ï¼Œåˆ™æ˜¯æŠŠè¿™äº›ä¿å­˜ä¸‹æ¥çš„å…¥å‚ä¿¡æ¯ï¼Œåœ¨å¼€å‘ç¯å¢ƒ/æµ‹è¯•ç¯å¢ƒ/é¢„å‘ç¯å¢ƒï¼Œè¿›è¡Œè¯·æ±‚ï¼Œä¹‹åéªŒè¯è¯·æ±‚åçš„ç»“æœæ˜¯å¦ä¸çº¿ä¸Šå½•åˆ¶çš„æµé‡ç»“æœä¸€è‡´ã€‚æ•´ä¸ªçš„è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯æµé‡çš„å½•åˆ¶å’Œå›æ”¾ã€‚

ä½†å®é™…çš„æ“ä½œåœºæ™¯è¦æ¯”è¿™ä¸ªè¿‡ç¨‹å¤æ‚ï¼Œå¦‚ï¼›å½•åˆ¶æµé‡çš„æ“ä½œï¼Œè¦æ— ä¾µå…¥ä»£ç çš„ï¼Œè¦æŠŠæ•´ä¸ªè°ƒç”¨é“¾è·¯ï¼Œå…¨éƒ¨å½•åˆ¶ä¸‹æ¥ï¼Œè€Œä¸æ˜¯å•ä¸ªæ¥å£ã€‚åŒæ—¶å½•åˆ¶çš„ä¸åªæ˜¯å¯¹æ¥å£çš„æ“ä½œï¼Œè¿˜æœ‰ç¼“å­˜ã€rpcã€æ•°æ®åº“ï¼ˆMyBatisï¼‰ã€esï¼Œç­‰å„ç±»ç»„ä»¶å…¼å®¹ï¼Œéƒ½èƒ½ç¡®ä¿å¯æ­£ç¡®å½•åˆ¶åˆ°å®Œæ•´æ•°æ®ï¼Œä»¥ä¾¿åœ¨æµé‡å›æ”¾æ—¶ï¼Œå¯ä»¥mockæ‰æ•°æ®æ¥å£ï¼Œä»¥æ­¤åªéªŒè¯åŠŸèƒ½é€»è¾‘ã€‚

è¯´åˆ°ï¼Œé€»è¾‘å’Œæ•°æ®ï¼Œè¿™é‡Œæƒ³åˆ°äº†DDDæ¶æ„çš„é¢†åŸŸå±‚å’ŒåŸºç¡€è®¾æ–½å±‚ï¼Œé¢†åŸŸå±‚ï¼ˆdomainï¼‰ä¸“é—¨ä¸šåŠ¡åŠŸèƒ½é€»è¾‘çš„ï¼Œè€ŒåŸºç¡€è®¾ç½®å±‚ï¼ˆinfrastructureï¼‰åˆ™æ˜¯æä¾›æ•°æ®çš„ã€‚è¿™æ ·æœ‰äº†ä¸šåŠ¡åŠŸèƒ½å’Œæ•°æ®è·å–çš„åˆ†ç¦»ï¼Œä¸è®©æ ¸å¿ƒä¸šåŠ¡é€»è¾‘åˆæºæ‚å¤–éƒ¨æ¥å£çš„è°ƒç”¨ï¼Œå…¶å®ç»´æŠ¤å’Œè¿­ä»£èµ·æ¥ï¼Œæ˜¯ä¼šæ›´åŠ å®¹æ˜“çš„ã€‚

## äºŒã€è®²è®²åŸç†

ä¸ºäº†å¯ä»¥æ— ä¾µå…¥å¼çš„å®Œæˆç³»ç»Ÿçš„æµé‡å½•åˆ¶å’Œæµé‡å›æ”¾ï¼Œè¿™é‡Œå¼•å…¥äº†ä¸€ä¸ª Java Agent å­—èŠ‚ç å¢å¼ºæŠ€æœ¯ï¼Œé€šè¿‡åœ¨ç¨‹åºå¯åŠ¨é˜¶æ®µï¼Œå¯¹å·¥ç¨‹ä»£ç çš„æ–¹æ³•è¿›è¡ŒåŸ‹ç‚¹ã€‚è¿™ä¸ªåŸ‹ç‚¹ï¼Œå°±ç­‰åŒäºåŠ¨æ€çš„é€šè¿‡ class æ–‡ä»¶å†™å…¥æ–°çš„ä»£ç ï¼Œæ–°çš„ä»£ç å¯ä»¥é‡‡é›†åˆ°æ–¹æ³•çš„å‡ºå…¥å‚ä¿¡æ¯ï¼Œå¹¶æŠŠè¿™äº›ä¿¡æ¯å‘é€åˆ°æµé‡å½•åˆ¶å­˜å‚¨æ–¹ï¼Œæˆ–è€…æ‰§è¡Œæ—¶è¿›è¡Œmockæ¥å£è¯·æ±‚ç»“æœå¤„ç†ã€‚

è¿™éƒ¨åˆ†æŠ€æœ¯æ–¹æ¡ˆï¼Œå°å‚…å“¥äº19-20å¹´ï¼Œç¼–å†™äº†å…ˆå…³çš„æŠ€æœ¯èµ„æ–™ã€‚å…¶ä¸­åŒ…æ‹¬äº†ç”¨äºå¤„ç†å­—èŠ‚ç å¢å¼ºæŠ€æœ¯çš„ï¼Œasmã€javassistã€byte-buddy ä¸‰ç§æ¡†æ¶ã€‚

<div align="center">
    <img src="https://bugstack.cn/assets/images/2020/itstack-demo-asm-02-1.png" width="750px">
</div>

æ–‡æ¡£ï¼š[https://bugstack.cn/md/bytecode/asm/2020-04-05-%5BASM%E5%AD%97%E8%8A%82%E7%A0%81%E7%BC%96%E7%A8%8B%5DJavaAgent+ASM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8F%92%E6%A1%A9%E9%87%87%E9%9B%86%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0%E4%BB%A5%E5%8F%8A%E5%85%A5%E5%8F%82%E5%92%8C%E5%87%BA%E5%8F%82%E7%BB%93%E6%9E%9C%E5%B9%B6%E8%AE%B0%E5%BD%95%E6%96%B9%E6%B3%95%E8%80%97%E6%97%B6.html](https://bugstack.cn/md/bytecode/asm/2020-04-05-%5BASM%E5%AD%97%E8%8A%82%E7%A0%81%E7%BC%96%E7%A8%8B%5DJavaAgent+ASM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8F%92%E6%A1%A9%E9%87%87%E9%9B%86%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0%E4%BB%A5%E5%8F%8A%E5%85%A5%E5%8F%82%E5%92%8C%E5%87%BA%E5%8F%82%E7%BB%93%E6%9E%9C%E5%B9%B6%E8%AE%B0%E5%BD%95%E6%96%B9%E6%B3%95%E8%80%97%E6%97%B6.html)

### 1. å¢å¼ºä»£ç 

```java
mv.visitVarInsn(LLOAD, startTimeIdentifier);
mv.visitLdcInsn(methodId);
if (parameterTypeList.isEmpty()) {
    mv.visitMethodInsn(INVOKESTATIC, Type.getInternalName(ProfilingAspect.class), "point", "(JI)V", false);
} else {
    mv.visitVarInsn(ALOAD, parameterIdentifier);  // 5
    mv.visitVarInsn(ALOAD, localCount);           // 6
    mv.visitMethodInsn(INVOKESTATIC, Type.getInternalName(ProfilingAspect.class), "point", "(JI[Ljava/lang/Object;Ljava/lang/Object;)V", false);
}
```

### 2. æ‹¦æˆªä¿¡æ¯

```java
ASMç±»è¾“å‡ºè·¯å¾„ï¼š/Users/xiaofuge/itstack/git/github.com/SQM/target/test-classes/org/itstack/test/ApiTest$1SQM.class
ç›‘æ§ - Begin
ç±»åï¼šorg.itstack.test.ApiTest
æ–¹æ³•ï¼šqueryUserInfo
å…¥å‚ç±»å‹ï¼š["I","I"]
å…¥æ•°[å€¼]ï¼š[111,17]
å‡ºå‚ç±»å‹ï¼šLjava/lang/String;
å‡ºå‚[å€¼]ï¼š"ä½ å¥½ï¼Œbugstackè™«æ´æ ˆ | ç²¾ç¥å°ä¼™ï¼"
è€—æ—¶ï¼š95(s)
ç›‘æ§ - End

æµ‹è¯•ç»“æœï¼šä½ å¥½ï¼Œbugstackè™«æ´æ ˆ | ç²¾ç¥å°ä¼™ï¼
```

- ä»¥ä¸Šä¸ºç®€è¦çš„æ¡ˆä¾‹ä»£ç ï¼Œé€šè¿‡ASMå­—èŠ‚ç å¢å¼ºæ¡†æ¶æ¥å¯¹æ–¹æ³•ä¿®æ”¹ï¼Œå¢åŠ æ—¥å¿—æ‰“å°ä¿¡æ¯ï¼Œåœ¨æ‰§è¡Œæ–¹æ³•æ—¶ï¼Œè·å–å‡ºå…¥å‚ã€‚
- å­—èŠ‚ç å¢å¼ºæŠ€æœ¯åº”ç”¨çš„æ–¹é¢éå¸¸å¤šï¼Œå¦‚ï¼›MapStructã€éå…¥ä¾µçš„å…¨é“¾è·¯ç›‘æ§ã€Lombokï¼Œç”šè‡³ä½ ç”¨è¿‡çš„ IntelliJ IDEA ç ´è§£ä¹Ÿæ˜¯å­—èŠ‚ç å¢å¼ºæŠ€æœ¯ã€‚

## ä¸‰ã€å·¥å…·ä»‹ç»

å…³äºæµé‡å½•åˆ¶å’Œæµé‡å›æ”¾çš„å·¥å…·æ˜¯è›®å¤šçš„ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼›[jvm-sandbox-repeater](https://github.com/alibaba/jvm-sandbox-repeater)ã€[MoonBox](https://github.com/vivo/MoonBox)ã€[arextest](https://arextest.com/) ç­‰ã€‚

- jvm-sandbox-repeaterï¼Œæ˜¯ä¸€ä¸ªåŸºäº JVM-Sandbox é‡‡ç”¨Javaæ¥å®ç°çš„æµé‡å½•åˆ¶å›æ”¾å·¥å…·ï¼Œæˆ–è€…å¯ä»¥ç†è§£ä¸ºå®ƒæ˜¯ä¸€ä¸ªåŸºäºJavaè™šæ‹Ÿæœºçš„æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œä¸­JVMä¸­ï¼Œæ— éœ€å¯¹ç›®æ ‡åº”ç”¨ç¨‹åºè¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚
- Moonboxï¼ˆæœˆå…‰å®ç›’ï¼‰ï¼Œæ˜¯ä¸€ä¸ªæ— ä¾µå…¥çš„çº¿ä¸Šæµé‡å½•åˆ¶ å’Œæµé‡å›æ”¾å¹³å°ï¼Œæ²¿ç”¨äº†jvm-sandbox-repeaterçš„SPIè®¾è®¡ï¼Œå¹¶æä¾›äº†å¤§é‡çš„å¸¸ç”¨æ’ä»¶ï¼ŒåŒæ—¶ä¹Ÿæä¾›æ•°æ®ç»Ÿè®¡å’Œå­˜å‚¨èƒ½åŠ›ã€‚é€šè¿‡Moonboxå¯ä»¥å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•ã€çº¿ä¸Šé—®é¢˜è¿½è¸ªã€å’Œä¸šåŠ¡ç›‘æ§ç­‰èƒ½åŠ›
- arextestï¼ŒAREX é€šè¿‡å°†çœŸå®çš„åœ¨çº¿æµé‡å¤åˆ¶åˆ°æµ‹è¯•ç¯å¢ƒè¿›è¡Œè‡ªåŠ¨åŒ– API æµ‹è¯•æ¥è§£å†³è‡ªåŠ¨åŒ–æµ‹è¯•çš„æŒ‘æˆ˜ã€‚**ä½œä¸ºæœ¬æ–‡åˆ†äº«åœºæ™¯å·¥å…·ä½¿ç”¨ã€‚**

**åè¯è§£é‡Š**

- **å½•åˆ¶**ï¼šæŠŠä¸€æ¬¡è¯·æ±‚çš„å…¥å‚ã€å‡ºå‚ã€**ä¸‹æ¸¸RPCã€DBã€ç¼“å­˜**ç­‰åºåˆ—åŒ–å¹¶å­˜å‚¨çš„è¿‡ç¨‹
- **å›æ”¾**ï¼šæŠŠå½•åˆ¶æ•°æ®è¿˜åŸï¼Œé‡æ–°å‘èµ·ä¸€æ¬¡æˆ–Næ¬¡è¯·æ±‚ï¼Œå¯¹ç‰¹å®šçš„ä¸‹æ¸¸èŠ‚ç‚¹è¿›è¡ŒMOCKçš„è¿‡ç¨‹
- **å…¥å£è°ƒç”¨**ï¼šå…¥å£è°ƒç”¨ä¸€èˆ¬æ˜¯åº”ç”¨çš„**æµé‡æ¥æº**ï¼Œæ¯”å¦‚http/dubboï¼Œåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­å½•åˆ¶è°ƒç”¨å…¥å‚ï¼Œè¿”å›å€¼ã€‚å›æ”¾æ—¶ä½œä¸ºæµé‡å‘èµ·å’Œæ‰§è¡Œç»“æœå¯¹æ¯”ä¾æ®
- **å­è°ƒç”¨**ï¼šåŒºåˆ«äºå…¥å£è°ƒç”¨ï¼Œå­è°ƒç”¨æ˜¯è°ƒç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŸæ¬¡æ–¹æ³•è°ƒç”¨ã€‚å­è°ƒç”¨åœ¨å½•åˆ¶æ—¶ä¼šè®°å½•è¯¥æ–¹æ³•çš„å…¥å‚ã€è¿”å›å€¼ï¼›å›æ”¾æ—¶ç”¨è¯¥è¿”å›å€¼è¿›è¡ŒMOCK
- **MOCK**ï¼šåœ¨å›æ”¾æ—¶ï¼Œè¢«æ‹¦æˆªçš„å­è°ƒç”¨**ä¸ä¼šå‘ç”ŸçœŸå®è°ƒç”¨**ï¼Œåˆ©ç”¨å­—èŠ‚ç åŠ¨æ€å¹²é¢„èƒ½åŠ›ï¼Œå°†å½•åˆ¶æ—¶çš„è¿”å›å€¼ç›´æ¥è¿”å›
- **é™å™ª**ï¼šåœ¨å›æ”¾æ—¶ï¼Œéƒ¨åˆ†å›æ”¾å­è°ƒç”¨å…¥å‚æˆ–è€…å›æ”¾æµé‡å“åº”ç»“æœå’ŒåŸå§‹æµé‡å¯¹æ¯”ä¸ä¸€è‡´å­—æ®µï¼Œå¯¹è¿™äº›éå¿…è¦å­—æ®µè¿›è¡Œæ’é™¤å¯¹æ¯”è¿‡ç¨‹

## å››ã€å·¥å…·ä½¿ç”¨

### 1. æ¡ˆä¾‹å·¥ç¨‹

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-01.png" width="800px">
</div>

- åœ°å€ï¼š[https://github.com/fuzhengwei/xfg-dev-tech-traffic-agent](https://github.com/fuzhengwei/xfg-dev-tech-traffic-agent)
- å¦‚å›¾ï¼š1~6ç‚¹ï¼Œè¯´æ˜äº†å„ä¸ªæ¨¡å—çš„ç”¨é€”ã€‚
- æç¤ºï¼šå»ºè®®ä½¿ç”¨äº‘æœåŠ¡å™¨éƒ¨ç½²æµé‡å½•åˆ¶&å›æ”¾æœåŠ¡ï¼Œéå¸¸æ–¹ä¾¿ã€‚

### 2. å®‰è£…æ’ä»¶

åœ°å€ï¼š[https://chromewebstore.google.com/detail/arex-chrome-extension/jmmficadjneeekafmnheppeoehlgjdjj](https://chromewebstore.google.com/detail/arex-chrome-extension/jmmficadjneeekafmnheppeoehlgjdjj)

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-04.png" width="800px">
</div>

- å®‰è£…æ’ä»¶æ˜¯ä¸ºäº†æœ‰æƒé™è®¿é—®æ¥å£ã€‚

### 3. æœåŠ¡éƒ¨ç½²ï¼ˆarexï¼‰

**å‰ç½®æ¡ä»¶**ï¼Œ2c4gäº‘æœåŠ¡å™¨ï¼Œå®Œæˆåˆå§‹åŒ–Dockerç¯å¢ƒã€‚è¿™é‡Œæœ‰ä¸€é”®å®‰è£…è„šæœ¬ï¼Œ[https://bugstack.cn/md/road-map/docker-install.html](https://bugstack.cn/md/road-map/docker-install.html)

```java
[root@iv-jdyun ~]# cd /
[root@iv-jdyun ~]# mkdir dev-ops
[root@iv-jdyun ~]# cd dev-ops
[root@iv-jdyun ~]# sudo yum install git
[root@iv-jdyun ~]# git clone --depth 1 https://github.com/arextest/deployments.git
[root@iv-jdyun ~]# cd deployments
[root@iv-jdyun ~]# docker-compose up -d
```

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-02.png" width="800px">
</div>

- æ‰§è¡Œè„šæœ¬å®‰è£…å®Œæˆåï¼Œåœ¨äº‘æœåŠ¡å™¨å®‰å…¨ç»„å¼€æ”¾ç«¯å£å·ï¼ˆå‡º/å…¥è§„åˆ™ï¼‰ã€‚
- ä¹‹åè®¿é—®ï¼šhttp://ip:8088 é¦–æ¬¡è®¿é—®ä¼šæ…¢ä¸€äº›ï¼Œè¿›å…¥åä¼šè®©è®¾ç½®ä½ çš„ç™»å½•è´¦å·ã€‚

### 4. å¯åŠ¨é¡¹ç›® - å½•åˆ¶æµé‡

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-03.png" width="900px">
</div>

- é¦–å…ˆï¼Œéœ€è¦ç»™é¡¹ç›®å·¥ç¨‹åŠ å…¥ä¸€ä¸ª agentï¼Œæ¥å½•åˆ¶å’Œå›æ”¾ã€‚arex çš„ agent jarï¼Œä¸‹è½½åæ–¹åˆ°å·¥ç¨‹ä¸‹ï¼Œlib ä¸­ã€‚ç›®å‰å·¥ç¨‹ä¸­å·²ç»ä¸‹è½½äº†ï¼Œå¦‚æœå°†æ¥æœ‰æ›´æ–°ï¼Œå¯ä»¥é‡æ–°ä¸‹è½½æœ€æ–°çš„ã€‚åœ°å€ï¼š[https://github.com/arextest/arex-agent-java/releases](https://github.com/arextest/arex-agent-java/releases)
- ä¹‹åï¼Œæœ¬åœ°é¡¹ç›®æµ‹è¯•éªŒè¯çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆ **install**ï¼ŒæˆåŠŸä¹‹åä½¿ç”¨ `run_application_2_agent.sh` å¯åŠ¨é¡¹ç›®ï¼Œè¿™ä¸ªæ“ä½œä¼šæŠŠ agent åŠ è½½åˆ°ç¨‹åºå¯åŠ¨ä¸­ã€‚

#### 4.1 æœ¬åœ°æµ‹è¯•

```java
#!/bin/bash

# AREX Agent å¯åŠ¨è„šæœ¬
# ç”¨äºåœ¨ä¸åŒç¯å¢ƒä¸‹å¯åŠ¨åº”ç”¨å¹¶åŠ è½½ AREX Agent

# è®¾ç½® AREX Agent ç›¸å…³å‚æ•°
AREX_AGENT_PATH="./lib/arex-agent.jar"
AREX_SERVICE_NAME="xfg-dev-tech-app"
AREX_STORAGE_HOST="115.190.107.206:8093"

# åº”ç”¨ JAR åŒ…è·¯å¾„ï¼ˆç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
APP_JAR="../../xfg-dev-tech-app/target/xfg-dev-tech-app.jar"

# JVM å‚æ•°
JVM_OPTS="-Xms512m -Xmx1024m"

# æ£€æŸ¥ AREX Agent æ–‡ä»¶æ˜¯å¦å­˜åœ¨
if [ ! -f "$AREX_AGENT_PATH" ]; then
    echo "é”™è¯¯: AREX Agent æ–‡ä»¶ä¸å­˜åœ¨: $AREX_AGENT_PATH"
    echo "è¯·ç¡®ä¿ arex-agent.jar æ–‡ä»¶å·²æ”¾ç½®åœ¨æ­£ç¡®ä½ç½®"
    exit 1
fi

# æ£€æŸ¥åº”ç”¨ JAR åŒ…æ˜¯å¦å­˜åœ¨
if [ ! -f "$APP_JAR" ]; then
    echo "é”™è¯¯: åº”ç”¨ JAR åŒ…ä¸å­˜åœ¨: $APP_JAR"
    echo "è¯·å…ˆæ‰§è¡Œ mvn clean package æ„å»ºåº”ç”¨"
    exit 1
fi

echo "æ­£åœ¨å¯åŠ¨åº”ç”¨..."
echo "AREX Agent: $AREX_AGENT_PATH"
echo "Service Name: $AREX_SERVICE_NAME"
echo "Storage Host: $AREX_STORAGE_HOST"
echo "Application: $APP_JAR"
echo ""

echo "æ‰§è¡Œé…ç½®ï¼š"$JVM_OPTS \
          -javaagent:"$AREX_AGENT_PATH" \
          -Darex.service.name="$AREX_SERVICE_NAME" \
          -Darex.storage.service.host="$AREX_STORAGE_HOST" \
          -jar "$APP_JAR"

# å¯åŠ¨åº”ç”¨
java $JVM_OPTS \
     -javaagent:"$AREX_AGENT_PATH" \
     -Darex.service.name="$AREX_SERVICE_NAME" \
     -Darex.storage.service.host="$AREX_STORAGE_HOST" \
     -jar "$APP_JAR"
```

#### 4.2 docker é•œåƒ

##### 4.2.1 dockerfile

```java
# åŸºç¡€é•œåƒ
FROM openjdk:8-jre-slim

# ä½œè€…
MAINTAINER xiaofuge

# é…ç½®
ENV PARAMS=""

# AREX Agent é…ç½®
ENV AREX_SERVICE_NAME="xfg-dev-tech-app"
ENV AREX_STORAGE_HOST="115.190.107.206:8093"

# æ—¶åŒº
ENV TZ=PRC
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# æ·»åŠ  AREX Agent
ARG AREX_AGENT_PATH=docs/dev-ops/lib/arex-agent.jar
ADD ${AREX_AGENT_PATH} /arex-agent.jar

# æ·»åŠ åº”ç”¨
ADD target/xfg-dev-tech-app.jar /xfg-dev-tech-app.jar

ENTRYPOINT ["sh","-c","java $JAVA_OPTS -javaagent:/arex-agent.jar -Darex.service.name=$AREX_SERVICE_NAME -Darex.storage.service.host=$AREX_STORAGE_HOST -jar /xfg-dev-tech-app.jar $PARAMS"]
```

##### 4.2.2 docker-compose

```java
version: '3.8'

services:
  xfg-dev-tech-app:
    image: fuzhengwei/xfg-dev-tech-app:traffic-agent-v1
    container_name: xfg-dev-tech-app
    ports:
      - "8091:8091"
    environment:
      # AREX Agent é…ç½®
      - AREX_SERVICE_NAME=xfg-dev-tech-app
      - AREX_STORAGE_HOST=115.190.107.206:8093
      # JVM é…ç½®
      - JAVA_OPTS=-Xms512m -Xmx1024m
    volumes:
      # æ—¥å¿—ç›®å½•æŒ‚è½½ï¼ˆå¯é€‰ï¼‰
      - ./data/logs:/var/log/app
    networks:
      - app-network
    restart: unless-stopped
    
networks:
  app-network:
    driver: bridge

volumes:
  app-logs:
    driver: local
```

- æ­¤æ–¹å¼é€‚ç”¨äºé¡¹ç›®éƒ¨ç½²ä¸Šçº¿ã€‚

### 5. å¯åŠ¨ç¨‹åº

```java
./bin/bash /xfg-dev-tech-traffic-agent/docs/dev-ops/run_application_2_agent.sh
```

```java
(base) fuzhengwei1@ZBMac-GV47H1GXD dev-ops % /bin/bash /Users/fuzhengwei1/Documents/develop/github/xfg-dev-tech-traffic-agent/docs/dev-ops/run_application_2_agent.sh
æ­£åœ¨å¯åŠ¨åº”ç”¨...
AREX Agent: ./lib/arex-agent.jar
Service Name: xfg-dev-tech-app
Storage Host: 115.190.107.206:8093
Application: ../../xfg-dev-tech-app/target/xfg-dev-tech-app.jar

æ‰§è¡Œé…ç½®ï¼š-Xms512m -Xmx1024m -javaagent:./lib/arex-agent.jar -Darex.service.name=xfg-dev-tech-app -Darex.storage.service.host=115.190.107.206:8093 -jar ../../xfg-dev-tech-app/target/xfg-dev-tech-app.jar
2025-06-21 17:57:25:792 [AREX] Agent-v0.4.8 starts initialization...
Java HotSpot(TM) 64-Bit Server VM warning: Sharing is only supported for boot loader classes because bootstrap classpath has been appended

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::               (v2.7.12)

25-06-21.17:57:27.856 [main            ] INFO  Application            - Starting Application v1.0-SNAPSHOT using Java 17.0.7 on ZBMac-GV47H1GXD with PID 96181 (/Users/fuzhengwei1/Documents/develop/github/xfg-dev-tech-traffic-agent/xfg-dev-tech-app/target/xfg-dev-tech-app.jar started by fuzhengwei1 in /Users/fuzhengwei1/Documents/develop/github/xfg-dev-tech-traffic-agent/docs/dev-ops)
25-06-21.17:57:27.858 [main            ] INFO  Application            - The following 1 profile is active: "dev"
25-06-21.17:57:28.635 [main            ] INFO  TomcatWebServer        - Tomcat initialized with port(s): 8091 (http)
25-06-21.17:57:28.641 [main            ] INFO  Http11NioProtocol      - Initializing ProtocolHandler ["http-nio-8091"]
25-06-21.17:57:28.641 [main            ] INFO  StandardService        - Starting service [Tomcat]
25-06-21.17:57:28.642 [main            ] INFO  StandardEngine         - Starting Servlet engine: [Apache Tomcat/9.0.75]
25-06-21.17:57:28.683 [main            ] INFO  [/]                    - Initializing Spring embedded WebApplicationContext
25-06-21.17:57:28.683 [main            ] INFO  ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 781 ms
25-06-21.17:57:28.913 [main            ] INFO  Http11NioProtocol      - Starting ProtocolHandler ["http-nio-8091"]
25-06-21.17:57:28.928 [main            ] INFO  TomcatWebServer        - Tomcat started on port(s): 8091 (http) with context path ''
25-06-21.17:57:28.935 [main            ] INFO  Application            - Started Application in 1.575 seconds (JVM running for 3.285)
```

- å¯åŠ¨ç¨‹åºï¼Œä¼šçœ‹åˆ° arex-agent.jar çš„åŠ è½½ï¼Œè¿™ä»£è¡¨æ˜¯æ­£ç¡®âœ…çš„ï¼Œå¯ä»¥ä¸ŠæŠ¥æœåŠ¡ä¿¡æ¯ã€‚

### 6. æµé‡å½•åˆ¶

```java
@Slf4j
@RestController
@RequestMapping("/api/traffic")
public class TrafficController {

    @GetMapping("/query_user_age")
    public Integer queryUserAge(@RequestParam("userId") String userId) {
        log.info("è¯·æ±‚å‚æ•°:{}", userId);
//        return getCache();
        return getDB();
    }

    // æ¨¡æ‹Ÿä»ç¼“å­˜è·å–æ•°æ®
    public Integer getCache() {
        return 20;
    }

    // æ¨¡æ‹Ÿä»æ•°æ®åº“è·å–æ•°æ®
    public Integer getDB() {
        return 21;
    }

}
```

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-05.png" width="600px">
</div>

- ä½ å¯ä»¥ä½¿ç”¨å·¥ç¨‹ä¸‹ï¼Œtest-api-curl.sh è„šæœ¬è®¿é—®æ¥å£ï¼Œä¹Ÿå¯ä»¥å…¶ä»–æ–¹å¼è¯·æ±‚æ¥å£ã€‚
- å½“ä½ è¯·æ±‚å®Œæˆæ¥å£åï¼Œå°±å¯ä»¥å»arexæ§åˆ¶å°æ£€æŸ¥ä¸ŠæŠ¥çš„ä¿¡æ¯å’Œæµé‡å½•åˆ¶çš„æ•°æ®äº†ã€‚

### 7. æµé‡å›æ”¾

#### 7.1 å†…ç½‘ç©¿é€

æµé‡å›æ”¾æ˜¯ä»äº‘æœåŠ¡å™¨è°ƒç”¨æœ¬åœ°ï¼Œä½†æœ¬åœ°æ²¡æœ‰å¯¹å¤–çš„å…¬ç½‘IPï¼Œæ‰€ä»¥éœ€è¦å†…ç½‘ç©¿é€ï¼Œè®©äº‘æœåŠ¡å™¨å¯ä»¥è°ƒç”¨ã€‚è¿™é‡Œçš„å†…ç½‘ç©¿é€å·¥å…·å¾ˆå¤šï¼Œå¯ä»¥é€‰æ‹©ï¼›[natapp](https://natapp.cn/)ã€[cpolar.com](https://www.cpolar.com/) ç­‰ã€‚

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-06.png" width="800px">
</div>

```java
Powered By NATAPP       Please visit https://natapp.cn                                                                                                                                     (Ctrl+C to Quit)
                                                                                                                                                                                                           
Tunnel Status           Online                                                                                                                                                                             
  
Version                 2.3.9 (New Version 2.4.0)     
  
Forwarding              http://xfg-studio.natapp1.cc -> 127.0.0.1:8091                                                                                                                                     

Web Interface           Disabled                                                                                                                                                                           
                                                                                     
Total Connections       0                                                                                                                                        
```

- å¯åŠ¨åï¼Œä¼šæŠŠæœ¬åœ°çš„æœåŠ¡:ç«¯å£ï¼Œæš´æ¼å‡ºå»ï¼Œé€šè¿‡ http åŸŸååœ°å€è®¿é—®ã€‚
- æ³¨æ„ï¼Œåœ¨natappé…ç½®ä½ çš„åº”ç”¨ç«¯å£ï¼Œå¦‚ 8091ï¼Œå¦‚æœæ˜¯å…¶ä»–å°±ä¿®æ”¹ä¸‹ã€‚

#### 7.2 å›æ”¾é…ç½® - æ­£ç¡®å›æ”¾

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-07.png" width="800px">
</div>

- å¦‚å›¾ï¼Œå¡«å†™å›æ”¾é…ç½®ä¿¡æ¯ã€‚
- è¿™æ¬¡æˆ‘ä»¬æ˜¯æ­£ç¡®å›æ”¾ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°ç¨‹åºæ²¡æœ‰ä»»ä½•å˜æ›´ã€‚é…ç½®åç‚¹OKã€‚
- ç‚¹å‡»åï¼Œå¯ä»¥åœ¨æˆ‘ä»¬æœ¬åœ°æœåŠ¡çœ‹åˆ°å›è°ƒçš„æ—¥å¿—ï¼Œä½†è¿˜è¦ç¨å¾®ç­‰å¾…ä¸€ä¼š arex å¹³å°ï¼Œä»–è¦æ¯”å¯¹å›æ”¾ç»“æœã€‚å®Œæˆåï¼ŒPassed è¡¨ç¤ºå›æ”¾é€šè¿‡ã€‚

#### 7.2 å›æ”¾é…ç½® - å¼‚å¸¸å›æ”¾

é¦–å…ˆï¼Œæˆ‘ä»¬è¦ä¿®æ”¹ä¸‹ä»£ç ã€‚

```java
@RestController
@RequestMapping("/api/traffic")
public class TrafficController {

    @GetMapping("/query_user_age")
    public Integer queryUserAge(@RequestParam("userId") String userId) {
        log.info("è¯·æ±‚å‚æ•°:{}", userId);
//        return getCache();
        return getDB();
    }

    // æ¨¡æ‹Ÿä»ç¼“å­˜è·å–æ•°æ®
    public Integer getCache() {
        return 20;
    }

    // æ¨¡æ‹Ÿä»æ•°æ®åº“è·å–æ•°æ®
    public Integer getDB() {
        return 21;
    }

}
```

- è¿™ä¸ªæ¥å£æ–¹æ³•ï¼Œå¦‚æœå½•åˆ¶æµé‡æ˜¯ç”¨çš„ getCache()ï¼Œé‚£ä¹ˆè¿™ä¼šå°±ä¿®æ”¹ä¸º getDB()ï¼Œè®©ä¸¤æ¬¡ç»“æœä¸ä¸€æ ·ã€‚
- ä¹‹åï¼Œè¦é‡æ–° install å¹¶é‡æ–°æ‰§è¡Œ `run_application_2_agent.sh` å¯åŠ¨é¡¹ç›®ã€‚å…³é—­æ‰§è¡Œ Ctrl/Command + C

é…ç½®ï¼Œæµé‡å›æ”¾æ“ä½œã€‚

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-08.png" width="600px">
</div>

- ä¹‹åï¼Œå†æ¥ä¸€éå›æ”¾ã€‚è¿™æ ·å°±æ˜¯é”™è¯¯çš„ç»“æœäº†ã€‚

### 8. æ¥å£è¯·æ±‚ï¼ˆDebugï¼‰

<div align="center">
    <img src="https://bugstack.cn/images/roadmap/tutorial/road-map-traffic-agent-09.png" width="800px">
</div>

- arex å·¥å…·ï¼Œè¿˜æ”¯æŒçº¿ä¸Šè¯·æ±‚æœ¬åœ°æ¥å£æ“ä½œã€‚
- ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä»çº¿ä¸Šå½•åˆ¶çš„æµé‡ï¼Œå¯ä»¥ç›´æ¥æ‹¿æµé‡ï¼Œè°ƒè¯•æœ¬åœ°æ¥å£ã€‚æœ‰äº†è¿™æ ·ä¸€ä¸ªæ“ä½œï¼Œå“ªäº›çº¿ä¸Šè¯·æ±‚å‚æ•°éå¸¸å¤æ‚çš„ç»“æ„ï¼Œå°±å¯ä»¥ç›´æ¥ä¸€é”®å¯¹æœ¬åœ°è¿›è¡ŒéªŒè¯äº†ã€‚
