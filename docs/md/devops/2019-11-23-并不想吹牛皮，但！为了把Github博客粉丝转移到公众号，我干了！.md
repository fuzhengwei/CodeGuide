---
layout: post
category: itstack-demo-any
title: å¹¶ä¸æƒ³å¹ç‰›çš®ï¼Œä½†ï¼ä¸ºäº†æŠŠGithubåšå®¢ç²‰ä¸è½¬ç§»åˆ°å…¬ä¼—å·ï¼Œæˆ‘å¹²äº†ï¼
tagline: by ä»˜æ”¿å§”
tag: [java,itstack-demo-any]
excerpt: æˆªè‡³åˆ°19å¹´11æœˆæˆ‘å·²ç»å·¥ä½œ6å¹´äº†ï¼Œä»ä¸šJavaä½†ä¹ŸæŠ˜è…¾è¿‡C#ã€æPHPä¹Ÿå¼„è¿‡ä¸­ç»§å™¨ã€IOæ¿å¡ï¼Œä¼¼ä¹æˆ‘å°±æ˜¯ä¸€ä¸ªå¾ˆå–œæ¬¢åœ¨æŠ€æœ¯ä¸ŠæŠ˜è…¾çš„äººï¼ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿæäº†6å¹´çš„ä¸ªäººå°ç½‘ç«™ï¼Œå®ƒä»¬çš„å‘ˆç°å½¢å¼å¤šç§å¤šæ ·ï¼›æœ‰ç”¨PHPè‡ªå·±æ£é¼“çš„æŠ€æœ¯ç«™ç”¨äºåˆ†äº«èµ„æ–™ã€ä¹¦ç±ã€è½¯ä»¶ç­‰ã€æœ‰ç”¨PHPWINDå’ŒDISCUZçš„æ­å»ºçš„ä¸ªäººè®ºå›ã€æœ‰ç”¨emlogå’Œwordpressæ­å»ºçš„ä¸ªäººåšå®¢ã€ä¹Ÿæœ‰å€Ÿç”¨äºgithub+hexo/jekyllçš„èƒ½åŠ›ç»„è£…å‡ºçš„æŠ€æœ¯åšå®¢ã€‚ä½†æ— ä¸€ä¾‹å¤–å®ƒä»¬éƒ½æˆ˜æ­»äºå¾æˆ˜çš„è·¯ä¸Šäº†ï¼Œäº¡äºï¼›orgåŸŸåä¸èƒ½å¤‡æ¡ˆã€PHPæœåŠ¡å™¨ç˜«ç—ªè¢«æ¸…ç©ºã€httpè¿æ¥è¢«æ³¨å…¥æ¶æ„å†…å®¹ã€å®šä½ä¸å‡†ç¡®ç»å¸¸æ¢æ¨¡å¼ã€ç¼ºå°‘æ ¸å¿ƒä¼˜è´¨å†…å®¹ç­‰ç­‰ã€‚ä½†ï¼è€è¡²çš„å¿ƒä¾ç„¶å¦‚æ˜¥(cun)ï¼Œå› ä¸ºå–œæ¬¢å¹²ä¸€ä»¶äº‹ï¼Œå¾€å¾€æ¥è‡ªäºå¹²ä¸€äº†ä»¶å–œæ¬¢çš„äº‹ï¼
lock: need
---

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## 1. å‰è¨€ä»‹ç»
è¿™ä¸ªï¼æˆªè‡³åˆ°19å¹´11æœˆæˆ‘å·²ç»å·¥ä½œ6å¹´äº†ï¼Œä»ä¸šJavaä½†ä¹ŸæŠ˜è…¾è¿‡C#ã€æPHPä¹Ÿå¼„è¿‡ä¸­ç»§å™¨ã€IOæ¿å¡ï¼Œä¼¼ä¹æˆ‘å°±æ˜¯ä¸€ä¸ªå¾ˆå–œæ¬¢åœ¨æŠ€æœ¯ä¸ŠæŠ˜è…¾çš„äººï¼ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿæäº†6å¹´çš„ä¸ªäººå°ç½‘ç«™ï¼Œå®ƒä»¬çš„å‘ˆç°å½¢å¼å¤šç§å¤šæ ·ï¼›æœ‰ç”¨PHPè‡ªå·±æ£é¼“çš„æŠ€æœ¯ç«™ç”¨äºåˆ†äº«èµ„æ–™ã€ä¹¦ç±ã€è½¯ä»¶ç­‰ã€æœ‰ç”¨PHPWINDå’ŒDISCUZçš„æ­å»ºçš„ä¸ªäººè®ºå›ã€æœ‰ç”¨emlogå’Œwordpressæ­å»ºçš„ä¸ªäººåšå®¢ã€ä¹Ÿæœ‰å€Ÿç”¨äºgithub+hexo/jekyllçš„èƒ½åŠ›ç»„è£…å‡ºçš„æŠ€æœ¯åšå®¢ã€‚ä½†æ— ä¸€ä¾‹å¤–å®ƒä»¬éƒ½æˆ˜æ­»äºå¾æˆ˜çš„è·¯ä¸Šäº†ï¼Œäº¡äºï¼›orgåŸŸåä¸èƒ½å¤‡æ¡ˆã€PHPæœåŠ¡å™¨ç˜«ç—ªè¢«æ¸…ç©ºã€httpè¿æ¥è¢«æ³¨å…¥æ¶æ„å†…å®¹ã€å®šä½ä¸å‡†ç¡®ç»å¸¸æ¢æ¨¡å¼ã€ç¼ºå°‘æ ¸å¿ƒä¼˜è´¨å†…å®¹ç­‰ç­‰ã€‚ä½†ï¼è€è¡²çš„å¿ƒä¾ç„¶å¦‚æ˜¥(cun)ï¼Œå› ä¸ºå–œæ¬¢å¹²ä¸€ä»¶äº‹ï¼Œå¾€å¾€æ¥è‡ªäºå¹²ä¸€äº†ä»¶å–œæ¬¢çš„äº‹ï¼

æ‰€ä»¥ï¼ä»19å¹´å¼€å§‹æˆ‘åˆç»§ç»­å†™åšå®¢äº†ï¼Œæ³¨å†Œäº†æ–°çš„åŸŸåbugstack.cnï¼Œå¤‡äº†æ¡ˆã€ä¹°äº†æœåŠ¡å™¨ã€è¿˜å–Šäº†æ–°çš„å£å·ï¼›æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼å¹¶ä¸”å°†å°˜å°å·²ä¹…çš„å¾®ä¿¡å…¬ä¼—å·æ‰¾å›ï¼›ç»“æ„ä¸Šè°ƒæ•´ã€å†…å®¹ä¸Šå¸ƒå±€ã€ç²‰ä¸ä¸Šæ±‚å…³æ³¨ã€‚åœ¨è¿™æœŸé—´é‡åˆ°äº†æ›´å¤§çš„ç‰›ï¼›å°ç°ã€ç‹äºŒå“¥ã€çº¯æ´çš„å¾®ç¬‘è¿˜æœ‰æ¾å“¥ç­‰ä¸€ç¾¤ä¼™ä¼´ï¼Œä»ä»–ä»¬é‚£å­¦åˆ°å¾ˆå¤šçŸ¥è¯†ï¼ŒçœŸçš„éå¸¸æ„Ÿè°¢ï¼

é‚£ä¹ˆï¼è¿™æ¬¡çš„äº§å“åŠŸèƒ½æ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼›å°†åŸºäºGithub+Jekyllæ­å»ºçš„é™æ€åšå®¢ä¸æˆ‘å¹¶æœªå¼€å‘è¿‡çš„å¾®ä¿¡å…¬ä¼—å·åŠŸèƒ½æ‰“é€šï¼Œé€šè¿‡åœ¨æ–‡ç« çŸ­å£ä»¤ç åŠ é”å¼•å¯¼ç”¨æˆ·åˆ°å…¬ä¼—å·å†…å›å¤å¯†ç å¯è§£é”å†…å®¹ï¼Œä»¥æ­¤æ¥è·å¾—ç²‰ä¸å…³æ³¨ï¼Œå½“ç„¶å¦‚æœå–æ¶ˆå…³æ³¨äº†åˆ™æ–‡ç« ç»§ç»­é”å®šã€‚

åœ¨å¤šè¯´ä¸€å¥ï¼Œæˆ‘ç†è§£çš„äº§å“ï¼›å…¶å®æ˜¯ä½¿ç”¨ç ”å‘æŠ€æœ¯åŠ›æ­å»ºå‡ºå¯ä»¥ç”¨äºæ‰¿è½½æ¥æ”¶ç”¨æˆ·åœ¨å„ç§è®¾å¤‡ä¸Šæ‰€ç”Ÿäº§çš„è¡Œä¸ºæ•°æ®çš„ä¸€ç§äº§å“åŒ–æœåŠ¡ã€‚æ‰€ä»¥æœ‰äº›äº§å“åœ¨åšå‡æ³•ï¼ŒåŒæ—¶ä¹Ÿæœ‰ä¸ºä¸°å¯Œçš„åŠŸèƒ½åšåŠ æ³•ï¼Œä½†ç©¶å…¶ä¸€ç‚¹æˆ‘ä»¬å…¶å®éƒ½æ˜¯åœ¨ä¸ºæ¥æ”¶æœ‰ä»·å€¼æ•°æ®æœåŠ¡çš„ã€‚å…´è¡°å­˜äº¡ï¼Œçš†åœ¨æ ¸å¿ƒæ•°æ®æ²‰æ·€ä¸è¿ä½œä¸Šï¼

## 2. æµç¨‹è®¾è®¡
ä¸ºäº†ä½¿åšå®¢ç²‰ä¸ä¸»åŠ¨å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·åˆæ¬¡æµè§ˆæ–‡ç« æ—¶å¢åŠ æƒé™éªŒè¯ï¼Œç»™æ¯ä¸€ä¸ªç”¨æˆ·éƒ½ç”Ÿæˆä¸€ä¸ªå”¯ä¸€ç å¼•å¯¼ç”¨æˆ·åœ¨å…¬ä¼—å·å†…å›å¤è§£é”æ–‡ç« ï¼Œä»¥æ­¤æ¥ä¸å¾®ä¿¡openidå¯¹åº”ã€‚å½“ç”¨æˆ·å–æ¶ˆå…³æ³¨æ—¶åˆ™è¿›è¡Œåˆ é™¤openidæˆ–æ ‡è®°çŠ¶æ€ï¼Œä½¿å¾—ç”¨æˆ·æ— æ³•ç»§ç»­æµè§ˆæ–‡ç« ã€‚å…¶å®ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œæˆ‘å‚ç…§äº†å¤§ç‰›çš„æ–¹å¼å†…å®¹60%çš„åŒºåŸŸå¯è§ï¼Œå…¶ä½™å†…å®¹æ¸è¿›é®æŒ¡ï¼Œè’™èƒ§èƒ§çš„æ„Ÿè§‰è¿˜æŒºç¾ã€‚æ•´ä½“æµç¨‹å›¾å¦‚ä¸‹ï¼›
![å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ & æµç¨‹å›¾è®¾è®¡](https://bugstack.cn/assets/images/pic-content/2019/11/other-112601.png)

## 3. åŠŸèƒ½å®ç°
ä¸ºäº†å®ç°æœ¬äº§å“åŠŸèƒ½ï¼Œæˆ‘å‡†å¤‡äº†ï¼›
1. å¾®ä¿¡å…¬ä¼—å·ï¼›bugstackè™«æ´æ ˆ
2. åšå®¢ï¼›æœ¬æ–‡ä½¿ç”¨çš„æ˜¯github+jekyllï¼›åœ°å€ï¼šhttps://bugstack.cn
3. åŸŸåï¼›åŸŸåç”³è¯·æ¯”è¾ƒç®€å•ï¼Œä½†å¯èƒ½é’ˆå¯¹ä¸åŒçš„æœåŠ¡å•†è¿˜å¿…é¡»å¤‡æ¡ˆåæ‰å¯ä»¥ä½¿ç”¨
4. å‹ç›Ÿï¼›ä¸»è¦ä¸ºäº†è·å–å…¨å±€çš„å”¯ä¸€idå€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–å…·å¤‡æ­¤åŠŸèƒ½çš„äº§å“æˆ–è€…è‡ªå·±å®ç°
5. éƒ¨ç½²ç¯å¢ƒï¼›Javaäº‘æœåŠ¡å™¨ã€Mysqläº‘æ•°æ®åº“ã€httpsè¯ä¹¦ã€Jdk1.8ã€tomcat1.8ï¼Œäº‘å¸‚åœºæ¯”è¾ƒå¤šæŒ‰éœ€è´­ä¹°ï¼Œå¦‚æœæ˜¯æœ¬åœ°è°ƒè¯•å¯ä»¥ä½¿ç”¨https://natapp.cnï¼Œåšå…è´¹ç½‘ç»œç©¿é€æ˜ å°„

### 3.1 å‰ç«¯
å‰ç«¯ä¸»è¦è´Ÿè´£é’ˆå¯¹å‘å¸ƒæ—¶è®¾ç½®äº†look: needçš„æ–‡ç« ï¼Œåœ¨ç”¨æˆ·æµè§ˆæ–‡ç« æ£€æŸ¥æ˜¯å¦æœ‰æƒé™æŸ¥çœ‹å…¨éƒ¨å†…å®¹ï¼Œå½“ç”¨æˆ·æ²¡æœ‰æƒé™æ—¶éšè—æ–‡ç« 60%å†…å®¹ï¼Œå¹¶é€šè¿‡é¡µé¢ç»“å°¾æé†’ç”¨æˆ·åœ¨å…¬ä¼—å·å†…å›å¤å£ä»¤è§£é”æ–‡ç« ã€‚

1. æ‰¾åˆ°åŠ é”æ–‡ç« å®¹å™¨IDï¼Œæ–‡ç« å®¹å™¨é€‰æ‹©å™¨ï¼šarticle.post.container.needï¼Œæ‹¿åˆ°é€‰æ‹©å™¨IDé’ˆå¯¹è¿™ç±»æ–‡ç« è¿›è¡Œç¼©å°éšè—å¤„ç†ã€‚

```html
<article class="post container need lock" itemscope="" itemtype="http://schema.org/BlogPosting" style="height: 4400px;">

    <div class="row">

        
        <div class="col-md-9 markdown-body">

            <h2 id="å‰è¨€ä»‹ç»">å‰è¨€ä»‹ç»</h2>
<p>ä¸ºä»€ä¹ˆä¼šæœ‰è·¯ç”±å±‚ï¼Ÿå› ä¸ºåœ¨å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¸­ï¼Œå¾€å¾€å¹¶ä¸ä¼šç›´æ¥å°†æœåŠ¡æš´æ¼ç»™è°ƒç”¨ç«¯ï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨è·¯ç”±å±‚è¿›è¡Œä¸šåŠ¡éš”ç¦»ï¼Œä»¥è¾¾åˆ°ä¸åŒçš„ä¸šåŠ¡è°ƒç”¨å¯¹åº”çš„æœåŠ¡æ¨¡å—ã€‚</p>

<p><strong>Spring Cloud Zuul</strong></p>
```

2. ä½¿ç”¨JqueryæŠŠæ–‡ç« æ‰€åœ¨å®¹å™¨é«˜åº¦ç¼©å°ï¼Œè¿™æ ·ä¼šæŠŠå†…å®¹è¿›è¡Œå‹ç¼©

```js
// æ–‡ç« æ‰€åœ¨å®¹å™¨çš„é€‰æ‹©å™¨
var articleSelector = 'article.post.container.need';
// æ‰¾åˆ°æ–‡ç« æ‰€åœ¨çš„å®¹å™¨
var $article = $(articleSelector);

// æ–‡ç« çš„å®é™…é«˜åº¦
var article = $article[0], height = article.clientHeight;
// æ–‡ç« éšè—åçš„é«˜åº¦
var halfHeight = height * 0.4;
// éšè—ç¼©å°
$article.css('height', halfHeight + 'px');
$article.addClass('lock');
```

3. ç»™æ–‡ç« åŠ ä¸€ç‚¹æœ¦èƒ§æ„Ÿï¼Œæ¸å˜éšè—

```css
.asb-post-01 {
 position: absolute;
 left: 0;
 bottom: 0;
 width: 100%;
 display: none;
 z-index: 10000;
margin-bottom: 0;
}

.asb-post-01 .mask {
 height: 240px;
 width: 100%;
 background: -webkit-gradient(linear, 0 top, 0 bottom, from(rgba(255, 255, 255, 0)), to(#fff));
}
```

4. ä»UMå…¨å±€å”¯ä¸€IDä¸­è·å–token
å‹ç›Ÿä½œä¸ºç½‘ç«™æ•°æ®é‡‡é›†æœåŠ¡ï¼Œä¼šç”Ÿæˆä¸€ä¸ªé’ˆå¯¹ç”¨æˆ·çš„å…¨å±€å”¯ä¸€å€¼UM_distinctidï¼Œè€Œæˆ‘ä»¬éœ€è¦å°±ä½¿ç”¨è¿™ä¸ªå€¼éƒ¨åˆ†æˆªå–åä½œä¸ºå”¯ä¸€tokenåŠ é”é’¥åŒ™

```other
UM_distinctid = 16e9cd64925334-0882eb883c9554-7711b3e-144000-16e9cd6492631c
```

```js
function getCookie(name) {
	var value = "; " + document.cookie;
	var parts = value.split("; " + name + "=");
	if (parts.length == 2)
		return parts.pop().split(";").shift();
}

function getToken() {
    let value = getCookie('UM_distinctid');
    if (!value) {
        return getUUID().toUpperCase();
    }
    return value.substring(value.length - 6).toUpperCase();
}
```

5. å®šæ—¶è½®æ—‹æ£€æŸ¥æ˜¯å¦å…³æ³¨å…¬ä¼—å·å¹¶è§£é”ï¼Œå¯ä»¥ä¼˜åŒ–å†™å…¥å…¨å±€Jqueryå€¼æˆ–è€…è®°å½•åœ¨cookieï¼Œå‡å°‘è½®è¯¢æ£€æŸ¥æ¬¡æ•°

```js
// æŸ¥è¯¢åç«¯çš„ç»“æœ
var _detect = function() {
	console.info(token);
	$.ajax({
		url : 'https://bugstack.cn/xx/xx/check',
		type: "GET",
		dataType: "text",
		data : {
			token : token
		},
		success : function(data) {
			console.log(data);
			if (data == 'refuse') {
				_lock();
			} else {
				_unlock();
			}
		},
		error : function(data) {
			_unlock();
		}
	})
}

// å®šæ—¶ä»»åŠ¡
_detect();
setInterval(function() {
	_detect();
}, 5000);
```

6. å¼•å¯¼ç”¨æˆ·å…³æ³¨å…¬ä¼—å·
ç°åœ¨å°†tokenå€¼å›æ˜¾åˆ°é¡µé¢ï¼Œæé†’ç”¨æˆ·å…³æ³¨å…¬ä¼—å·å›å¤å£ä»¤è§£é”å…¨éƒ¨æ–‡ç« ï¼Œä»¥æ­¤æ¥å¾—åˆ°ç²‰ä¸çš„å…³æ³¨ã€‚æ•ˆæœå¦‚ä¸‹ï¼›

![å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ & æ–‡ç« åŠ é”æ•ˆæœ](https://bugstack.cn/assets/images/pic-content/2019/11/other-112602.png)

### 3.2 åç«¯

1. æœ¬åœ°ç¯å¢ƒå¼€å‘éœ€è¦å®‰è£…(å…è´¹)http://natapp.cn/ï¼Œåšç½‘ç»œç©¿é€ä¾¿äºæˆ‘ä»¬è¿›è¡Œæµ‹è¯•
2. æœåŠ¡åº¦ä¸‰ä¸ªä¸»è¦æ¥å£ï¼›1åŒåç§°çš„getã€postè¯·æ±‚ï¼Œåˆ†åˆ«ç”¨äºå…¬ä¼—å·éªŒéªŒã€æ¥æ”¶ç”¨æˆ·è¡Œä¸ºä¸å›å¤ä¿¡æ¯ã€‚2ç»™åšå®¢æä¾›éªŒè¯æ˜¯å¦è§£é”æ¥å£
3. åœ¨å¾®ä¿¡å…¬ä¼—å·ï¼›å¼€å‘->åŸºç¡€è®¾ç½®(æœåŠ¡å™¨é…ç½®)ï¼Œä¿®æ”¹é…ç½®å†…å®¹å¹¶å¼€å¯æœåŠ¡ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä¼šæ”¶åˆ°éªŒè¯è¯·æ±‚ä¿¡æ¯
4. JavaæœåŠ¡åº¦é‡‡ç”¨é¢†åŸŸé©±åŠ¨è®¾è®¡å¾®æœåŠ¡æ–¹å¼å¼€å‘ï¼ŒDDDçš„å¼€å‘æ¨¡å¼ä¼šæ›´åŠ æ¸…æ™°ä»¥åŠæ˜“äºåç»­åŠŸèƒ½çš„æ‹“å±•
5. (æé†’)ä¸ªäººå¾®ä¿¡å·ï¼Œéƒ¨åˆ†æ¥å£æƒé™æ˜¯æ²¡æœ‰çš„ï¼ŒåŒæ—¶å¦‚æœå¼€å¯å¼€å‘è€…åŠŸèƒ½é…ç½®åï¼Œè‡ªå®šä¹‰èœå•å’Œè‡ªå®šä¹‰å›å¤éƒ½ä¼šå¤±æ•ˆã€‚è€Œè‡ªå®šä¹‰èœå•åˆä¸å¼€æ”¾ç»™ä¸ªäººå¾®ä¿¡å·ï¼Œæ‰€ä»¥éœ€è¦å†æ¬¡é…ç½®å¼€å¯ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹

#### å¼€å‘ç¯å¢ƒ
1. jdk 1.8ã€tomcat8ã€idea2018ã€Maven3
2. Spring Boot 2.1.2.RELEASE
3. mysql 5.6
4. natapp ç½‘ç»œç©¿é€

#### å·¥ç¨‹ä»£ç 

>itstack-ark-wx & é¢†åŸŸé©±åŠ¨è®¾è®¡æ–¹å¼è®¾è®¡

```java
itstack-ark-wx
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â”œâ”€â”€ java
    â”‚   â”‚   â””â”€â”€ org.itstack.demo
    â”‚   â”‚       â”œâ”€â”€ application
    â”‚   â”‚       â”‚	â”œâ”€â”€ UserLockAuthService.java
    â”‚   â”‚       â”‚	â”œâ”€â”€ WxReceiveService.java	
    â”‚   â”‚       â”‚	â””â”€â”€ WxValidateService.java	
    â”‚   â”‚       â”œâ”€â”€ domain
    â”‚   â”‚       â”‚	â”œâ”€â”€ lockauth
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ repository
    â”‚   â”‚       â”‚	â”‚   â”‚   â””â”€â”€ IUserAuthPatrolRepository.java	
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ service
    â”‚   â”‚       â”‚	â”‚       â””â”€â”€ UserLockAuthServiceImpl.java		
    â”‚   â”‚       â”‚	â”œâ”€â”€ receive
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ model
    â”‚   â”‚       â”‚	â”‚   â”‚   â”œâ”€â”€ BehaviorMatter.java
    â”‚   â”‚       â”‚	â”‚   â”‚   â””â”€â”€ MessageTextEntity.java
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ repository
    â”‚   â”‚       â”‚	â”‚   â”‚   â””â”€â”€ IUserAuthGrantRepository.java	
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ service
    â”‚   â”‚       â”‚	â”‚       â”œâ”€â”€ engine
    â”‚   â”‚       â”‚	â”‚       â”‚   â”œâ”€â”€ impl	
    â”‚   â”‚       â”‚	â”‚       â”‚   â”‚	â””â”€â”€ MsgEngineHandle.java
    â”‚   â”‚       â”‚	â”‚       â”‚   â”œâ”€â”€ Engine.java	
    â”‚   â”‚       â”‚	â”‚       â”‚   â”œâ”€â”€ EngineBase.java	
    â”‚   â”‚       â”‚	â”‚       â”‚   â””â”€â”€ EngineConfig.java	
    â”‚   â”‚       â”‚	â”‚       â”œâ”€â”€ logic
    â”‚   â”‚       â”‚	â”‚       â”‚   â”œâ”€â”€ impl	
    â”‚   â”‚       â”‚	â”‚       â”‚   â”‚	â”œâ”€â”€ AnswerFilter.java
    â”‚   â”‚       â”‚	â”‚       â”‚   â”‚	â”œâ”€â”€ SubscribeFilter.java
    â”‚   â”‚       â”‚	â”‚       â”‚   â”‚	â”œâ”€â”€ UnlockFilter.java
    â”‚   â”‚       â”‚	â”‚       â”‚   â”‚	â””â”€â”€ UnsubscribeFilter.java	
    â”‚   â”‚       â”‚	â”‚       â”‚   â””â”€â”€ LogicFilter.java	
    â”‚   â”‚       â”‚	â”‚       â””â”€â”€ WxReceiveServiceImpl.java	
    â”‚   â”‚       â”‚	â””â”€â”€ validate
    â”‚   â”‚       â”‚	    â””â”€â”€ service
    â”‚   â”‚       â”‚	        â””â”€â”€ WxValidateServiceImpl.java	
    â”‚   â”‚       â”œâ”€â”€ infrastructure
    â”‚   â”‚       â”‚	â”œâ”€â”€ common
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ Constants.java
    â”‚   â”‚       â”‚	â”œâ”€â”€ dao	
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ UserAuthDao.java	
    â”‚   â”‚       â”‚	â”œâ”€â”€ po
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ UserAuth.java		
    â”‚   â”‚       â”‚	â”œâ”€â”€ repository
    â”‚   â”‚       â”‚	â”‚   â”œâ”€â”€ UserAuthGrantRepository.java	
    â”‚   â”‚       â”‚	â”‚   â””â”€â”€ UserAuthPatrolRepository.java	
    â”‚   â”‚       â”‚	â””â”€â”€ util
    â”‚   â”‚       â”‚	    â”œâ”€â”€ sdk
    â”‚   â”‚       â”‚	    â”‚   â””â”€â”€ SignatureUtil.java	
    â”‚   â”‚       â”‚	    â””â”€â”€ XmlUtil.java
    â”‚   â”‚       â”œâ”€â”€ interfaces
    â”‚   â”‚       â”‚	â”œâ”€â”€ BlogController.java
    â”‚   â”‚       â”‚	â””â”€â”€ WxPortalController.java
    â”‚   â”‚       â””â”€â”€ WxApplication.java
    â”‚   â””â”€â”€ resources	
    â”‚       â”œâ”€â”€ mybatis
    â”‚       â””â”€â”€ application.yml
    â””â”€â”€ test
         â””â”€â”€ java
             â””â”€â”€ org.itstack.ark.wx.test
                 â””â”€â”€ ApiTest.java

```

>itstack-ark-wx & å»ºè¡¨è¯­å¥

```sql
CREATE TABLE
    user_auth
    (
        id bigint NOT NULL AUTO_INCREMENT,
        openId VARCHAR(64),
        token VARCHAR(16) NOT NULL,
        uuid VARCHAR(128),
        createTime DATETIME,
        updateTime DATETIME,
        PRIMARY KEY (id, token),
        CONSTRAINT idx_uuid UNIQUE (uuid)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8
```

**è®²è§£éƒ¨åˆ†é‡ç‚¹ä»£ç å—ï¼Œå®Œæ•´ä»£ç ä¸‹è½½å…³æ³¨å…¬ä¼—å·ï¼›bugstackè™«æ´æ ˆ & å›å¤ï¼šitstack-ark-wx**

**interfacesæ¥å£å±‚**

>WxPortalController.java & æ¥æ”¶å¾®ä¿¡å…¬ä¼—å·éªŒç­¾ä¸è¡Œä¸ºä¿¡æ¯é€šçŸ¥

- å¾®ä¿¡å…¬ä¼—å·éƒ½æ˜¯é€šè¿‡æœåŠ¡æä¾›æ–¹çš„ä¸€ä¸ªæ¥å£çš„get/postè¯·æ±‚æ¥æ‰§è¡Œæ“ä½œçš„{è¿™æ ·è®¾è®¡çœŸsaoä½†çœŸé¦™}

- getæ¥å£ä¸»è¦æ˜¯éªŒè¯ç­¾å

- postæ¥å£ä¼šæ”¶åˆ°ï¼›å…³æ³¨ã€å–æ¶ˆå…³æ³¨ã€ç”¨æˆ·çš„å›å¤ä¿¡æ¯

```java
/**
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ
 * çº¯æ´ç‰ˆåšå®¢ï¼šhttps://bugstack.cn
 * æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼
 * Create by ä»˜æ”¿å§” on @2019
 */
@RestController
@RequestMapping("/wx/portal/{appid}")
public class WxPortalController {

    private Logger logger = LoggerFactory.getLogger(WxPortalController.class);

    @Autowired
    private WxValidateService wxValidateService;
    @Autowired
    private WxReceiveService wxReceiveService;

    /**
     * å¤„ç†å¾®ä¿¡æœåŠ¡å™¨å‘æ¥çš„getè¯·æ±‚ï¼Œè¿›è¡Œç­¾åçš„éªŒè¯
     * <p>
     * appid     å¾®ä¿¡ç«¯AppID
     * signature å¾®ä¿¡ç«¯å‘æ¥çš„ç­¾å
     * timestamp å¾®ä¿¡ç«¯å‘æ¥çš„æ—¶é—´æˆ³
     * nonce     å¾®ä¿¡ç«¯å‘æ¥çš„éšæœºå­—ç¬¦ä¸²
     * echostr   å¾®ä¿¡ç«¯å‘æ¥çš„éªŒè¯å­—ç¬¦ä¸²
     */
    @GetMapping(produces = "text/plain;charset=utf-8")
    public String validate(@PathVariable String appid,
                           @RequestParam(value = "signature", required = false) String signature,
                           @RequestParam(value = "timestamp", required = false) String timestamp,
                           @RequestParam(value = "nonce", required = false) String nonce,
                           @RequestParam(value = "echostr", required = false) String echostr) {
        try {
            logger.info("å¾®ä¿¡å…¬ä¼—å·éªŒç­¾ä¿¡æ¯{}å¼€å§‹ [{}, {}, {}, {}]", appid, signature, timestamp, nonce, echostr);
            if (StringUtils.isAnyBlank(signature, timestamp, nonce, echostr)) {
                throw new IllegalArgumentException("è¯·æ±‚å‚æ•°éæ³•ï¼Œè¯·æ ¸å®!");
            }
            boolean check = wxValidateService.checkSign(signature, timestamp, nonce);
            logger.info("å¾®ä¿¡å…¬ä¼—å·éªŒç­¾ä¿¡æ¯{}å®Œæˆ checkï¼š{}", appid, check);
            if (!check) return null;
            return echostr;
        } catch (Exception e) {
            logger.error("å¾®ä¿¡å…¬ä¼—å·éªŒç­¾ä¿¡æ¯{}å¤±è´¥ [{}, {}, {}, {}]", appid, signature, timestamp, nonce, echostr, e);
            return null;
        }
    }

    /**
     * æ­¤å¤„æ˜¯å¤„ç†å¾®ä¿¡æœåŠ¡å™¨çš„æ¶ˆæ¯è½¬å‘çš„
     */
    @PostMapping(produces = "application/xml; charset=UTF-8")
    public String post(@PathVariable String appid,
                       @RequestBody String requestBody,
                       @RequestParam("signature") String signature,
                       @RequestParam("timestamp") String timestamp,
                       @RequestParam("nonce") String nonce,
                       @RequestParam("openid") String openid,
                       @RequestParam(name = "encrypt_type", required = false) String encType,
                       @RequestParam(name = "msg_signature", required = false) String msgSignature) {
        try {
            logger.info("æ¥æ”¶å¾®ä¿¡å…¬ä¼—å·ä¿¡æ¯è¯·æ±‚{}å¼€å§‹ {}", openid, requestBody);
            MessageTextEntity message = XmlUtil.xmlToBean(requestBody, MessageTextEntity.class);
            BehaviorMatter behaviorMatter = new BehaviorMatter();
            behaviorMatter.setOpenId(openid);
            behaviorMatter.setFromUserName(message.getFromUserName());
            behaviorMatter.setMsgType(message.getMsgType());
            behaviorMatter.setContent(message.getContent());
            behaviorMatter.setEvent(message.getEvent());
            behaviorMatter.setCreateTime(new Date(Long.parseLong(message.getCreateTime()) * 1000L));
            // å¤„ç†æ¶ˆæ¯
            String result = wxReceiveService.doReceive(behaviorMatter);
            logger.info("æ¥æ”¶å¾®ä¿¡å…¬ä¼—å·ä¿¡æ¯è¯·æ±‚{}å®Œæˆ {}", openid, result);
            return result;
        } catch (Exception e) {
            logger.error("æ¥æ”¶å¾®ä¿¡å…¬ä¼—å·ä¿¡æ¯è¯·æ±‚{}å¤±è´¥ {}", openid, requestBody, e);
            return "";
        }
    }

}
```

>BlogController.java & åšå®¢éªŒæƒæ¥å£ï¼Œç”¨äºåˆ¤æ–­æ–‡ç« æ˜¯å¦è§£é”

- å› ä¸ºæˆ‘ä»¬è¿™ä¸ªæœåŠ¡éƒ¨ç½²åœ¨äºŒçº§åŸŸåä¸‹ï¼Œå› æ­¤éœ€è¦è®¾ç½®è·¨åŸŸè®¿é—®
- ç”±äºæˆ‘ä»¬ç½‘ç«™æ˜¯httpsåŠ å¯†ï¼Œé‚£ä¹ˆéhttpsæ˜¯ä¸èƒ½è¢«è®¿é—®ï¼Œéœ€è¦ä¸‹è½½å®‰è£…è¯ä¹¦åˆ°tomcatæœåŠ¡å™¨
- æœ¬æ¥å£åªè¿”å›successå’Œrefuseï¼Œé€šè¿‡å³å¯è§£é”

```java
/**
 * å¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ
 * çº¯æ´ç‰ˆåšå®¢ï¼šhttps://bugstack.cn
 * æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼
 * Create by ä»˜æ”¿å§” on @2019
 */
@CrossOrigin("https://bugstack.cn")
@RestController
@RequestMapping("/api")
public class BlogController {

    private Logger logger = LoggerFactory.getLogger(BlogController.class);

    @Autowired
    private UserLockAuthService userLockAuthService;

    @GetMapping(value = "check", produces = "application/json;charset=utf-8")
    public String check(@RequestParam String token) {
        try {
            logger.info("æ ¡éªŒåšå®¢æµè§ˆç”¨æˆ·æˆæƒçŠ¶æ€{}å¼€å§‹", token);
            boolean status = userLockAuthService.checkAuth(token);
            logger.info("æ ¡éªŒåšå®¢æµè§ˆç”¨æˆ·æˆæƒçŠ¶æ€{}å®Œæˆ", token, status);
            return status ? "success" : "refuse";
        } catch (Exception e) {
            logger.error("æ ¡éªŒåšå®¢æµè§ˆç”¨æˆ·æˆæƒçŠ¶æ€{}å¤±è´¥", token, e);
            return "refuse";
        }
    }

}
```

**applicationåº”ç”¨å±‚**

- æœ¬å±‚ä¸»è¦å®šä¹‰é€»è¾‘åˆ†å±‚ï¼Œå±äºéå¸¸è–„çš„ä¸€å±‚ï¼Œåœ¨ä¸€äº›å¤æ‚è®¾è®¡ä¸­ä¼šæœ‰ä¸€äº›æœåŠ¡ç¼–æ’
  - UserLockAuthService ç”¨æˆ·æƒé™éªŒè¯
  - WxReceiveService æ¥æ”¶ç”¨æˆ·è¡Œä¸ºæ¶ˆæ¯
  - WxValidateService å¾®ä¿¡å…¬ä¼—å·éªŒç­¾
 
 
>UserLockAuthService.java & å®šä¹‰åç”±é¢†åŸŸå±‚å®ç°

```java
public interface UserLockAuthService {

    boolean checkAuth(String token);

}
```
 
**domainé¢†åŸŸå±‚**

- é¢†åŸŸå±‚å®Œæˆäº†ï¼›æƒé™éªŒè¯ã€è¡Œä¸ºæ¶ˆæ¯å¤„ç†ã€å…¬ä¼—å·éªŒç­¾
- è¿™é‡Œæœ€é‡è¦çš„å„ç§è¡Œä¸ºæ¶ˆæ¯å¤„ç†ï¼Œæˆ‘ä»¬è®¾è®¡ä¸ºå†³ç­–æ ‘å·¥å‚æ¨¡å‹ï¼Œå®šä¹‰äº†é€»è¾‘åŠŸèƒ½å’Œå¼•æ“æœåŠ¡ï¼Œåç»­åªéœ€è¦æŒ‰éœ€æ‰©å±•å³å¯

>logic/LogicFilter.java & å®šä¹‰é€»è¾‘æ¨¡å‹ï¼Œimplä¸­æœ‰å¯¹åº”çš„ä¸€ç»„çš„å®ç°ç±»

```java
public interface LogicFilter {

    String filter(BehaviorMatter request);

}
```

>logic/impl/SubscribeFilter.java & å…¶ä¸­ä¸€ä¸ªå®ç°ï¼Œå…³æ³¨æ—¶è¡Œä¸ºå¤„ç†

```java
@Service("subscribe")
public class SubscribeFilter implements LogicFilter {

    private final String content = "æ‚¨å¥½ï¼\n" +
            "\n" +
            "éå¸¸æ„Ÿè°¢æ‚¨å…³æ³¨ï¼Œå¾®ä¿¡å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ  | ä¹ŸæœŸå¾…æ‚¨åˆ†äº«ç»™æ›´å¤šå°ä¼™ä¼´ï¼\n" +
            "\n" +
            "bugstackè™«æ´æ ˆï¼Œä¸“æ³¨äºåŸåˆ›æŠ€æœ¯ä¸“é¢˜æ¡ˆä¾‹ï¼Œä»¥æœ€æ˜“å­¦ä¹ ç¼–ç¨‹å¼€å‘çš„æ–¹å¼åˆ†äº«æŠ€æœ¯çŸ¥è¯†ï¼Œè®©èŒæ–°ã€å°ç™½ã€å¤§ç‰›éƒ½èƒ½æœ‰æ‰€æ”¶è·ã€‚ç›®å‰å·²ç»å®Œæˆçš„ä¸“é¢˜æœ‰ï¼›ã€ŠNetty4.xä»å…¥é—¨åˆ°å®æˆ˜ã€‹ã€ã€Šæ‰‹å†™RPCæ¡†æ¶ã€‹ã€ã€Šç”¨Javaå®ç°JVMã€‹ã€ã€ŠåŸºäºJavaAgentçš„å…¨é“¾è·¯ç›‘æ§ã€‹ã€ã€ŠDDDä¸“é¢˜æ¡ˆä¾‹ã€‹ï¼Œå…¶ä»–æ›´å¤šä¸“é¢˜è¿˜åœ¨æ’å…µå¸ƒé˜µä¸­ã€‚\n" +
            "\n" +
            "è·å–ä¸“é¢˜æ¡ˆä¾‹æºç å›å¤ï¼›nettyæ¡ˆä¾‹ã€rpcæ¡ˆä¾‹ã€ç”¨Javaå®ç°jvmæºç ã€åŸºäºJavaAgentçš„å…¨é“¾è·¯ç›‘æ§æ¡ˆä¾‹ã€DDDè½åœ°ã€‚\n" +
            "\n" +
            "è”ç³»ä½œè€…ï¼šä»˜æ”¿å§” | monkeycode";

    @Override
    public String filter(BehaviorMatter request) {
        return content;
    }

}
```

>engine/impl/MsgEngineHandle.java & å¼•æ“è·¯ç”±è°ƒç”¨

```java
@Service("msgEngineHandle")
public class MsgEngineHandle extends EngineBase {

    @Value("${wx.config.originalid:ä½ çš„Erré»˜è®¤å€¼}")
    private String originalId;

    @Override
    public String process(BehaviorMatter request) throws Exception {
        LogicFilter router = super.router(request);
        if (null == router) return null;
        String resultStr = router.filter(request);
        if (StringUtils.isBlank(resultStr)) return "";
        //åé¦ˆä¿¡æ¯[æ–‡æœ¬]ï¼Œæš‚æ—¶åªæœ‰æ–‡æœ¬åç»­æŒ‰éœ€æ‹“å±•
        MessageTextEntity res = new MessageTextEntity();
        res.setToUserName(request.getOpenId());
        res.setFromUserName(originalId);
        res.setCreateTime(String.valueOf(System.currentTimeMillis() / 1000L));
        res.setMsgType("text");
        res.setContent(resultStr);
        return XmlUtil.beanToXml(res);
    }

}
```

**infrastructureåŸºç¡€å±‚**

- æœ¬å±‚ä¸»è¦æä¾›åŸºç¡€æœåŠ¡èƒ½åŠ›ï¼ŒåŒ…æ‹¬æ•°æ®åº“æ“ä½œã€ç¼“å­˜æ“ä½œã€å·¥å…·åŒ…ç­‰
- å¦‚æœä½ çš„æœåŠ¡ä¸­ç”±rediså¯ä»¥åœ¨æœ¬å±‚æ¥æä¾›
- åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­æ•°æ®åº“ä¸æå€¡å…±ç”¨ï¼Œæ˜¯å•ç‹¬åˆ†ç¦»ï¼Œå› ä¸ºæ­¤è®¾è®¡ä¸­åªæœ‰ç”¨æˆ·è¡¨è¿˜ä½“ç°çš„ä¸æ˜æ˜¾

>repository/UserAuthGrantRepository.java & æ•°æ®åº“å®ç°

```java
@Repository("userAuthGrantRepository")
public class UserAuthGrantRepository implements IUserAuthGrantRepository {

    @Autowired
    private UserAuthDao userAuthDao;

    @Override
    public void grantAuth(String openId, String token) {
        UserAuth userAuthReq = new UserAuth();
        userAuthReq.setOpenId(openId);
        userAuthReq.setToken(token);
        userAuthReq.setUuid(openId + "_" + token);
        userAuthDao.insert(userAuthReq);
    }

    @Override
    public void revokeAuth(String openId) {
        userAuthDao.delete(openId);
    }

}
```

### 3.3 éƒ¨ç½²

#### 1. å·¥ç¨‹æ‰“åŒ…

1. springbooté…ç½®æ‰“åŒ…éƒ¨ç½²æˆå¯è¿è¡ŒwaråŒ…

	>pom.xml

	```xml
	<packaging>war</packaging>
	```

	>WxApplication.java

	```java
	@SpringBootApplication
	public class WxApplication extends SpringBootServletInitializer {

		@Override
		protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
			return builder.sources(WxApplication.class);
		}

		public static void main(String[] args) {
			SpringApplication.run(WxApplication.class, args);
		}

	}
	```

2. ä¿®æ”¹é…ç½®application.ymlï¼Œæ•°æ®åº“é…ç½®ã€å¾®ä¿¡é…ç½®

	```java
	server:
	  port: 80

	spring:
	#  datasource:
	#    username: root
	#    password: 123456
	#    url: jdbc:mysql://localhost:3306/itstack-ark-wx?useUnicode=true&characterEncoding=utf8
	#    driver-class-name: com.mysql.jdbc.Driver


	mybatis:
	  mapper-locations: classpath:/mybatis/mapper/*.xml
	  config-location:  classpath:/mybatis/config/mybatis-config.xml

	# å¾®ä¿¡å…¬ä¼—å·é…ç½®ä¿¡æ¯
	# originalidï¼šåŸå§‹ID
	# appidï¼šä¸ªäººAppID
	# tokenï¼šå¼€é€šæ¥å£æœåŠ¡è‡ªå®šä¹‰è®¾ç½®
	wx:
	  config:
		originalid: xxxxxxx
		appid: xxxxxxx
		token: xxxxxxx
	```

#### 2. æœåŠ¡ä¸Šçº¿

1. ç”³è¯·äº‘æœåŠ¡å™¨ï¼Œç›®å‰æä¾›æ–¹æ¯”è¾ƒå¤šï¼Œä¸€èˆ¬å¯ä»¥å’ŒåŸŸåé€‰æ‹©ä¸€ä¸ªæœåŠ¡å•†
2. å‡†å¤‡å¥½LinuxæœåŠ¡å™¨jdk1.8ã€tomcat8 
3. çœ‹ä¸ªäººåŸŸåè®¿é—®æƒ…å†µï¼Œé…Œæƒ…ç”³è¯·Httpsï¼Œé…ç½®RSA
4. æœ¬åœ°å®‰è£…XShellã€Xftpï¼Œæ–¹ä¾¿éƒ¨ç½²å’Œæ–‡ä»¶ä¼ è¾“
5. å‡†å¤‡å¥½ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼Œç”¨äºé…ç½®æœåŠ¡
   ![](https://raw.githubusercontent.com/fuzhengwei/fuzhengwei.github.io/master/assets/images/pic-content/2019/11/other-112603.png)
6. å¯åŠ¨æœåŠ¡
   ```java
    [root@instance-39394m67 bin]# ./startup.sh
   
		 .   ____          _            __ _ _
	 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
	( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
	 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
	  '  |____| .__|_| |_|_| |_\__, | / / / /
	 =========|_|==============|___/=/_/_/_/
	 :: Spring Boot ::        (v2.1.2.RELEASE)

	2019-11-23 18:10:57.131  INFO 22052 --- [ost-startStop-1] org.itstack.ark.wx.WxApplication         : Starting WxApplication v1.0.0-SNAPSHOT on instance-39394m67 with PID 22052 (/usr/local/java/apache-tomcat-8.5.37/webapps/itstack-ark-wx/WEB-INF/classes started by root in /usr/local/java/apache-tomcat-8.5.37/bin)
	2019-11-23 18:10:57.158  INFO 22052 --- [ost-startStop-1] org.itstack.ark.wx.WxApplication         : No active profile set, falling back to default profiles: default
	2019-11-23 18:10:59.137  INFO 22052 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1890 ms
	2019-11-23 18:11:01.050  INFO 22052 --- [ost-startStop-1] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'
	2019-11-23 18:11:01.336  WARN 22052 --- [ost-startStop-1] ion$DefaultTemplateResolverConfiguration : Cannot find template location: classpath:/templates/ (please add some templates or check your Thymeleaf configuration)
	2019-11-23 18:11:01.677  INFO 22052 --- [ost-startStop-1] org.itstack.ark.wx.WxApplication         : Started WxApplication in 5.873 seconds (JVM running for 10.311)
	23-Nov-2019 18:11:01.718 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployWAR Deployment of web application archive [/usr/local/java/apache-tomcat-8.5.37/webapps/itstack-ark-wx.war] has finished in [9,226] ms
	23-Nov-2019 18:11:01.720 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deploying web application directory [/usr/local/java/apache-tomcat-8.5.37/webapps/ROOT]
	23-Nov-2019 18:11:01.746 INFO [localhost-startStop-1] org.apache.catalina.startup.HostConfig.deployDirectory Deployment of web application directory [/usr/local/java/apache-tomcat-8.5.37/webapps/ROOT] has finished in [26] ms
	23-Nov-2019 18:11:01.753 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler ["http-nio-80"]
	23-Nov-2019 18:11:01.764 INFO [main] org.apache.coyote.AbstractProtocol.start Starting ProtocolHandler ["ajp-nio-8009"]
	23-Nov-2019 18:11:01.766 INFO [main] org.apache.catalina.startup.Catalina.start Server startup in 9326 ms
	2019-11-23 18:11:13.039  INFO 22052 --- [p-nio-80-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
	2019-11-23 18:11:13.059  INFO 22052 --- [p-nio-80-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 20 ms
	2019-11-23 18:11:13.172  INFO 22052 --- [p-nio-80-exec-1] o.i.ark.wx.interfaces.BlogController     : æ ¡éªŒåšå®¢æµè§ˆç”¨æˆ·æˆæƒçŠ¶æ€UDHIUSå¼€å§‹
   ```

#### 3. åŠŸèƒ½éªŒè¯

1. éªŒè¯è¿æ¥ï¼›https://bugstack.cn/itstack-demo-ddd/2019/10/16/DDD%E4%B8%93%E9%A2%98%E6%A1%88%E4%BE%8B%E4%BA%8C-%E9%A2%86%E5%9F%9F%E5%B1%82%E5%86%B3%E7%AD%96%E8%A7%84%E5%88%99%E6%A0%91%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1.html

2. å¼•å¯¼æç¤ºï¼›
![](https://raw.githubusercontent.com/fuzhengwei/fuzhengwei.github.io/master/assets/images/pic-content/2019/11/other-112604.png)

3. æ–‡ç« è§£é”ï¼›
![](https://raw.githubusercontent.com/fuzhengwei/fuzhengwei.github.io/master/assets/images/pic-content/2019/11/other-112605.png)

## 4. ç»¼ä¸Šæ€»ç»“

1. è¿˜æ˜¯å¾ˆæ„Ÿæ¿€é‚£äº›å‰é€”çš„æ¢è·¯äººï¼Œä¸ºåŸåˆ›ç ”å‘è´¡çŒ®åŠ›é‡
2. æˆ‘åšå®¢ï¼›https://bugstack.cnï¼Œå¯ä»¥å°è¯•éªŒè¯æˆ–è€…å…‹éš†å¯¹åº”çš„ä»£ç ä»“åº“
3. åˆ©ç”¨äº†11æœˆ24æ—¥å‘¨å…­ç»™è‡ªå·±åŠ ä¸ªé€šå®µç­å®Œæˆæ‰€æœ‰ä»£ç çš„å¼€å‘å’ŒæœåŠ¡ç”³è¯·åˆ°éƒ¨ç½²ï¼Œä»æœ€å¼€å§‹æ‹¿åˆ°æƒ³æ³•åˆ°æœ€ç»ˆå®ç°è¿˜æ˜¯ç»å†äº†å¾ˆå¤šååå·å·
4. è¿™é‡Œé¢è¿˜æœ‰å¾ˆå¤šå¯ä»¥ä¼˜åŒ–çš„ç‚¹ä»¥åŠä¸€äº›æ‹“å±•çš„åŠŸèƒ½ï¼Œåç»­ä¼šé™†ç»­å®Œå–„ï¼Œå¦‚æœç”±å°ä¼™ä¼´æœ‰å¥½çš„ç‚¹å­æ¬¢è¿éšæ—¶äº¤æµ
5. æºç è´¡çŒ®ç»™æ‰€æœ‰ç ”å‘ï¼Œå¾®ä¿¡å…¬ä¼—å·å†…å›å¤ï¼›**itstack-ark-wx**ï¼Œå³å¯è·å¾—ä¸€ä»½åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡å¼€å‘çš„å¾®ä¿¡å…¬ä¼—å·ä¸åšå®¢æ‰“é€šå·¥ç¨‹(Star&Frok)
6. å¤œæ·±äººé™å’£å’£æ•²ä»£ç æˆ‘ä¹Ÿä¼šæ€€ç–‘ï¼Œæˆ‘æ˜¯è°ï¼Œæˆ‘åœ¨å“ªï¼Œæˆ‘åœ¨å¹²ä»€ä¹ˆï¼å“ï¼Œè¿™å°±æ˜¯ï¼›å–œæ¬¢å¹²ä¸€ä»½å·¥ä½œï¼Œå¾€å¾€æ¥è‡ªäºå¹²äº†ä¸€ä»¶å–œæ¬¢çš„å·¥ä½œ


