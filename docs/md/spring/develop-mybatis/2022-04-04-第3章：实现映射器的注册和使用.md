---
title: ç¬¬3ç« ï¼šå®ç°æ˜ å°„å™¨çš„æ³¨å†Œå’Œä½¿ç”¨
lock: need
---

# ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬3ç« ï¼šå®ç°æ˜ å°„å™¨çš„æ³¨å†Œå’Œä½¿ç”¨

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/o6lnWJqU_6FNO8HpxAs9gA](https://mp.weixin.qq.com/s/o6lnWJqU_6FNO8HpxAs9gA)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=684642107&bvid=BV1oU4y1y7VC&cid=737663066&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`å¦‚ä½•é¢å¯¹å¤æ‚ç³»ç»Ÿçš„è®¾è®¡ï¼Ÿ`

æˆ‘ä»¬å¯ä»¥æŠŠ Springã€Mybatisã€Dubbo è¿™æ ·çš„å¤§å‹æ¡†æ¶æˆ–è€…ä¸€äº›å…¬å¸å†…éƒ¨çš„è¾ƒæ ¸å¿ƒé¡¹ç›®ï¼Œéƒ½å¯ä»¥ç§°ä¸ºå¤æ‚çš„ç³»ç»Ÿã€‚è¿™æ ·çš„å·¥ç¨‹ä¹Ÿä¸åœ¨æ˜¯åˆå­¦ç¼–ç¨‹æ‰‹é‡Œçš„ç©å…·é¡¹ç›®ï¼Œæ²¡æœ‰æ‰€è°“çš„CRUDï¼Œæ›´å¤šæ—¶å€™è¦é¢å¯¹çš„éƒ½æ˜¯å¯¹ç³»ç»Ÿåˆ†å±‚çš„ç»“æ„è®¾è®¡å’Œèšåˆé€»è¾‘åŠŸèƒ½çš„å®ç°ï¼Œå†é€šè¿‡å±‚å±‚è½¬æ¢è¿›è¡Œå®ç°å’Œè°ƒç”¨ã€‚

è¿™å¯¹äºå¾ˆå¤šåˆšä¸Šé“çš„å°ç å†œæ¥è¯´ï¼Œä¼šæ„Ÿè§‰éå¸¸éš¾å—ï¼Œä¸çŸ¥é“è¦ä»å“ªä¸‹æ‰‹ï¼Œä½†åˆæƒ³ç€å¯ä»¥ä¸€å£åƒä¸ªèƒ–å­ã€‚å…¶å®è¿™æ˜¯ä¸ç°å®çš„ï¼Œå› ä¸ºè¿™äº›å¤æ‚ç³»ç»Ÿä¸­çš„æ¡†æ¶ä¸­æœ‰å¤ªå¤šçš„å†…å®¹ä½ è¿˜æ²¡ç”¨äº†è§£å’Œç†Ÿæ‚‰ï¼Œè¶Šæ˜¯ç¡¬æè¶Šéš¾å—ï¼Œä¿¡å¿ƒè¶Šå—æ‰“å‡»ã€‚

å…¶å®å¯¹äºè§£å†³è¿™ç±»å¤æ‚çš„é¡¹ç›®é—®é¢˜ï¼Œæ ¸å¿ƒåœ¨äºè¦å°†åˆ†æ”¯é—®é¢˜ç‚¹ç¼©å°ï¼Œçªå‡ºä¸»å¹²é“¾è·¯ï¼Œå…·ä½“çš„æ‰‹æ®µåŒ…æ‹¬ï¼šåˆ†æ²»ã€æŠ½è±¡å’ŒçŸ¥è¯†ã€‚è¿ç”¨è®¾è®¡æ¨¡å¼å’Œè®¾è®¡åŸåˆ™ç­‰ç›¸å…³çŸ¥è¯†ï¼ŒæŠŠé—®é¢˜ç©ºé—´åˆç†åˆ‡å‰²ä¸ºè‹¥å¹²å­é—®é¢˜ï¼Œé—®é¢˜è¶Šå°ä¹Ÿå°±è¶Šå®¹æ˜“ç†è§£å’Œå¤„ç†ã€‚å°±åƒä½ å¯ä»¥æŠŠå¾ˆå¤šå†…å®¹åšæˆå•ä¸ªç‹¬ç«‹çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œæœ€ç»ˆåœ¨è¿›è¡Œèšåˆä½¿ç”¨ã€‚

## äºŒã€ç›®æ ‡

åœ¨ä¸Šä¸€ç« èŠ‚æˆ‘ä»¬åˆæ­¥çš„äº†è§£äº†æ€ä¹ˆç»™ä¸€ä¸ªæ¥å£ç±»ç”Ÿæˆå¯¹åº”çš„æ˜ å°„å™¨ä»£ç†ï¼Œå¹¶åœ¨ä»£ç†ä¸­å®Œæˆä¸€äº›ç”¨æˆ·å¯¹æ¥å£æ–¹æ³•çš„è°ƒç”¨å¤„ç†ã€‚è™½ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªæ ¸å¿ƒé€»è¾‘çš„å¤„ç†æ–¹å¼ï¼Œä½†åœ¨ä½¿ç”¨ä¸Šè¿˜æ˜¯æœ‰äº›åˆ€è€•ç«ç§çš„ï¼ŒåŒ…æ‹¬ï¼šéœ€è¦ç¼–ç å‘ŠçŸ¥ MapperProxyFactory è¦å¯¹å“ªä¸ªæ¥å£è¿›è¡Œä»£ç†ï¼Œä»¥åŠè‡ªå·±ç¼–å†™ä¸€ä¸ªå‡çš„ SqlSession å¤„ç†å®é™…è°ƒç”¨æ¥å£æ—¶çš„è¿”å›ç»“æœã€‚

é‚£ä¹ˆç»“åˆè¿™ä¸¤å—é—®é¢˜ç‚¹ï¼Œæˆ‘ä»¬æœ¬ç« èŠ‚è¦å¯¹æ˜ å°„å™¨çš„æ³¨å†Œæä¾›æ³¨å†Œæœºå¤„ç†ï¼Œæ»¡è¶³ç”¨æˆ·å¯ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™æä¾›ä¸€ä¸ªåŒ…çš„è·¯å¾„å³å¯å®Œæˆæ‰«æå’Œæ³¨å†Œã€‚ä¸æ­¤åŒæ—¶éœ€è¦å¯¹ SqlSession è¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œè®©å®ƒå¯ä»¥æŠŠæˆ‘ä»¬çš„æ˜ å°„å™¨ä»£ç†å’Œæ–¹æ³•è°ƒç”¨è¿›è¡ŒåŒ…è£…ï¼Œå»ºç«‹ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ¨¡å‹ç»“æ„ï¼Œä¾¿äºåç»­çš„å†…å®¹çš„æ·»åŠ ã€‚

## ä¸‰ã€è®¾è®¡

é‰´äºæˆ‘ä»¬å¸Œæœ›æŠŠæ•´ä¸ªå·¥ç¨‹åŒ…ä¸‹å…³äºæ•°æ®åº“æ“ä½œçš„ DAO æ¥å£ä¸ Mapper æ˜ å°„å™¨å…³è”èµ·æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦åŒ…è£…ä¸€ä¸ªå¯ä»¥æ‰«æåŒ…è·¯å¾„çš„å®Œæˆæ˜ å°„çš„æ³¨å†Œå™¨ç±»ã€‚

å½“ç„¶æˆ‘ä»¬è¿˜è¦æŠŠä¸Šä¸€ç« èŠ‚ä¸­ç®€åŒ–çš„ SqlSession è¿›è¡Œå®Œå–„ï¼Œç”± SqlSession å®šä¹‰æ•°æ®åº“å¤„ç†æ¥å£å’Œè·å– Mapper å¯¹è±¡çš„æ“ä½œï¼Œå¹¶æŠŠå®ƒäº¤ç»™æ˜ å°„å™¨ä»£ç†ç±»è¿›è¡Œä½¿ç”¨ã€‚*è¿™ä¸€éƒ¨åˆ†æ˜¯å¯¹ä¸Šä¸€ç« èŠ‚å†…å®¹çš„å®Œå–„*

æœ‰äº† SqlSession ä»¥åï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ç§åŠŸèƒ½æœåŠ¡ï¼Œæœ‰äº†åŠŸèƒ½æœåŠ¡ä»¥åè¿˜éœ€è¦ç»™è¿™ä¸ªåŠŸèƒ½æœåŠ¡æä¾›ä¸€ä¸ªå·¥å‚ï¼Œæ¥å¯¹å¤–ç»Ÿä¸€æä¾›è¿™ç±»æœåŠ¡ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ Mybatis ä¸­éå¸¸å¸¸è§çš„æ“ä½œï¼Œå¼€å¯ä¸€ä¸ª SqlSessionã€‚æ•´ä¸ªè®¾è®¡å¯ä»¥å¦‚å›¾ 3-1

![å›¾ 3-1 æ˜ å°„å™¨çš„æ³¨å†Œå’Œä½¿ç”¨](https://bugstack.cn/images/article/spring/mybatis-220404-01.png)

- ä»¥åŒ…è£…æ¥å£æä¾›æ˜ å°„å™¨ä»£ç†ç±»ä¸ºç›®æ ‡ï¼Œè¡¥å…¨æ˜ å°„å™¨æ³¨å†Œæœº `MapperRegistry`ï¼Œè‡ªåŠ¨æ‰«æåŒ…ä¸‹æ¥å£å¹¶æŠŠæ¯ä¸ªæ¥å£ç±»æ˜ å°„çš„ä»£ç†ç±»å…¨éƒ¨å­˜å…¥æ˜ å°„å™¨ä»£ç†çš„ HashMap ç¼“å­˜ä¸­ã€‚
- è€Œ SqlSessionã€SqlSessionFactory æ˜¯åœ¨æ­¤æ³¨å†Œæ˜ å°„å™¨ä»£ç†çš„ä¸Šæ¬¡å±‚ä½¿ç”¨æ ‡å‡†å®šä¹‰å’Œå¯¹å¤–æœåŠ¡æä¾›çš„å°è£…ï¼Œä¾¿äºç”¨æˆ·ä½¿ç”¨ã€‚*æˆ‘ä»¬æŠŠä½¿ç”¨æ–¹å½“æˆç”¨æˆ·* ç»è¿‡è¿™æ ·çš„å°è£…å°±å°±å¯ä»¥æ›´åŠ æ–¹ä¾¿æˆ‘ä»¬åç»­åœ¨æ¡†æ¶ä¸ŠåŠŸèƒ½çš„ç»§ç»­æ‰©å±•äº†ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¯ä»¥åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å¯¹è¿™æ ·çš„è®¾è®¡ç»“æ„æœ‰ä¸€äº›æ€è€ƒï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ è§£å†³ä¸€äº›ä¸šåŠ¡åŠŸèƒ½å¼€å‘è¿‡ç¨‹ä¸­çš„é¢†åŸŸæœåŠ¡åŒ…è£…ã€‚

## å››ã€å®ç°

### 1. å·¥ç¨‹ç»“æ„

```java
mybatis-step-02
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn.bugstack.mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”‚   â”œâ”€â”€ MapperProxy.java
    â”‚           â”‚   â”œâ”€â”€ MapperProxyFactory.java
    â”‚           â”‚   â””â”€â”€ MapperRegistry.java
    â”‚           â””â”€â”€ session
    â”‚               â”œâ”€â”€ defaults
    â”‚               â”‚   â”œâ”€â”€ DefaultSqlSession.java
    â”‚               â”‚   â””â”€â”€ DefaultSqlSessionFactory.java
    â”‚               â”œâ”€â”€ SqlSession.java
    â”‚               â””â”€â”€ SqlSessionFactory.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn.bugstack.mybatis.test.dao
                â”œâ”€â”€ dao
                â”‚   â”œâ”€â”€ ISchoolDao.java
                â”‚   â””â”€â”€ IUserDao.java
                â””â”€â”€ ApiTest.java
```

**å·¥ç¨‹æºç **ï¼š`å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç `

æ˜ å°„å™¨æ ‡å‡†å®šä¹‰å®ç°å…³ç³»ï¼Œå¦‚å›¾ 3-2

![å›¾ 3-2 æ˜ å°„å™¨æ ‡å‡†å®šä¹‰å®ç°å…³ç³»](https://bugstack.cn/images/article/spring/mybatis-220404-02.png)

- MapperRegistry æä¾›åŒ…è·¯å¾„çš„æ‰«æå’Œæ˜ å°„å™¨ä»£ç†ç±»æ³¨å†ŒæœºæœåŠ¡ï¼Œå®Œæˆæ¥å£å¯¹è±¡çš„ä»£ç†ç±»æ³¨å†Œå¤„ç†ã€‚
- SqlSessionã€DefaultSqlSession ç”¨äºå®šä¹‰æ‰§è¡Œ SQL æ ‡å‡†ã€è·å–æ˜ å°„å™¨ä»¥åŠå°†æ¥ç®¡ç†äº‹åŠ¡ç­‰æ–¹é¢çš„æ“ä½œã€‚åŸºæœ¬æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨ Mybatis çš„ API æ¥å£ä¹Ÿéƒ½æ˜¯ä»è¿™ä¸ªæ¥å£ç±»å®šä¹‰çš„æ–¹æ³•è¿›è¡Œä½¿ç”¨çš„ã€‚
- SqlSessionFactory æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼ï¼Œç”¨äºæä¾› SqlSession æœåŠ¡ï¼Œå±è”½åˆ›å»ºç»†èŠ‚ï¼Œå»¶è¿Ÿåˆ›å»ºè¿‡ç¨‹ã€‚

### 2. æ˜ å°„å™¨æ³¨å†Œæœº

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.binding.MapperRegistry`

```java
public class MapperRegistry {

    /**
     * å°†å·²æ·»åŠ çš„æ˜ å°„å™¨ä»£ç†åŠ å…¥åˆ° HashMap
     */
    private final Map<Class<?>, MapperProxyFactory<?>> knownMappers = new HashMap<>();

    public <T> T getMapper(Class<T> type, SqlSession sqlSession) {
        final MapperProxyFactory<T> mapperProxyFactory = (MapperProxyFactory<T>) knownMappers.get(type);
        if (mapperProxyFactory == null) {
            throw new RuntimeException("Type " + type + " is not known to the MapperRegistry.");
        }
        try {
            return mapperProxyFactory.newInstance(sqlSession);
        } catch (Exception e) {
            throw new RuntimeException("Error getting mapper instance. Cause: " + e, e);
        }
    }

    public <T> void addMapper(Class<T> type) {
        /* Mapper å¿…é¡»æ˜¯æ¥å£æ‰ä¼šæ³¨å†Œ */
        if (type.isInterface()) {
            if (hasMapper(type)) {
                // å¦‚æœé‡å¤æ·»åŠ äº†ï¼ŒæŠ¥é”™
                throw new RuntimeException("Type " + type + " is already known to the MapperRegistry.");
            }
            // æ³¨å†Œæ˜ å°„å™¨ä»£ç†å·¥å‚
            knownMappers.put(type, new MapperProxyFactory<>(type));
        }
    }

    public void addMappers(String packageName) {
        Set<Class<?>> mapperSet = ClassScanner.scanPackage(packageName);
        for (Class<?> mapperClass : mapperSet) {
            addMapper(mapperClass);
        }
    }

}
```

- MapperRegistry æ˜ å°„å™¨æ³¨å†Œç±»çš„æ ¸å¿ƒä¸»è¦åœ¨äºæä¾›äº† `ClassScanner.scanPackage` æ‰«æåŒ…è·¯å¾„ï¼Œè°ƒç”¨ `addMapper` æ–¹æ³•ï¼Œç»™æ¥å£ç±»åˆ›å»º `MapperProxyFactory` æ˜ å°„å™¨ä»£ç†ç±»ï¼Œå¹¶å†™å…¥åˆ° knownMappers çš„ HashMap ç¼“å­˜ä¸­ã€‚
- å¦å¤–å°±æ˜¯è¿™ä¸ªç±»ä¹Ÿæä¾›äº†å¯¹åº”çš„ getMapper è·å–æ˜ å°„å™¨ä»£ç†ç±»çš„æ–¹æ³•ï¼Œå…¶å®è¿™æ­¥å°±åŒ…è£…äº†æˆ‘ä»¬ä¸Šä¸€ç« èŠ‚æ‰‹åŠ¨æ“ä½œå®ä¾‹åŒ–çš„è¿‡ç¨‹ï¼Œæ›´åŠ æ–¹ä¾¿åœ¨ DefaultSqlSession ä¸­è·å– Mapper æ—¶è¿›è¡Œä½¿ç”¨ã€‚

### 3. SqlSession æ ‡å‡†å®šä¹‰å’Œå®ç°

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.session.SqlSession`

```java
public interface SqlSession {

    /**
     * Retrieve a single row mapped from the statement key
     * æ ¹æ®æŒ‡å®šçš„SqlIDè·å–ä¸€æ¡è®°å½•çš„å°è£…å¯¹è±¡
     *
     * @param <T>       the returned object type å°è£…ä¹‹åçš„å¯¹è±¡ç±»å‹
     * @param statement sqlID
     * @return Mapped object å°è£…ä¹‹åçš„å¯¹è±¡
     */
    <T> T selectOne(String statement);

    /**
     * Retrieve a single row mapped from the statement key and parameter.
     * æ ¹æ®æŒ‡å®šçš„SqlIDè·å–ä¸€æ¡è®°å½•çš„å°è£…å¯¹è±¡ï¼Œåªä¸è¿‡è¿™ä¸ªæ–¹æ³•å®¹è®¸æˆ‘ä»¬å¯ä»¥ç»™sqlä¼ é€’ä¸€äº›å‚æ•°
     * ä¸€èˆ¬åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™ä¸ªå‚æ•°ä¼ é€’çš„æ˜¯pojoï¼Œæˆ–è€…Mapæˆ–è€…ImmutableMap
     *
     * @param <T>       the returned object type
     * @param statement Unique identifier matching the statement to use.
     * @param parameter A parameter object to pass to the statement.
     * @return Mapped object
     */
    <T> T selectOne(String statement, Object parameter);

    /**
     * Retrieves a mapper.
     * å¾—åˆ°æ˜ å°„å™¨ï¼Œè¿™ä¸ªå·§å¦™çš„ä½¿ç”¨äº†æ³›å‹ï¼Œä½¿å¾—ç±»å‹å®‰å…¨
     *
     * @param <T>  the mapper type
     * @param type Mapper interface class
     * @return a mapper bound to this SqlSession
     */
    <T> T getMapper(Class<T> type);

}
```

- åœ¨ SqlSession ä¸­å®šä¹‰ç”¨æ¥æ‰§è¡Œ SQLã€è·å–æ˜ å°„å™¨å¯¹è±¡ä»¥åŠåç»­ç®¡ç†äº‹åŠ¡æ“ä½œçš„æ ‡å‡†æ¥å£ã€‚
- ç›®å‰è¿™ä¸ªæ¥å£ä¸­å¯¹äºæ•°æ®åº“çš„æ“ä½œä»…ä»…åªæä¾›äº† selectOneï¼Œåç»­è¿˜ä¼šæœ‰ç›¸åº”å…¶ä»–æ–¹æ³•çš„å®šä¹‰ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.session.defaults`

```java
public class DefaultSqlSession implements SqlSession {

    /**
     * æ˜ å°„å™¨æ³¨å†Œæœº
     */
    private MapperRegistry mapperRegistry;

    // çœç•¥æ„é€ å‡½æ•°

    @Override
    public <T> T selectOne(String statement, Object parameter) {
        return (T) ("ä½ è¢«ä»£ç†äº†ï¼" + "æ–¹æ³•ï¼š" + statement + " å…¥å‚ï¼š" + parameter);
    }

    @Override
    public <T> T getMapper(Class<T> type) {
        return mapperRegistry.getMapper(type, this);
    }

}
```

- é€šè¿‡ DefaultSqlSession å®ç°ç±»å¯¹ SqlSession æ¥å£è¿›è¡Œå®ç°ã€‚
- getMapper æ–¹æ³•ä¸­è·å–æ˜ å°„å™¨å¯¹è±¡æ˜¯é€šè¿‡ MapperRegistry ç±»è¿›è¡Œè·å–çš„ï¼Œåç»­è¿™éƒ¨åˆ†ä¼šè¢«é…ç½®ç±»è¿›è¡Œæ›¿æ¢ã€‚
- åœ¨ selectOne ä¸­æ˜¯ä¸€æ®µç®€å•çš„å†…å®¹è¿”å›ï¼Œç›®å‰è¿˜æ²¡æœ‰ä¸æ•°æ®åº“è¿›è¡Œå…³è”ï¼Œè¿™éƒ¨åˆ†åœ¨æˆ‘ä»¬æ¸è¿›å¼çš„å¼€å‘è¿‡ç¨‹ä¸­é€æ­¥å®ç°ã€‚

### 4. SqlSessionFactory å·¥å‚å®šä¹‰å’Œå®ç°

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.session.SqlSessionFactory`

```java
public interface SqlSessionFactory {

    /**
     * æ‰“å¼€ä¸€ä¸ª session
     * @return SqlSession
     */
   SqlSession openSession();

}
```

- è¿™å…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•å·¥å‚çš„å®šä¹‰ï¼Œåœ¨å·¥å‚ä¸­æä¾›æ¥å£å®ç°ç±»çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ SqlSessionFactory å·¥å‚ä¸­æä¾›çš„å¼€å¯ SqlSession çš„èƒ½åŠ›ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.session.defaults.DefaultSqlSessionFactory`

```java
public class DefaultSqlSessionFactory implements SqlSessionFactory {

    private final MapperRegistry mapperRegistry;

    public DefaultSqlSessionFactory(MapperRegistry mapperRegistry) {
        this.mapperRegistry = mapperRegistry;
    }

    @Override
    public SqlSession openSession() {
        return new DefaultSqlSession(mapperRegistry);
    }

}
```

- é»˜è®¤çš„ç®€å•å·¥å‚å®ç°ï¼Œå¤„ç†å¼€å¯ SqlSession æ—¶ï¼Œå¯¹ DefaultSqlSession çš„åˆ›å»ºä»¥åŠä¼ é€’ mapperRegistryï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä½¿ç”¨ SqlSession æ—¶è·å–æ¯ä¸ªä»£ç†ç±»çš„æ˜ å°„å™¨å¯¹è±¡äº†ã€‚

## äº”ã€æµ‹è¯•

### 1. äº‹å…ˆå‡†å¤‡

åœ¨åŒä¸€ä¸ªåŒ…è·¯å¾„ä¸‹ï¼Œæä¾›2ä¸ªä»¥ä¸Šçš„ Dao æ¥å£ï¼š

```java
public interface ISchoolDao {

    String querySchoolName(String uId);

}

public interface IUserDao {

    String queryUserName(String uId);

    Integer queryUserAge(String uId);

}
```

### 2. å•å…ƒæµ‹è¯•

```java
@Test
public void test_MapperProxyFactory() {
    // 1. æ³¨å†Œ Mapper
    MapperRegistry registry = new MapperRegistry();
    registry.addMappers("cn.bugstack.mybatis.test.dao");
    
    // 2. ä» SqlSession å·¥å‚è·å– Session
    SqlSessionFactory sqlSessionFactory = new DefaultSqlSessionFactory(registry);
    SqlSession sqlSession = sqlSessionFactory.openSession();
    
    // 3. è·å–æ˜ å°„å™¨å¯¹è±¡
    IUserDao userDao = sqlSession.getMapper(IUserDao.class);
    
    // 4. æµ‹è¯•éªŒè¯
    String res = userDao.queryUserName("10001");
    logger.info("æµ‹è¯•ç»“æœï¼š{}", res);
}
```

- åœ¨å•å…ƒæµ‹è¯•ä¸­é€šè¿‡æ³¨å†Œæœºæ‰«æåŒ…è·¯å¾„æ³¨å†Œæ˜ å°„å™¨ä»£ç†å¯¹è±¡ï¼Œå¹¶æŠŠæ³¨å†Œæœºä¼ é€’ç»™ SqlSessionFactory å·¥å‚ï¼Œè¿™æ ·å®Œæˆä¸€ä¸ªé“¾æ¥è¿‡ç¨‹ã€‚
- ä¹‹åé€šè¿‡ SqlSession è·å–å¯¹åº” DAO ç±»å‹çš„å®ç°ç±»ï¼Œå¹¶è¿›è¡Œæ–¹æ³•éªŒè¯ã€‚

**æµ‹è¯•ç»“æœ**

```java
22:43:23.254 [main] INFO  cn.bugstack.mybatis.test.ApiTest - æµ‹è¯•ç»“æœï¼šä½ è¢«ä»£ç†äº†ï¼æ–¹æ³•ï¼šqueryUserName å…¥å‚ï¼š[Ljava.lang.Object;@50cbc42f

Process finished with exit code 0
```

- é€šè¿‡æµ‹è¯•å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰æˆ‘ä»¬å·²ç»åœ¨ä¸€ä¸ªæœ‰ Mybatis å½±å­çš„æ‰‹å†™ ORM æ¡†æ¶ä¸­ï¼Œå®Œæˆäº†ä»£ç†ç±»çš„æ³¨å†Œå’Œä½¿ç”¨è¿‡ç¨‹ã€‚

## å…­ã€æ€»ç»“

- é¦–å…ˆè¦ä»è®¾è®¡ç»“æ„ä¸Šäº†è§£å·¥å‚æ¨¡å¼å¯¹å…·ä½“åŠŸèƒ½ç»“æ„çš„å°è£…ï¼Œå±è”½è¿‡ç¨‹ç»†èŠ‚ï¼Œé™å®šä¸Šä¸‹æ–‡å…³ç³»ï¼ŒæŠŠå¯¹å¤–çš„ä½¿ç”¨å‡å°‘è€¦åˆã€‚
- ä»è¿™ä¸ªè¿‡ç¨‹ä¸Šè¯»è€…ä¼™ä¼´ä¹Ÿèƒ½å‘ç°ï¼Œä½¿ç”¨ SqlSessionFactory çš„å·¥å‚å®ç°ç±»åŒ…è£…äº† SqlSession çš„æ ‡å‡†å®šä¹‰å®ç°ç±»ï¼Œå¹¶ç”± SqlSession å®Œæˆå¯¹æ˜ å°„å™¨å¯¹è±¡çš„æ³¨å†Œå’Œä½¿ç”¨ã€‚
- æœ¬ç« å­¦ä¹ è¦æ³¨æ„å‡ ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬ï¼šæ˜ å°„å™¨ã€ä»£ç†ç±»ã€æ³¨å†Œæœºã€æ¥å£æ ‡å‡†ã€å·¥å‚æ¨¡å¼ã€ä¸Šä¸‹æ–‡ã€‚è¿™äº›å·¥ç¨‹å¼€å‘çš„æŠ€å·§éƒ½æ˜¯åœ¨æ‰‹å†™ Mybatis çš„è¿‡ç¨‹ä¸­éå¸¸é‡è¦çš„éƒ¨åˆ†ï¼Œäº†è§£å’Œç†Ÿæ‚‰æ‰èƒ½æ›´å¥½çš„åœ¨è‡ªå·±çš„ä¸šåŠ¡ä¸­è¿›è¡Œä½¿ç”¨ã€‚

## ä¸ƒã€ä¼˜ç§€ä½œä¸š

- [å®ç°æ˜ å°„å™¨çš„æ³¨å†Œå’Œä½¿ç”¨ @liuc](https://t.zsxq.com/08y9Q7qPd)
- [éœ€è¦å°†daoå±‚æ¥å£ä¸mapper æ˜ å°„å™¨å…³è”èµ·æ¥,éœ€è¦åˆ›å»ºä¸€ä¸ªæ³¨å†Œå™¨ @Alpha](https://t.zsxq.com/06IaAMZvF)
- [é€šè¿‡å¯¹åº”mapperçš„æ˜ å°„å™¨å·¥å‚å¯ä»¥ç”Ÿæˆç›¸åº”çš„æ˜ å°„å™¨å¯¹è±¡ @W](https://t.zsxq.com/06uBau7Qr)
- [åˆ›å»ºMapperProxyFactoryçš„ç¼“å­˜å™¨ï¼Œå¹¶ä¸”ä¸ºäº†è§£æ”¾åŒæ‰‹ @W](https://t.zsxq.com/06uBau7Qr)
- [å®Œæˆæ˜ å°„å™¨çš„æ³¨å†Œä»¥åŠä»£ç è°ƒè¯• @å·](https://t.zsxq.com/06AMrzv3j)
- [æˆ‘ä»¬è™½ç„¶å¸®Mapperç±»æ¥å£è¿›è¡Œä»£ç†ï¼Œäº¤ç»™ä»£ç†å·¥å‚å»å®ç° @ç¬](https://t.zsxq.com/086IbEDtl)
- [é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç° Spring æ ¸å¿ƒçš„ AOP åŠŸèƒ½ã€‚@Homage](https://t.zsxq.com/08OZaj17G)