---
title: ç¬¬4ç« ï¼šMapper XMLçš„è§£æå’Œæ³¨å†Œä½¿ç”¨
lock: need
---

# ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬4ç« ï¼šMapper XMLçš„è§£æå’Œæ³¨å†Œä½¿ç”¨

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/C_bb9f1Hr9aJAvbmrDHHig](https://mp.weixin.qq.com/s/C_bb9f1Hr9aJAvbmrDHHig)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=469969468&bvid=BV1qT41157D8&cid=744089465&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`ä½ æ˜¯æ€ä¹ˆé¢å¯¹åŠŸèƒ½è¿­ä»£çš„ï¼Ÿ`

å…¶å®å¾ˆå¤šç¨‹åºå‘˜åœ¨åˆšå¼€å§‹åšç¼–ç¨‹æˆ–è€…æ–°åŠ å…¥ä¸€å®¶å…¬å¸æ—¶ï¼Œéƒ½æ²¡æœ‰å¤šå°‘æœºä¼šå¯ä»¥åšä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯åœ¨è€é¡¹ç›®ä¸Šä¸æ–­çš„è¿­ä»£æ›´æ–°ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä½ å¯èƒ½è¦å­¦ä¹ Nä¸ªå‰äººç•™ä¸‹çš„å„å¼å„æ ·çš„é£æ ¼è¿¥å¼‚çš„ä»£ç ç‰‡æ®µï¼Œåœ¨è¿™äº›çºµæ¨ªäº¤é”™çš„æµç¨‹ä¸­ï¼Œæ‰¾åˆ°ä¸€å¸­ä¹‹åœ°ï¼ŒæŠŠè‡ªå·±çš„`ifelse`åŠ è¿›å»ã€‚

è™½ç„¶è¿™æ ·èƒ¡ä¹±çš„åŠ `ifelse`ï¼Œåˆšä¸Šæ‰‹å°±â€œæ‘†çƒ‚â€çš„å¿ƒæ€ï¼Œè®©äººå¾ˆéš¾å—ã€‚ä½†è¦æƒ³åœ¨å·²ç»è¢«å‹ç¼©çš„å·¥æœŸä¸‹ï¼Œè¿˜èƒ½äº¤ä»˜å‡ºé«˜è´¨é‡çš„ä»£ç å…¶å®ä¹Ÿå¾ˆéš¾å®Œæˆï¼Œæ‰€ä»¥ä¸€éƒ¨åˆ†ç ”å‘è¢«é€¼åˆ°èƒ½ç”¨å°±è¡Œï¼Œèƒ½è·‘å°±å¯ä»¥ã€‚

ä½†è¯´å›æ¥ï¼Œå…¶å®ä¸èƒ½é€æ­¥æ¸…ç†ä¸€ç‰‡å±å±±ï¼Œè®©ä»£ç åœ¨ä½ çš„æ‰‹ä¸Šé€æ­¥æ¸…æ™°ã€æ•´æ´ã€å¹²å‡€ï¼Œå¾ˆå¤šæ—¶å€™ä¹Ÿæ˜¯ä½œä¸ºç å†œè‡ªèº«ç»éªŒçš„ä¸è¶³ï¼Œä¸æ‡‚å¾—ç³»ç»Ÿé‡æ„ã€ä¸äº†è§£è®¾è®¡åŸåˆ™ã€ä¸ç†Ÿæ‚‰ä¸šåŠ¡èƒŒæ™¯ã€ä¸æ¸…æ¥šäº§å“èµ°å‘ç­‰ç­‰åŸå› é€ æˆçš„ã€‚æ‰€ä»¥æœ€å¥½çš„åŠæ³•æ˜¯æå‡è‡ªèº«çš„èƒ½åŠ›ï¼Œæ¯æ¥åˆ°ä¸€æ¬¡éœ€æ±‚éƒ½æœ‰ä¸€äº›æŠ€æœ¯ä¸Šçš„æ”¹å˜ï¼Œæ—¢ç„¶å®ƒæ˜¯å±å±±ï¼Œé‚£å°±å½“åšæ‰“æ€ªå‡çº§äº†ï¼Œä¿®ä¸€ç‚¹ã€æ”¹ä¸€å—ã€è¡¥ä¸€ç‰‡ï¼Œæ€»ä¼šåœ¨ä½ æ‰‹ä¸Šè¶Šæ¥è¶Šæ˜“äºç»´æŠ¤å’Œæ‰©å±•çš„ã€‚

## äºŒã€ç›®æ ‡

åœ¨æˆ‘ä»¬æ¸è¿›å¼çš„é€æ­¥å®ç° Mybatis æ¡†æ¶è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬è¦æœ‰ä¸€ä¸ªç›®æ ‡å¯¼å‘çš„æ€è·¯ï¼Œä¹Ÿå°±æ˜¯è¯´ Mybatis çš„æ ¸å¿ƒé€»è¾‘æ€ä¹ˆå®ç°ã€‚

å…¶å®æˆ‘ä»¬å¯ä»¥æŠŠè¿™æ ·ä¸€ä¸ª ORM æ¡†æ¶çš„ç›®æ ‡ï¼Œç®€å•çš„æè¿°æˆæ˜¯ä¸ºäº†ç»™ä¸€ä¸ªæ¥å£æä¾›ä»£ç†ç±»ï¼Œç±»ä¸­åŒ…æ‹¬äº†å¯¹ Mapper ä¹Ÿå°±æ˜¯ xml æ–‡ä»¶ä¸­çš„ SQL ä¿¡æ¯(`ç±»å‹`ã€`å…¥å‚`ã€`å‡ºå‚`ã€`æ¡ä»¶`)è¿›è¡Œè§£æå’Œå¤„ç†ï¼Œè¿™ä¸ªå¤„ç†è¿‡ç¨‹å°±æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œä»¥åŠè¿”å›å¯¹åº”çš„ç»“æœç»™åˆ°æ¥å£ã€‚å¦‚å›¾ 4-1

![å›¾ 4-1 ORM æ¡†æ¶æ ¸å¿ƒæµç¨‹](https://bugstack.cn/images/article/spring/mybatis-220409-01.png)

é‚£ä¹ˆæŒ‰ç…§ ORM æ ¸å¿ƒæµç¨‹çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬æœ¬ç« èŠ‚å°±éœ€è¦åœ¨ä¸Šä¸€ç« èŠ‚çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ‰©å±•å¯¹ Mapper æ–‡ä»¶çš„è§£æä»¥åŠæå–å‡ºå¯¹åº”çš„ SQL æ–‡ä»¶ã€‚å¹¶åœ¨å½“å‰è¿™ä¸ªé˜¶æ®µï¼Œå¯ä»¥æ»¡è¶³æˆ‘ä»¬è°ƒç”¨ DAO æ¥å£æ–¹æ³•çš„æ—¶å€™ï¼Œå¯ä»¥è¿”å› Mapper ä¸­å¯¹åº”çš„å¾…æ‰§è¡Œ SQL è¯­å¥ã€‚*ä¸ºäº†ä¸è‡³äºæŠŠæ•´ä¸ªå·¥ç¨‹æ’‘å¤§ï¼Œå°å‚…å“¥ä¼šå¸¦ç€å¤§å®¶é€æ­¥å®Œæˆè¿™äº›å†…å®¹ï¼Œæ‰€ä»¥æœ¬ç« èŠ‚æš‚æ—¶ä¸ä¼šå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå¾…åç»­é€æ­¥å®ç°*

## ä¸‰ã€è®¾è®¡

ç»“åˆä¸Šä¸€ç« èŠ‚æˆ‘ä»¬ä½¿ç”¨äº† `MapperRegistry` å¯¹åŒ…è·¯å¾„è¿›è¡Œæ‰«ææ³¨å†Œæ˜ å°„å™¨ï¼Œå¹¶åœ¨ `DefaultSqlSession` ä¸­è¿›è¡Œä½¿ç”¨ã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å‘½åç©ºé—´ã€SQLæè¿°ã€æ˜ å°„ä¿¡æ¯ç»Ÿä¸€ç»´æŠ¤åˆ°æ¯ä¸€ä¸ª DAO å¯¹åº”çš„ Mapper XML çš„æ–‡ä»¶ä»¥åï¼Œå…¶å® XML å°±æ˜¯æˆ‘ä»¬çš„æºå¤´äº†ã€‚é€šè¿‡å¯¹ XML æ–‡ä»¶çš„è§£æå’Œå¤„ç†å°±å¯ä»¥å®Œæˆ Mapper æ˜ å°„å™¨çš„æ³¨å†Œå’Œ SQL ç®¡ç†ã€‚è¿™æ ·ä¹Ÿå°±æ›´åŠ æˆ‘ä»¬æ“ä½œå’Œä½¿ç”¨äº†ã€‚å¦‚å›¾ 4-2

![å›¾ 4-2 XML æ–‡ä»¶è§£ææ³¨å†Œå¤„ç†](https://bugstack.cn/images/article/spring/mybatis-220409-02.png)

- é¦–å…ˆéœ€è¦å®šä¹‰ `SqlSessionFactoryBuilder` å·¥å‚å»ºé€ è€…æ¨¡å¼ç±»ï¼Œé€šè¿‡å…¥å£ IO çš„æ–¹å¼å¯¹ XML æ–‡ä»¶è¿›è¡Œè§£æã€‚å½“å‰æˆ‘ä»¬ä¸»è¦ä»¥è§£æ SQL éƒ¨åˆ†ä¸ºä¸»ï¼Œå¹¶æ³¨å†Œæ˜ å°„å™¨ï¼Œä¸²è”å‡ºæ•´ä¸ªæ ¸å¿ƒæµç¨‹çš„è„‰ç»œã€‚
- æ–‡ä»¶è§£æä»¥åä¼šå­˜æ”¾åˆ° Configuration é…ç½®ç±»ä¸­ï¼Œæ¥ä¸‹æ¥ä½ ä¼šçœ‹åˆ°è¿™ä¸ªé…ç½®ç±»ä¼šè¢«ä¸²è”åˆ°æ•´ä¸ª Mybatis æµç¨‹ä¸­ï¼Œæ‰€æœ‰å†…å®¹å­˜æ”¾å’Œè¯»å–éƒ½ç¦»ä¸å¼€è¿™ä¸ªç±»ã€‚å¦‚æˆ‘ä»¬åœ¨ DefaultSqlSession ä¸­è·å– Mapper å’Œæ‰§è¡Œ selectOne ä¹ŸåŒæ ·æ˜¯éœ€è¦åœ¨ Configuration é…ç½®ç±»ä¸­è¿›è¡Œè¯»å–æ“ä½œã€‚

## å››ã€å®ç°

### 1. å·¥ç¨‹ç»“æ„

```java
mybatis-step-03
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn.bugstack.mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”‚   â”œâ”€â”€ MapperMethod.java
    â”‚           â”‚   â”œâ”€â”€ MapperProxy.java
    â”‚           â”‚   â”œâ”€â”€ MapperProxyFactory.java
    â”‚           â”‚   â””â”€â”€ MapperRegistry.java
    â”‚           â”œâ”€â”€ builder
    â”‚           â”‚   â”œâ”€â”€ xml
    â”‚           â”‚   â”‚   â””â”€â”€ XMLConfigBuilder.java
    â”‚           â”‚   â””â”€â”€ BaseBuilder.java
    â”‚           â”œâ”€â”€ io
    â”‚           â”‚   â””â”€â”€ Resources.java
    â”‚           â”œâ”€â”€ mapping
    â”‚           â”‚   â”œâ”€â”€ MappedStatement.java
    â”‚           â”‚   â””â”€â”€ SqlCommandType.java
    â”‚           â””â”€â”€ session
    â”‚               â”œâ”€â”€ defaults
    â”‚               â”‚   â”œâ”€â”€ DefaultSqlSession.java
    â”‚               â”‚   â””â”€â”€ DefaultSqlSessionFactory.java
    â”‚               â”œâ”€â”€ Configuration.java
    â”‚               â”œâ”€â”€ SqlSession.java
    â”‚               â”œâ”€â”€ SqlSessionFactory.java
    â”‚               â””â”€â”€ SqlSessionFactoryBuilder.java
    â””â”€â”€ test
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ cn.bugstack.mybatis.test.dao
        â”‚       â”œâ”€â”€ dao
        â”‚       â”‚   â””â”€â”€ IUserDao.java
        â”‚       â”œâ”€â”€ po
        â”‚       â”‚   â””â”€â”€ User.java
        â”‚       â””â”€â”€ ApiTest.java
        â””â”€â”€ resources
            â”œâ”€â”€ mapper
            â”‚   â””â”€â”€User_Mapper.xml
            â””â”€â”€ mybatis-config-datasource.xml
```

**å·¥ç¨‹æºç **ï¼š`å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç `

XML è§£æå’Œæ³¨å†Œç±»å®ç°å…³ç³»ï¼Œå¦‚å›¾ 4-2

![å›¾ 4-2 XML è§£æå’Œæ³¨å†Œç±»å®ç°å…³ç³»](https://bugstack.cn/images/article/spring/mybatis-220409-03.png)

- SqlSessionFactoryBuilder ä½œä¸ºæ•´ä¸ª Mybatis çš„å…¥å£ï¼Œæä¾›å»ºé€ è€…å·¥å‚ï¼ŒåŒ…è£… XML è§£æå¤„ç†ï¼Œå¹¶è¿”å›å¯¹åº” SqlSessionFactory å¤„ç†ç±»ã€‚
- é€šè¿‡è§£ææŠŠ XML ä¿¡æ¯æ³¨å†Œåˆ° Configuration é…ç½®ç±»ä¸­ï¼Œå†é€šè¿‡ä¼ é€’ Configuration é…ç½®ç±»åˆ°å„ä¸ªé€»è¾‘å¤„ç†ç±»é‡Œï¼ŒåŒ…æ‹¬ DefaultSqlSession ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è·å–æ˜ å°„å™¨å’Œæ‰§è¡ŒSQLçš„æ—¶å€™ï¼Œä»é…ç½®ç±»ä¸­æ‹¿åˆ°å¯¹åº”çš„å†…å®¹äº†ã€‚

### 2. æ„å»ºSqlSessionFactoryå»ºé€ è€…å·¥å‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.session.SqlSessionFactoryBuilder`

```java
public class SqlSessionFactoryBuilder {

    public SqlSessionFactory build(Reader reader) {
        XMLConfigBuilder xmlConfigBuilder = new XMLConfigBuilder(reader);
        return build(xmlConfigBuilder.parse());
    }

    public SqlSessionFactory build(Configuration config) {
        return new DefaultSqlSessionFactory(config);
    }

}
```

- SqlSessionFactoryBuilder æ˜¯ä½œä¸ºæ•´ä¸ª Mybatis çš„å…¥å£ç±»ï¼Œé€šè¿‡æŒ‡å®šè§£æXMLçš„IOï¼Œå¼•å¯¼æ•´ä¸ªæµç¨‹çš„å¯åŠ¨ã€‚
- ä»è¿™ä¸ªç±»å¼€å§‹æ–°å¢åŠ äº† XMLConfigBuilderã€Configuration ä¸¤ä¸ªå¤„ç†ç±»ï¼Œåˆ†åˆ«ç”¨äºè§£æ XML å’Œä¸²è”æ•´ä¸ªæµç¨‹çš„å¯¹è±¡ä¿å­˜æ“ä½œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šåˆ†åˆ«ä»‹ç»è¿™äº›æ–°å¼•å…¥çš„å¯¹è±¡ã€‚

### 3. XML è§£æå¤„ç†

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.builder.xml.XMLConfigBuilder`

```java
public class XMLConfigBuilder extends BaseBuilder {

    private Element root;

    public XMLConfigBuilder(Reader reader) {
        // 1. è°ƒç”¨çˆ¶ç±»åˆå§‹åŒ–Configuration
        super(new Configuration());
        // 2. dom4j å¤„ç† xml
        SAXReader saxReader = new SAXReader();
        try {
            Document document = saxReader.read(new InputSource(reader));
            root = document.getRootElement();
        } catch (DocumentException e) {
            e.printStackTrace();
        }
    }

    public Configuration parse() {
        try {
            // è§£ææ˜ å°„å™¨
            mapperElement(root.element("mappers"));
        } catch (Exception e) {
            throw new RuntimeException("Error parsing SQL Mapper Configuration. Cause: " + e, e);
        }
        return configuration;
    }

    private void mapperElement(Element mappers) throws Exception {
        List<Element> mapperList = mappers.elements("mapper");
        for (Element e : mapperList) {
            		// è§£æå¤„ç†ï¼Œå…·ä½“å‚ç…§æºç 
            		
                // æ·»åŠ è§£æ SQL
                configuration.addMappedStatement(mappedStatement);
            }

            // æ³¨å†ŒMapperæ˜ å°„å™¨
            configuration.addMapper(Resources.classForName(namespace));
        }
    }
    
}
```

- XMLConfigBuilder æ ¸å¿ƒæ“ä½œåœ¨äºåˆå§‹åŒ– Configurationï¼Œå› ä¸º Configuration çš„ä½¿ç”¨ç¦»è§£æ XML å’Œå­˜æ”¾æ˜¯æœ€è¿‘çš„æ“ä½œï¼Œæ‰€ä»¥æ”¾åœ¨è¿™é‡Œæ¯”è¾ƒé€‚åˆã€‚
- ä¹‹åå°±æ˜¯å…·ä½“çš„ parse() è§£ææ“ä½œï¼Œå¹¶æŠŠè§£æåçš„ä¿¡æ¯ï¼Œé€šè¿‡ Configuration é…ç½®ç±»è¿›è¡Œå­˜æ”¾ï¼ŒåŒ…æ‹¬ï¼šæ·»åŠ è§£æ SQLã€æ³¨å†ŒMapperæ˜ å°„å™¨ã€‚
- è§£æé…ç½®æ•´ä½“åŒ…æ‹¬ï¼šç±»å‹åˆ«åã€æ’ä»¶ã€å¯¹è±¡å·¥å‚ã€å¯¹è±¡åŒ…è£…å·¥å‚ã€è®¾ç½®ã€ç¯å¢ƒã€ç±»å‹è½¬æ¢ã€æ˜ å°„å™¨ï¼Œä½†ç›®å‰æˆ‘ä»¬è¿˜ä¸éœ€è¦é‚£ä¹ˆå¤šï¼Œæ‰€ä»¥åªåšä¸€äº›å¿…è¦çš„ SQL è§£æå¤„ç†ã€‚

### 4. é€šè¿‡é…ç½®ç±»åŒ…è£…æ³¨å†Œæœºå’ŒSQLè¯­å¥

**æºç è¯¦è§(é…ç½®é¡¹)**ï¼š`cn.bugstack.mybatis.session.Configuration`

```java
public class Configuration {

    /**
     * æ˜ å°„æ³¨å†Œæœº
     */
    protected MapperRegistry mapperRegistry = new MapperRegistry(this);

    /**
     * æ˜ å°„çš„è¯­å¥ï¼Œå­˜åœ¨Mapé‡Œ
     */
    protected final Map<String, MappedStatement> mappedStatements = new HashMap<>();

    public <T> void addMapper(Class<T> type) {
        mapperRegistry.addMapper(type);
    }

    public void addMappedStatement(MappedStatement ms) {
        mappedStatements.put(ms.getId(), ms);
    }
}
```

åœ¨é…ç½®ç±»ä¸­æ·»åŠ æ˜ å°„å™¨æ³¨å†Œæœºå’Œæ˜ å°„è¯­å¥çš„å­˜æ”¾ï¼›
- æ˜ å°„å™¨æ³¨å†Œæœºæ˜¯æˆ‘ä»¬ä¸Šä¸€ç« èŠ‚å®ç°çš„å†…å®¹ï¼Œç”¨äºæ³¨å†Œ Mapper æ˜ å°„å™¨é”æä¾›çš„æ“ä½œç±»ã€‚
- å¦å¤–ä¸€ä¸ª MappedStatement æ˜¯æœ¬ç« èŠ‚æ–°æ·»åŠ çš„ SQL ä¿¡æ¯è®°å½•å¯¹è±¡ï¼ŒåŒ…æ‹¬è®°å½•ï¼šSQLç±»å‹ã€SQLè¯­å¥ã€å…¥å‚ç±»å‹ã€å‡ºå‚ç±»å‹ç­‰ã€‚*è¯¦ç»†å¯å‚ç…§æºç *

### 5. DefaultSqlSessionç»“åˆé…ç½®é¡¹è·å–ä¿¡æ¯

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.session.defaults.DefaultSqlSession`

```java
public class DefaultSqlSession implements SqlSession {

    private Configuration configuration;

    @Override
    public <T> T selectOne(String statement, Object parameter) {
        MappedStatement mappedStatement = configuration.getMappedStatement(statement);
        return (T) ("ä½ è¢«ä»£ç†äº†ï¼" + "\næ–¹æ³•ï¼š" + statement + "\nå…¥å‚ï¼š" + parameter + "\nå¾…æ‰§è¡ŒSQLï¼š" + mappedStatement.getSql());
    }

    @Override
    public <T> T getMapper(Class<T> type) {
        return configuration.getMapper(type, this);
    }

}
```

- DefaultSqlSession ç›¸å¯¹äºä¸Šä¸€ç« èŠ‚ï¼Œå°å‚…å“¥è¿™é‡ŒæŠŠ `MapperRegistry mapperRegistry` æ›¿æ¢ä¸º `Configuration configuration`ï¼Œè¿™æ ·æ‰èƒ½ä¼ é€’æ›´ä¸°å¯Œçš„ä¿¡æ¯å†…å®¹ï¼Œè€Œä¸åªæ˜¯æ³¨å†Œå™¨æ“ä½œã€‚
- ä¹‹ååœ¨ DefaultSqlSession#selectOneã€DefaultSqlSession#getMapper ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½ä½¿ç”¨ configuration æ¥è·å–å¯¹åº”çš„ä¿¡æ¯ã€‚
- ç›®å‰ selectOne æ–¹æ³•ä¸­åªæ˜¯æŠŠè·å–çš„ä¿¡æ¯è¿›è¡Œæ‰“å°ï¼Œåç»­å°†å¼•å…¥ SQL æ‰§è¡Œå™¨è¿›è¡Œç»“æœæŸ¥è¯¢å¹¶è¿”å›ã€‚

## äº”ã€æµ‹è¯•

### 1. äº‹å…ˆå‡†å¤‡

æä¾› DAO æ¥å£å’Œå¯¹åº”çš„ Mapper xml é…ç½®

```java
public interface IUserDao {

    String queryUserInfoById(String uId);

}
```

```xml
<mapper namespace="cn.bugstack.mybatis.test.dao.IUserDao">

    <select id="queryUserInfoById" parameterType="java.lang.Long" resultType="cn.bugstack.mybatis.test.po.User">
        SELECT id, userId, userHead, createTime
        FROM user
        where id = #{id}
    </select>

</mapper>
```

### 2. å•å…ƒæµ‹è¯•

```java
@Test
public void test_SqlSessionFactory() throws IOException {
    // 1. ä»SqlSessionFactoryä¸­è·å–SqlSession
    Reader reader = Resources.getResourceAsReader("mybatis-config-datasource.xml");
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
    SqlSession sqlSession = sqlSessionFactory.openSession();

    // 2. è·å–æ˜ å°„å™¨å¯¹è±¡
    IUserDao userDao = sqlSession.getMapper(IUserDao.class);

    // 3. æµ‹è¯•éªŒè¯
    String res = userDao.queryUserInfoById("10001");
    logger.info("æµ‹è¯•ç»“æœï¼š{}", res);
}
```

- ç›®å‰çš„ä½¿ç”¨æ–¹å¼å°±å’Œ Mybatis éå¸¸åƒäº†ï¼Œé€šè¿‡åŠ è½½ xml é…ç½®æ–‡ä»¶ï¼Œäº¤ç»™ SqlSessionFactoryBuilder è¿›è¡Œæ„å»ºè§£æï¼Œå¹¶è·å– SqlSessionFactory å·¥å‚ã€‚è¿™æ ·å°±å¯ä»¥é¡ºåˆ©çš„å¼€å¯ Session ä»¥åŠå®Œæˆåç»­çš„æ“ä½œã€‚

**æµ‹è¯•ç»“æœ**

```java
07:07:40.519 [main] INFO  cn.bugstack.mybatis.test.ApiTest - æµ‹è¯•ç»“æœï¼šä½ è¢«ä»£ç†äº†ï¼
æ–¹æ³•ï¼šcn.bugstack.mybatis.test.dao.IUserDao.queryUserInfoById
å…¥å‚ï¼š[Ljava.lang.Object;@23223dd8
å¾…æ‰§è¡ŒSQLï¼š
        SELECT id, userId, userHead, createTime
        FROM user
        where id = ?
    

Process finished with exit code 0
```

- ä»æµ‹è¯•ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰çš„ä»£ç†æ“ä½œå·²ç»å¯ä»¥æŠŠæˆ‘ä»¬ä» XML ä¸­è§£æçš„ SQL ä¿¡æ¯è¿›è¡Œæ‰“å°äº†ï¼Œåç»­æˆ‘ä»¬å°†ç»“åˆè¿™éƒ¨åˆ†çš„å¤„ç†ç»§ç»­å®Œæˆæ•°æ®åº“çš„æ“ä½œã€‚

## å…­ã€æ€»ç»“

- äº†è§£ ORM å¤„ç†çš„æ ¸å¿ƒæµç¨‹ï¼ŒçŸ¥æ™“ç›®å‰æˆ‘ä»¬æ‰€å¤„åœ¨çš„æ­¥éª¤å’Œè¦å®Œæˆçš„å†…å®¹ï¼Œåªæœ‰éå¸¸æ¸…æ¥šçš„çŸ¥é“è¿™ä¸ªä»£ç†ã€å°è£…ã€è§£æå’Œè¿”å›ç»“æœçš„è¿‡ç¨‹æ‰èƒ½æ›´å¥½çš„å®Œæˆæ•´ä¸ªæ¡†æ¶çš„å®ç°ã€‚
- SqlSessionFactoryBuilder çš„å¼•å…¥åŒ…è£…äº†æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼šXML æ–‡ä»¶çš„è§£æã€Configuration é…ç½®ç±»çš„å¤„ç†ï¼Œè®© DefaultSqlSession å¯ä»¥æ›´åŠ çµæ´»çš„æ‹¿åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼Œè·å– Mapper å’Œ SQL è¯­å¥ã€‚
- å¦å¤–ä»æ•´ä¸ªå·¥ç¨‹æ­å»ºçš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šå·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€ä»£ç†æ¨¡å¼çš„ä½¿ç”¨ï¼Œä¹Ÿæœ‰å¾ˆå¤šè®¾è®¡åŸåˆ™çš„è¿ç”¨ï¼Œè¿™äº›æŠ€å·§éƒ½å¯ä»¥è®©æ•´ä¸ªå·¥ç¨‹å˜å¾—æ˜“äºç»´æŠ¤å’Œæ˜“äºè¿­ä»£ã€‚*è¿™ä¹Ÿæ˜¯ç ”å‘äººå‘˜åœ¨å­¦ä¹ æºç çš„è¿‡ç¨‹ä¸­ï¼Œéå¸¸å€¼å¾—é‡ç‚¹å…³æ³¨çš„åœ°æ–¹ã€‚*

## ä¸ƒã€ä¼˜ç§€ä½œä¸š

- [Mapper XMLçš„è§£æå’Œæ³¨å†Œä½¿ç”¨ @liuc](https://t.zsxq.com/08wDxcVV4)