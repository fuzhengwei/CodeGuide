---
title: ç¬¬8ç« ï¼šæŠŠåå°„ç”¨åˆ°å‡ºç¥å…¥åŒ–
lock: need
---

# ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬8ç« ï¼šæŠŠåå°„ç”¨åˆ°å‡ºç¥å…¥åŒ–

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/FNgAruzgFebXZiOk0XZT4A](https://mp.weixin.qq.com/s/FNgAruzgFebXZiOk0XZT4A)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=898907420&bvid=BV1gN4y1L7NR&cid=789356841&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`ä¸ºä»€ä¹ˆï¼Œè¯»ä¸æ‡‚æ¡†æ¶æºç ï¼Ÿ`

æˆ‘ä»¬éƒ½çŸ¥é“ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¦‚æœæƒ³å­¦ä¹ åˆ°æ›´æ·±å±‚æ¬¡çš„æŠ€æœ¯ï¼Œå°±éœ€è¦é˜…è¯»å¤§é‡çš„æ¡†æ¶æºç ï¼Œå­¦ä¹ è¿™äº›æ¡†æ¶æºç ä¸­çš„å¼€å‘å¥—è·¯å’Œè®¾è®¡æ€æƒ³ï¼Œä»è€Œæå‡è‡ªå·±çš„ç¼–ç¨‹èƒ½åŠ›ã€‚

äº‹å¤§å®¶éƒ½æ¸…æ¥šï¼Œä½†åœ¨å®æ“ä¸Šï¼Œå¾ˆå¤šç å†œæ ¹æœ¬æ²¡æ³•é˜…è¯»æ¡†æ¶æºç ã€‚é¦–å…ˆä¸€ä¸ªéå¸¸å¤§çš„é—®é¢˜æ˜¯ï¼Œé¢å¯¹å¦‚æ­¤åºå¤§çš„æ¡†æ¶æºç ï¼Œä¸çŸ¥é“ä»å“ªä¸‹æ‰‹ã€‚ä¸å¹³å¸¸çš„ä¸šåŠ¡éœ€æ±‚å¼€å‘ç›¸æ¯”ï¼Œæ¡†æ¶æºç ä¸­è¿ç”¨äº†å¤§é‡çš„è®¾è®¡åŸåˆ™å’Œè®¾è®¡æ¨¡å¼å¯¹ç³»ç»ŸåŠŸèƒ½è¿›è¡Œè§£è€¦å’Œå®ç°ï¼Œä¹Ÿä½¿ç”¨äº†ä¸å°‘å¦‚åå°„ã€ä»£ç†ã€å­—èŠ‚ç ç­‰ç›¸å…³æŠ€æœ¯ã€‚

å½“ä½ è¿˜ä»¥ä¸ºæ˜¯å¹³å¸¸çš„ä¸šåŠ¡éœ€æ±‚ä¸­çš„å®ä¾‹åŒ–å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œå»æ‰¾å¯»æºç ä¸­çš„æµç¨‹æ—¶ï¼Œå¯èƒ½æ ¹æœ¬å°±æ‰¾ä¸åˆ°å®ƒæ˜¯ä½•æ—¶å‘èµ·è°ƒç”¨çš„ã€æ€ä¹ˆè¿›è¡Œä¼ å‚ã€åœ¨å“ªå¤„ç†èµ‹å€¼çš„ç­‰ä¸€è¿ä¸²çš„é—®é¢˜ï¼Œéƒ½æŠŠä¸€ä¸ªå¥½ç å†œåŠé€€åœ¨å¼€å§‹å­¦ä¹ çš„è·¯ä¸Šã€‚

## äºŒã€ç›®æ ‡

ä¸çŸ¥é“å¤§å®¶åœ¨å­¦ä¹ [ã€Šæ‰‹å†™ Mybatisã€‹](https://mp.weixin.qq.com/s/smohXRphj-FejvrP-FOgBw)çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦æœ‰å¯¹ç…§ Mybatis æºç ä¸€èµ·å­¦ä¹ ï¼Œå¦‚æœä½ æœ‰å¯¹ç…§æºç ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡ä¼šå‘ç°æˆ‘ä»¬åœ¨å®ç°æ•°æ®æºæ± åŒ–æ—¶ï¼Œå¯¹äºå±æ€§ä¿¡æ¯çš„è·å–ï¼Œé‡‡ç”¨çš„æ˜¯ç¡¬ç¼–ç çš„æ–¹å¼ã€‚å¦‚å›¾ 8-1 æ‰€ç¤º

![å›¾ 8-1 æ•°æ®æºæ± åŒ–é…ç½®è·å–](https://bugstack.cn/images/article/spring/mybatis-220506-01.png)

- ä¹Ÿå°±æ˜¯ `props.getProperty("driver")`ã€`props.getProperty("url")` ç­‰å±æ€§ï¼Œéƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨ç¼–ç çš„æ–¹å¼è·å–çš„ã€‚
- é‚£å…¶å®åƒ driverã€urlã€usernameã€password ä¸éƒ½æ˜¯æ ‡å‡†çš„å›ºå®šå­—æ®µå—ï¼Œè¿™æ ·è·å–æœ‰ä»€ä¹ˆä¸å¯¹çš„ã€‚å¦‚æœæŒ‰ç…§æˆ‘ä»¬ç°åœ¨çš„ç†è§£æ¥è¯´ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¯¹ï¼Œä½†å…¶å®é™¤äº†è¿™äº›å­—æ®µä»¥å¤–ï¼Œå¯èƒ½è¿˜æœ‰æ—¶å€™ä¼šé…ç½®ä¸€äº›æ‰©å±•å­—æ®µï¼Œé‚£ä¹ˆæ€ä¹ˆè·å–å‘¢ï¼Œæ€»ä¸èƒ½æ¯æ¬¡éƒ½æ˜¯ç¡¬ç¼–ç ã€‚
- æ‰€ä»¥å¦‚æœä½ æœ‰é˜…è¯» Mybatis çš„æºç ï¼Œä¼šå‘ç°è¿™é‡Œä½¿ç”¨äº† Mybatis è‡ªå·±å®ç°çš„å…ƒå¯¹è±¡åå°„å·¥å…·ç±»ï¼Œå¯ä»¥å®Œæˆä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„åå°„å¡«å……ã€‚è¿™å—çš„å·¥å…·ç±»å«åš MetaObject å¹¶æä¾›ç›¸åº”çš„ï¼›å…ƒå¯¹è±¡ã€å¯¹è±¡åŒ…è£…å™¨ã€å¯¹è±¡å·¥å‚ã€å¯¹è±¡åŒ…è£…å·¥å‚ä»¥åŠ Reflector åå°„å™¨çš„ä½¿ç”¨ã€‚é‚£ä¹ˆæœ¬ç« èŠ‚æˆ‘ä»¬å°±æ¥å®ç°ä¸€ä¸‹åå°„å·¥å…·åŒ…çš„å†…å®¹ï¼Œå› ä¸ºéšç€æˆ‘ä»¬åç»­çš„å¼€å‘ï¼Œä¹Ÿä¼šæœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨åå°„å™¨ä¼˜é›…çš„å¤„ç†æˆ‘ä»¬çš„å±æ€§ä¿¡æ¯ã€‚**è¿™ä¹Ÿèƒ½ä¸ºä½ æ·»åŠ ä¸€äº›å…³äºåå°„çš„å¼ºå¤§çš„ä½¿ç”¨ï¼**

## ä¸‰ã€è®¾è®¡

å¦‚æœè¯´æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡çš„æ‰€æä¾›çš„å±æ€§è¿›è¡Œç»Ÿä¸€çš„è®¾ç½®å’Œè·å–å€¼çš„æ“ä½œï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠå½“å‰è¿™ä¸ªè¢«å¤„ç†çš„å¯¹è±¡è¿›è¡Œè§£è€¦ï¼Œæå–å‡ºå®ƒæ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶æŒ‰ç…§ä¸åŒçš„ç±»å‹è¿›è¡Œåå°„å¤„ç†ï¼Œä»è€ŒåŒ…è£…æˆä¸€ä¸ªå·¥å…·åŒ…ã€‚å¦‚å›¾ 8-2 æ‰€ç¤º

![å›¾ 8-2 å¯¹è±¡å±æ€§åå°„å¤„ç†](https://bugstack.cn/images/article/spring/mybatis-220506-02.png)

- å…¶å®æ•´ä¸ªè®¾è®¡è¿‡ç¨‹éƒ½ä»¥å›´ç»•å¦‚ä½•æ‹†è§£å¯¹è±¡å¹¶æä¾›åå°„æ“ä½œä¸ºä¸»ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªå¯¹è±¡æ¥è¯´ï¼Œå®ƒæ‰€åŒ…æ‹¬çš„æœ‰å¯¹è±¡çš„æ„é€ å‡½æ•°ã€å¯¹è±¡çš„å±æ€§ã€å¯¹è±¡çš„æ–¹æ³•ã€‚è€Œå¯¹è±¡çš„æ–¹æ³•å› ä¸ºéƒ½æ˜¯è·å–å’Œè®¾ç½®å€¼çš„æ“ä½œï¼Œæ‰€ä»¥åŸºæœ¬éƒ½æ˜¯getã€setå¤„ç†ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™äº›æ–¹æ³•åœ¨å¯¹è±¡æ‹†è§£çš„è¿‡ç¨‹ä¸­éœ€è¦æ‘˜å–å‡ºæ¥è¿›è¡Œä¿å­˜ã€‚
- å½“çœŸæ­£çš„å¼€å§‹æ“ä½œæ—¶ï¼Œåˆ™ä¼šä¾èµ–äºå·²ç»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå¯¹å…¶è¿›è¡Œå±æ€§å¤„ç†ã€‚è€Œè¿™äº›å¤„ç†è¿‡ç¨‹å®é™…éƒ½æ˜¯åœ¨ä½¿ç”¨ JDK æ‰€æä¾›çš„åå°„è¿›è¡Œæ“ä½œçš„ï¼Œè€Œåå°„è¿‡ç¨‹ä¸­çš„æ–¹æ³•åç§°ã€å…¥å‚ç±»å‹éƒ½å·²ç»è¢«æˆ‘ä»¬æ‹†è§£å’Œå¤„ç†äº†ï¼Œæœ€ç»ˆä½¿ç”¨çš„æ—¶å€™ç›´æ¥è°ƒç”¨å³å¯ã€‚

## å››ã€å®ç°

### 1. å·¥ç¨‹ç»“æ„

```java
mybatis-step-07
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn.bugstack.mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”œâ”€â”€ builder
    â”‚           â”œâ”€â”€ datasource
    â”‚           â”‚   â”œâ”€â”€ druid
    â”‚           â”‚   â”‚   â””â”€â”€ DruidDataSourceFactory.java
    â”‚           â”‚   â”œâ”€â”€ pooled
    â”‚           â”‚   â”‚   â”œâ”€â”€ PooledConnection.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ PooledDataSource.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ PooledDataSourceFactory.java
    â”‚           â”‚   â”‚   â””â”€â”€ PoolState.java
    â”‚           â”‚   â”œâ”€â”€ unpooled
    â”‚           â”‚   â”‚   â”œâ”€â”€ UnpooledDataSource.java
    â”‚           â”‚   â”‚   â””â”€â”€ UnpooledDataSourceFactory.java
    â”‚           â”‚   â””â”€â”€ DataSourceFactory.java
    â”‚           â”œâ”€â”€ executor
    â”‚           â”œâ”€â”€ io
    â”‚           â”œâ”€â”€ mapping
    â”‚           â”œâ”€â”€ reflection
    â”‚           â”‚   â”œâ”€â”€ factory
    â”‚           â”‚   â”‚   â”œâ”€â”€ DefaultObjectFactory.java
    â”‚           â”‚   â”‚   â””â”€â”€ ObjectFactory.java
    â”‚           â”‚   â”œâ”€â”€ invoker
    â”‚           â”‚   â”‚   â”œâ”€â”€ GetFieldInvoker.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ Invoker.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ MethodInvoker.java
    â”‚           â”‚   â”‚   â””â”€â”€ SetFieldInvoker.java
    â”‚           â”‚   â”œâ”€â”€ property
    â”‚           â”‚   â”‚   â”œâ”€â”€ PropertyNamer.java
    â”‚           â”‚   â”‚   â””â”€â”€ PropertyTokenizer.java
    â”‚           â”‚   â”œâ”€â”€ wrapper
    â”‚           â”‚   â”‚   â”œâ”€â”€ BaseWrapper.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanWrapper.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ CollectionWrapper.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ DefaultObjectWrapperFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ MapWrapper.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ObjectWrapper.java
    â”‚           â”‚   â”‚   â””â”€â”€ ObjectWrapperFactory.java
    â”‚           â”‚   â”œâ”€â”€ MetaClass.java
    â”‚           â”‚   â”œâ”€â”€ MetaObject.java
    â”‚           â”‚   â”œâ”€â”€ Reflector.java
    â”‚           â”‚   â””â”€â”€ SystemMetaObject.java
    â”‚           â”œâ”€â”€ session
    â”‚           â”œâ”€â”€ transaction
    â”‚           â””â”€â”€ type
    â””â”€â”€ test
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ cn.bugstack.mybatis.test.dao
        â”‚       â”œâ”€â”€ dao
        â”‚       â”‚   â””â”€â”€ IUserDao.java
        â”‚       â”œâ”€â”€ po
        â”‚       â”‚   â””â”€â”€ User.java
        â”‚       â”œâ”€â”€ ApiTest.java
        â”‚       â””â”€â”€ ReflectionTest.java
        â””â”€â”€ resources
            â”œâ”€â”€ mapper
            â”‚   â””â”€â”€User_Mapper.xml
            â””â”€â”€ mybatis-config-datasource.xml
```

**å·¥ç¨‹æºç **ï¼š`å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç `

å…ƒå¯¹è±¡åå°„å·¥å…·ç±»ï¼Œå¤„ç†å¯¹è±¡çš„å±æ€§è®¾ç½®å’Œè·å–æ“ä½œæ ¸å¿ƒç±»ï¼Œå¦‚å›¾ 8-3 æ‰€ç¤º

![å›¾ 8-3 æ‰€ç¤º å…ƒå¯¹è±¡åå°„å·¥å…·ç±»ï¼Œå¤„ç†å¯¹è±¡çš„å±æ€§è®¾ç½®å’Œè·å–æ“ä½œæ ¸å¿ƒç±»](https://bugstack.cn/images/article/spring/mybatis-220506-03.png)

- ä»¥ Reflector åå°„å™¨ç±»å¤„ç†å¯¹è±¡ç±»ä¸­çš„ get/set å±æ€§ï¼ŒåŒ…è£…ä¸ºå¯è°ƒç”¨çš„ Invoker åå°„ç±»ï¼Œè¿™æ ·åœ¨å¯¹ get/set æ–¹æ³•åå°„è°ƒç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨æ–¹æ³•åç§°è·å–å¯¹åº”çš„ Invoker å³å¯ `getGetInvoker(String propertyName)`ã€‚
- æœ‰äº†åå°„å™¨çš„å¤„ç†ï¼Œä¹‹åå°±æ˜¯å¯¹åŸå¯¹è±¡çš„åŒ…è£…äº†ï¼Œç”± SystemMetaObject æä¾›åˆ›å»º MetaObject å…ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œå°†æˆ‘ä»¬éœ€è¦å¤„ç†çš„å¯¹è±¡è¿›è¡Œæ‹†è§£å’Œ ObjectWrapper å¯¹è±¡åŒ…è£…å¤„ç†ã€‚å› ä¸ºä¸€ä¸ªå¯¹è±¡çš„ç±»å‹è¿˜éœ€è¦è¿›è¡Œä¸€æ¡ç»†èŠ‚çš„å¤„ç†ï¼Œä»¥åŠå±æ€§ä¿¡æ¯çš„æ‹†è§£ï¼Œä¾‹å¦‚ï¼š`ç­çº§[0].å­¦ç”Ÿ.æˆç»©` è¿™æ ·ä¸€ä¸ªç±»ä¸­çš„å…³è”ç±»çš„å±æ€§ï¼Œåˆ™éœ€è¦è¿›è¡Œé€’å½’çš„æ–¹å¼æ‹†è§£å¤„ç†åï¼Œæ‰èƒ½è®¾ç½®å’Œè·å–å±æ€§å€¼ã€‚
- æœ€ç»ˆåœ¨ Mybatis å…¶ä»–çš„åœ°æ–¹å°±å¯ä»¥ï¼Œæœ‰éœ€è¦å±æ€§å€¼è®¾å®šæ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨åˆ°åå°„å·¥å…·åŒ…è¿›è¡Œå¤„ç†äº†ã€‚è¿™é‡Œé¦–å½“å…¶å†²çš„æˆ‘ä»¬ä¼šæŠŠæ•°æ®æºæ± åŒ–ä¸­å…³äº Properties å±æ€§çš„å¤„ç†ä½¿ç”¨åå°„å·¥å…·ç±»è¿›è¡Œæ”¹é€ ã€‚*å‚è€ƒæœ¬ç« èŠ‚ä¸­å¯¹åº”çš„æºç ç±»*

### 2. åå°„è°ƒç”¨è€…

å…³äºå¯¹è±¡ç±»ä¸­çš„å±æ€§å€¼è·å–å’Œè®¾ç½®å¯ä»¥åˆ†ä¸º Field å­—æ®µçš„ get/set è¿˜æœ‰æ™®é€šçš„ Method çš„è°ƒç”¨ï¼Œä¸ºäº†å‡å°‘ä½¿ç”¨æ–¹çš„è¿‡å¤šçš„å¤„ç†ï¼Œè¿™é‡Œå¯ä»¥æŠŠé›†ä¸­è°ƒç”¨è€…çš„å®ç°åŒ…è£…æˆè°ƒç”¨ç­–ç•¥ï¼Œç»Ÿä¸€æ¥å£ä¸åŒç­–ç•¥ä¸åŒçš„å®ç°ç±»ã€‚

**å®šä¹‰æ¥å£**

```java
public interface Invoker {

    Object invoke(Object target, Object[] args) throws Exception;

    Class<?> getType();

}
```

- æ— è®ºä»»ä½•ç±»å‹çš„åå°„è°ƒç”¨ï¼Œéƒ½ç¦»ä¸å¼€å¯¹è±¡å’Œå…¥å‚ï¼Œåªè¦æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªå­—æ®µå’Œè¿”å›ç»“æœå®šä¹‰çš„é€šç”¨ï¼Œå°±å¯ä»¥åŒ…ä½ä¸åŒç­–ç•¥çš„å®ç°ç±»äº†ã€‚

#### 2.1 MethodInvoker

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.reflection.invoker.MethodInvoker`

```java
public class MethodInvoker implements Invoker {

    private Class<?> type;
    private Method method;

    @Override
    public Object invoke(Object target, Object[] args) throws Exception {
        return method.invoke(target, args);
    }

}
```

- æä¾›æ–¹æ³•åå°„è°ƒç”¨å¤„ç†ï¼Œæ„é€ å‡½æ•°ä¼šä¼ å…¥å¯¹åº”çš„æ–¹æ³•ç±»å‹ã€‚

#### 2.2 GetFieldInvoker

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.reflection.invoker.GetFieldInvoker`

```java
public class GetFieldInvoker implements Invoker {

    private Field field;

    @Override
    public Object invoke(Object target, Object[] args) throws Exception {
        return field.get(target);
    }

}
```

- getter æ–¹æ³•çš„è°ƒç”¨è€…å¤„ç†ï¼Œå› ä¸ºgetæ˜¯æœ‰è¿”å›å€¼çš„ï¼Œæ‰€ä»¥ç›´æ¥å¯¹ Field å­—æ®µæ“ä½œå®Œåç›´æ¥è¿”å›ç»“æœã€‚

#### 2.3 SetFieldInvoker

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.reflection.invoker.SetFieldInvoker`

```java
public class SetFieldInvoker implements Invoker {

    private Field field;

    @Override
    public Object invoke(Object target, Object[] args) throws Exception {
        field.set(target, args[0]);
        return null;
    }

}
```

- setter æ–¹æ³•çš„è°ƒç”¨è€…å¤„ç†ï¼Œå› ä¸ºsetåªæ˜¯è®¾ç½®å€¼ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªè¿”å›ä¸€ä¸ª null å°±å¯ä»¥äº†ã€‚

### 3. åå°„å™¨è§£è€¦å¯¹è±¡

Reflector åå°„å™¨ä¸“é—¨ç”¨äºè§£è€¦å¯¹è±¡ä¿¡æ¯çš„ï¼Œåªæœ‰æŠŠä¸€ä¸ªå¯¹è±¡ä¿¡æ¯æ‰€å«å¸¦çš„å±æ€§ã€æ–¹æ³•ä»¥åŠå…³è”çš„ç±»éƒ½ä»¥æ­¤è§£æå‡ºæ¥ï¼Œæ‰èƒ½æ»¡è¶³åç»­å¯¹å±æ€§å€¼çš„è®¾ç½®å’Œè·å–ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.reflection.Reflector`

```java
public class Reflector {

    private static boolean classCacheEnabled = true;

    private static final String[] EMPTY_STRING_ARRAY = new String[0];
    // çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜
    private static final Map<Class<?>, Reflector> REFLECTOR_MAP = new ConcurrentHashMap<>();

    private Class<?> type;
    // get å±æ€§åˆ—è¡¨
    private String[] readablePropertyNames = EMPTY_STRING_ARRAY;
    // set å±æ€§åˆ—è¡¨
    private String[] writeablePropertyNames = EMPTY_STRING_ARRAY;
    // set æ–¹æ³•åˆ—è¡¨
    private Map<String, Invoker> setMethods = new HashMap<>();
    // get æ–¹æ³•åˆ—è¡¨
    private Map<String, Invoker> getMethods = new HashMap<>();
    // set ç±»å‹åˆ—è¡¨
    private Map<String, Class<?>> setTypes = new HashMap<>();
    // get ç±»å‹åˆ—è¡¨
    private Map<String, Class<?>> getTypes = new HashMap<>();
    // æ„é€ å‡½æ•°
    private Constructor<?> defaultConstructor;

    private Map<String, String> caseInsensitivePropertyMap = new HashMap<>();

    public Reflector(Class<?> clazz) {
        this.type = clazz;
        // åŠ å…¥æ„é€ å‡½æ•°
        addDefaultConstructor(clazz);
        // åŠ å…¥ getter
        addGetMethods(clazz);
        // åŠ å…¥ setter
        addSetMethods(clazz);
        // åŠ å…¥å­—æ®µ
        addFields(clazz);
        readablePropertyNames = getMethods.keySet().toArray(new String[getMethods.keySet().size()]);
        writeablePropertyNames = setMethods.keySet().toArray(new String[setMethods.keySet().size()]);
        for (String propName : readablePropertyNames) {
            caseInsensitivePropertyMap.put(propName.toUpperCase(Locale.ENGLISH), propName);
        }
        for (String propName : writeablePropertyNames) {
            caseInsensitivePropertyMap.put(propName.toUpperCase(Locale.ENGLISH), propName);
        }
    }
    
    // ... çœç•¥å¤„ç†æ–¹æ³•
}
```

- Reflector åå°„å™¨ç±»ä¸­æä¾›äº†å„ç±»å±æ€§ã€æ–¹æ³•ã€ç±»å‹ä»¥åŠæ„é€ å‡½æ•°çš„ä¿å­˜æ“ä½œï¼Œå½“è°ƒç”¨åå°„å™¨æ—¶ä¼šé€šè¿‡æ„é€ å‡½æ•°çš„å¤„ç†ï¼Œé€æ­¥ä»å¯¹è±¡ç±»ä¸­æ‹†è§£å‡ºè¿™äº›å±æ€§ä¿¡æ¯ï¼Œä¾¿äºåç»­åå°„ä½¿ç”¨ã€‚
- è¯»è€…åœ¨å¯¹è¿™éƒ¨åˆ†æºç å­¦ä¹ æ—¶ï¼Œå¯ä»¥å‚è€ƒå¯¹åº”çš„ç±»å’Œè¿™é‡Œçš„å¤„ç†æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯ä¸€äº›å¯¹åå°„çš„æ“ä½œï¼Œè·å–å‡ºåŸºæœ¬çš„ç±»å‹ã€æ–¹æ³•ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œæ•´ç†å­˜æ”¾ã€‚

### 4. å…ƒç±»åŒ…è£…åå°„å™¨

Reflector åå°„å™¨ç±»æä¾›çš„æ˜¯æœ€åŸºç¡€çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¾ˆå¤šæ–¹æ³•ä¹Ÿéƒ½æ˜¯ç§æœ‰çš„ï¼Œä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„ä½¿ç”¨ï¼Œè¿˜éœ€è¦åšä¸€å±‚å…ƒç±»çš„åŒ…è£…ã€‚åœ¨å…ƒç±» MetaClass æä¾›å¿…è¦çš„åˆ›å»ºåå°„å™¨ä»¥åŠä½¿ç”¨åå°„å™¨è·å– get/set çš„ Invoker åå°„æ–¹æ³•ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.reflection.MetaClass`

```java
public class MetaClass {

    private Reflector reflector;

    private MetaClass(Class<?> type) {
        this.reflector = Reflector.forClass(type);
    }

    public static MetaClass forClass(Class<?> type) {
        return new MetaClass(type);
    }

    public String[] getGetterNames() {
        return reflector.getGetablePropertyNames();
    }

    public String[] getSetterNames() {
        return reflector.getSetablePropertyNames();
    }

    public Invoker getGetInvoker(String name) {
        return reflector.getGetInvoker(name);
    }

    public Invoker getSetInvoker(String name) {
        return reflector.getSetInvoker(name);
    }

		// ... æ–¹æ³•åŒ…è£…
}
```

- MetaClass å…ƒç±»ç›¸å½“äºæ˜¯å¯¹æˆ‘ä»¬éœ€è¦å¤„ç†å¯¹è±¡çš„åŒ…è£…ï¼Œè§£è€¦ä¸€ä¸ªåŸå¯¹è±¡ï¼ŒåŒ…è£…å‡ºä¸€ä¸ªå…ƒç±»ã€‚è€Œè¿™äº›å…ƒç±»ã€å¯¹è±¡åŒ…è£…å™¨ä»¥åŠå¯¹è±¡å·¥å‚ç­‰ï¼Œå†ç»„åˆå‡ºä¸€ä¸ªå…ƒå¯¹è±¡ã€‚ç›¸å½“äºè¯´è¿™äº›å…ƒç±»å’Œå…ƒå¯¹è±¡éƒ½æ˜¯å¯¹æˆ‘ä»¬éœ€è¦æ“ä½œçš„åŸå¯¹è±¡è§£è€¦åçš„å°è£…ã€‚æœ‰äº†è¿™æ ·çš„æ“ä½œï¼Œå°±å¯ä»¥è®©æˆ‘ä»¬å¤„ç†æ¯ä¸€ä¸ªå±æ€§æˆ–è€…æ–¹æ³•äº†ã€‚

### 5. å¯¹è±¡åŒ…è£…å™¨Wrapper

å¯¹è±¡åŒ…è£…å™¨ç›¸å½“äºæ˜¯æ›´åŠ è¿›ä¸€æ­¥åå°„è°ƒç”¨åŒ…è£…å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿä¸ºä¸åŒçš„å¯¹è±¡ç±»å‹æä¾›ä¸åŒçš„åŒ…è£…ç­–ç•¥ã€‚*æ¡†æ¶æºç éƒ½å–œæ¬¢ä½¿ç”¨è®¾è®¡æ¨¡å¼ï¼Œä»æ¥ä¸æ˜¯ä¸€è¡Œè¡Œifelseçš„ä»£ç * 

åœ¨å¯¹è±¡åŒ…è£…å™¨æ¥å£ä¸­å®šä¹‰äº†æ›´åŠ æ˜ç¡®çš„éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å®šä¹‰å‡ºäº† get/set æ ‡å‡†çš„é€šç”¨æ–¹æ³•ã€è·å–get\setå±æ€§åç§°å’Œå±æ€§ç±»å‹ï¼Œä»¥åŠæ·»åŠ å±æ€§ç­‰æ“ä½œã€‚

**å¯¹è±¡åŒ…è£…å™¨æ¥å£**

```java
public interface ObjectWrapper {

    // get
    Object get(PropertyTokenizer prop);

    // set
    void set(PropertyTokenizer prop, Object value);

    // æŸ¥æ‰¾å±æ€§
    String findProperty(String name, boolean useCamelCaseMapping);

    // å–å¾—getterçš„åå­—åˆ—è¡¨
    String[] getGetterNames();

    // å–å¾—setterçš„åå­—åˆ—è¡¨
    String[] getSetterNames();

    //å–å¾—setterçš„ç±»å‹
    Class<?> getSetterType(String name);

    // å–å¾—getterçš„ç±»å‹
    Class<?> getGetterType(String name);

    // ... çœç•¥

}
```

- åç»­æ‰€æœ‰å®ç°äº†å¯¹è±¡åŒ…è£…å™¨æ¥å£çš„å®ç°ç±»ï¼Œéƒ½éœ€è¦æä¾›è¿™äº›æ–¹æ³•å®ç°ï¼ŒåŸºæœ¬æœ‰äº†è¿™äº›æ–¹æ³•ï¼Œä¹Ÿå°±èƒ½éå¸¸å®¹æ˜“çš„å¤„ç†ä¸€ä¸ªå¯¹è±¡çš„åå°„æ“ä½œäº†ã€‚
- æ— è®ºä½ æ˜¯è®¾ç½®å±æ€§ã€è·å–å±æ€§ã€æ‹¿åˆ°å¯¹åº”çš„å­—æ®µåˆ—è¡¨è¿˜æ˜¯ç±»å‹éƒ½æ˜¯å¯ä»¥æ»¡è¶³çš„ã€‚

### 6. å…ƒå¯¹è±¡å°è£…

åœ¨æœ‰äº†åå°„å™¨ã€å…ƒç±»ã€å¯¹è±¡åŒ…è£…å™¨ä»¥åï¼Œåœ¨ä½¿ç”¨å¯¹è±¡å·¥å‚å’ŒåŒ…è£…å·¥å‚ï¼Œå°±å¯ä»¥ç»„åˆå‡ºä¸€ä¸ªå®Œæ•´çš„å…ƒå¯¹è±¡æ“ä½œç±»äº†ã€‚å› ä¸ºæ‰€æœ‰çš„ä¸åŒæ–¹å¼çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬ï¼šåŒ…è£…å™¨ç­–ç•¥ã€åŒ…è£…å·¥ç¨‹ã€ç»Ÿä¸€çš„æ–¹æ³•å¤„ç†ï¼Œè¿™äº›éƒ½éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„å¤„ç†æ–¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å…ƒå¯¹è±¡è¿›è¡Œç®¡ç†ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.reflection.MetaObject`

```java
public class MetaObject {
    // åŸå¯¹è±¡
    private Object originalObject;
    // å¯¹è±¡åŒ…è£…å™¨
    private ObjectWrapper objectWrapper;
    // å¯¹è±¡å·¥å‚
    private ObjectFactory objectFactory;
    // å¯¹è±¡åŒ…è£…å·¥å‚
    private ObjectWrapperFactory objectWrapperFactory;

    private MetaObject(Object object, ObjectFactory objectFactory, ObjectWrapperFactory objectWrapperFactory) {
        this.originalObject = object;
        this.objectFactory = objectFactory;
        this.objectWrapperFactory = objectWrapperFactory;

        if (object instanceof ObjectWrapper) {
            // å¦‚æœå¯¹è±¡æœ¬èº«å·²ç»æ˜¯ObjectWrapperå‹ï¼Œåˆ™ç›´æ¥èµ‹ç»™objectWrapper
            this.objectWrapper = (ObjectWrapper) object;
        } else if (objectWrapperFactory.hasWrapperFor(object)) {
            // å¦‚æœæœ‰åŒ…è£…å™¨,è°ƒç”¨ObjectWrapperFactory.getWrapperFor
            this.objectWrapper = objectWrapperFactory.getWrapperFor(this, object);
        } else if (object instanceof Map) {
            // å¦‚æœæ˜¯Mapå‹ï¼Œè¿”å›MapWrapper
            this.objectWrapper = new MapWrapper(this, (Map) object);
        } else if (object instanceof Collection) {
            // å¦‚æœæ˜¯Collectionå‹ï¼Œè¿”å›CollectionWrapper
            this.objectWrapper = new CollectionWrapper(this, (Collection) object);
        } else {
            // é™¤æ­¤ä»¥å¤–ï¼Œè¿”å›BeanWrapper
            this.objectWrapper = new BeanWrapper(this, object);
        }
    }

    public static MetaObject forObject(Object object, ObjectFactory objectFactory, ObjectWrapperFactory objectWrapperFactory) {
        if (object == null) {
            // å¤„ç†ä¸€ä¸‹null,å°†nullåŒ…è£…èµ·æ¥
            return SystemMetaObject.NULL_META_OBJECT;
        } else {
            return new MetaObject(object, objectFactory, objectWrapperFactory);
        }
    }
    
    // å–å¾—å€¼
    // å¦‚ ç­çº§[0].å­¦ç”Ÿ.æˆç»©
    public Object getValue(String name) {
        PropertyTokenizer prop = new PropertyTokenizer(name);
        if (prop.hasNext()) {
            MetaObject metaValue = metaObjectForProperty(prop.getIndexedName());
            if (metaValue == SystemMetaObject.NULL_META_OBJECT) {
                // å¦‚æœä¸Šå±‚å°±æ˜¯nulläº†ï¼Œé‚£å°±ç»“æŸï¼Œè¿”å›null
                return null;
            } else {
                // å¦åˆ™ç»§ç»­çœ‹ä¸‹ä¸€å±‚ï¼Œé€’å½’è°ƒç”¨getValue
                return metaValue.getValue(prop.getChildren());
            }
        } else {
            return objectWrapper.get(prop);
        }
    }

    // è®¾ç½®å€¼
    // å¦‚ ç­çº§[0].å­¦ç”Ÿ.æˆç»©
    public void setValue(String name, Object value) {
        PropertyTokenizer prop = new PropertyTokenizer(name);
        if (prop.hasNext()) {
            MetaObject metaValue = metaObjectForProperty(prop.getIndexedName());
            if (metaValue == SystemMetaObject.NULL_META_OBJECT) {
                if (value == null && prop.getChildren() != null) {
                    // don't instantiate child path if value is null
                    // å¦‚æœä¸Šå±‚å°±æ˜¯ null äº†ï¼Œè¿˜å¾—çœ‹æœ‰æ²¡æœ‰å„¿å­ï¼Œæ²¡æœ‰é‚£å°±ç»“æŸ
                    return;
                } else {
                    // å¦åˆ™è¿˜å¾— new ä¸€ä¸ªï¼Œå§”æ´¾ç»™ ObjectWrapper.instantiatePropertyValue
                    metaValue = objectWrapper.instantiatePropertyValue(name, prop, objectFactory);
                }
            }
            // é€’å½’è°ƒç”¨setValue
            metaValue.setValue(prop.getChildren(), value);
        } else {
            // åˆ°äº†æœ€åä¸€å±‚äº†ï¼Œæ‰€ä»¥å§”æ´¾ç»™ ObjectWrapper.set
            objectWrapper.set(prop, value);
        }
    }
    
    // ... çœç•¥
}    
```

- MetaObject å…ƒå¯¹è±¡ç®—æ˜¯æ•´ä¸ªæœåŠ¡çš„åŒ…è£…ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æä¾›å„ç±»å¯¹è±¡çš„åŒ…è£…å™¨ç±»å‹çš„åˆ›å»ºã€‚ä¹‹åæä¾›äº†ä¸€äº›åŸºæœ¬çš„æ“ä½œå°è£…ï¼Œè¿™å›å°è£…åå°±æ›´è´´è¿‘å®é™…çš„ä½¿ç”¨äº†ã€‚
- åŒ…æ‹¬è¿™é‡Œæä¾›çš„ getValue(String name) ã€setValue(String name, Object value) ç­‰ï¼Œå…¶ä¸­å½“ä¸€äº›å¯¹è±¡çš„ä¸­çš„å±æ€§ä¿¡æ¯ä¸æ˜¯ä¸€ä¸ªå±‚æ¬¡ï¼Œæ˜¯ `ç­çº§[0].å­¦ç”Ÿ.æˆç»©` è¿˜éœ€è¦è¢«æ‹†è§£åæ‰èƒ½è·å–åˆ°å¯¹åº”çš„å¯¹è±¡å’Œå±æ€§å€¼ã€‚
- å½“æ‰€æœ‰çš„è¿™äº›å†…å®¹æä¾›å®Œæˆä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨ `SystemMetaObject#forObject` æä¾›å…ƒå¯¹è±¡çš„è·å–äº†ã€‚

### 7. æ•°æ®æºå±æ€§è®¾ç½®

å¥½äº†ï¼Œç°åœ¨æœ‰äº†æˆ‘ä»¬å®ç°çš„å±æ€§åå°„æ“ä½œå·¥å…·åŒ…ï¼Œé‚£ä¹ˆå¯¹äºæ•°æ®æºä¸­å±æ€§ä¿¡æ¯çš„è®¾ç½®ï¼Œå°±å¯ä»¥æ›´åŠ ä¼˜é›…çš„æ“ä½œäº†ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.datasource.unpooled.UnpooledDataSourceFactory`

```java
public class UnpooledDataSourceFactory implements DataSourceFactory {

    protected DataSource dataSource;

    public UnpooledDataSourceFactory() {
        this.dataSource = new UnpooledDataSource();
    }

    @Override
    public void setProperties(Properties props) {
        MetaObject metaObject = SystemMetaObject.forObject(dataSource);
        for (Object key : props.keySet()) {
            String propertyName = (String) key;
            if (metaObject.hasSetter(propertyName)) {
                String value = (String) props.get(propertyName);
                Object convertedValue = convertValue(metaObject, propertyName, value);
                metaObject.setValue(propertyName, convertedValue);
            }
        }
    }

    @Override
    public DataSource getDataSource() {
        return dataSource;
    }
    
}
```

- åœ¨ä¹‹å‰æˆ‘ä»¬å¯¹äºæ•°æ®æºä¸­å±æ€§ä¿¡æ¯çš„è·å–éƒ½æ˜¯é‡‡ç”¨çš„ç¡¬ç¼–ç ï¼Œé‚£ä¹ˆè¿™å›åœ¨ setProperties æ–¹æ³•ä¸­åˆ™å¯ä»¥ä½¿ç”¨ SystemMetaObject.forObject(dataSource) è·å– DataSource çš„å…ƒå¯¹è±¡äº†ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åå°„å°±èƒ½æŠŠæˆ‘ä»¬éœ€è¦çš„å±æ€§å€¼è®¾ç½®è¿›å»ã€‚
- è¿™æ ·åœ¨æ•°æ®æº UnpooledDataSourceã€PooledDataSource ä¸­å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„å±æ€§å€¼ä¿¡æ¯äº†ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬é‚£ç§åœ¨2ä¸ªæ•°æ®æºçš„å®ç°ä¸­ç¡¬ç¼–ç æ“ä½œã€‚

## äº”ã€æµ‹è¯•

æœ¬ç« èŠ‚çš„æµ‹è¯•ä¼šåˆ†ä¸º2éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬è¿™ä¸ªç« èŠ‚å®ç°çš„åå°„å™¨å·¥å…·ç±»çš„æµ‹è¯•ï¼Œå¦å¤–ä¸€æ–¹é¢æ˜¯æˆ‘ä»¬æŠŠåå°„å™¨å·¥å…·ç±»æ¥å…¥åˆ°æ•°æ®æºçš„ä½¿ç”¨ä¸­ï¼ŒéªŒè¯ä½¿ç”¨æ˜¯å¦é¡ºåˆ©ã€‚

### 1. äº‹å…ˆå‡†å¤‡

#### 1.1 åˆ›å»ºåº“è¡¨

åˆ›å»ºä¸€ä¸ªæ•°æ®åº“åç§°ä¸º mybatis å¹¶åœ¨åº“ä¸­åˆ›å»ºè¡¨ user ä»¥åŠæ·»åŠ æµ‹è¯•æ•°æ®ï¼Œå¦‚ä¸‹ï¼š

```sql
CREATE TABLE
    USER
    (
        id bigint NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ID',
        userId VARCHAR(9) COMMENT 'ç”¨æˆ·ID',
        userHead VARCHAR(16) COMMENT 'ç”¨æˆ·å¤´åƒ',
        createTime TIMESTAMP NULL COMMENT 'åˆ›å»ºæ—¶é—´',
        updateTime TIMESTAMP NULL COMMENT 'æ›´æ–°æ—¶é—´',
        userName VARCHAR(64),
        PRIMARY KEY (id)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;
    
insert into user (id, userId, userHead, createTime, updateTime, userName) values (1, '10001', '1_04', '2022-04-13 00:00:00', '2022-04-13 00:00:00', 'å°å‚…å“¥');    
```

#### 1.2 é…ç½®æ•°æ®æº

```xml
<environments default="development">
    <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
            <property name="driver" value="com.mysql.jdbc.Driver"/>
            <property name="url" value="jdbc:mysql://127.0.0.1:3306/mybatis?useUnicode=true"/>
            <property name="username" value="root"/>
            <property name="password" value="123456"/>
        </dataSource>
    </environment>
</environments>
```

- é€šè¿‡ `mybatis-config-datasource.xml` é…ç½®æ•°æ®æºä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šdriverã€urlã€usernameã€password
- åœ¨è¿™é‡Œ dataSource æµ‹è¯•éªŒè¯ UNPOOLED å’Œ POOLEDï¼Œå› ä¸ºè¿™2ä¸ªéƒ½å±äºè¢«åå°„å·¥å…·ç±»å¤„ç†

#### 1.3 é…ç½®Mapper

```xml
<select id="queryUserInfoById" parameterType="java.lang.Long" resultType="cn.bugstack.mybatis.test.po.User">
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id}
</select>
```

- è¿™éƒ¨åˆ†æš‚æ—¶ä¸éœ€è¦è°ƒæ•´ï¼Œç›®å‰è¿˜åªæ˜¯ä¸€ä¸ªå…¥å‚çš„ç±»å‹çš„å‚æ•°ï¼Œåç»­æˆ‘ä»¬å…¨éƒ¨å®Œå–„è¿™éƒ¨åˆ†å†…å®¹ä»¥åï¼Œåˆ™å†æä¾›æ›´å¤šçš„å…¶ä»–å‚æ•°è¿›è¡ŒéªŒè¯ã€‚

### 2. å•å…ƒæµ‹è¯•

#### 2.1 åå°„ç±»æµ‹è¯•

```java
@Test
public void test_reflection() {
    Teacher teacher = new Teacher();
    List<Teacher.Student> list = new ArrayList<>();
    list.add(new Teacher.Student());
    teacher.setName("å°å‚…å“¥");
    teacher.setStudents(list);

    MetaObject metaObject = SystemMetaObject.forObject(teacher);

    logger.info("getGetterNamesï¼š{}", JSON.toJSONString(metaObject.getGetterNames()));
    logger.info("getSetterNamesï¼š{}", JSON.toJSONString(metaObject.getSetterNames()));
    logger.info("nameçš„getæ–¹æ³•è¿”å›å€¼ï¼š{}", JSON.toJSONString(metaObject.getGetterType("name")));
    logger.info("studentsçš„setæ–¹æ³•å‚æ•°å€¼ï¼š{}", JSON.toJSONString(metaObject.getGetterType("students")));
    logger.info("nameçš„hasGetterï¼š{}", metaObject.hasGetter("name"));
    logger.info("student.idï¼ˆå±æ€§ä¸ºå¯¹è±¡ï¼‰çš„hasGetterï¼š{}", metaObject.hasGetter("student.id"));
    logger.info("è·å–nameçš„å±æ€§å€¼ï¼š{}", metaObject.getValue("name"));
    // é‡æ–°è®¾ç½®å±æ€§å€¼
    metaObject.setValue("name", "å°ç™½");
    logger.info("è®¾ç½®nameçš„å±æ€§å€¼ï¼š{}", metaObject.getValue("name"));
    // è®¾ç½®å±æ€§ï¼ˆé›†åˆï¼‰çš„å…ƒç´ å€¼
    metaObject.setValue("students[0].id", "001");
    logger.info("è·å–studentsé›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å±æ€§å€¼ï¼š{}", JSON.toJSONString(metaObject.getValue("students[0].id")));
    logger.info("å¯¹è±¡çš„åºåˆ—åŒ–ï¼š{}", JSON.toJSONString(teacher));
}
```

- è¿™æ˜¯ä¸€ç»„æ¯”è¾ƒå¸¸è§çš„ç”¨äºæµ‹è¯• Mybatis æºç ä¸­ MetaObject çš„æµ‹è¯•ç±»ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå•å…ƒæµ‹è¯•ç”¨åˆ°æˆ‘ä»¬è‡ªå·±å®ç°çš„åå°„å·¥å…·ç±»ä¸Šï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

**æµ‹è¯•ç»“æœ**

```java
07:44:23.601 [main] INFO  c.b.mybatis.test.ReflectionTest - getGetterNamesï¼š["student","price","name","students"]
07:44:23.608 [main] INFO  c.b.mybatis.test.ReflectionTest - getSetterNamesï¼š["student","price","name","students"]
07:44:23.609 [main] INFO  c.b.mybatis.test.ReflectionTest - nameçš„getæ–¹æ³•è¿”å›å€¼ï¼š"java.lang.String"
07:44:23.609 [main] INFO  c.b.mybatis.test.ReflectionTest - studentsçš„setæ–¹æ³•å‚æ•°å€¼ï¼š"java.util.List"
07:44:23.609 [main] INFO  c.b.mybatis.test.ReflectionTest - nameçš„hasGetterï¼štrue
07:44:23.609 [main] INFO  c.b.mybatis.test.ReflectionTest - student.idï¼ˆå±æ€§ä¸ºå¯¹è±¡ï¼‰çš„hasGetterï¼štrue
07:44:23.610 [main] INFO  c.b.mybatis.test.ReflectionTest - è·å–nameçš„å±æ€§å€¼ï¼šå°å‚…å“¥
07:44:23.610 [main] INFO  c.b.mybatis.test.ReflectionTest - è®¾ç½®nameçš„å±æ€§å€¼ï¼šå°ç™½
07:44:23.610 [main] INFO  c.b.mybatis.test.ReflectionTest - è·å–studentsé›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å±æ€§å€¼ï¼š"001"
07:44:23.665 [main] INFO  c.b.mybatis.test.ReflectionTest - å¯¹è±¡çš„åºåˆ—åŒ–ï¼š{"name":"å°ç™½","price":0.0,"students":[{"id":"001"}]}

Process finished with exit code 0
```

- å¥½äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæµ‹è¯•ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æ‹¿åˆ°äº†å¯¹åº”çš„å±æ€§ä¿¡æ¯ï¼Œå¹¶å¯ä»¥è®¾ç½®ä»¥åŠä¿®æ”¹å±æ€§å€¼ï¼Œæ— è®ºæ˜¯å•ä¸ªå±æ€§è¿˜æ˜¯å¯¹è±¡å±æ€§ï¼Œéƒ½å¯ä»¥æ“ä½œã€‚

#### 2.2 æ•°æ®æºæµ‹è¯•

```java
@Test
public void test_SqlSessionFactory() throws IOException {
    // 1. ä»SqlSessionFactoryä¸­è·å–SqlSession
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(Resources.getResourceAsReader("mybatis-config-datasource.xml"));
    SqlSession sqlSession = sqlSessionFactory.openSession();

    // 2. è·å–æ˜ å°„å™¨å¯¹è±¡
    IUserDao userDao = sqlSession.getMapper(IUserDao.class);

    // 3. æµ‹è¯•éªŒè¯
    User user = userDao.queryUserInfoById(1L);
    logger.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(user));
}
```

- è¿™å—çš„è°ƒç”¨æˆ‘ä»¬æ‰‹å†™æ¡†æ¶çš„æµ‹è¯•ç±»åˆ°ä¸éœ€è¦ä»€ä¹ˆæ”¹å˜ï¼Œåªè¦æ•°æ®æºé…ç½®ä¸Šä½¿ç”¨ `type="POOLED/UNPOOLED"` å³å¯ï¼Œè¿™æ ·å°±èƒ½æµ‹è¯•æˆ‘ä»¬è‡ªå·±å¼€å‘çš„ä½¿ç”¨äº†åå°„å™¨è®¾ç½®å±æ€§çš„æ•°æ®æºç±»äº†ã€‚

**æµ‹è¯•ç»“æœ**

![å›¾ 8-4 ä½¿ç”¨MetaObject è®¾ç½®å±æ€§å€¼](https://bugstack.cn/images/article/spring/mybatis-220506-04.png)

```java
07:51:54.898 [main] INFO  c.b.m.d.pooled.PooledDataSource - Created connection 212683148.
07:51:55.006 [main] INFO  cn.bugstack.mybatis.test.ApiTest - æµ‹è¯•ç»“æœï¼š{"id":1,"userHead":"1_04","userId":"10001","userName":"å°å‚…å“¥"}
```

- æ ¹æ®å•å…ƒæµ‹è¯•å’Œè°ƒè¯•çš„æˆªå›¾ï¼Œå¯ä»¥çœ‹åˆ°å±æ€§å€¼é€šè¿‡åå°„çš„æ–¹å¼è®¾ç½®åˆ°å¯¹è±¡ä¸­ï¼Œä¹Ÿæ»¡è¶³äº†æˆ‘ä»¬åœ¨åˆ›å»ºæ•°æ®æºæ—¶å€™çš„ä½¿ç”¨ã€‚è¿™æ ·å°±å¯ä»¥é¡ºåˆ©çš„è°ƒç”¨æ•°æ®æºå®Œæˆæ•°æ®çš„æŸ¥è¯¢æ“ä½œäº†ã€‚

## ä¸ƒã€æ€»ç»“

- æœ¬ç« èŠ‚å…³äºåå°„å·¥å…·ç±»çš„å®ç°ä¸­ï¼Œä½¿ç”¨äº†å¤§é‡çš„ JDK æ‰€æä¾›çš„å…³äºåå°„ä¸€äº›å¤„ç†æ“ä½œï¼Œä¹ŸåŒ…æ‹¬å¯ä»¥è·å–ä¸€ä¸ª Class ç±»ä¸­çš„å±æ€§ã€å­—æ®µã€æ–¹æ³•çš„ä¿¡æ¯ã€‚é‚£ä¹ˆå†æœ‰äº†è¿™äº›ä¿¡æ¯ä»¥åå°±å¯ä»¥æŒ‰ç…§åŠŸèƒ½æµç¨‹è¿›è¡Œè§£è€¦ï¼ŒæŠŠå±æ€§ã€åå°„ã€åŒ…è£…ï¼Œéƒ½ä¾æ¬¡æ‹†åˆ†å‡ºæ¥ï¼Œå¹¶æŒ‰ç…§è®¾è®¡åŸåˆ™ï¼Œé€æ­¥åŒ…è£…è®©å¤–æ¥æ›´å°‘çš„çŸ¥é“å†…éƒ¨çš„å¤„ç†ã€‚
- è¿™é‡Œçš„åå°„ä¹Ÿç®—æ˜¯å°å¤©èŠ±æ¿çš„ä½¿ç”¨çº§åˆ«äº†ï¼Œå°è£…çš„å·¥å…·ç±»æ–¹å¼ï¼Œå¦‚æœåœ¨æˆ‘ä»¬ä¹Ÿæœ‰ç±»ä¼¼çš„åœºæ™¯ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚å› ä¸ºæ•´ä¸ªå·¥å…·ç±»å¹¶æ²¡æœ‰å¤ªå¤šçš„é¢å¤–å…³è”ï¼Œç›´æ¥æ‹¿æ¥å°è£…æˆä¸€ä¸ªå·¥å…·åŒ…è¿›è¡Œä½¿ç”¨ï¼Œå¤„ç†å¹³å¸¸çš„ä¸šåŠ¡é€»è¾‘ä¸­ç»„ä»¶åŒ–çš„éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯éå¸¸ä¸é”™çš„ã€‚*æŠ€æœ¯è¿ç§»ã€å­¦ä»¥è‡´ç”¨ã€å‡èŒåŠ è–ª*
- ç”±äºæ•´ä¸ªå·¥å…·åŒ…ä¸­æ¶‰åŠçš„ç±»è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¤§å®¶åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­å°½å¯èƒ½çš„éªŒè¯å’Œè°ƒè¯•ï¼Œä»¥åŠå¯¹æŸä¸ªä¸æ¸…æ¥šçš„æ–¹æ³•è¿›è¡Œå•ç‹¬å¼€å‘å’Œæµ‹è¯•ï¼Œè¿™æ ·æ‰èƒ½æ»¤æ¸…æ•´ä¸ªç»“æ„æ˜¯å¦‚ä½•å®ç°çš„ã€‚*å½“ä½ æŠŠè¿™å—çš„å†…å®¹å…¨éƒ¨æ‹¿ä¸‹ï¼Œä»¥åå†é‡åˆ°åå°„å°±æ˜¯å°æ„æ€äº†*

## å…«ã€ä¼˜ç§€ä½œä¸š

- [å®Œæˆmybatisè‡ªå·±å®ç°çš„MetaObjectåå°„å·¥å…·ç±»ã€‚è¿™å—åŒ…æ‹¬ï¼šå…ƒå¯¹è±¡ã€å¯¹è±¡åŒ…è£…å™¨ã€å¯¹è±¡å·¥å‚ã€å¯¹è±¡åŒ…è£…å·¥å‚ä»¥åŠReflectoråå°„å™¨ã€‚ @æ¨æ¨å¾—äº¿ğŸ™‰](https://t.zsxq.com/0666qVFqj)
- [äº†è§£äº†SecurityManagerçš„ä½¿ç”¨å’Œåå°„è·å–æ³›å‹çš„æ–¹å¼ @ç‹—å“¥](https://t.zsxq.com/07jLbAB1V)
- [æœ¬ç« å°±æ˜¯è¦è‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸‹åå°„å·¥å…·åŒ…ï¼Œå¹¶ç”¨å®ƒæ¥æ”¹é€ åŸæ•°æ®æºå·¥å‚çš„éƒ¨åˆ†ä»£ç  @å°çŒªç¢ç¢å¿µ](https://t.zsxq.com/0bfxapOQB)
- [ä¸ºäº†æ”¹é€ è¿™æ ·çš„ç¡¬ç¼–ç æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŸºäºJDKåå°„åŠŸèƒ½å°è£…ä¸€ä¸ªå·¥å…·åŒ… @liuc](https://t.zsxq.com/08Zdjyfd8)
- [å°†åˆ›å»ºDataSourceæ—¶çš„ç¡¬ç¼–ç éƒ¨åˆ†ä¿®æ”¹ä¸ºä½¿ç”¨åå°„å·¥å…·ç±»è¿›è¡Œèµ‹å€¼ï¼Œç†Ÿæ‚‰åå°„å·¥å…·ç±»çš„ä½¿ç”¨ä»¥åŠæ„å»ºæµç¨‹ã€‚@é«˜é«˜çš„é£èµ·æ¥](https://t.zsxq.com/10tbST0Gg)
- [è¿™ä¸€ç« å†…å®¹è¶…çº§çš„å¤šï¼Œå†ä¹Ÿä¸æ•¢è¯´è‡ªå·±ä¼šåå°„äº†ï¼Œå­¦æ— æ­¢å¢ƒæ‚ğŸ˜‚ã€æ¢³ç†çš„å¾ˆç»†è…»ã€‘@ADé’™å¥¶](https://t.zsxq.com/10LV8eY5X)