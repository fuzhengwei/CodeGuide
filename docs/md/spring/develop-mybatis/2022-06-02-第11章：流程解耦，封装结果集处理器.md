---
title: ç¬¬11ç« ï¼šæµç¨‹è§£è€¦ï¼Œå°è£…ç»“æœé›†å¤„ç†å™¨
lock: need
---

# ã€ŠMybatis æ‰‹æ’¸ä¸“æ ã€‹ç¬¬11ç« ï¼šæµç¨‹è§£è€¦ï¼Œå°è£…ç»“æœé›†å¤„ç†å™¨

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/0v2ugaiGEwZcFiG04k3-hg](https://mp.weixin.qq.com/s/0v2ugaiGEwZcFiG04k3-hg)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

<iframe id="B-Video" src="//player.bilibili.com/player.html?aid=344887184&bvid=BV1bd4y1A7Fi&cid=816693277&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="480"> </iframe>

## ä¸€ã€å‰è¨€

`ç å†œï¼Œå¦‚ä½•ä¸ºè‡ªå·±çš„èŒä¸šç”Ÿæ¶¯ç»­æœŸï¼Ÿ`

ä¸Šç­å°±åƒæ‰“æ€ªå‡çº§ï¼Œæ‹¿ç€ä¸€æŠŠè¥¿ç“œåˆ€ï¼Œä»å—å¤©é—¨ç åˆ°åŒ—å¤©é—¨ã€‚ä½†æ—¶é—´é•¿äº†ï¼Œæ€ªè¶Šæ¥è¶Šå‡¶äº†ï¼Œè¥¿ç“œåˆ€ä¹Ÿä¸å¾—æ‰‹äº†ã€‚å’‹åŠï¼Œåœ¨æ¸¸æˆé‡Œå¤§å®¶è‚¯å®šæ˜¯æƒ³åŠæ³•æ¢è£…å¤‡äº†ã€ä¹°æ­¦å™¨äº†ã€å­¦æŠ€èƒ½äº†ï¼Œè¿™æ ·æ‰èƒ½æœ‰æœºä¼šæ‰“é€šæ›´å¤šçš„å…³å¡ã€‚

å…¶å®æˆ‘ä»¬ä½œä¸ºç¨‹åºå‘˜ä¸Šç­ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸€ç›´éƒ½ä»¥ä¸ºè¿™ç‚¹æŠ€æœ¯å¤Ÿå†™å†™CRUDå°±å¤Ÿäº†ï¼Œåæ­£ç°åœ¨è¿˜èƒ½åº”ä»˜çš„äº†ã€‚ä½†3å¹´åå‘¢ã€5å¹´åå‘¢ï¼Œæ€»æœ‰ä¸€å¤©ä½ çš„æŠ€æœ¯æ ¹æœ¬æ²¡æ³•æ»¡è¶³å…¬å¸å¯¹ä½ ç°é˜¶æ®µçš„è¦æ±‚ï¼Œæœ€ç®€å•çš„CRUDä¹Ÿæ—©å·²äº¤ç»™äº†æ›¾ç»å¹´è½»çš„å¦å¤–çš„ä½ ã€‚

æœ‰äººè¯´ï¼šâ€œç¨‹åºå‘˜ä¸æ˜¯æŠ€æœ¯ç‰›å°±èƒ½ä¸€ç›´è¡Œï¼â€ ä½†å…¶å®æŠ€æœ¯ç‰›å°±æ˜¯è¡Œï¼Œå½“ä½ ç‰›åˆ°ä¸€å®šçš„é˜¶æ®µï¼Œè§£å†³åˆ«äººè§£å†³ä¸äº†çš„é—®é¢˜ï¼Œå¤„ç†åˆ«äººå¤„ç†çš„ä¸äº†çš„æ–¹æ¡ˆï¼Œèå­ç²‘ç²‘ç‹¬ä¸€ä»½ï¼Œè°åˆèƒ½æ‹¦å¾—ä½ä½ å‘¢ã€‚åœ¨å“ªé‡Œå·¥ä½œéƒ½æ˜¯ä½ è‡ªå·±æ¥å®šçš„ï¼Œä½ åªç®¡æŠ€æœ¯ç‰›ï¼Œå°±èƒ½æ¨ªç€èµ°ã€‚

## äºŒã€ç›®æ ‡

å»¶ç»­ç€ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬å¯¹å‚æ•°çš„å°è£…å’Œè°ƒç”¨ï¼Œä½¿ç”¨äº†ç­–ç•¥æ¨¡å¼è¿›è¡Œè§£è€¦å¤„ç†ï¼Œæœ¬ç« èŠ‚å°†å¯¹æ‰§è¡Œå®ŒæŸ¥è¯¢çš„ç»“æœè¿›è¡Œå°è£…å¤„ç†ã€‚è€Œä¸æ˜¯åƒæˆ‘ä»¬å‰é¢ç« èŠ‚é‚£æ ·ç²—é²çš„åˆ¤æ–­å°è£…ï¼Œå› ä¸ºè¿™æ ·çš„æ–¹å¼æ—¢ä¸èƒ½æ»¡è¶³ä¸åŒç±»å‹çš„ä¼˜é›…æ‰©å±•ï¼Œä¹Ÿä¸ä»¥ä¸ºç»´æŠ¤è¿­ä»£ã€‚å¦‚å›¾ 11-1 æ‰€ç¤º

![å›¾ 11-1 ç®€å•çš„ç»“æœé›†å¤„ç†](https://bugstack.cn/images/article/spring/mybatis-220602-01.png)

- å¯¹äºç»“æœé›†çš„å°è£…å¤„ç†ï¼Œå…¶å®æ ¸å¿ƒåœ¨äºæˆ‘ä»¬æ‹¿åˆ°äº† Mapper XML ä¸­æ‰€é…ç½®çš„è¿”å›ç±»å‹ï¼Œè§£æåæŠŠä»æ•°æ®åº“æŸ¥è¯¢åˆ°çš„ç»“æœï¼Œåå°„åˆ°ç±»å‹å®ä¾‹åŒ–çš„å¯¹è±¡ä¸Šã€‚
- é‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸åŒè¿”å›ç±»å‹çš„å¤„ç†ï¼Œæ¯”å¦‚Longã€Doubleã€Stringã€Dateç­‰ï¼Œéƒ½è¦ä¸€ä¸€ä¸æ•°æ®åº“çš„ç±»å‹åŒ¹é…ï¼Œä¸æ­¤åŒæ—¶ï¼Œè¿”å›çš„ç»“æœå¯èƒ½æ˜¯ä¸€ä¸ªæ™®é€šçš„åŸºæœ¬ç±»å‹ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘ä»¬å°è£…åçš„å¯¹è±¡ç±»å‹ã€‚å¹¶è¿™ä¸ªç»“æœæŸ¥è¯¢ä¹Ÿä¸ä¸€å®šåªæ˜¯ä¸€æ¡è®°å½•ï¼Œè¿˜å¯èƒ½æ˜¯å¤šæ¡è®°å½•ã€‚é‚£ä¹ˆä¸ºäº†æ›´å¥½çš„å¤„ç†è¿™äº›ä¸åŒæƒ…å†µä¸‹çš„é—®é¢˜ï¼Œå°±éœ€è¦å¯¹æµç¨‹è¿›è¡Œåˆ†æ²»å’Œå®ç°ï¼Œä»¥åŠåœ¨è¿‡ç¨‹ä¸­è¿›è¡ŒæŠ½è±¡åŒ–çš„è§£è€¦ï¼Œè¿™æ ·æ‰èƒ½æ»¡è¶³äºæˆ‘ä»¬æŠŠä¸åŒçš„è¿”å›ä¿¡æ¯è¯‰æ±‚ï¼Œå°è£…åˆ°å¯¹è±¡é‡Œå»ã€‚*åˆ†æ²»ã€æŠ½è±¡å’ŒçŸ¥è¯†ï¼Œæ¥è‡ªäºäººæœˆç¥è¯ä¸­çš„åº·å¨å®šå¾‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿè®¾è®¡çš„ç¬¬ä¸€åŸåˆ™ã€‚*

## ä¸‰ã€è®¾è®¡

åœ¨æˆ‘ä»¬ä½¿ç”¨  JDBC è·å–åˆ°æŸ¥è¯¢ç»“æœ ResultSet#getObject å¯ä»¥è·å–è¿”å›å±æ€§å€¼ï¼Œä½†å…¶å® ResultSet æ˜¯å¯ä»¥æŒ‰ç…§ä¸åŒçš„å±æ€§ç±»å‹è¿›è¡Œè¿”å›ç»“æœçš„ï¼Œè€Œä¸æ˜¯éƒ½è¿”å› Object å¯¹è±¡ï¼ˆå¦‚å›¾11-2 æ‰€ç¤ºï¼‰ã€‚é‚£ä¹ˆå…¶å®æˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚ä¸­å¤„ç†å±æ€§ä¿¡æ¯æ—¶å€™ï¼Œæ‰€å¼€å‘çš„ TypeHandler æ¥å£çš„å®ç°ç±»ï¼Œå°±å¯ä»¥æ‰©å……è¿”å›ç»“æœçš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼šLongTypeHandler#getResultã€StringTypeHandler#getResult ç­‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼éå¸¸æ˜ç¡®çš„å®šä½åˆ°è¿”å›çš„ç»“æœï¼Œè€Œä¸éœ€è¦è¿›è¡Œifåˆ¤æ–­å¤„ç†ã€‚

![å›¾ 11-2 è¿”å›ç±»å‹](https://bugstack.cn/images/article/spring/mybatis-220602-02.png)

å†æœ‰äº†è¿™ä¸ªç›®æ ‡çš„å‰æä¸‹ï¼Œå°±å¯ä»¥é€šè¿‡è§£æ XML ä¿¡æ¯æ—¶å°è£…è¿”å›ç±»å‹åˆ°æ˜ å°„å™¨è¯­å¥ç±»ä¸­ï¼ŒMappedStatement#resultMaps ç›´åˆ°æ‰§è¡Œå®Œ SQL è¯­å¥ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„è¿”å›ç»“æœå‚æ•°ç±»å‹ï¼Œåˆ›å»ºå¯¹è±¡å’Œä½¿ç”¨ MetaObject åå°„å·¥å…·ç±»å¡«å……å±æ€§ä¿¡æ¯ã€‚è¯¦ç»†è®¾è®¡å¦‚å›¾ 11-3 æ‰€ç¤º

![å›¾ 11-3 å°è£…ç»“æœé›†å¤„ç†å™¨](https://bugstack.cn/images/article/spring/mybatis-220602-03.png)

- é¦–å…ˆæˆ‘ä»¬åœ¨è§£æ XML è¯­å¥è§£ææ„å»ºå™¨ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª MapperBuilderAssistant æ˜ å°„å™¨çš„åŠ©æ‰‹ç±»ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹å‚æ•°çš„ç»Ÿä¸€åŒ…è£…å¤„ç†ï¼ŒæŒ‰ç…§èŒè´£å½’å±çš„æ–¹å¼è¿›è¡Œç»†åˆ†è§£è€¦ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼åœ¨ MapperBuilderAssistant#setStatementResultMap ä¸­å°è£…è¿”å›ç»“æœä¿¡æ¯ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨ Mybatis é…ç½®è¿”å›å¯¹è±¡çš„æ—¶å€™ ResultType å°±èƒ½è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ï¼Œè€Œä¸éœ€è¦éƒ½æ˜¯é…ç½®ä¸€ä¸ª ResultMap æ˜ å°„ç»“æœã€‚ä½†è¿™é‡Œçš„è®¾è®¡å…¶å®æ˜¯æŠŠ ResultType ä¹ŸæŒ‰ç…§ä¸€ä¸ª ResultMap çš„æ–¹å¼è¿›è¡Œå°è£…å¤„ç†ï¼Œè¿™æ ·ç»Ÿä¸€ä¸€ä¸ªæ ‡å‡†çš„æ–¹å¼è¿›è¡ŒåŒ…è£…ï¼Œåšäº†åˆ°é€‚é…çš„æ•ˆæœï¼Œä¹Ÿæ›´åŠ æ–¹ä¾¿åé¢å¯¹è¿™æ ·çš„å‚æ•°è¿›è¡Œç»Ÿä¸€ä½¿ç”¨ã€‚
- æ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œ JDBC æ“ä½œæŸ¥è¯¢åˆ°æ•°æ®ä»¥åï¼Œå¯¹ç»“æœçš„å°è£…ã€‚é‚£ä¹ˆåœ¨ DefaultResultSetHandler è¿”å›ç»“æœå¤„ç†ä¸­ï¼Œé¦–å…ˆä¼šæŒ‰ç…§æˆ‘ä»¬å·²ç»è§£æçš„åˆ°çš„ ResultType è¿›è¡Œå¯¹è±¡çš„å®ä¾‹åŒ–ã€‚å®ä¾‹åŒ–å¯¹è±¡ä»¥åå†æ ¹æ®è§£æå‡ºæ¥å¯¹è±¡ä¸­å‚æ•°çš„åç§°è·å–å¯¹åº”çš„ç±»å‹ï¼Œåœ¨æ ¹æ®ç±»å‹æ‰¾åˆ° TypeHandler æ¥å£å®ç°ç±»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢æåˆ°çš„ LongTypeHandlerã€StringTypeHandlerï¼Œå› ä¸ºé€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå¯ä»¥é¿å… ifÂ·Â·Â·else çš„åˆ¤æ–­ï¼Œè€Œæ˜¯ç›´æ¥O(1)æ—¶é—´å¤æ‚åº¦å®šä½åˆ°å¯¹åº”çš„ç±»å‹å¤„ç†å™¨ï¼Œåœ¨ä¸åŒçš„ç±»å‹å¤„ç†å™¨ä¸­è¿”å›ç»“æœä¿¡æ¯ã€‚æœ€ç»ˆæ‹¿åˆ°ç»“æœå†é€šè¿‡å‰é¢ç« èŠ‚å·²ç»å¼€å‘è¿‡çš„ MetaObject åå°„å·¥å…·ç±»è¿›è¡Œå±æ€§ä¿¡æ¯çš„è®¾ç½®ã€‚*metaObject.setValue(property, value)* æœ€ç»ˆå¡«å……å®ä¾‹åŒ–å¹¶è®¾ç½®äº†å±æ€§å†…å®¹çš„ç»“æœå¯¹è±¡åˆ°ä¸Šä¸‹æ–‡ä¸­ï¼Œç›´è‡³å¤„ç†å®Œæˆè¿”å›æœ€ç»ˆçš„ç»“æœæ•°æ®ï¼Œä»¥æ­¤å¤„ç†å®Œæˆã€‚

## å››ã€å®ç°

### 1. å·¥ç¨‹ç»“æ„

```java
mybatis-step-10
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn.bugstack.mybatis
    â”‚           â”œâ”€â”€ binding
    â”‚           â”œâ”€â”€ builder
    â”‚           â”‚   â”œâ”€â”€ xml
    â”‚           â”‚   â”‚   â”œâ”€â”€ XMLConfigBuilder.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ XMLMapperBuilder.java
    â”‚           â”‚   â”‚   â””â”€â”€ XMLStatementBuilder.java
    â”‚           â”‚   â”œâ”€â”€ BaseBuilder.java
    â”‚           â”‚   â”œâ”€â”€ MapperBuilderAssistant.java
    â”‚           â”‚   â”œâ”€â”€ ParameterExpression.java
    â”‚           â”‚   â”œâ”€â”€ SqlSourceBuilder.java
    â”‚           â”‚   â””â”€â”€ StaticSqlSource.java
    â”‚           â”œâ”€â”€ datasource
    â”‚           â”œâ”€â”€ executor
    â”‚           â”‚   â”œâ”€â”€ parameter
    â”‚           â”‚   â”‚   â””â”€â”€ ParameterHandler.java
    â”‚           â”‚   â”œâ”€â”€ result
    â”‚           â”‚   â”‚   â”œâ”€â”€ DefaultResultContext.java
    â”‚           â”‚   â”‚   â””â”€â”€ DefaultResultHandler.java
    â”‚           â”‚   â”œâ”€â”€ resultset
    â”‚           â”‚   â”‚   â”œâ”€â”€ DefaultResultSetHandler.java
    â”‚           â”‚   â”‚   â””â”€â”€ ResultSetHandler.java
    â”‚           â”‚   â”‚   â””â”€â”€ ResultSetWrapper.java
    â”‚           â”‚   â”œâ”€â”€ statement
    â”‚           â”‚   â”‚   â”œâ”€â”€ BaseStatementHandler.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ PreparedStatementHandler.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ SimpleStatementHandler.java
    â”‚           â”‚   â”‚   â””â”€â”€ StatementHandler.java
    â”‚           â”‚   â”œâ”€â”€ BaseExecutor.java
    â”‚           â”‚   â”œâ”€â”€ Executor.java
    â”‚           â”‚   â””â”€â”€ SimpleExecutor.java
    â”‚           â”œâ”€â”€ io
    â”‚           â”œâ”€â”€ mapping
    â”‚           â”‚   â”œâ”€â”€ BoundSql.java
    â”‚           â”‚   â”œâ”€â”€ Environment.java
    â”‚           â”‚   â”œâ”€â”€ MappedStatement.java
    â”‚           â”‚   â”œâ”€â”€ ParameterMapping.java
    â”‚           â”‚   â”œâ”€â”€ ResultMap.java
    â”‚           â”‚   â”œâ”€â”€ ResultMapping.java
    â”‚           â”‚   â”œâ”€â”€ SqlCommandType.java
    â”‚           â”‚   â””â”€â”€ SqlSource.java
    â”‚           â”œâ”€â”€ parsing
    â”‚           â”œâ”€â”€ reflection
    â”‚           â”œâ”€â”€ scripting
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ DefaultParameterHandler.java
    â”‚           â”‚   â”‚   â””â”€â”€ RawSqlSource.java
    â”‚           â”‚   â”œâ”€â”€ xmltags
    â”‚           â”‚   â”‚   â”œâ”€â”€ DynamicContext.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ MixedSqlNode.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ SqlNode.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ StaticTextSqlNode.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ XMLLanguageDriver.java
    â”‚           â”‚   â”‚   â””â”€â”€ XMLScriptBuilder.java
    â”‚           â”‚   â”œâ”€â”€ LanguageDriver.java
    â”‚           â”‚   â””â”€â”€ LanguageDriverRegistry.java
    â”‚           â”œâ”€â”€ session
    â”‚           â”‚   â”œâ”€â”€ defaults
    â”‚           â”‚   â”‚   â”œâ”€â”€ DefaultSqlSession.java
    â”‚           â”‚   â”‚   â””â”€â”€ DefaultSqlSessionFactory.java
    â”‚           â”‚   â”œâ”€â”€ Configuration.java
    â”‚           â”‚   â”œâ”€â”€ ResultContext.java
    â”‚           â”‚   â”œâ”€â”€ ResultHandler.java
    â”‚           â”‚   â”œâ”€â”€ RowBounds.java
    â”‚           â”‚   â”œâ”€â”€ SqlSession.java
    â”‚           â”‚   â”œâ”€â”€ SqlSessionFactory.java
    â”‚           â”‚   â”œâ”€â”€ SqlSessionFactoryBuilder.java
    â”‚           â”‚   â””â”€â”€ TransactionIsolationLevel.java
    â”‚           â”œâ”€â”€ transaction
    â”‚           â””â”€â”€ type
    â”‚               â”œâ”€â”€ BaseTypeHandler.java
    â”‚               â”œâ”€â”€ JdbcType.java
    â”‚               â”œâ”€â”€ LongTypeHandler.java
    â”‚               â”œâ”€â”€ StringTypeHandler.java
    â”‚               â”œâ”€â”€ TypeAliasRegistry.java
    â”‚               â”œâ”€â”€ TypeHandler.java
    â”‚               â””â”€â”€ TypeHandlerRegistry.java
    â””â”€â”€ test
        â”œâ”€â”€ java
        â”‚   â””â”€â”€ cn.bugstack.mybatis.test.dao
        â”‚       â”œâ”€â”€ dao
        â”‚       â”‚   â””â”€â”€ IUserDao.java
        â”‚       â”œâ”€â”€ po
        â”‚       â”‚   â””â”€â”€ User.java
        â”‚       â””â”€â”€ ApiTest.java
        â””â”€â”€ resources
            â”œâ”€â”€ mapper
            â”‚   â””â”€â”€User_Mapper.xml
            â””â”€â”€ mybatis-config-datasource.xml
```

**å·¥ç¨‹æºç **ï¼š`å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šæ‰‹å†™Mybatisï¼Œè·å–å®Œæ•´æºç `

æµç¨‹è§£è€¦ï¼Œå°è£…ç»“æœé›†å¤„ç†å™¨æ ¸å¿ƒç±»å…³ç³»ï¼Œå¦‚å›¾ 11-4 æ‰€ç¤º

![å›¾ 11-4 å°è£…ç»“æœé›†å¤„ç†å™¨æ ¸å¿ƒç±»å…³ç³»](https://bugstack.cn/images/article/spring/mybatis-220602-04.png)

- åœ¨ XML è¯­å¥æ„å»ºå™¨ä¸­ä½¿ç”¨æ˜ å°„æ„å»ºå™¨åŠ©æ‰‹ï¼ŒåŒ…è£…æ˜ å°„å™¨è¯­å¥å…¥å‚ã€å‡ºå‚çš„å°è£…å¤„ç†ã€‚é€šè¿‡æ­¤å¤„åŠŸèƒ½èŒè´£çš„åˆ‡å‰²ï¼Œæ»¡è¶³ä¸åŒé€»è¾‘å•å…ƒçš„æ‰©å±•ã€‚*MapperBuilderAssistant#setStatementResultMap å¤„ç† ResultType/ResultMap çš„å°è£…ä¿¡æ¯ã€‚*
- å…¥å‚ä¿¡æ¯çš„è§£æä¼šå­˜æ”¾åˆ°æ˜ å°„è¯­å¥ MappedStatement ç±»ä¸­ï¼Œè¿™æ ·éšç€ DefaultSqlSession#selectOne å…·ä½“æ–¹æ³•çš„æ‰§è¡Œæ—¶ï¼Œå°±å¯ä»¥é€šè¿‡ statement ä»é…ç½®é¡¹ä¸­è·å–åˆ°å¯¹åº”çš„ MappedStatement ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œçš„è®¾è®¡æ˜¯ç¬¦åˆä¸€ä¸ªå……è¡€æ¨¡å‹ç»“æ„çš„é¢†åŸŸåŠŸèƒ½èšåˆã€‚
- æœ€åå°±æ˜¯å®ç°äº† ResultSetHandler ç»“æœé›†å¤„ç†å™¨æ¥å£çš„ DefaultResultSetHandler å®ç°ç±»ï¼Œå¯¹æŸ¥è¯¢ç»“æœçš„å°è£…å¤„ç†ï¼Œè¿™é‡Œä¸»è¦åˆ†ä¸ºæŒ‰ç…§è§£æå‡ºæ¥çš„ resultType ç±»å‹è¿›è¡Œå®ä¾‹åŒ–å¯¹è±¡ï¼Œä¹‹åæ ¹æ®å¯¹è±¡çš„å±æ€§ä¿¡æ¯å¯»æ‰¾å¯¹åº”çš„å¤„ç†ç­–ç•¥ï¼Œé¿å…ifÂ·Â·Â·elseåˆ¤æ–­çš„æ–¹å¼è·å–å¯¹åº”çš„ç»“æœï¼Œå½“å¯¹è±¡å’Œå±æ€§éƒ½å‡†å¤‡å®Œæ¯•åï¼Œå°±å¯ä»¥ä½¿ç”¨ MetaObject å…ƒå¯¹è±¡åå°„å·¥å…·ç±»è¿›è¡Œå±æ€§å¡«å……ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ç»“æœå¯¹è±¡ï¼Œå¹¶å†™å…¥åˆ°ç»“æœä¸Šä¸‹æ–‡ä¸­ DefaultResultContext è¿”å›ã€‚

### 2. å‡ºå‚å‚æ•°å¤„ç†

é‰´äºå¯¹ XML è¯­å¥æ„å»ºå™¨ä¸­è§£æè¯­å¥åçš„ä¿¡æ¯å°è£…ä¼šé€æ­¥å¢å¤šï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦å¼•å…¥æ˜ å°„æ„å»ºå™¨åŠ©æ‰‹å¯¹ç±»ä¸­æ–¹æ³•çš„èŒè´£è¿›è¡Œåˆ’åˆ†ï¼Œé™ä½ä¸€ä¸ªæ–¹æ³•å—å†…çš„é€»è¾‘å¤æ‚åº¦ã€‚è¿™æ ·çš„æ–¹å¼ä¹Ÿæ›´åŠ åˆ©äºä»£ç çš„ç»´æŠ¤å’Œæ‰©å±•ã€‚

#### 2.1 ç»“æœæ˜ å°„å°è£…

ç†Ÿæ‚‰ä½¿ç”¨ Mybatis çš„è¯»è€…éƒ½æ¸…æ¥šçš„çŸ¥é“ï¼Œåœ¨ä¸€æ¡è¯­å¥é…ç½®ä¸­éœ€è¦æœ‰åŒ…æ‹¬ä¸€ä¸ªè¿”å›ç±»å‹çš„é…ç½®ï¼Œè¿™ä¸ªè¿”å›ç±»å‹å¯ä»¥æ˜¯é€šè¿‡ resultType é…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨  resultMap è¿›è¡Œå¤„ç†ï¼Œè€Œæ— è®ºä½¿ç”¨å“ªç§æ–¹å¼å…¶å®æœ€ç»ˆéƒ½ä¼šè¢«å°è£…æˆç»Ÿä¸€çš„ ResultMap ç»“æœæ˜ å°„ç±»ã€‚

é‚£ä¹ˆä¸€èˆ¬æˆ‘ä»¬é…ç½® ResultMap éƒ½æ˜¯é…ç½®äº†å­—æ®µçš„æ˜ å°„ï¼Œæ‰€ä»¥å®é™…çš„ä»£ç å¼€å‘ä¸­ ResultMap è¿˜ä¼šåŒ…å« ResultMapping ä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªå­—æ®µçš„æ˜ å°„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šcolumã€javaTypeã€jdbcType ç­‰ã€‚*ç”±äºæœ¬ç« èŠ‚æš‚æ—¶è¿˜ä¸æ¶‰åŠåˆ° ResultMap çš„ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆåªæ˜¯å»ºå¥½åŸºæœ¬çš„åœ°åŸºç»“æ„å°±å¯ä»¥ã€‚*

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.mapping.ResultMap`

```java
public class ResultMap {

    private String id;
    private Class<?> type;
    private List<ResultMapping> resultMappings;
    private Set<String> mappedColumns;

		//...
}
```

- ResultMap å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¿”å›ç»“æœä¿¡æ¯æ˜ å°„ç±»ï¼Œå¹¶æä¾›äº†å»ºé€ è€…æ–¹æ³•ï¼Œæ–¹ä¾¿å¤–éƒ¨ä½¿ç”¨ã€‚æ²¡æœ‰å¤ªå¤šçš„é€»è¾‘è¡Œä¸ºï¼Œå…·ä½“å¯ä»¥å‚ç…§æºç ã€‚

#### 2.2 æ„å»ºå™¨åŠ©æ‰‹

MapperBuilderAssistant æ„å»ºå™¨åŠ©æ‰‹ä¸“é—¨ä¸ºåˆ›å»º MappedStatement æ˜ å°„è¯­å¥ç±»è€ŒæœåŠ¡çš„ï¼Œåœ¨è¿™ä¸ªç±»ä¸­å°è£…äº†å…¥å‚å’Œå‡ºå‚çš„æ˜ å°„ã€ä»¥åŠæŠŠè¿™äº›é…ç½®ä¿¡æ¯å†™å…¥åˆ° Configuration é…ç½®é¡¹ä¸­ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.builder.MapperBuilderAssistant`

```java
public class MapperBuilderAssistant extends BaseBuilder {

    /**
     * æ·»åŠ æ˜ å°„å™¨è¯­å¥
     */
    public MappedStatement addMappedStatement(
            String id,
            SqlSource sqlSource,
            SqlCommandType sqlCommandType,
            Class<?> parameterType,
            String resultMap,
            Class<?> resultType,
            LanguageDriver lang
    ) {
        // ç»™idåŠ ä¸Šnamespaceå‰ç¼€ï¼šcn.bugstack.mybatis.test.dao.IUserDao.queryUserInfoById
        id = applyCurrentNamespace(id, false);
        MappedStatement.Builder statementBuilder = new MappedStatement.Builder(configuration, id, sqlCommandType, sqlSource, resultType);

        // ç»“æœæ˜ å°„ï¼Œç»™ MappedStatement#resultMaps
        setStatementResultMap(resultMap, resultType, statementBuilder);

        MappedStatement statement = statementBuilder.build();
        // æ˜ å°„è¯­å¥ä¿¡æ¯ï¼Œå»ºé€ å®Œå­˜æ”¾åˆ°é…ç½®é¡¹ä¸­
        configuration.addMappedStatement(statement);

        return statement;
    }

    private void setStatementResultMap(
            String resultMap,
            Class<?> resultType,
            MappedStatement.Builder statementBuilder) {
        List<ResultMap> resultMaps = new ArrayList<>();
        /*
         * é€šå¸¸ä½¿ç”¨ resultType å³å¯æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯
         * <select id="queryUserInfoById" resultType="cn.bugstack.mybatis.test.po.User">
         * ä½¿ç”¨ resultType çš„æƒ…å†µä¸‹ï¼ŒMybatis ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª ResultMapï¼ŒåŸºäºå±æ€§åç§°æ˜ å°„åˆ—åˆ° JavaBean çš„å±æ€§ä¸Šã€‚
         */
        ResultMap.Builder inlineResultMapBuilder = new ResultMap.Builder(
                configuration,
                statementBuilder.id() + "-Inline",
                resultType,
                new ArrayList<>());
        resultMaps.add(inlineResultMapBuilder.build());
        statementBuilder.resultMaps(resultMaps);
    }

}
```

- åœ¨æ˜ å°„æ„å»ºå™¨åŠ©æ‰‹ä¸­ï¼Œæä¾›äº†æ·»åŠ æ˜ å°„å™¨è¯­å¥çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ›´åŠ æ ‡å‡†çš„å°è£…äº†å…¥å‚å’Œå‡ºå‚ä¿¡æ¯ã€‚*å¦‚æœè¿™äº›å†…å®¹å…¨éƒ¨éƒ½å †ç Œåˆ° XMLStatementBuilder è¯­å¥æ„å»ºå™¨çš„è§£æä¸­ï¼Œå°±ä¼šæ˜¾å¾—éå¸¸è‡ƒè‚¿ä¸æ˜“äºç»´æŠ¤äº†*
- åœ¨ MapperBuilderAssistant#setStatementResultMap æ–¹æ³•ä¸­ï¼Œå…¶å®å®ƒåªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç»“æœæ˜ å°„å»ºé€ çš„è¿‡ç¨‹ï¼Œæ— è®ºæ˜¯å¦ä¸º ResultMap éƒ½ä¼šè¿›è¡Œè¿™æ ·çš„å°è£…å¤„ç†ã€‚å¹¶æœ€ç»ˆæŠŠåˆ›å»ºçš„ä¿¡æ¯å†™å…¥åˆ° MappedStatement æ˜ å°„è¯­å¥ç±»ä¸­ã€‚

#### 2.3 è°ƒç”¨åŠ©æ‰‹ç±»

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æ¸…ç† XMLStatementBuilder è¯­å¥æ„å»ºå™¨ä¸­è§£æåï¼Œæ˜ å°„è¯­å¥ç±»çš„æ„å»ºå’Œå­˜æ”¾å¤„ç†æµç¨‹ã€‚é€šè¿‡ä½¿ç”¨åŠ©æ‰‹ç±»ï¼Œç»Ÿä¸€å°è£…å‚æ•°ä¿¡æ¯ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.builder.xml.XMLStatementBuilder`

![](https://bugstack.cn/images/article/spring/mybatis-220602-05.png)

- ä¸ä¸Šä¸€ç« èŠ‚ç›¸æ¯”ï¼Œå¯¹äºè¿™éƒ¨åˆ†çš„è§£æåçš„ç»“æœå¤„ç†çš„èŒè´£å†…å®¹ï¼Œåˆ’åˆ†åˆ°äº†æ–°å¢åŠ çš„åŠ©æ‰‹ç±»ä¸­ï¼Œè¿™ç§å®ç°æ–¹å¼åœ¨ Mybatis çš„æºç ä¸­è¿˜æ˜¯éå¸¸å¤šçš„ï¼Œå¤§éƒ¨åˆ†çš„å†…å®¹å¤„ç†ï¼Œéƒ½ä¼šæä¾›ä¸€ä¸ªåŠ©æ‰‹ç±»è¿›è¡Œæ“ä½œã€‚

### 3. æŸ¥è¯¢ç»“æœå°è£…

ä» DefaultSqlSession è°ƒç”¨ Executor è¯­å¥æ‰§è¡Œå™¨ï¼Œä¸€ç›´åˆ° PreparedStatementHandler é¢„å¤„ç†è¯­å¥å¤„ç†ï¼Œæœ€åå°±æ˜¯ DefaultResultSetHandler ç»“æœä¿¡æ¯çš„å°è£…ã€‚

å‰é¢ç« èŠ‚å¯¹æ­¤å¤„çš„å°è£…å¤„ç†ï¼Œå¹¶æ²¡æœ‰è§£è€¦çš„æ“ä½œï¼Œåªæ˜¯ç®€å•çš„ JDBC ä½¿ç”¨é€šè¿‡æŸ¥è¯¢ç»“æœï¼Œåå°„å¤„ç†è¿”å›ä¿¡æ¯å°±ç»“æŸäº†ã€‚å¦‚æœæ˜¯ä½¿ç”¨è¿™æ ·çš„ä¸€ä¸ªç®€å•çš„ ifÂ·Â·Â·else é¢å‘è¿‡ç¨‹æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œé‚£ä¹ˆåç»­æ‰€éœ€è¦æ»¡è¶³ Mybatis çš„å…¨éƒ¨å°è£…å¯¹è±¡åŠŸèƒ½ï¼Œå°±ä¼šå˜å¾—ç‰¹åˆ«åƒåŠ›ï¼Œä¸€ä¸ªæ–¹æ³•å—ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ã€‚

æ‰€ä»¥è¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å¤„ç†æ˜¯éœ€è¦è¢«è§£è€¦ï¼Œåˆ†ä¸ºï¼›å¯¹è±¡çš„å®ä¾‹åŒ–ã€ç»“æœä¿¡æ¯çš„å°è£…ã€ç­–ç•¥æ¨¡å¼çš„å¤„ç†ã€å†™å…¥ä¸Šä¸‹æ–‡è¿”å›ç­‰æ“ä½œï¼Œåªæœ‰é€šè¿‡è¿™æ ·çš„è§£è€¦æµç¨‹ï¼Œæ‰èƒ½æ›´åŠ æ–¹ä¾¿çš„æ‰©å±•æµç¨‹ä¸åŒèŠ‚ç‚¹ä¸­çš„å„ç±»éœ€æ±‚ã€‚

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.executor.resultset.DefaultResultSetHandler#handleResultSet`

![](https://bugstack.cn/images/article/spring/mybatis-220602-06.png)

- è¿™æ˜¯ä¸€å¥—ç»“æœå°è£…çš„æ ¸å¿ƒå¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬åˆ›å»ºå¤„ç†å™¨ã€å°è£…æ•°æ®å’Œä¿å­˜ç»“æœï¼Œæ¥ä¸‹æ¥å°±åˆ†åˆ«ä»‹ç»ä¸‹è¿™å—ä»£ç çš„å…·ä½“å®ç°ã€‚

#### 3.1 ç»“æœé›†æ”¶é›†å™¨

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.executor.result.DefaultResultHandler`

```java
public class DefaultResultHandler implements ResultHandler {

    private final List<Object> list;
    /**
     * é€šè¿‡ ObjectFactory åå°„å·¥å…·ç±»ï¼Œäº§ç”Ÿç‰¹å®šçš„ List
     */
    @SuppressWarnings("unchecked")
    public DefaultResultHandler(ObjectFactory objectFactory) {
        this.list = objectFactory.create(List.class);
    }

    @Override
    public void handleResult(ResultContext context) {
        list.add(context.getResultObject());
    }

}
```

- è¿™é‡Œå°è£…äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ç»“æœé›†å¯¹è±¡ï¼Œé»˜è®¤æƒ…å†µä¸‹éƒ½ä¼šå†™å…¥åˆ°è¿™ä¸ªå¯¹è±¡çš„ list é›†åˆä¸­ã€‚

#### 3.2 å¯¹è±¡åˆ›å»º

åœ¨å¤„ç†å°è£…æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬æ ¹æ® resultType ä½¿ç”¨åå°„å·¥å…·ç±» ObjectFactory#create æ–¹æ³•åˆ›å»ºå‡º Bean å¯¹è±¡ã€‚*è¿™ä¸ªè¿‡ç¨‹ä¼šæ ¹æ®ä¸åŒçš„ç±»å‹è¿›è¡Œåˆ›å»ºï¼Œä¸è¿‡æš‚æ—¶æˆ‘ä»¬è¿™é‡Œåªæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ‰€ä»¥ä¸ä¼šå¡«å……å¤ªå¤šçš„ä»£ç ï¼Œé¿å…æ‰°ä¹±è¯»è€…çš„é‡ç‚¹æ ¸å¿ƒå†…å®¹çš„å­¦ä¹ *

è°ƒç”¨é“¾è·¯ï¼šhandleResultSet->handleRowValuesForSimpleResultMap->getRowValue->createResultObject

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.executor.resultset.DefaultResultSetHandler#createResultObject`

```java
private Object createResultObject(ResultSetWrapper rsw, ResultMap resultMap, List<Class<?>> constructorArgTypes, List<Object> constructorArgs, String columnPrefix) throws SQLException {
    final Class<?> resultType = resultMap.getType();
    final MetaClass metaType = MetaClass.forClass(resultType);
    if (resultType.isInterface() || metaType.hasDefaultConstructor()) {
        // æ™®é€šçš„Beanå¯¹è±¡ç±»å‹
        return objectFactory.create(resultType);
    }
    throw new RuntimeException("Do not know how to create an instance of " + resultType);
}
```

- å¯¹äºè¿™æ ·çš„æ™®é€šå¯¹è±¡ï¼Œåªéœ€è¦ä½¿ç”¨åå°„å·¥å…·ç±»å°±å¯ä»¥å®ä¾‹åŒ–å¯¹è±¡äº†ï¼Œä¸è¿‡è¿™ä¸ªæ—¶å€™å±æ€§ä¿¡æ¯è¿˜æ²¡æœ‰å¡«å……ã€‚*å…¶å®å’Œæˆ‘ä»¬ä½¿ç”¨çš„ clazz.newInstance(); ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœ*

#### 3.3 å±æ€§å¡«å……

å¯¹è±¡å®ä¾‹åŒ–å®Œæˆåï¼Œå°±æ˜¯æ ¹æ® ResultSet è·å–å‡ºå¯¹åº”çš„å€¼å¡«å……åˆ°å¯¹è±¡çš„å±æ€§ä¸­ï¼Œä½†è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œè¿™ä¸ªç»“æœçš„è·å–æ¥è‡ªäº TypeHandler#getResult æ¥å£æ–°å¢çš„æ–¹æ³•ï¼Œç”±ä¸åŒçš„ç±»å‹å¤„ç†å™¨å®ç°ï¼Œé€šè¿‡è¿™æ ·çš„ç­–ç•¥æ¨¡å¼è®¾è®¡æ–¹å¼å°±å¯ä»¥å·§å¦™çš„é¿å… ifÂ·Â·Â·else çš„åˆ¤æ–­å¤„ç†ã€‚

![å›¾ 11-7 ä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼Œè·å–è¿”å›ç»“æœ](https://bugstack.cn/images/article/spring/mybatis-220602-07.png)

**æºç è¯¦è§**ï¼š`cn.bugstack.mybatis.executor.resultset.DefaultResultSetHandler#applyAutomaticMappings`

![](https://bugstack.cn/images/article/spring/mybatis-220602-08.png)

- columnName æ˜¯å±æ€§åç§°ï¼Œæ ¹æ®å±æ€§åç§°ï¼ŒæŒ‰ç…§åå°„å·¥å…·ç±»ä»å¯¹è±¡ä¸­è·å–å¯¹åº”çš„ properyType å±æ€§ç±»å‹ï¼Œä¹‹åå†æ ¹æ®ç±»å‹è·å–åˆ° TypeHandler ç±»å‹å¤„ç†å™¨ã€‚æœ‰äº†å…·ä½“çš„ç±»å‹å¤„ç†å™¨ï¼Œåœ¨è·å–æ¯ä¸€ä¸ªç±»å‹å¤„ç†å™¨ä¸‹çš„ç»“æœå†…å®¹å°±æ›´åŠ æ–¹ä¾¿äº†ã€‚
- è·å–å±æ€§å€¼åï¼Œå†ä½¿ç”¨ MetaObject åå°„å·¥å…·ç±»è®¾ç½®å±æ€§å€¼ï¼Œä¸€æ¬¡å¾ªç¯è®¾ç½®å®Œæˆä»¥åï¼Œè¿™æ ·ä¸€ä¸ªå®Œæ•´çš„ç»“æœä¿¡æ¯ Bean å¯¹è±¡å°±å¯ä»¥è¿”å›äº†ã€‚*è¿”å›åå†™å…¥åˆ° DefaultResultContext#nextResultObject ä¸Šä¸‹æ–‡ä¸­*

## äº”ã€æµ‹è¯•

### 1. äº‹å…ˆå‡†å¤‡

#### 1.1 åˆ›å»ºåº“è¡¨

åˆ›å»ºä¸€ä¸ªæ•°æ®åº“åç§°ä¸º mybatis å¹¶åœ¨åº“ä¸­åˆ›å»ºè¡¨ user ä»¥åŠæ·»åŠ æµ‹è¯•æ•°æ®ï¼Œå¦‚ä¸‹ï¼š

```sql
CREATE TABLE
    USER
    (
        id bigint NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ID',
        userId VARCHAR(9) COMMENT 'ç”¨æˆ·ID',
        userHead VARCHAR(16) COMMENT 'ç”¨æˆ·å¤´åƒ',
        createTime TIMESTAMP NULL COMMENT 'åˆ›å»ºæ—¶é—´',
        updateTime TIMESTAMP NULL COMMENT 'æ›´æ–°æ—¶é—´',
        userName VARCHAR(64),
        PRIMARY KEY (id)
    )
    ENGINE=InnoDB DEFAULT CHARSET=utf8;
    
insert into user (id, userId, userHead, createTime, updateTime, userName) values (1, '10001', '1_04', '2022-04-13 00:00:00', '2022-04-13 00:00:00', 'å°å‚…å“¥');    
```

#### 1.2 é…ç½®æ•°æ®æº

```xml
<environments default="development">
    <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
            <property name="driver" value="com.mysql.jdbc.Driver"/>
            <property name="url" value="jdbc:mysql://127.0.0.1:3306/mybatis?useUnicode=true"/>
            <property name="username" value="root"/>
            <property name="password" value="123456"/>
        </dataSource>
    </environment>
</environments>
```

- é€šè¿‡ `mybatis-config-datasource.xml` é…ç½®æ•°æ®æºä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šdriverã€urlã€usernameã€password
- åœ¨è¿™é‡Œ dataSource å¯ä»¥æŒ‰éœ€é…ç½®æˆ DRUIDã€UNPOOLED å’Œ POOLED è¿›è¡Œæµ‹è¯•éªŒè¯ã€‚

#### 1.3 é…ç½®Mapper

```xml
<select id="queryUserInfoById" parameterType="java.lang.Long" resultType="cn.bugstack.mybatis.test.po.User">
    SELECT id, userId, userName, userHead
    FROM user
    where id = #{id}
</select>
```

- è¿™éƒ¨åˆ†æš‚æ—¶ä¸éœ€è¦è°ƒæ•´ï¼Œç›®å‰è¿˜åªæ˜¯ä¸€ä¸ªå…¥å‚çš„ç±»å‹çš„å‚æ•°ï¼Œåç»­æˆ‘ä»¬å…¨éƒ¨å®Œå–„è¿™éƒ¨åˆ†å†…å®¹ä»¥åï¼Œåˆ™å†æä¾›æ›´å¤šçš„å…¶ä»–å‚æ•°è¿›è¡ŒéªŒè¯ã€‚

### 2. å•å…ƒæµ‹è¯•

```java
@Before
public void init() throws IOException {
    // 1. ä»SqlSessionFactoryä¸­è·å–SqlSession
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(Resources.getResourceAsReader("mybatis-config-datasource.xml"));
    sqlSession = sqlSessionFactory.openSession();
}

@Test
public void test_queryUserInfoById() {
    // 1. è·å–æ˜ å°„å™¨å¯¹è±¡
    IUserDao userDao = sqlSession.getMapper(IUserDao.class);
    // 2. æµ‹è¯•éªŒè¯ï¼šåŸºæœ¬å‚æ•°
    User user = userDao.queryUserInfoById(1L);
    logger.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(user));
}
```

- è¿™é‡Œæˆ‘ä»¬åªæµ‹è¯•ä¸€ä¸ªæŸ¥è¯¢ç»“æœå³å¯ï¼Œè¿”å›çš„ç±»å‹æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡ç±»å‹ã€‚

**æµ‹è¯•ç»“æœ**

![](https://bugstack.cn/images/article/spring/mybatis-220602-09.png)

```java
12:39:17.321 [main] INFO  c.b.mybatis.builder.SqlSourceBuilder - æ„å»ºå‚æ•°æ˜ å°„ propertyï¼šid propertyTypeï¼šclass java.lang.Long
12:39:17.321 [main] INFO  c.b.mybatis.builder.SqlSourceBuilder - æ„å»ºå‚æ•°æ˜ å°„ propertyï¼šuserId propertyTypeï¼šclass java.lang.String
12:39:17.382 [main] INFO  c.b.m.s.defaults.DefaultSqlSession - æ‰§è¡ŒæŸ¥è¯¢ statementï¼šcn.bugstack.mybatis.test.dao.IUserDao.queryUserInfoById parameterï¼š1
12:39:17.684 [main] INFO  c.b.m.s.d.DefaultParameterHandler - æ ¹æ®æ¯ä¸ªParameterMappingä¸­çš„TypeHandlerè®¾ç½®å¯¹åº”çš„å‚æ•°ä¿¡æ¯ valueï¼š1
12:39:17.728 [main] INFO  cn.bugstack.mybatis.test.ApiTest - æµ‹è¯•ç»“æœï¼š{"id":1,"userHead":"1_04","userId":"10001","userName":"å°å‚…å“¥"}

Process finished with exit code 0
```

- é€šè¿‡ DefaultResultSetHandler ç»“æœå¤„ç†å™¨çš„åŠŸèƒ½è§£è€¦å’Œå®ç°ï¼Œå·²ç»å¯ä»¥æ­£å¸¸æŸ¥è¯¢å’Œè¿”å›å¯¹åº”çš„å¯¹è±¡ä¿¡æ¯äº†ï¼Œåç»­å…¶ä»–å†…å®¹çš„æ‰©å±•ä¹Ÿå¯ä»¥åŸºäºè¿™ä¸ªåŸºåº§è¿›è¡Œå¤„ç†ã€‚

## å…­ã€æ€»ç»“

- è¿™ä¸€ç« èŠ‚çš„æ•´ä¸ªåŠŸèƒ½å®ç°ï¼Œéƒ½åœ¨å›´ç»•æµç¨‹çš„è§£è€¦è¿›è¡Œå¤„ç†ï¼Œå°†å¯¹è±¡çš„å‚æ•°è§£æå’Œç»“æœå°è£…éƒ½è¿›è¡Œæ‹†è§£ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼æ¥åˆ†é…å„ä¸ªæ¨¡å—çš„å•ä¸€èŒè´£ï¼Œä¸è®©ä¸€ä¸ªç±»çš„æ–¹æ³•æ‰¿æ‹…è¿‡å¤šçš„äº¤å‰åŠŸèƒ½ã€‚
- é‚£ä¹ˆæˆ‘ä»¬åœ¨ç»“åˆè¿™æ ·çš„æ€æƒ³å’Œè®¾è®¡ï¼Œåå¤é˜…è¯»å’ŒåŠ¨æ‰‹å®è·µä¸­ï¼Œæ¥å­¦ä¹ è¿™æ ·çš„ä»£ç è®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ï¼Œéƒ½èƒ½ä¸ºæˆ‘ä»¬ä»¥åå®é™…å¼€å‘ä¸šåŠ¡ä»£ç æ—¶å€™å¸¦æ¥å‚è€ƒå»ºè®®ï¼Œé¿å…æ€»æ˜¯æŠŠæ‰€æœ‰çš„æµç¨‹éƒ½å†™åˆ°ä¸€ä¸ªç±»æˆ–è€…æ–¹æ³•ä¸­ã€‚
- åˆ°æœ¬ç« èŠ‚å…¨æ ¸å¿ƒæµç¨‹åŸºæœ¬å°±ä¸²è”æ¸…æ¥šäº†ï¼Œå†æœ‰çš„å°±æ˜¯ä¸€äº›åŠŸèƒ½çš„æ‹“å±•ï¼Œæ¯”å¦‚æ”¯æŒæ›´å¤šçš„å‚æ•°ç±»å‹ï¼Œä»¥åŠæ·»åŠ é™¤äº† Select ä»¥å¤–çš„å…¶ä»–æ“ä½œï¼Œè¿˜æœ‰ä¸€äº›ç¼“å­˜æ•°æ®çš„ä½¿ç”¨ç­‰ï¼Œåé¢ç« èŠ‚å°†åœ¨è¿™äº›å†…å®¹ä¸­ï¼Œæ‘˜å–ä¸€äº›æ ¸å¿ƒçš„è®¾è®¡å’Œå®ç°è¿›è¡Œè®²è§£ï¼Œè®©è¯»è€…å¸æ”¶æ›´å¤šçš„è®¾è®¡æŠ€å·§ã€‚

## ä¸ƒã€ä¼˜ç§€ä½œä¸š

- [æ‰¿æ¥ä¸Šä¸€ç« èŠ‚ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯¹å‚æ•°çš„å¤„ç†ï¼Œè¿™ä¸€ç« èŠ‚å¯¹æ‰§è¡Œå®ŒæŸ¥è¯¢çš„ç»“æœè¿›è¡Œå°è£…å¤„ç†ã€‚@æ¨æ¨å¾—äº¿ğŸ™‰](https://t.zsxq.com/07RFEEyBI)
- [å°†åŸæ¥åœ¨XMLStatementBuilderä¸­ä¿å­˜MapperStatementå¯¹è±¡æ”¹å˜åˆ°åœ¨MapperBuilderAssistantä¸­ç”Ÿäº§ @ç©ºç©º](https://t.zsxq.com/084fyLjUU)
- [å¯¹å…¨éƒ¨ç±»è¿›è¡Œåˆ†ç±»å¹¶æ¢³ç†æ•´ä½“æµç¨‹ @ç‹—ç‹—](https://t.zsxq.com/08RMH5y82)
- [å…³é”®æ­¥éª¤æ˜¯å°è£…æ•°æ®ï¼Œè¿™é‡Œéœ€è¦è·å–æ¯ä¸€è¡Œçš„è®°å½• @ADé’™å¥¶](https://t.zsxq.com/110088i2N)