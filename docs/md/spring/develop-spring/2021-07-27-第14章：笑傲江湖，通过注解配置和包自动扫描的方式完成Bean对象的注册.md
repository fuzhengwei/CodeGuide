---
layout: post
category: spring
title: ç¬¬14ç« ï¼šè‡ªåŠ¨æ‰«æBeanå¯¹è±¡æ³¨å†Œ
tagline: by å°å‚…å“¥
tag: [java]
excerpt: å…¶å®åˆ°æœ¬ç« èŠ‚æˆ‘ä»¬å·²ç»æŠŠå…³äº IOC å’Œ AOP å…¨éƒ¨æ ¸å¿ƒå†…å®¹éƒ½å·²ç»å®ç°å®Œæˆäº†ï¼Œåªä¸è¿‡åœ¨ä½¿ç”¨ä¸Šè¿˜æœ‰ç‚¹åƒæ—©æœŸçš„ Spring ç‰ˆæœ¬ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ¨ spring.xml ä¸­è¿›è¡Œé…ç½®ã€‚è¿™ä¸å®é™…çš„ç›®å‰ä½¿ç”¨çš„ Spring æ¡†æ¶è¿˜æ˜¯æœ‰è›®å¤§çš„å·®åˆ«ï¼Œè€Œè¿™ç§å·®åˆ«å…¶å®éƒ½æ˜¯åœ¨æ ¸å¿ƒåŠŸèƒ½é€»è¾‘ä¹‹ä¸Šå»ºè®¾çš„åœ¨æ›´å°‘çš„é…ç½®ä¸‹ï¼Œåšåˆ°æ›´ç®€åŒ–çš„ä½¿ç”¨ã€‚
lock: need
---

# ã€ŠSpring æ‰‹æ’¸ä¸“æ ã€‹ç¬¬ 14 ç« ï¼šç¬‘å‚²æ±Ÿæ¹–ï¼Œé€šè¿‡æ³¨è§£é…ç½®å’ŒåŒ…è‡ªåŠ¨æ‰«æçš„æ–¹å¼å®ŒæˆBeanå¯¹è±¡çš„æ³¨å†Œ

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/1BWMc9sYUB9-uz2w7TZWmw](https://mp.weixin.qq.com/s/1BWMc9sYUB9-uz2w7TZWmw)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`å¿’å¤æ‚ï¼Œæ²¡ç­‰ææ˜ç™½å¤§ä¿ƒéƒ½è¿‡å»äº†ï¼`

ä½ ç»å†è¿‡`618`å’Œ`åŒ11`å—ï¼Ÿä½ åŠ å…¥è¿‡å¤§ä¿ƒæ—¶å€™é‚£ä¹ˆå¤šå¤æ‚çš„è¥é”€æ´»åŠ¨èµšå‡ æ¯›é’±å—ï¼Ÿä½ å¼€å‘è¿‡è¿è¯»æ˜ç™½ç©æ³•éƒ½éœ€è¦ä¸€å‘¨ä½†åªä½¿ç”¨3å¤©çš„å¤§ä¿ƒéœ€æ±‚å—ï¼Ÿæœ‰æ—¶å€™å¯¹äºæœ‰äº›äº§å“çš„éœ€æ±‚çœŸçš„æ˜¯å¤ªå¤æ‚äº†ï¼Œå¤æ‚åˆ°å¼€å‘ã€æµ‹è¯•éƒ½éœ€è¦åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¸æ–­çš„å­¦ä¹ æœ€åæ‰å¯èƒ½è¯»æ‡‚äº§å“ä¸ºå•¥è¿™æ ·çš„ç©ï¼Œè¦æ˜¯ä¸€ä¸ªé•¿æœŸçš„æ´»åŠ¨å¯èƒ½ä¹Ÿå°±ç®—äº†ï¼ŒåŸ¹å…»ç”¨æˆ·å¿ƒæ™ºå—ï¼ä½†è¿™ä¸€æ•´å¥—æ‹‰æ–°ã€åŠ©åŠ›ã€æ¿€æ´»ã€ä¸‹å•ã€æŠ•ä¿ã€é¢†åˆ¸ã€æ¶ˆè´¹ã€å¼€çº¢åŒ…ç­‰ç­‰ä¸€è¿ä¸²çš„éªšæ“ä½œä¸‹æ¥ï¼Œå¦‚æœåœ¨çº¿ä¸Šåªç”¨3å¤©å‘¢ï¼Œæˆ–è€…æ˜¯åªç”¨1å¤©ï¼Œé‚£TMè¿å‚ä¸çš„ç”¨æˆ·éƒ½æ²¡å¼„æ˜ç™½å‘¢ï¼Œæ´»åŠ¨å°±ç»“æŸäº†ï¼Œæœ€åèƒ½æ‰“æ¥ä»€ä¹ˆæ ·å¥½çš„æ•°æ®å‘¢ï¼Ÿ*å¯¹äºè¿™æ ·æµç¨‹å¤æ‚ï¼Œä¼°è®¡è¿ç¾Šæ¯›å½“éƒ½çœ‹ä¸ä¸Šï¼ï¼ï¼*

ä»¥ä¸Šåªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å¹¶ä¸ä¼šæçš„è¿™ä¹ˆæ¶å¿ƒï¼Œè¯„å®¡ä¹Ÿæ˜¯è¿‡ä¸å»çš„ï¼è€ŒåŒæ ·çš„é“ç†ç”¨åœ¨ç¨‹åºè®¾è®¡å¼€å‘å’Œä½¿ç”¨ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä½ æŠŠä½ çš„ä»£ç é€»è¾‘å®ç°çš„è¿‡äºåˆ†æ•£ï¼Œè®©å¤–éƒ¨è°ƒç”¨æ–¹åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦è°ƒç”¨ä½ çš„æ¥å£å¤šä¸ªå’Œå¤šæ¬¡ï¼Œè¿˜æ²¡æœ‰æ¶ˆæ¯è§¦è¾¾ï¼Œåªèƒ½å®šæ—¶è‡ªå·±è½®è®­ä½ çš„æ¥å£æŸ¥çœ‹è®¢å•çŠ¶æ€ï¼Œæ¯æ¬¡è¿˜åªèƒ½æŸ¥10æ¡ï¼ŒæŸ¥å¤šäº†ä½ è¯´ä¸è¡Œï¼Œç­‰ç­‰åäººç±»çš„è®¾è®¡ï¼Œéƒ½ä¼šç»™è°ƒç”¨æ–¹å¸¦æ¥è¦å¹²ä½ çš„ä½“ä¼šã€‚

æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åœ¨å®Œæˆç›®çš„çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯å¸Œæœ›å°½å¯èƒ½æµç¨‹ç®€å•ã€æ¨¡å¼æ¸…æ™°ã€è‡ªåŠ¨æœåŠ¡ã€‚é‚£è¿™åœ¨Springçš„æ¡†æ¶ä¸­ä¹Ÿæ˜¯æœ‰æ‰€ä½“ç°çš„ï¼Œè¿™ä¸ªæ¡†æ¶çš„æ™®åŠä½¿ç”¨ç¨‹åº¦å’Œå®ƒæ‰€èƒ½å¸¦æ¥çš„æ–¹ä¾¿æ€§æ˜¯åˆ†ä¸å¼€çš„ï¼Œè€Œæˆ‘ä»¬å¦‚æœèƒ½åšåˆ°å¦‚æ­¤çš„æ–¹ä¾¿ï¼Œé‚£è‚¯å®šæ˜¯ä¸€ç§å¥½çš„è®¾è®¡å’Œå®ç°ã€‚

## äºŒã€ç›®æ ‡

å…¶å®åˆ°æœ¬ç« èŠ‚æˆ‘ä»¬å·²ç»æŠŠå…³äº IOC å’Œ AOP å…¨éƒ¨æ ¸å¿ƒå†…å®¹éƒ½å·²ç»å®ç°å®Œæˆäº†ï¼Œåªä¸è¿‡åœ¨ä½¿ç”¨ä¸Šè¿˜æœ‰ç‚¹åƒæ—©æœŸçš„ Spring ç‰ˆæœ¬ï¼Œéœ€è¦ä¸€ä¸ªä¸€ä¸ªåœ¨ spring.xml ä¸­è¿›è¡Œé…ç½®ã€‚è¿™ä¸å®é™…çš„ç›®å‰ä½¿ç”¨çš„ Spring æ¡†æ¶è¿˜æ˜¯æœ‰è›®å¤§çš„å·®åˆ«ï¼Œè€Œè¿™ç§å·®åˆ«å…¶å®éƒ½æ˜¯åœ¨æ ¸å¿ƒåŠŸèƒ½é€»è¾‘ä¹‹ä¸Šå»ºè®¾çš„åœ¨æ›´å°‘çš„é…ç½®ä¸‹ï¼Œåšåˆ°æ›´ç®€åŒ–çš„ä½¿ç”¨ã€‚

è¿™å…¶ä¸­å°±åŒ…æ‹¬ï¼šåŒ…çš„æ‰«ææ³¨å†Œã€æ³¨è§£é…ç½®çš„ä½¿ç”¨ã€å ä½ç¬¦å±æ€§çš„å¡«å……ç­‰ç­‰ï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åœ¨ç›®å‰çš„æ ¸å¿ƒé€»è¾‘ä¸Šå¡«å……ä¸€äº›è‡ªåŠ¨åŒ–çš„åŠŸèƒ½ï¼Œè®©å¤§å®¶å¯ä»¥å­¦ä¹ åˆ°è¿™éƒ¨åˆ†çš„è®¾è®¡å’Œå®ç°ï¼Œä»ä¸­ä½“ä¼šåˆ°ä¸€äº›å…³äºä»£ç é€»è¾‘çš„å®ç°è¿‡ç¨‹ï¼Œæ€»ç»“ä¸€äº›ç¼–ç ç»éªŒã€‚

## ä¸‰ã€æ–¹æ¡ˆ

é¦–å…ˆæˆ‘ä»¬è¦è€ƒè™‘ğŸ¤”ï¼Œä¸ºäº†å¯ä»¥ç®€åŒ– Bean å¯¹è±¡çš„é…ç½®ï¼Œè®©æ•´ä¸ª Bean å¯¹è±¡çš„æ³¨å†Œéƒ½æ˜¯è‡ªåŠ¨æ‰«æçš„ï¼Œé‚£ä¹ˆåŸºæœ¬éœ€è¦çš„å…ƒç´ åŒ…æ‹¬ï¼šæ‰«æè·¯å¾„å…¥å£ã€XMLè§£ææ‰«æä¿¡æ¯ã€ç»™éœ€è¦æ‰«æçš„Beanå¯¹è±¡åšæ³¨è§£æ ‡è®°ã€æ‰«æClasså¯¹è±¡æ‘˜å–Beanæ³¨å†Œçš„åŸºæœ¬ä¿¡æ¯ï¼Œç»„è£…æ³¨å†Œä¿¡æ¯ã€æ³¨å†ŒæˆBeanå¯¹è±¡ã€‚é‚£ä¹ˆåœ¨è¿™äº›æ¡ä»¶å…ƒç´ çš„æ”¯æ’‘ä¸‹ï¼Œå°±å¯ä»¥å®ç°å‡ºé€šè¿‡è‡ªå®šä¹‰æ³¨è§£å’Œé…ç½®æ‰«æè·¯å¾„çš„æƒ…å†µä¸‹ï¼Œå®Œæˆ Bean å¯¹è±¡çš„æ³¨å†Œã€‚é™¤æ­¤ä¹‹å¤–å†é¡ºå¸¦è§£å†³ä¸€ä¸ªé…ç½®ä¸­å ä½ç¬¦å±æ€§çš„çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡ `${token}` ç»™ Bean å¯¹è±¡æ³¨å…¥è¿›å»å±æ€§ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªæ“ä½œéœ€è¦ç”¨åˆ° BeanFactoryPostProcessorï¼Œå› ä¸ºå®ƒå¯ä»¥å¤„ç† **åœ¨æ‰€æœ‰çš„ BeanDefinition åŠ è½½å®Œæˆåï¼Œå®ä¾‹åŒ– Bean å¯¹è±¡ä¹‹å‰ï¼Œæä¾›ä¿®æ”¹ BeanDefinition å±æ€§çš„æœºåˆ¶** è€Œå®ç°è¿™éƒ¨åˆ†å†…å®¹æ˜¯ä¸ºäº†åç»­æŠŠæ­¤ç±»å†…å®¹ç»“åˆåˆ°è‡ªåŠ¨åŒ–é…ç½®å¤„ç†ä¸­ã€‚æ•´ä½“è®¾è®¡ç»“æ„å¦‚ä¸‹å›¾ï¼š  

![](https://bugstack.cn/assets/images/spring/spring-14-01.png)

ç»“åˆbeançš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‰«æåªä¸è¿‡æ˜¯æ‰«æç‰¹å®šæ³¨è§£çš„ç±»ï¼Œæå–ç±»çš„ç›¸å…³ä¿¡æ¯ç»„è£…æˆBeanDefinitionæ³¨å†Œåˆ°å®¹å™¨ä¸­ã€‚

åœ¨XmlBeanDefinitionReaderä¸­è§£æ```<context:component-scan />```æ ‡ç­¾ï¼Œæ‰«æç±»ç»„è£…BeanDefinitionç„¶åæ³¨å†Œåˆ°å®¹å™¨ä¸­çš„æ“ä½œåœ¨ClassPathBeanDefinitionScanner#doScanä¸­å®ç°ã€‚

- è‡ªåŠ¨æ‰«ææ³¨å†Œä¸»è¦æ˜¯æ‰«ææ·»åŠ äº†è‡ªå®šä¹‰æ³¨è§£çš„ç±»ï¼Œåœ¨xmlåŠ è½½è¿‡ç¨‹ä¸­æå–ç±»çš„ä¿¡æ¯ï¼Œç»„è£… BeanDefinition æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­ã€‚
- æ‰€ä»¥æˆ‘ä»¬ä¼šç”¨åˆ° `<context:component-scan />` é…ç½®åŒ…è·¯å¾„å¹¶åœ¨ XmlBeanDefinitionReader è§£æå¹¶åšç›¸åº”çš„å¤„ç†ã€‚*è¿™é‡Œçš„å¤„ç†ä¼šåŒ…æ‹¬å¯¹ç±»çš„æ‰«æã€è·å–æ³¨è§£ä¿¡æ¯ç­‰*
- æœ€åè¿˜åŒ…æ‹¬äº†ä¸€éƒ¨åˆ†å…³äº `BeanFactoryPostProcessor` çš„ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®Œæˆå¯¹å ä½ç¬¦é…ç½®ä¿¡æ¯çš„åŠ è½½ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨åˆ° BeanFactoryPostProcessor åœ¨æ‰€æœ‰çš„ BeanDefinition åŠ è½½å®Œæˆåï¼Œå®ä¾‹åŒ– Bean å¯¹è±¡ä¹‹å‰ï¼Œä¿®æ”¹ BeanDefinition çš„å±æ€§ä¿¡æ¯ã€‚*è¿™ä¸€éƒ¨åˆ†çš„å®ç°ä¹Ÿä¸ºåç»­å¤„ç†å…³äºå ä½ç¬¦é…ç½®åˆ°æ³¨è§£ä¸Šåšå‡†å¤‡*

## å››ã€å®ç° 

### 1. å·¥ç¨‹ç»“æ„

```java
small-spring-step-13
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn.bugstack.springframework
    â”‚           â”œâ”€â”€ aop
    â”‚           â”‚   â”œâ”€â”€ aspectj
    â”‚           â”‚   â”‚   â””â”€â”€ AspectJExpressionPointcut.java
    â”‚           â”‚   â”‚   â””â”€â”€ AspectJExpressionPointcutAdvisor.java
    â”‚           â”‚   â”œâ”€â”€ framework 
    â”‚           â”‚   â”‚   â”œâ”€â”€ adapter
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ MethodBeforeAdviceInterceptor.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ autoproxy
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ MethodBeforeAdviceInterceptor.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ AopProxy.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ Cglib2AopProxy.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ JdkDynamicAopProxy.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ProxyFactory.java
    â”‚           â”‚   â”‚   â””â”€â”€ ReflectiveMethodInvocation.java
    â”‚           â”‚   â”œâ”€â”€ AdvisedSupport.java
    â”‚           â”‚   â”œâ”€â”€ Advisor.java
    â”‚           â”‚   â”œâ”€â”€ BeforeAdvice.java
    â”‚           â”‚   â”œâ”€â”€ ClassFilter.java
    â”‚           â”‚   â”œâ”€â”€ MethodBeforeAdvice.java
    â”‚           â”‚   â”œâ”€â”€ MethodMatcher.java
    â”‚           â”‚   â”œâ”€â”€ Pointcut.java
    â”‚           â”‚   â”œâ”€â”€ PointcutAdvisor.java
    â”‚           â”‚   â””â”€â”€ TargetSource.java
    â”‚           â”œâ”€â”€ beans
    â”‚           â”‚   â”œâ”€â”€ factory
    â”‚           â”‚   â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AutowireCapableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinition.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanFactoryPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanReference.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigurableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ InstantiationAwareBeanPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ SingletonBeanRegistry.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractAutowireCapableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractBeanDefinitionReader.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinitionReader.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinitionRegistry.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ CglibSubclassingInstantiationStrategy.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultListableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultSingletonBeanRegistry.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DisposableBeanAdapter.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ FactoryBeanRegistrySupport.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ InstantiationStrategy.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ SimpleInstantiationStrategy.java  
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ XmlBeanDefinitionReader.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ Aware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanClassLoaderAware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanFactoryAware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanNameAware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ConfigurableListableBeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ DisposableBean.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ FactoryBean.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ HierarchicalBeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ InitializingBean.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ListableBeanFactory.java
    â”‚           â”‚   â”‚   â””â”€â”€ PropertyPlaceholderConfigurer.java
    â”‚           â”‚   â”œâ”€â”€ BeansException.java
    â”‚           â”‚   â”œâ”€â”€ PropertyValue.java
    â”‚           â”‚   â””â”€â”€ PropertyValues.java 
    â”‚           â”œâ”€â”€ context
    â”‚           â”‚   â”œâ”€â”€ annotation
    â”‚           â”‚   â”‚   â”œâ”€â”€ ClassPathBeanDefinitionScanner.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ClassPathScanningCandidateComponentProvider.java 
    â”‚           â”‚   â”‚   â””â”€â”€ Scope.java 
    â”‚           â”‚   â”œâ”€â”€ event
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractApplicationEventMulticaster.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ApplicationContextEvent.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ApplicationEventMulticaster.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ContextClosedEvent.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ContextRefreshedEvent.java 
    â”‚           â”‚   â”‚   â””â”€â”€ SimpleApplicationEventMulticaster.java 
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractApplicationContext.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractRefreshableApplicationContext.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractXmlApplicationContext.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ApplicationContextAwareProcessor.java 
    â”‚           â”‚   â”‚   â””â”€â”€ ClassPathXmlApplicationContext.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationContext.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationContextAware.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationEvent.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationEventPublisher.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationListener.java 
    â”‚           â”‚   â””â”€â”€ ConfigurableApplicationContext.java
    â”‚           â”œâ”€â”€ core.io
    â”‚           â”‚   â”œâ”€â”€ ClassPathResource.java 
    â”‚           â”‚   â”œâ”€â”€ DefaultResourceLoader.java 
    â”‚           â”‚   â”œâ”€â”€ FileSystemResource.java 
    â”‚           â”‚   â”œâ”€â”€ Resource.java 
    â”‚           â”‚   â”œâ”€â”€ ResourceLoader.java
    â”‚           â”‚   â””â”€â”€ UrlResource.java
    â”‚           â”œâ”€â”€ stereotype
    â”‚           â”‚   â””â”€â”€ Component.java
    â”‚           â””â”€â”€ utils
    â”‚               â””â”€â”€ ClassUtils.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn.bugstack.springframework.test
                â”œâ”€â”€ bean
                â”‚   â”œâ”€â”€ IUserService.java
                â”‚   â””â”€â”€ UserService.java
                â””â”€â”€ ApiTest.java
```

**å·¥ç¨‹æºç **ï¼š`å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–å®Œæ•´æºç `

åœ¨Beançš„ç”Ÿå‘½å‘¨æœŸä¸­è‡ªåŠ¨åŠ è½½åŒ…æ‰«ææ³¨å†ŒBeanå¯¹è±¡å’Œè®¾ç½®å ä½ç¬¦å±æ€§çš„ç±»å…³ç³»ï¼Œå¦‚å›¾ 14-2

![å›¾ 14-2](https://bugstack.cn/assets/images/spring/spring-14-02.png)

- æ•´ä¸ªç±»çš„å…³ç³»ç»“æ„æ¥çœ‹ï¼Œå…¶å®æ¶‰åŠçš„å†…å®¹å¹¶ä¸å¤šï¼Œä¸»è¦åŒ…æ‹¬çš„å°±æ˜¯ xml è§£æç±» XmlBeanDefinitionReader å¯¹ ClassPathBeanDefinitionScanner#doScan çš„ä½¿ç”¨ã€‚
- åœ¨ doScan æ–¹æ³•ä¸­å¤„ç†æ‰€æœ‰æŒ‡å®šè·¯å¾„ä¸‹æ·»åŠ äº†æ³¨è§£çš„ç±»ï¼Œæ‹†è§£å‡ºç±»çš„ä¿¡æ¯ï¼šåç§°ã€ä½œç”¨èŒƒå›´ç­‰ï¼Œè¿›è¡Œåˆ›å»º BeanDefinition å¥½ç”¨äº Bean å¯¹è±¡çš„æ³¨å†Œæ“ä½œã€‚
- PropertyPlaceholderConfigurer ç›®å‰çœ‹ä¸Šå»åƒä¸€å—å•ç‹¬çš„å†…å®¹ï¼Œåç»­ä¼šæŠŠè¿™å—çš„å†…å®¹ä¸è‡ªåŠ¨åŠ è½½ Bean å¯¹è±¡è¿›è¡Œæ•´åˆï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åœ¨æ³¨è§£ä¸Šä½¿ç”¨å ä½ç¬¦é…ç½®ä¸€äº›åœ¨é…ç½®æ–‡ä»¶é‡Œçš„å±æ€§ä¿¡æ¯ã€‚

### 2. å¤„ç†å ä½ç¬¦é…ç½®

**cn.bugstack.springframework.beans.factory.PropertyPlaceholderConfigurer**

```java
public class PropertyPlaceholderConfigurer implements BeanFactoryPostProcessor {

    /**
     * Default placeholder prefix: {@value}
     */
    public static final String DEFAULT_PLACEHOLDER_PREFIX = "${";

    /**
     * Default placeholder suffix: {@value}
     */
    public static final String DEFAULT_PLACEHOLDER_SUFFIX = "}";

    private String location;

    @Override
    public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException {
        // åŠ è½½å±æ€§æ–‡ä»¶
        try {
            DefaultResourceLoader resourceLoader = new DefaultResourceLoader();
            Resource resource = resourceLoader.getResource(location);
            Properties properties = new Properties();
            properties.load(resource.getInputStream());

            String[] beanDefinitionNames = beanFactory.getBeanDefinitionNames();
            for (String beanName : beanDefinitionNames) {
                BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanName);

                PropertyValues propertyValues = beanDefinition.getPropertyValues();
                for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {
                    Object value = propertyValue.getValue();
                    if (!(value instanceof String)) continue;
                    String strVal = (String) value;
                    StringBuilder buffer = new StringBuilder(strVal);
                    int startIdx = strVal.indexOf(DEFAULT_PLACEHOLDER_PREFIX);
                    int stopIdx = strVal.indexOf(DEFAULT_PLACEHOLDER_SUFFIX);
                    if (startIdx != -1 && stopIdx != -1 && startIdx < stopIdx) {
                        String propKey = strVal.substring(startIdx + 2, stopIdx);
                        String propVal = properties.getProperty(propKey);
                        buffer.replace(startIdx, stopIdx + 1, propVal);
                        propertyValues.addPropertyValue(new PropertyValue(propertyValue.getName(), buffer.toString()));
                    }
                }
            }
        } catch (IOException e) {
            throw new BeansException("Could not load properties", e);
        }
    }

    public void setLocation(String location) {
        this.location = location;
    }

}
```

- ä¾èµ–äº BeanFactoryPostProcessor åœ¨ Bean ç”Ÿå‘½å‘¨æœŸçš„å±æ€§ï¼Œå¯ä»¥åœ¨ Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹å‰ï¼Œæ”¹å˜å±æ€§ä¿¡æ¯ã€‚æ‰€ä»¥è¿™é‡Œé€šè¿‡å®ç° BeanFactoryPostProcessor æ¥å£ï¼Œå®Œæˆå¯¹é…ç½®æ–‡ä»¶çš„åŠ è½½ä»¥åŠæ‘˜å–å ä½ç¬¦ä¸­çš„åœ¨å±æ€§æ–‡ä»¶é‡Œçš„é…ç½®ã€‚
- è¿™æ ·å°±å¯ä»¥æŠŠæå–åˆ°çš„é…ç½®ä¿¡æ¯æ”¾ç½®åˆ°å±æ€§é…ç½®ä¸­äº†ï¼Œ`buffer.replace(startIdx, stopIdx + 1, propVal); propertyValues.addPropertyValue` 

### 3. å®šä¹‰æ‹¦æˆªæ³¨è§£

**cn.bugstack.springframework.context.annotation.Scope**

```java
@Target({ElementType.TYPE, ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Scope {

    String value() default "singleton";

}
```

- ç”¨äºé…ç½®ä½œç”¨åŸŸçš„è‡ªå®šä¹‰æ³¨è§£ï¼Œæ–¹ä¾¿é€šè¿‡é…ç½®Beanå¯¹è±¡æ³¨è§£çš„æ—¶å€™ï¼Œæ‹¿åˆ°Beanå¯¹è±¡çš„ä½œç”¨åŸŸã€‚*ä¸è¿‡ä¸€èˆ¬éƒ½ä½¿ç”¨é»˜è®¤çš„ singleton*

**cn.bugstack.springframework.stereotype.Component**

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Component {

    String value() default "";

}
```

- Component è‡ªå®šä¹‰æ³¨è§£å¤§å®¶éƒ½éå¸¸ç†Ÿæ‚‰äº†ï¼Œç”¨äºé…ç½®åˆ° Class ç±»ä¸Šçš„ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ Serviceã€Controllerï¼Œä¸è¿‡æ‰€æœ‰çš„å¤„ç†æ–¹å¼åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œå°±åªå±•ç¤ºä¸€ä¸ª Component å³å¯ã€‚ 

### 4. å¤„ç†å¯¹è±¡æ‰«æè£…é…

**cn.bugstack.springframework.context.annotation.ClassPathScanningCandidateComponentProvider**

```java
public class ClassPathScanningCandidateComponentProvider {

    public Set<BeanDefinition> findCandidateComponents(String basePackage) {
        Set<BeanDefinition> candidates = new LinkedHashSet<>();
        Set<Class<?>> classes = ClassUtil.scanPackageByAnnotation(basePackage, Component.class);
        for (Class<?> clazz : classes) {
            candidates.add(new BeanDefinition(clazz));
        }
        return candidates;
    }

}
```

- è¿™é‡Œå…ˆè¦æä¾›ä¸€ä¸ªå¯ä»¥é€šè¿‡é…ç½®è·¯å¾„ `basePackage=cn.bugstack.springframework.test.bean`ï¼Œè§£æå‡º classes ä¿¡æ¯çš„å·¥å…·æ–¹æ³• findCandidateComponentsï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ‰«æåˆ°æ‰€æœ‰ @Component æ³¨è§£çš„ Bean å¯¹è±¡äº†ã€‚

**cn.bugstack.springframework.context.annotation.ClassPathBeanDefinitionScanner** 

```java
public class ClassPathBeanDefinitionScanner extends ClassPathScanningCandidateComponentProvider {

    private BeanDefinitionRegistry registry;

    public ClassPathBeanDefinitionScanner(BeanDefinitionRegistry registry) {
        this.registry = registry;
    }

    public void doScan(String... basePackages) {
        for (String basePackage : basePackages) {
            Set<BeanDefinition> candidates = findCandidateComponents(basePackage);
            for (BeanDefinition beanDefinition : candidates) {
                // è§£æ Bean çš„ä½œç”¨åŸŸ singletonã€prototype
                String beanScope = resolveBeanScope(beanDefinition);
                if (StrUtil.isNotEmpty(beanScope)) {
                    beanDefinition.setScope(beanScope);
                }
                registry.registerBeanDefinition(determineBeanName(beanDefinition), beanDefinition);
            }
        }
    }

    private String resolveBeanScope(BeanDefinition beanDefinition) {
        Class<?> beanClass = beanDefinition.getBeanClass();
        Scope scope = beanClass.getAnnotation(Scope.class);
        if (null != scope) return scope.value();
        return StrUtil.EMPTY;
    }

    private String determineBeanName(BeanDefinition beanDefinition) {
        Class<?> beanClass = beanDefinition.getBeanClass();
        Component component = beanClass.getAnnotation(Component.class);
        String value = component.value();
        if (StrUtil.isEmpty(value)) {
            value = StrUtil.lowerFirst(beanClass.getSimpleName());
        }
        return value;
    }

}
```

- ClassPathBeanDefinitionScanner æ˜¯ç»§æ‰¿è‡ª ClassPathScanningCandidateComponentProvider çš„å…·ä½“æ‰«æåŒ…å¤„ç†çš„ç±»ï¼Œåœ¨ doScan ä¸­é™¤äº†è·å–åˆ°æ‰«æçš„ç±»ä¿¡æ¯ä»¥åï¼Œè¿˜éœ€è¦è·å– Bean çš„ä½œç”¨åŸŸå’Œç±»åï¼Œå¦‚æœä¸é…ç½®ç±»ååŸºæœ¬éƒ½æ˜¯æŠŠé¦–å­—æ¯ç¼©å†™ã€‚

### 5. è§£æxmlä¸­è°ƒç”¨æ‰«æ

**cn.bugstack.springframework.beans.factory.xml.XmlBeanDefinitionReader**

```java
public class XmlBeanDefinitionReader extends AbstractBeanDefinitionReader {

    protected void doLoadBeanDefinitions(InputStream inputStream) throws ClassNotFoundException, DocumentException {
        SAXReader reader = new SAXReader();
        Document document = reader.read(inputStream);
        Element root = document.getRootElement();

        // è§£æ context:component-scan æ ‡ç­¾ï¼Œæ‰«æåŒ…ä¸­çš„ç±»å¹¶æå–ç›¸å…³ä¿¡æ¯ï¼Œç”¨äºç»„è£… BeanDefinition
        Element componentScan = root.element("component-scan");
        if (null != componentScan) {
            String scanPath = componentScan.attributeValue("base-package");
            if (StrUtil.isEmpty(scanPath)) {
                throw new BeansException("The value of base-package attribute can not be empty or null");
            }
            scanPackage(scanPath);
        }
       
        // ... çœç•¥å…¶ä»–
            
        // æ³¨å†Œ BeanDefinition
        getRegistry().registerBeanDefinition(beanName, beanDefinition);
    }

    private void scanPackage(String scanPath) {
        String[] basePackages = StrUtil.splitToArray(scanPath, ',');
        ClassPathBeanDefinitionScanner scanner = new ClassPathBeanDefinitionScanner(getRegistry());
        scanner.doScan(basePackages);
    }

}
```

- å…³äº XmlBeanDefinitionReader ä¸­ä¸»è¦æ˜¯åœ¨åŠ è½½é…ç½®æ–‡ä»¶åï¼Œå¤„ç†æ–°å¢çš„è‡ªå®šä¹‰é…ç½®å±æ€§ `component-scan`ï¼Œè§£æåè°ƒç”¨ scanPackage æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ ClassPathBeanDefinitionScanner#doScan åŠŸèƒ½ã€‚
- å¦å¤–è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¸ºäº†å¯ä»¥æ–¹ä¾¿çš„åŠ è½½å’Œè§£æxmlï¼ŒXmlBeanDefinitionReader å·²ç»å…¨éƒ¨æ›¿æ¢ä¸º dom4j çš„æ–¹å¼è¿›è¡Œè§£æå¤„ç†ã€‚ 

## äº”ã€æµ‹è¯•

### 1. äº‹å…ˆå‡†å¤‡

```java
@Component("userService")
public class UserService implements IUserService {

    private String token;

    public String queryUserInfo() {
        try {
            Thread.sleep(new Random(1).nextInt(100));
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return "å°å‚…å“¥ï¼Œ100001ï¼Œæ·±åœ³";
    }

    public String register(String userName) {
        try {
            Thread.sleep(new Random(1).nextInt(100));
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        return "æ³¨å†Œç”¨æˆ·ï¼š" + userName + " successï¼";
    }

    @Override
    public String toString() {
        return "UserService#token = { " + token + " }";
    }

    public String getToken() {
        return token;
    }

    public void setToken(String token) {
        this.token = token;
    }
}
```

- ç»™ UserService ç±»æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ `@Component("userService")` å’Œä¸€ä¸ªå±æ€§ä¿¡æ¯ `String token`ã€‚è¿™æ˜¯ä¸ºäº†åˆ†åˆ«æµ‹è¯•åŒ…æ‰«æå’Œå ä½ç¬¦å±æ€§ã€‚

### 2. å±æ€§é…ç½®æ–‡ä»¶

```java
token=RejDlI78hu223Opo983Ds
```

- è¿™é‡Œé…ç½®ä¸€ä¸ª token çš„å±æ€§ä¿¡æ¯ï¼Œç”¨äºé€šè¿‡å ä½ç¬¦çš„æ–¹å¼è¿›è¡Œè·å–

### 3. spring.xml é…ç½®å¯¹è±¡

**spring-property.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
	         http://www.springframework.org/schema/beans/spring-beans.xsd
		 http://www.springframework.org/schema/context">

    <bean class="cn.bugstack.springframework.beans.factory.PropertyPlaceholderConfigurer">
        <property name="location" value="classpath:token.properties"/>
    </bean>

    <bean id="userService" class="cn.bugstack.springframework.test.bean.UserService">
        <property name="token" value="${token}"/>
    </bean>

</beans>
```

- åŠ è½½ `classpath:token.properties` è®¾ç½®å ä½ç¬¦å±æ€§å€¼ `${token}` 

**spring-scan.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
	         http://www.springframework.org/schema/beans/spring-beans.xsd
		 http://www.springframework.org/schema/context">

    <context:component-scan base-package="cn.bugstack.springframework.test.bean"/>

</beans>
```

- æ·»åŠ  `component-scan` å±æ€§ï¼Œè®¾ç½®åŒ…æ‰«ææ ¹è·¯å¾„

### 4. å•å…ƒæµ‹è¯•(å ä½ç¬¦)

```java
@Test
public void test_property() {
    ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:spring-property.xml");
    IUserService userService = applicationContext.getBean("userService", IUserService.class);
    System.out.println("æµ‹è¯•ç»“æœï¼š" + userService);
}
```

**æµ‹è¯•ç»“æœ**

```java
æµ‹è¯•ç»“æœï¼šUserService#token = { RejDlI78hu223Opo983Ds }

Process finished with exit code 0
```

- é€šè¿‡æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ° UserService ä¸­çš„ token å±æ€§å·²ç»é€šè¿‡å ä½ç¬¦çš„æ–¹å¼è®¾ç½®è¿›å»é…ç½®æ–‡ä»¶é‡Œçš„ `token.properties` çš„å±æ€§å€¼äº†ã€‚

### 5. å•å…ƒæµ‹è¯•(åŒ…æ‰«æ)

```java
@Test
public void test_scan() {
    ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:spring-scan.xml");
    IUserService userService = applicationContext.getBean("userService", IUserService.class);
    System.out.println("æµ‹è¯•ç»“æœï¼š" + userService.queryUserInfo());
}
```

**æµ‹è¯•ç»“æœ**

```java
æµ‹è¯•ç»“æœï¼šå°å‚…å“¥ï¼Œ100001ï¼Œæ·±åœ³

Process finished with exit code 0
```

- é€šè¿‡è¿™ä¸ªæµ‹è¯•ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œç°åœ¨ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å°±å¯ä»¥è®© Class æ³¨å†Œå®Œæˆ Bean å¯¹è±¡äº†ã€‚

## å…­ã€æ€»ç»“

- é€šè¿‡æ•´ç¯‡çš„å†…å®¹å®ç°å¯ä»¥çœ‹å‡ºæ¥ï¼Œç›®å‰çš„åŠŸèƒ½æ·»åŠ å…¶å®å·²ç»ä¸å¤æ‚äº†ï¼Œéƒ½æ˜¯åœ¨ IOC å’Œ AOP æ ¸å¿ƒçš„åŸºç¡€ä¸Šæ¥è¡¥å…¨åŠŸèƒ½ã€‚è¿™äº›è¡¥å…¨çš„åŠŸèƒ½ä¹Ÿæ˜¯åœ¨å®Œå–„ Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®©æ•´ä¸ªåŠŸèƒ½ä½¿ç”¨ä¹Ÿè¶Šæ¥è¶Šå®¹æ˜“ã€‚
- åœ¨ä½ ä¸æ–­çš„å®ç°ç€ Spring çš„å„é¡¹åŠŸèƒ½æ—¶ï¼Œä¹Ÿå¯ä»¥æŠŠè‡ªå·±åœ¨å¹³å¸¸ä½¿ç”¨ Spring çš„ä¸€äº›åŠŸèƒ½æƒ³æ³•èå…¥è¿›æ¥ï¼Œæ¯”å¦‚åƒ Spring æ˜¯å¦‚ä½•åŠ¨æ€åˆ‡æ¢æ•°æ®æºçš„ï¼Œçº¿ç¨‹æ± æ˜¯æ€ä¹ˆæä¾›é…ç½®çš„ï¼Œè¿™äº›å†…å®¹è™½ç„¶ä¸æ˜¯æœ€åŸºç¡€çš„æ ¸å¿ƒèŒƒå›´ï¼Œä½†ä¹Ÿéå¸¸é‡è¦ã€‚
- å¯èƒ½æœ‰äº›æ—¶å€™è¿™äº›ç±»å®ç°çš„å†…å®¹å¯¹æ–°äººæ¥è¯´æ¯”è¾ƒå¤šï¼Œå¯ä»¥ä¸€ç‚¹ç‚¹åŠ¨æ‰‹å®ç°é€æ­¥ç†è§£ï¼Œåœ¨æŠŠä¸€äº›ç¨å¾®è¾ƒæœ‰éš¾åº¦çš„å†…å®¹å®ç°åï¼Œå…¶å®åé¢ä¹Ÿå°±æ²¡æœ‰é‚£ä¹ˆéš¾ç†è§£äº†ã€‚

## ä¸ƒã€ä¼˜ç§€ä½œä¸š

- [åˆ©ç”¨è‡ªå®šä¹‰æ³¨è§£ å®ç°Beançš„è‡ªåŠ¨åŒ–æ‰«ææ³¨å†Œ @Rechie](https://t.zsxq.com/05ZjYbyJA)
- [è§£å†³åŒ…æ‰«æé—®é¢˜ä»¥åŠ${}å­—ç¬¦æ˜ å°„ @Chin](https://t.zsxq.com/06URR3ZBq)
- [ç›®å‰éœ€è¦åœ¨spring.xmlä¸­é…ç½®<bean>ï¼Œæ‰å¯ä»¥ä½¿ç”¨ä½¿ç”¨Springå®¹å™¨å®ŒæˆBeançš„ç”Ÿå‘½å‘¨æœŸ @liuc](https://t.zsxq.com/089S6Zf5P)
- [è¿™ä¸€ç« èŠ‚æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯è¿›ä¸€æ­¥ç®€åŒ–é…ç½®æ–‡ä»¶æ“ä½œï¼Œæ‰«ææŒ‡å®šè·¯å¾„å¹¶é€šè¿‡æ³¨è§£å®Œæˆ Bean çš„æ³¨å†Œã€‚ @Homage](https://t.zsxq.com/08gaH0bTk)
- [åœ¨å®ç°è‡ªåŠ¨æ‰«æå¸¦ @Component æ³¨è§£çš„å¯¹è±¡è‡ªåŠ¨è£…é…å’Œæ³¨å†Œçš„åŸºç¡€ä¸Šï¼Œé¢å¯ä»¥ä½¿ç”¨ @Autowiredã€@Value æ³¨è§£ï¼Œå®Œæˆå¯¹å±æ€§å’Œå¯¹è±¡çš„æ³¨å…¥æ“ä½œã€‚@æ°´ä¸­ææœˆ](https://t.zsxq.com/084AWdKED)
- [åœ¨åˆ›å»º Bean å¯¹è±¡ä¹‹å‰ï¼Œè¦å…ˆè·å–åˆ° Bean çš„å±æ€§ä¿¡æ¯ç»„è£…æˆ BeanDefinition @lucien](https://t.zsxq.com/0bb6gydsQ)