---
title: ç¬¬18ç« ï¼šæ•°æ®ç±»å‹è½¬æ¢å·¥å‚è®¾è®¡å®ç°
lock: need
---

# ç¬¬18ç« ï¼šæŒ‚å°å°åˆ€ï¼Œæ•°æ®ç±»å‹è½¬æ¢å·¥å‚è®¾è®¡å®ç°

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>æ˜Ÿçƒï¼š[https://articles.zsxq.com/id_d0cpbs31880x.html](https://articles.zsxq.com/id_d0cpbs31880x.html)

> æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## é›¶ã€ä¼˜ç§€ä½œä¸š

- [ç±»å‹è½¬æ¢æœºåˆ¶è®¾è®¡ @Rechie](https://t.zsxq.com/06jiAub2n)
- [Spring å…¨æ ¸å¿ƒç±»å›¾æ€»ç»“ @NibNait](https://t.zsxq.com/07vFe2vJ6)
- [é€æ¸å®Œå–„Springå…¨ä½“ç³»æµç¨‹å›¾ @Alex](https://t.zsxq.com/08YsTAwMZ)
- [ç±»å‹è½¬æ¢ä¹Ÿå°±æ˜¯æ•°æ®è½¬æ¢ï¼Œä» String è½¬ä¸º Integerã€String è½¬ä¸º Dateã€Double è½¬ä¸º Long éƒ½æ˜¯å¾ˆå¸¸ç”¨çš„åŠŸèƒ½ @æ°´ä¸­ææœˆ](https://t.zsxq.com/09SaqdeaX)

## ä¸€ã€å‰è¨€

`å€¼å¾—çš„ï¼Œæ€»æ˜¯åœ¨ç²¾é›•ç»†ç¢ï¼`

åœ¨ä½ å†™çš„ç¨‹åºå¼€å‘ä¸­ï¼Œä½ æœ‰ä¸ºä¸€ä¸ªç±»åã€æ–¹æ³•åã€å±æ€§åï¼Œåå¤æ–Ÿé…Œå—ï¼Ÿä»£ç æ ¼å¼é—´éš”å¤§å°ã€ç¼–å†™æ–¹å¼ã€æ³¨é‡Šæè¿°ä¸æ–­çš„æå‡å—ï¼Ÿä½ æœ‰ä¸ºä¸€ä¸ªåŠŸèƒ½é€»è¾‘çš„å®ç°ä¸æ–­çš„é‡æ„å—ï¼Ÿ**æˆ‘æœ‰ï¼Œæˆ‘ä¸€ç›´éƒ½æœ‰**ï¼Œä¸ºäº†èƒ½å†™å¥½ä¸€å—ä»£ç ï¼Œç”šè‡³ä¼šå¿˜è®°æ—¶é—´ä»ä¸Šåˆåˆ°ä¸‹åˆï¼Œå½“èƒ½å®ç°å®Œæˆåï¼Œä¼šæ¬£èµä¼¼çš„çœ‹å¾…è‡ªå·±çš„ä»£ç ï¼Œ*ä¹Ÿæ ¹æœ¬ä¸èˆå¾—æŠŠä»–äº¤ç»™åˆ«äºº*ï¼

å¦‚æœä½ ä¹Ÿæ˜¯è¿™æ ·çš„å·¥ç¨‹å¸ˆï¼Œå…¶å®åœ¨ä½ ä¸å»åˆ»æ„è¿½æ±‚å¤§å‚ã€é«˜è–ªã€å¥½èŒä½çš„æ—¶å€™ï¼Œä¹Ÿä¼šæŠŠä½ é€åˆ°é‚£ä¸ªä½ç½®ä¸Šå»ã€‚æƒ³ä¸è¢«è¿™ä¸ªå·²ç»æœ‰äº›å†…å·çš„è¡Œä¸šæ‰“ä¸‹å»ï¼Œé‚£ä¹ˆåŸºæœ¬å°±éœ€è¦é€‰æ‹©ä¸€æ¡èƒ½æ²‰æ·€ä¸‹æ¥æ ¸å¿ƒçŸ¥è¯†çš„è·¯å¾„æ¥æå‡è‡ªå·±ï¼Œåšå¥½é•¿æœŸè§„åˆ’ï¼Œè®©ä»¥åä½ çš„30å²æœ‰30å²çš„èƒ½åŠ›ï¼Œ35å²æœ‰35å²çš„ç»å†ï¼

## äºŒã€ç›®æ ‡

å…¶å®å®ç°åˆ°æœ¬ç« èŠ‚ï¼Œå…³äºIOCã€AOPåœ¨æ—¥å¸¸ä½¿ç”¨å’Œé¢è¯•ä¸­é«˜é¢‘å‡ºç°çš„æŠ€æœ¯ç‚¹éƒ½è¯¥æ¶µç›–äº†ã€‚é‚£ä¹ˆä¸ºäº†è¡¥å…¨æ•´ä¸ªæ¡†æ¶å†…å®¹çš„ç»“æ„ï¼Œæ–¹ä¾¿è¯»è€…åç»­åœ¨é˜…è¯» Spring æ—¶ä¸è‡³äºå¯¹`ç±»å‹è½¬æ¢`çš„çŸ¥è¯†ä½“ç³»é™Œç”Ÿï¼Œè¿™é‡Œå†æ·»åŠ ä¸€äº›å…³äºæ­¤ç±»çŸ¥è¯†çš„å®ç°ã€‚

ç±»å‹è½¬æ¢ä¹Ÿå¯ä»¥å«åšæ•°æ®è½¬æ¢ï¼Œæ¯”å¦‚ä»Stringåˆ°Integerã€ä»Stringåˆ°Dateã€ä»Dubboåˆ°Longç­‰ç­‰ï¼Œä½†è¿™äº›æ“ä½œä¸èƒ½åœ¨å·²ç»ä½¿ç”¨æ¡†æ¶çš„æƒ…å†µä¸‹è¿˜éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠè¿™æ ·çš„åŠŸèƒ½æ‰©å±•åˆ°Springæ¡†æ¶ä¸­ã€‚

## ä¸‰ã€è®¾è®¡

å¦‚æœæˆ‘ä»¬æ¥æŠŠåªæ˜¯çœ‹ä¸Šå»ä¸€ä¸ªç®€å•çš„ç±»å‹è½¬æ¢æ“ä½œæŠ½è±¡æˆæ¡†æ¶ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦ä¸€ä¸ªæ ‡å‡†çš„æ¥å£ï¼Œè°å®ç°è¿™ä¸ªæ¥å£å°±å…·å¤‡ç±»å‹è½¬æ¢çš„å…·ä½“å®ç°ï¼Œæä¾›ç±»å‹è½¬æ¢çš„èƒ½åŠ›ã€‚é‚£ä¹ˆåœ¨æœ‰äº†è¿™æ ·æ¥å£åï¼Œè¿˜éœ€è¦ç±»å‹è½¬æ¢æœåŠ¡çš„æ³¨å†Œã€å·¥å‚ç­‰å†…å®¹ï¼Œæ‰å¯ä»¥æŠŠç±»å‹è½¬æ¢æŠ½è±¡æˆä¸€ä¸ªç»„ä»¶æœåŠ¡ã€‚æ•´ä½“è®¾è®¡ç»“æ„å¦‚ä¸‹å›¾ï¼š

![](https://bugstack.cn/assets/images/spring/spring-18-01.png)

- é¦–å…ˆä»å·¥å‚å‡ºå‘æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª `ConversionServiceFactoryBean` æ¥å¯¹ç±»å‹è½¬æ¢æœåŠ¡è¿›è¡Œæ“ä½œã€‚
- è€Œå®ç°ç±»å‹è½¬æ¢çš„æœåŠ¡ï¼Œéœ€è¦å®šä¹‰ `Converter` è½¬æ¢ç±»å‹ã€`ConverterRegistry` æ³¨å†Œç±»å‹è½¬æ¢åŠŸèƒ½ï¼Œå¦å¤–è½¬æ¢ç±»å‹çš„æ“ä½œè¾ƒå¤šï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¼šéœ€è¦å®šä¹‰ä¸€ä¸ªç±»å‹è½¬æ¢å·¥å‚ `ConverterFactory` å„ä¸ªå…·ä½“çš„è½¬æ¢æ“ä½œæ¥å®ç°è¿™ä¸ªå·¥å‚æ¥å£ã€‚

## å››ã€å®ç°

### 1. å·¥ç¨‹ç»“æ„

```java
small-spring-step-17
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ cn.bugstack.springframework
    â”‚           â”œâ”€â”€ aop
    â”‚           â”‚   â”œâ”€â”€ aspectj
    â”‚           â”‚   â”‚   â””â”€â”€ AspectJExpressionPointcut.java
    â”‚           â”‚   â”‚   â””â”€â”€ AspectJExpressionPointcutAdvisor.java
    â”‚           â”‚   â”œâ”€â”€ framework 
    â”‚           â”‚   â”‚   â”œâ”€â”€ adapter
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ MethodBeforeAdviceInterceptor.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ autoproxy
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ MethodBeforeAdviceInterceptor.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ AopProxy.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ Cglib2AopProxy.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ JdkDynamicAopProxy.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ProxyFactory.java
    â”‚           â”‚   â”‚   â””â”€â”€ ReflectiveMethodInvocation.java
    â”‚           â”‚   â”œâ”€â”€ AdvisedSupport.java
    â”‚           â”‚   â”œâ”€â”€ Advisor.java
    â”‚           â”‚   â”œâ”€â”€ BeforeAdvice.java
    â”‚           â”‚   â”œâ”€â”€ ClassFilter.java
    â”‚           â”‚   â”œâ”€â”€ MethodBeforeAdvice.java
    â”‚           â”‚   â”œâ”€â”€ MethodMatcher.java
    â”‚           â”‚   â”œâ”€â”€ Pointcut.java
    â”‚           â”‚   â”œâ”€â”€ PointcutAdvisor.java
    â”‚           â”‚   â””â”€â”€ TargetSource.java
    â”‚           â”œâ”€â”€ beans
    â”‚           â”‚   â”œâ”€â”€ factory  
    â”‚           â”‚   â”‚   â”œâ”€â”€ annotation
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ Autowired.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AutowiredAnnotationBeanPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ Qualifier.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ Value.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ config
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AutowireCapableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinition.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanFactoryPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanReference.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigurableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ InstantiationAwareBeanPostProcessor.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ SingletonBeanRegistry.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractAutowireCapableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractBeanDefinitionReader.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ AbstractBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinitionReader.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ BeanDefinitionRegistry.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ CglibSubclassingInstantiationStrategy.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultListableBeanFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultSingletonBeanRegistry.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DisposableBeanAdapter.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ FactoryBeanRegistrySupport.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ InstantiationStrategy.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ SimpleInstantiationStrategy.java  
    â”‚           â”‚   â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ XmlBeanDefinitionReader.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ Aware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanClassLoaderAware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanFactoryAware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ BeanNameAware.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ConfigurableListableBeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ DisposableBean.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ FactoryBean.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ HierarchicalBeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ InitializingBean.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ListableBeanFactory.java
    â”‚           â”‚   â”‚   â”œâ”€â”€ ObjectFactory.java
    â”‚           â”‚   â”‚   â””â”€â”€ PropertyPlaceholderConfigurer.java
    â”‚           â”‚   â”œâ”€â”€ BeansException.java
    â”‚           â”‚   â”œâ”€â”€ PropertyValue.java
    â”‚           â”‚   â””â”€â”€ PropertyValues.java 
    â”‚           â”œâ”€â”€ context
    â”‚           â”‚   â”œâ”€â”€ annotation
    â”‚           â”‚   â”‚   â”œâ”€â”€ ClassPathBeanDefinitionScanner.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ClassPathScanningCandidateComponentProvider.java 
    â”‚           â”‚   â”‚   â””â”€â”€ Scope.java 
    â”‚           â”‚   â”œâ”€â”€ event
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractApplicationEventMulticaster.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ApplicationContextEvent.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ApplicationEventMulticaster.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ContextClosedEvent.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ContextRefreshedEvent.java 
    â”‚           â”‚   â”‚   â””â”€â”€ SimpleApplicationEventMulticaster.java 
    â”‚           â”‚   â”œâ”€â”€ support
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractApplicationContext.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractRefreshableApplicationContext.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ AbstractXmlApplicationContext.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ApplicationContextAwareProcessor.java 
    â”‚           â”‚   â”‚   â”œâ”€â”€ ClassPathXmlApplicationContext.java 
    â”‚           â”‚   â”‚   â””â”€â”€ ConversionServiceFactoryBean.java     
    â”‚           â”‚   â”œâ”€â”€ ApplicationContext.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationContextAware.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationEvent.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationEventPublisher.java 
    â”‚           â”‚   â”œâ”€â”€ ApplicationListener.java 
    â”‚           â”‚   â””â”€â”€ ConfigurableApplicationContext.java
    â”‚           â”œâ”€â”€ core
    â”‚           â”‚   â”œâ”€â”€ convert
    â”‚           â”‚   â”‚   â”œâ”€â”€ converter
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ Converter.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ConverterFactory.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ ConverterRegistry.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ GenericConverter.java    
    â”‚           â”‚   â”‚   â”œâ”€â”€ support  
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ DefaultConversionService.java
    â”‚           â”‚   â”‚   â”‚   â”œâ”€â”€ GenericConversionService.java
    â”‚           â”‚   â”‚   â”‚   â””â”€â”€ StringToNumberConverterFactory.java      
    â”‚           â”‚   â”‚   â””â”€â”€ ConversionService.java     
    â”‚           â”‚   â””â”€â”€ io    
    â”‚           â”‚   	  â”œâ”€â”€ ClassPathResource.java 
    â”‚           â”‚       â”œâ”€â”€ DefaultResourceLoader.java 
    â”‚           â”‚       â”œâ”€â”€ FileSystemResource.java 
    â”‚           â”‚       â”œâ”€â”€ Resource.java 
    â”‚           â”‚       â”œâ”€â”€ ResourceLoader.java
    â”‚           â”‚       â””â”€â”€ UrlResource.java
    â”‚           â”œâ”€â”€ stereotype
    â”‚           â”‚   â””â”€â”€ Component.java
    â”‚           â””â”€â”€ utils
    â”‚               â”œâ”€â”€ ClassUtils.java
    â”‚               â””â”€â”€ StringValueResolver.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ cn.bugstack.springframework.test
                â”œâ”€â”€ bean
                â”‚   â””â”€â”€ Husband.java
                â”œâ”€â”€ bean
                â”‚   â”œâ”€â”€ ConvertersFactoryBean.java
                â”‚   â”œâ”€â”€ StringToIntegerConverter.java  
                â”‚   â””â”€â”€ StringToLocalDateConverter.java  
                â””â”€â”€ ApiTest.java
```

**å·¥ç¨‹æºç **ï¼š`å…¬ä¼—å·ã€Œbugstackè™«æ´æ ˆã€ï¼Œå›å¤ï¼šSpring ä¸“æ ï¼Œè·å–å®Œæ•´æºç `

### 2. å®šä¹‰ç±»å‹è½¬æ¢æ¥å£

**åŒ…ï¼šcn.bugstack.springframework.core.convert.converter**

**ç±»å‹è½¬æ¢å¤„ç†æ¥å£**

```java
public interface Converter<S, T>  {

    /** Convert the source object of type {@code S} to target type {@code T}. */
    T convert(S source);

}
```

**ç±»å‹è½¬æ¢å·¥å‚**

```java
public interface ConverterFactory<S, R>{

    /**
     * Get the converter to convert from S to target type T, where T is also an instance of R.
     * @param <T> the target type
     * @param targetType the target type to convert to
     * @return a converter from S to T
     */
    <T extends R> Converter<S, T> getConverter(Class<T> targetType);

}
```

**ç±»å‹è½¬æ¢æ³¨å†Œæ¥å£**

```java
public interface ConverterRegistry {

    /**
     * Add a plain converter to this registry.
     * The convertible source/target type pair is derived from the Converter's parameterized types.
     * @throws IllegalArgumentException if the parameterized types could not be resolved
     */
    void addConverter(Converter<?, ?> converter);

    /**
     * Add a generic converter to this registry.
     */
    void addConverter(GenericConverter converter);

    /**
     * Add a ranged converter factory to this registry.
     * The convertible source/target type pair is derived from the ConverterFactory's parameterized types.
     * @throws IllegalArgumentException if the parameterized types could not be resolved
     */
    void addConverterFactory(ConverterFactory<?, ?> converterFactory);

}
```

- Converterã€ConverterFactoryã€ConverterRegistryï¼Œéƒ½æ˜¯ç”¨äºå®šä¹‰ç±»å‹è½¬æ¢æ“ä½œçš„ç›¸å…³æ¥å£ï¼Œåç»­æ‰€æœ‰çš„å®ç°éƒ½éœ€è¦å›´ç»•è¿™äº›æ¥å£æ¥å®ç°ï¼Œå…·ä½“çš„ä»£ç åŠŸèƒ½å¯ä»¥è¿›è¡Œè°ƒè¯•éªŒè¯ã€‚

### 3. å®ç°ç±»å‹è½¬æ¢æœåŠ¡

**cn.bugstack.springframework.core.convert.support.DefaultConversionService**

```java
public class DefaultConversionService extends GenericConversionService{

    public DefaultConversionService() {
        addDefaultConverters(this);
    }

    public static void addDefaultConverters(ConverterRegistry converterRegistry) {
        // æ·»åŠ å„ç±»ç±»å‹è½¬æ¢å·¥å‚
        converterRegistry.addConverterFactory(new StringToNumberConverterFactory());
    }

}
```

- DefaultConversionService æ˜¯ç»§æ‰¿ GenericConversionService çš„å®ç°ç±»ï¼Œè€Œ GenericConversionService å®ç°äº† ConversionService, ConverterRegistry ä¸¤ä¸ªæ¥å£ï¼Œç”¨äº canConvert åˆ¤æ–­å’Œè½¬æ¢æ¥å£ convert æ“ä½œã€‚

### 4. åˆ›å»ºç±»å‹è½¬æ¢å·¥å‚

**cn.bugstack.springframework.context.support.ConversionServiceFactoryBean**

```java
public class ConversionServiceFactoryBean implements FactoryBean<ConversionService>, InitializingBean {

    @Nullable
    private Set<?> converters;

    @Nullable
    private GenericConversionService conversionService;

    @Override
    public ConversionService getObject() throws Exception {
        return conversionService;
    }

    @Override
    public Class<?> getObjectType() {
        return conversionService.getClass();
    }

    @Override
    public boolean isSingleton() {
        return true;
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        this.conversionService = new DefaultConversionService();
        registerConverters(converters, conversionService);
    }

    private void registerConverters(Set<?> converters, ConverterRegistry registry) {
        if (converters != null) {
            for (Object converter : converters) {
                if (converter instanceof GenericConverter) {
                    registry.addConverter((GenericConverter) converter);
                } else if (converter instanceof Converter<?, ?>) {
                    registry.addConverter((Converter<?, ?>) converter);
                } else if (converter instanceof ConverterFactory<?, ?>) {
                    registry.addConverterFactory((ConverterFactory<?, ?>) converter);
                } else {
                    throw new IllegalArgumentException("Each converter object must implement one of the " +
                            "Converter, ConverterFactory, or GenericConverter interfaces");
                }
            }
        }
    }

    public void setConverters(Set<?> converters) {
        this.converters = converters;
    }

}
```

- æœ‰äº† FactoryBean çš„å®ç°å°±å¯ä»¥å®Œæˆå·¥ç¨‹å¯¹è±¡çš„æ“ä½œï¼Œå¯ä»¥æä¾›å‡ºè½¬æ¢å¯¹è±¡çš„æœåŠ¡ GenericConversionServiceï¼Œå¦å¤–åœ¨ afterPropertiesSet ä¸­è°ƒç”¨äº†æ³¨å†Œè½¬æ¢æ“ä½œçš„ç±»ã€‚æœ€ç»ˆè¿™ä¸ªç±»ä¼šè¢«é…ç½®åˆ° spring.xml ä¸­åœ¨å¯åŠ¨çš„è¿‡ç¨‹åŠ è½½ã€‚

### 5. ç±»å‹è½¬æ¢æœåŠ¡ä½¿ç”¨

**cn.bugstack.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory**

```java
protected void applyPropertyValues(String beanName, Object bean, BeanDefinition beanDefinition) {
    try {
        PropertyValues propertyValues = beanDefinition.getPropertyValues();
        for (PropertyValue propertyValue : propertyValues.getPropertyValues()) {
            String name = propertyValue.getName();
            Object value = propertyValue.getValue();
            if (value instanceof BeanReference) {
                // A ä¾èµ– Bï¼Œè·å– B çš„å®ä¾‹åŒ–
                BeanReference beanReference = (BeanReference) value;
                value = getBean(beanReference.getBeanName());
            }
            // ç±»å‹è½¬æ¢
            else {
                Class<?> sourceType = value.getClass();
                Class<?> targetType = (Class<?>) TypeUtil.getFieldType(bean.getClass(), name);
                ConversionService conversionService = getConversionService();
                if (conversionService != null) {
                    if (conversionService.canConvert(sourceType, targetType)) {
                        value = conversionService.convert(value, targetType);
                    }
                }
            }
            // åå°„è®¾ç½®å±æ€§å¡«å……
             BeanUtil.setFieldValue(bean, name, value);
        }
    } catch (Exception e) {
        throw new BeansException("Error setting property valuesï¼š" + beanName + " messageï¼š" + e);
    }
}
```

- åœ¨ AbstractAutowireCapableBeanFactory#applyPropertyValues å¡«å……å±æ€§çš„æ“ä½œä¸­ï¼Œå…·ä½“ä½¿ç”¨äº†ç±»å‹è½¬æ¢çš„åŠŸèƒ½ã€‚
- åœ¨ AutowiredAnnotationBeanPostProcessor#postProcessPropertyValues ä¹Ÿæœ‰åŒæ ·çš„å±æ€§ç±»å‹è½¬æ¢æ“ä½œã€‚

## äº”ã€æµ‹è¯•

### 1. äº‹å…ˆå‡†å¤‡

```java
public class Husband {

    private String wifiName;

    private Date marriageDate; // æ·»åŠ ä¸€ä¸ªæ—¥æœŸç±»çš„è½¬æ¢æ“ä½œ
 		
    // ... get/set
}    
```

**è½¬æ¢æ—¶é—´çš„æ“ä½œç±»**

```java
public class StringToLocalDateConverter implements Converter<String, LocalDate> {

	private final DateTimeFormatter DATE_TIME_FORMATTER;

	public StringToLocalDateConverter(String pattern) {
		DATE_TIME_FORMATTER = DateTimeFormatter.ofPattern(pattern);
	}

	@Override
	public LocalDate convert(String source) {
		return LocalDate.parse(source, DATE_TIME_FORMATTER);
	}

}
```

- Husband æ˜¯ä¸€ä¸ªåŸºç¡€å¯¹è±¡ç±»è®¾ç½®äº†æ—¶é—´å±æ€§ï¼Œä¹‹åå†æ·»åŠ ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œç”¨äºè½¬æ¢æ—¶é—´ä¿¡æ¯ã€‚

### 2. å±æ€§é…ç½®æ–‡ä»¶

**spring.xml**

```xml
<bean id="husband" class="cn.bugstack.springframework.test.bean.Husband">
    <property name="wifiName" value="ä½ çŒœ"/>
    <property name="marriageDate" value="2021-08-08"/>
</bean>

<bean id="conversionService" class="cn.bugstack.springframework.context.support.ConversionServiceFactoryBean">
    <property name="converters" ref="converters"/>
</bean>

<bean id="converters" class="cn.bugstack.springframework.test.converter.ConvertersFactoryBean"/>
```

- é…ç½®åŸºç¡€Beanå¯¹è±¡ï¼Œè®¾ç½®å±æ€§çš„æ—¥æœŸï¼ŒåŒæ—¶å†æ·»åŠ ç±»å‹è½¬æ¢çš„æœåŠ¡å’Œè‡ªå·±å®ç°çš„ `ConvertersFactoryBean`

### 3. å•å…ƒæµ‹è¯•

```java
@Test
public void test_convert() {
    ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("classpath:spring.xml");
    Husband husband = applicationContext.getBean("husband", Husband.class);
    System.out.println("æµ‹è¯•ç»“æœï¼š" + husband);
}

@Test
public void test_StringToIntegerConverter() {
    StringToIntegerConverter converter = new StringToIntegerConverter();
    Integer num = converter.convert("1234");
    System.out.println("æµ‹è¯•ç»“æœï¼š" + num);
}

@Test
public void test_StringToNumberConverterFactory() {
    StringToNumberConverterFactory converterFactory = new StringToNumberConverterFactory();
    Converter<String, Integer> stringToIntegerConverter = converterFactory.getConverter(Integer.class);
    System.out.println("æµ‹è¯•ç»“æœï¼š" + stringToIntegerConverter.convert("1234"));
    Converter<String, Long> stringToLongConverter = converterFactory.getConverter(Long.class);
    System.out.println("æµ‹è¯•ç»“æœï¼š" + stringToLongConverter.convert("1234"));
}
```

**æµ‹è¯•ç»“æœ**

```java
æµ‹è¯•ç»“æœï¼šHusband{wifiName='ä½ çŒœ', marriageDate=Sun Aug 08 00:00:00 CST 2021}

Process finished with exit code 0
```

- è¿™ä¸ªæµ‹è¯•å†…å®¹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¯ä»¥è‡ªè¡ŒéªŒè¯ç»“æœï¼Œè™½ç„¶æœ€ç»ˆçš„ç»“æœçœ‹ä¸Šå»æ¯”è¾ƒç®€å•ï¼Œä½†æ•´ä¸ªæ¡†æ¶ç»“æ„å®ç°è®¾è®¡è¿˜æ˜¯è›®å¤æ‚çš„ï¼ŒæŠŠè¿™ä¹ˆä¸€ä¸ªè½¬æ¢æ“ä½œæŠ½è±¡ä¸ºæ¥å£é€‚é…ã€å·¥å‚æ¨¡å‹ç­‰æ–¹å¼ï¼Œè¿˜æ˜¯å¾ˆå€¼å¾—å€Ÿé‰´çš„ã€‚

## å…­ã€æ€»ç»“

- æœ¬ç« èŠ‚å®ç°çš„ç±»å‹è½¬æ¢æ“ä½œå¦‚æœåªæ˜¯åŠŸèƒ½æ€§çš„å¼€å‘ï¼Œå°±åƒä½ è‡ªå·±æ‰¿æ¥çš„éœ€æ±‚é‚£æ ·ï¼Œå¯èƒ½åªæ˜¯ç®€å•çš„ifåˆ¤æ–­å°±æå®šäº†ï¼Œä½†æ”¾åœ¨ä¸€ä¸ªæˆç†Ÿçš„æ¡†æ¶è¦ä¸­è¦è€ƒè™‘çš„æ˜¯å¯å¤ç”¨æ€§ã€å¯æ‰©å±•æ€§ï¼Œæ‰€ä»¥ä¼šçœ‹åˆ°æ¥å£çš„å®šä¹‰ã€å·¥å‚çš„ä½¿ç”¨ç­‰ç­‰è®¾è®¡æ¨¡å¼åœ¨è¿™é‡Œä½“ç°ã€‚
- æœ€åéå¸¸æ„Ÿè°¢ä½ èƒ½åšæŒå­¦ä¹ åˆ°è¿™ä¸ªç« èŠ‚ï¼Œå¦‚æœä½ åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¹Ÿæ˜¯æ¯ä¸€ä¸ªç« èŠ‚éƒ½æ˜¯å¯¹ç€æ–‡ç« ã€å†™ç€ä»£ç ä»£ç ã€è°ƒè¯•ç€bugï¼Œæ„Ÿæ‚Ÿç€è®¾è®¡ï¼Œé‚£ä¹ˆä½ ä¸€å®šä¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¾—åˆ°å¾ˆå¤šå¾ˆå¤šï¼Œä»¥åå†é˜…è¯»Springçš„æºç ä¹Ÿå°±ä¸ä¼šæ„Ÿè§‰é‚£ä¹ˆéš¾äº†ã€‚

