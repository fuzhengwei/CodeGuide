---
title: ç¬¬7èŠ‚ï¼šé€šè¿‡Inspectionæœºåˆ¶ï¼Œå¯¹é™æ€ä»£ç å®‰å…¨å®¡æŸ¥
lock: need
---

# ã€ŠIntelliJ IDEA æ’ä»¶å¼€å‘ã€‹ç¬¬7èŠ‚ï¼šé€šè¿‡Inspectionæœºåˆ¶ï¼Œå¯¹é™æ€ä»£ç å®‰å…¨å®¡æŸ¥

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`çœŸèƒ½é—¹ï¼Œæ€•å–‡å–‡è›„ï¼Œè¿˜ä¸ç§ç¨»å­äº†ï¼Ÿ`

å–‡å–‡è›„ï¼Œæ˜¯ä¸œåŒ—çš„ä¸€ç§å®³è™«ï¼Œç»å¸¸åœ¨ç§æ°´ç¨»çš„å­£èŠ‚ï¼Œåœ¨æ± åŸ‚å­ä¸Šç›—æ´ï¼Œå¯¼è‡´ç¨»ç”°é‡Œçš„æ°´æ‚„æ‚„çš„æµæ²¡äº†ï¼Œå½±å“ç¨»è‹—å‘è‚²ã€‚

åæ¥å‘ç°åŸæ¥å†™ä»£ç ï¼Œä¹Ÿèƒ½ç¢°è§â€œè²è²è›„â€ï¼Œæ— è®ºä½ å†™çš„æ˜¯ä»€ä¹ˆåŠŸèƒ½ã€å“ªç§æŠ€æœ¯ã€ä½œä½•ç›®çš„ï¼Œè²è²è›„æ€»èƒ½ç»™ç›—å‡ ä¸ªæ´å‡ºæ¥ã€‚â€œä½ è¿™å·²ç»æœ‰å…¶ä»–çš„æŸæŸäº†ä½ æ€ä¹ˆè¿˜é€ è½®å­â€ã€â€œä½ è¿™æ–¹æ¡ˆä¸è¡Œç¨‹åºå‘˜ä¸è¦æµªè´¹æ—¶é—´â€ã€â€œä¹Ÿæ²¡çœ‹å‡ºæ¥ä½ è¿™æœ‰å•¥ä¼˜åŠ¿å’Œä»·å€¼å‘€æ€ä¹ˆç»™ä¸šåŠ¡èµ‹èƒ½â€ï¼Œè¿™ç§è¯å¬ä¸Šå»â€œè´¼â€æœ‰é“ç†ï¼Œå¹çš„å®å½“çš„ï¼Œä½†è®©ä»–å»åšåˆèƒ½æçš„ç¨€çš„å›Šçš„ã€‚

æ‰€ä»¥ï¼Œè¿œç¦»è²è²è›„ï¼Œåšä½ æƒ³åšçš„ã€æä½ æƒ³æçš„ã€å­¦ä½ æƒ³å­¦çš„ï¼ŒçŸ¥è¯†æ˜¯ä¸æ–­æ²‰æ·€çš„ç§¯ç´¯ã€æ–¹æ¡ˆæ˜¯ç§¯ç´¯åçš„åˆ›é€ ã€‚

## äºŒã€éœ€æ±‚ç›®çš„

æ€ä¹ˆåŠï¼Œéƒ½æœ‰æ ‡å‡†çš„ç ”å‘è§„èŒƒï¼Œä½†è¿˜æ˜¯æ²¡æ³•æ§åˆ¶ä½åˆ°å…·ä½“çš„æ¯ä¸ªç ”å‘ä¸‹ï¼Œç»™å†™å‡ºä»€ä¹ˆä»£ç äº†ã€‚

æœ‰æ—¶å€™æ ‡å‡†åªæ˜¯æ–‡æ¡£ï¼Œçœ‹å’Œæ‰§è¡Œçš„è¿™ä¸ªè¿‡ç¨‹ä¸­å°±ä¼šä¸€å®šçš„è½¬è¡Œå¤±æ•ˆæ€§ï¼Œä½ å¯èƒ½ä¼šæƒ³åŠ æ‰‹æ®µï¼›è¯„å®¡ã€æ‰£é’±ã€ç½šç»©æ•ˆã€æ£€è®¨ç­‰ç­‰ï¼Œä½†è¿™æ ·å¯èƒ½è¿˜åªæ˜¯å¢åŠ è¿‡ç¨‹æˆæœ¬ï¼Œæœ€ç»ˆæ•ˆæœä¹Ÿä¸ä¼šå¤ªå¥½ã€‚ä¸å¤ªå¯èƒ½ä¸€ä¸ªå†™ä»£ç è¿˜å¾—é…ä¸€ä¸ªä¿å§†ï¼Œæ‰€ä»¥å°±åƒ p3cã€pmd-ideaï¼Œè¿™æ ·çš„æ’ä»¶å‡ºæ¥äº†ï¼Œå¸®åŠ©ç¨‹åºå‘˜æŠŠä»£ç å†™å¥½ï¼Œæ²»ç†æ‰ä¸€äº›ä¸åˆæ ‡å‡†çš„é—®é¢˜ä»£ç ã€‚

é‚£ä¹ˆï¼Œä½ å¥½å¥‡è¿™ä¸ªäº‹æ˜¯æ€ä¹ˆå¹²çš„å—ï¼Œæ€ä¹ˆä½ å°±åœ¨ IDEA å†™ä»£ç ï¼Œå®ƒå°±èƒ½ç»™ä½ æ£€æµ‹å‡ºæ¥ï¼Œå‘Šè¯‰ä½ æœ‰é—®é¢˜ï¼Œå¹¶æé†’ä½ ä¿®æ”¹ä»¥åŠæœ‰äº›è¿˜å¯ä»¥ä¸€é”®å¸®åŠ©ä½ ä¿®æ”¹å‘¢ï¼Ÿé‚£å¦‚æœä½ æƒ³å†å¢åŠ ç‚¹ä½ ä»¬å…¬å¸ä¸ªæ€§çš„è¦æ±‚çš„æ—¶å€™ï¼Œæ€ä¹ˆæ‰©å±•å‘¢ï¼Ÿ**æœ¬ç« èŠ‚æˆ‘ä»¬å°±ä½¿ç”¨ IDEA æ’ä»¶å¼€å‘èƒ½åŠ›ï¼ŒæŠŠè¿™ä¸ªäº‹åŠå–½**

## ä¸‰ã€æ¡ˆä¾‹å¼€å‘

### 1. å·¥ç¨‹ç»“æ„

```java
guide-idea-plugin-pmd
â”œâ”€â”€ .gradle
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚   	â””â”€â”€ cn.bugstack.guide.idea.plugin 
    â”‚       	â”œâ”€â”€ rule
    â”‚       	â”‚	â”œâ”€â”€ FastJsonAutoType.java
    â”‚       	â”‚	â”œâ”€â”€ HardcodedIp.java    
    â”‚       	â”‚	â””â”€â”€ ReplacePseudorandomGenerator.java         
    â”‚       	â””â”€â”€ utils   
    â”‚       	 	â””â”€â”€ InspectionBundle.java    
    â”œâ”€â”€ resources
    â”‚   â”œâ”€â”€ inspectionDescriptions
    â”‚   â”‚   â”œâ”€â”€ FastJsonAutoType.html
    â”‚   â”‚   â”œâ”€â”€ HardcodedIp.html  
    â”‚   â”‚   â””â”€â”€ ReplacePseudorandomGenerator.html   
    â”‚   â””â”€â”€ META-INF
    â”‚       â””â”€â”€ plugin.xml 
    â”œâ”€â”€ build.gradle  
    â””â”€â”€ gradle.properties
```

**æºç è·å–**ï¼š#å…¬ä¼—å·ï¼š`bugstackè™«æ´æ ˆ` å›å¤ï¼š`idea` å³å¯ä¸‹è½½å…¨éƒ¨ IDEA æ’ä»¶å¼€å‘æºç 

åœ¨æ­¤ IDEA æ’ä»¶å·¥ç¨‹ä¸­ï¼Œä¸»è¦åˆ†ä¸º3å—åŒºåŸŸï¼š

- ruleï¼šè§„åˆ™é…ç½®åŒºåŸŸï¼Œä»¥ç»§æ‰¿ IDEA åŸç”Ÿ Inspection æ£€æŸ¥ç±»ï¼Œæ‰©å±•è‡ªèº«éœ€è¦æ‰«æçš„ä»£ç ç‰‡æ®µï¼Œè¿›è¡Œè­¦å‘Šã€æ³¨é‡Šã€ä¿®å¤ã€‚
- inspectionDescriptionsï¼šæ˜¯å¯¹åº”çš„è­¦å‘Šæ³¨é‡Šï¼Œç¼–å†™åˆ° html ä¸­ï¼Œæœ€ç»ˆå±•ç¤ºåˆ° IDEA ä¸‹å¯¹åº”çš„é—®é¢˜ä»£ç ç‰‡æ®µä¸Šã€‚
- plugin.xmlï¼šä¸­éœ€è¦é…ç½® localInspection ä¹Ÿå°±æ˜¯é…ç½®ä½ è‡ªå®šä¹‰çš„ä»£ç æ£€æµ‹å®ç°ç±»ã€‚

### 2. ä¼ªéšæœºæ•°æ£€æµ‹

**ç›®çš„**ï¼šæŠŠä»£ç ä¸­çš„ `new Random` ä¸å®‰å…¨ä¼ªéšæœºæ•°è­¦å‘Šå¹¶æä¾›ä¿®å¤ï¼Œå¤„ç†ä¸º `new SecureRandom`

**RandomRule**

![](https://bugstack.cn/images/article/assembly/assembly-211222-7-01.png)

```java
PsiElementFactory factory = JavaPsiFacade.getElementFactory(project);
typeElement.replace(factory.createTypeElementFromText("SecureRandom", null));
PsiNewExpression secureNewExp = (PsiNewExpression) factory.createExpressionFromText("new SecureRandom()", null);
newExp.replace(secureNewExp);
```

- é€šè¿‡ç»§æ‰¿ `AbstractBaseJavaLocalInspectionTool` Override `buildVisitor` æ–¹æ³•ï¼Œæ‰©å±•æ£€æµ‹ä»£ç ã€‚*å½“ä½ å†™äº†è¿™æ®µæ–¹æ³•åï¼ŒIDEA ä¼šæŠŠä¸€è¡Œè¡Œçš„ä»£ç éƒ½é€šè¿‡è¿™ä¸ªæ–¹æ³•ä¼ è¿›æ¥*
- åœ¨ `visitNewExpression` æ–¹æ³•ä¸­æ‰©å±•è‡ªèº«çš„æ£€æµ‹å¤„ç†ï¼Œé‡åˆ°äº†å“ªç§ä»£ç ç‰‡æ®µï¼Œè¦æä¾›ä»€ä¹ˆæ ·çš„æé†’ä»¥åŠæé†’çš„çº§åˆ«ï¼Œæœ€åæ˜¯æä¾›ä¸€ä¸ª Fix ä¿®å¤èƒ½åŠ›ï¼Œè¿™ä¸ªä¿®å¤èƒ½åŠ›å°±åœ¨æ›¿æ¢è¿™æ®µä»£ç ç‰‡æ®µï¼Œé€šè¿‡è¿˜å¯ä»¥æ“ä½œå¼•å…¥æ–°åŒ…çš„åŠ¨ä½œ `import xxx`

### 3. FastJsonæ£€æµ‹

**ç›®çš„**ï¼š`com.alibaba:fastjson` åœ¨å¼€å¯ AutoTypeSupport æ—¶ï¼Œå­˜åœ¨ååºåˆ—åŒ–é£é™©ã€‚å¦‚æœç¨‹åºä¸­æœ‰ `ParserConfig.getGlobalInstance().setAutoTypeSupport(true);` ä»£ç ç›´æ¥æé†’åˆ é™¤å¤„ç†ã€‚

```java
public PsiElementVisitor buildVisitor(@NotNull ProblemsHolder holder, boolean isOnTheFly) {
    return new JavaElementVisitor() {
        @Override
        public void visitMethodCallExpression(PsiMethodCallExpression expression) {
            if (hasFullQualifiedName(expression, "com.alibaba.fastjson.parser.ParserConfig", "setAutoTypeSupport")) {
                PsiExpression[] args = expression.getArgumentList().getExpressions();
                if (args.length == 1 &&
                        args[0] instanceof PsiLiteralExpression &&
                        Boolean.TRUE.equals(((PsiLiteralExpression) args[0]).getValue())
                ) {
                    holder.registerProblem(
                            expression,
                            "FastJson unserialization risk",
                            ProblemHighlightType.GENERIC_ERROR_OR_WARNING,
                            new DeleteElementQuickFix(expression, "!Fix: remove setAutoTypeSupport")
                    );
                }
            }
        }
    };
}
```

- æ•´ä¸ªå¯¹ä»£ç æ£€æµ‹çš„æ“ä½œåŸºæœ¬éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œè¿™ä¸ªæ— éä¹Ÿæ˜¯æ£€æµ‹å‡ºä»£ç åº“ï¼Œå¹¶è¿›è¡Œåˆ é™¤çš„æé†’å¤„ç† `DeleteElementQuickFix`

### 4. æé†’æ¨¡æ¿

```html
<html>
<body>
<b>å°å‚…å“¥-æé†’:</b> ä¸å®‰å…¨çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ <br>
<br>
<p>java.util.Random ä¾èµ–ä¸€ä¸ªå¯è¢«é¢„æµ‹çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ã€‚</p>
<br>
<p style="font-size: 10px;color: #629460;">æœ€ä½³å®è·µ:</p>
<p style="font-size: 10px;">ä½¿ç”¨java.security.SecureRandom</p>
</body>
</html>
```

- æé†’æ¨¡æ¿éœ€è¦ç¼–å†™ html æ ¼å¼çš„å†…å®¹ï¼Œè¿™ä¸ªå†…å®¹ä¼šè¢«å±•ç¤ºåˆ°é”™è¯¯ä»£ç çš„è¯¦æƒ…é‡Œã€‚*åé¢æˆ‘ä»¬åšæµ‹è¯•çš„å¯ä»¥æŸ¥çœ‹*

### 5. æ£€æµ‹é…ç½®

```xml
<extensions defaultExtensionNs="com.intellij">
    <localInspection
            language="JAVA"       groupPath="Java"
            groupName="X-PMD"   enabledByDefault="true"   level="ERROR"
            bundle="InspectionBundle"     key="replace.pseudorandom.generator.name"
            implementationClass="cn.bugstack.guide.idea.plugin.rule.RandomRule"
    />
    
    <localInspection
            language="JAVA"       groupPath="Java"
            groupName="X-PMD"   enabledByDefault="true"   level="ERROR"
            bundle="InspectionBundle"     key="fastjson.auto.type.name"
            implementationClass="cn.bugstack.guide.idea.plugin.rule.FastJsonRule"
    />
    
    <localInspection
            language="JAVA"      groupPath="Java"
            groupName="X-PMD"  enabledByDefault="true"     level="WARNING"
            bundle="InspectionBundle"     key="hardcoded.ip.name"
            implementationClass="cn.bugstack.guide.idea.plugin.rule.IPRule"
    />
</extensions>
```

- åœ¨ plugin.xml ä¸­é…ç½®æˆ‘ä»¬è‡ªå·±å¼€å‘å¥½çš„ä»£ç é™æ€æ£€æµ‹å¯¹è±¡ï¼Œè¿™æ ·ä½ çš„æ£€æµ‹ç±»å°±ç”Ÿæ•ˆäº†ã€‚

## å››ã€æµ‹è¯•éªŒè¯

**å¯åŠ¨æ’ä»¶**

![](https://bugstack.cn/images/article/assembly/assembly-211222-7-02.png)

- å¦‚æœä½ ä¸‹è½½ä»£ç åï¼Œæ²¡æœ‰ Plugin å¯ä»¥è‡ªå·±é…ç½®ä¸€ä¸‹ï¼Œåœ¨ Tasks ä¸­é…ç½® `:runIde`

**é”™è¯¯æé†’**

![](https://bugstack.cn/images/article/assembly/assembly-211222-7-03.png)

**é”™è¯¯è¯¦æƒ…**

![](https://bugstack.cn/images/article/assembly/assembly-211222-7-04.png)

- å½“ä½ ç‚¹å‡» Fixï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œè‡ªåŠ¨æ›¿æ¢ä»£ç å¹¶ä¿®å¤äº†ï¼Œå°±æ˜¯æŠŠ `Random random = new Random()` æ›¿æ¢ä¸º `SecureRandom random = new SecureRandom();`
- å…¶ä»–2ä¸ªä¹Ÿå¯ä»¥åœ¨è·å–ä»£ç åè¿›è¡Œæµ‹è¯•éªŒè¯ï¼Œä¸€ä¸ªæ˜¯IPï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ä½¿ç”¨ `ParserConfig.getGlobalInstance().setAutoTypeSupport(true);` çš„é”™è¯¯æé†’ã€‚

## äº”ã€æ€»ç»“

- æœ¬ç« èŠ‚æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ IDEA åŸç”Ÿ Inspection æ£€æŸ¥æœºåˆ¶ï¼Œæ‰©å±•æˆ‘ä»¬è‡ªå·±éœ€è¦æ·»åŠ çš„ä»£ç æ£€æµ‹é€»è¾‘ï¼Œä»¥åŠä½¿ç”¨ LocalQuickFix çš„å®ç°ç±»ï¼Œåšä»£ç çš„æ›¿æ¢å’Œå¼•å…¥å“åº”åŒ…çš„æ“ä½œã€‚
- å¦å¤–å¯¹äºä»£ç æ£€æµ‹ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´åŠ æ ‡å‡†çš„å·¥å…·å« PMD å®ƒæ˜¯ä¸€æ¬¾é‡‡ç”¨ BSD åè®®çš„ä»£ç æ£€æŸ¥å·¥å…·ï¼Œä½ å¯ä»¥æ‰©å±•å®ç°ä¸ºè‡ªå·±çš„æ ‡å‡†å’Œè§„èŒƒä»¥åŠå®Œå–„ä¸ªæ€§çš„æé†’å’Œä¿®å¤æ“ä½œã€‚
- åƒ p3c å°±æ˜¯ä¸€æ¬¾é™æ€ä»£ç æ£€æµ‹å·¥å…·ï¼Œç”¨çš„äººä¹Ÿéå¸¸å¤šï¼Œä¸è¿‡å®ƒçš„æ’ä»¶å¼€å‘ä¸æ˜¯åŸºäº Java å®ç°çš„ï¼Œä»£ç å¼€å‘ä¸Šä¹Ÿå¹¶æ²¡æœ‰ä¸€äº›æ³¨é‡Šã€‚æ‰€ä»¥éå¸¸å»ºè®®é˜…è¯» pmd-ideaï¼Œè¿™æ¬¾ä»£ç å†™çš„éå¸¸å¥½ï¼ŒæŠ½è±¡å……è¶³ã€ç»“æ„æ¸…æ™°ã€å†…å®¹å®Œæ•´ï¼š[https://github.com/ybroeker/pmd-idea](https://github.com/ybroeker/pmd-idea)

## å…­ã€ç³»åˆ—æ¨è

- [IDEA æ’ä»¶æ€ä¹ˆå¼€å‘ï¼Ÿ](https://bugstack.cn/md/assembly/idea-plugin/2021-08-27-%E6%8A%80%E6%9C%AF%E8%B0%83%E7%A0%94%EF%BC%8CIDEA%20%E6%8F%92%E4%BB%B6%E6%80%8E%E4%B9%88%E5%BC%80%E5%8F%91%EF%BC%9F.html)
- [p3c æ’ä»¶ï¼Œæ˜¯æ€ä¹ˆæ£€æŸ¥å‡ºä½ é‚£å±å±±çš„ä»£ç ï¼Ÿ](https://bugstack.cn/md/develop/standard/2021-09-27-p3c%20%E6%8F%92%E4%BB%B6%EF%BC%8C%E6%98%AF%E6%80%8E%E4%B9%88%E6%A3%80%E6%9F%A5%E5%87%BA%E4%BD%A0%E9%82%A3%E5%B1%8E%E5%B1%B1%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%9F.html#_3-%E8%A7%84%E7%BA%A6-p3c-pmd)
- [å‘å¸ƒJaråŒ…åˆ°Mavenä¸­å¤®ä»“åº“(ä¸ºå¼€å‘å¼€æºä¸­é—´ä»¶åšå‡†å¤‡)](https://bugstack.cn/md/assembly/middleware/2019-12-07-%E5%8F%91%E5%B8%83Jar%E5%8C%85%E5%88%B0Maven%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93%EF%BC%8C%E4%B8%BA%E5%BC%80%E5%8F%91%E5%BC%80%E6%BA%90%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%81%9A%E5%87%86%E5%A4%87.html)
- [è¿˜é‡æ„ï¼Ÿå°±ä½ é‚£ä»£ç åªèƒ½é“²äº†é‡å†™ï¼](https://bugstack.cn/md/develop/standard/2021-09-15-%E8%BF%98%E9%87%8D%E6%9E%84%EF%BC%9F%E5%B0%B1%E4%BD%A0%E9%82%A3%E4%BB%A3%E7%A0%81%E5%8F%AA%E8%83%BD%E9%93%B2%E4%BA%86%E9%87%8D%E5%86%99%EF%BC%81.html)
- [12ç§ vo2dto æ–¹æ³•ï¼Œå°± BeanUtils.copyProperties å‹æµ‹æœ€æ‹‰èƒ¯ï¼](https://bugstack.cn/md/develop/standard/2021-10-10-12%E7%A7%8D%20vo2dto%20%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B0%B1%20BeanUtils.copyProperties%20%E5%8E%8B%E6%B5%8B%E6%9C%80%E6%8B%89%E8%83%AF.html)