---
title: ç¬¬2èŠ‚ï¼šé…ç½®çª—ä½“å’Œä¾§è¾¹æ çª—ä½“çš„ä½¿ç”¨
lock: need
---

# ã€ŠIntelliJ IDEA æ’ä»¶å¼€å‘ã€‹ç¬¬2èŠ‚ï¼šé…ç½®çª—ä½“å’Œä¾§è¾¹æ çª—ä½“çš„ä½¿ç”¨

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)
<br/>åŸæ–‡ï¼š[https://mp.weixin.qq.com/s/R8qvoSNyedVM95Ty8sbhgg](https://mp.weixin.qq.com/s/R8qvoSNyedVM95Ty8sbhgg)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€è¯´æ˜

`æ–¹å‘ä¸å¯¹ï¼ŒåŠªåŠ›ç™½è´¹ï¼`

æ€»æœ‰äººæ‹¿åˆ°äº§å“çš„éœ€æ±‚ï¼Œå°±ç€æ€¥å¼€å¹²ï¼Œåæ­£ä¹Ÿæ‡’çš„æƒ³å¼€å‘ä¸­ä¼šå‘ç”Ÿå•¥ï¼Œä¸Šçº¿åå¤šå°‘äººä½¿ç”¨ï¼Œç®¡å®ƒä¸‰ä¸ƒäºŒåä¸€å…ˆå †èµ·æ¥ä»£ç çœ‹ä¸€çœ‹ï¼Œåæ­£èƒ½è·‘å°±è¡Œï¼Œæ— è®ºä»£ç è¿˜æ˜¯ä½ ï¼

å…¶å®å¾ˆå¤šæ—¶å€™åœ¨ç¼–å†™ä»£ç å‰ï¼Œæ‰€éœ€è¦åšçš„æŠ€æœ¯è°ƒç ”ã€æ¶æ„è®¾è®¡ã€æ¨¡å—åˆ†å±‚ã€æ•°æ®ç»“æ„ã€è¯¦ç»†åˆ†æã€æ–¹æ¡ˆè¯„å®¡ç­‰ï¼Œä¸`ä¸‰ä¸ƒäºŒåä¸€é‚£å®¶ä¼™`å¯¹æ¯”èµ·æ¥ï¼Œå¥½åƒéƒ½ä¼šæ˜¾å¾—æœ‰ç‚¹æ…¢ã€‚ä½†è¿™ä¸ªçœ‹ä¸Šå»æ…¢çš„è¿‡ç¨‹ï¼Œå´èƒ½è§£å†³ä»¥åå¾ˆå¤šå¸¸è§å’Œéº»çƒ¦çš„é—®é¢˜ï¼Œæ¯”å¦‚äº§å“éœ€æ±‚è¿­ä»£ã€ä¸šåŠ¡æµç¨‹å˜æ›´ã€ä»£ç é€»è¾‘æ›´æ”¹ã€çº¿ä¸Šå¼‚å¸¸æ’æŸ¥ã€‚è™½ç„¶çœ‹ç€æ…¢ï¼Œä½†è¿™ä¸ªç§¯åŸºæ ‘æœ¬çš„è¿‡ç¨‹å°±åƒæ‰“åœ°åŸºä¸€æ ·ï¼Œæ€»å¾—æœ‰ä¸€ä¸ªç¨³å®šçš„æ ¹åŸºï¼Œæ‰èƒ½ç›–å¥½æ•´æ ‹å¤§æ¥¼ã€‚**ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·ï¼Œå‹¿åœ¨æµ®æ²™ç­‘é«˜å°**

## äºŒã€éœ€æ±‚ç›®çš„

å¦‚æœä½ éœ€è¦å¼€å‘ä¸€ä¸ªè‡ªå®šä¹‰åŠŸèƒ½çš„æ’ä»¶ï¼Œæ— è®ºæ˜¯å¤„ç†ä»£ç ã€è¾…åŠ©ORMç”Ÿæˆã€æ—¥å¿—ä¿¡æ¯è®°å½•ç­‰ï¼Œéƒ½ä¼šéœ€è¦è¿›è¡Œä¸€ä¸ªæ’ä»¶çš„åŠŸèƒ½é…ç½®è¿›è¡Œåˆå§‹åŒ–æ“ä½œä»¥åŠæŠŠå¯¹åº”åŠŸèƒ½å±•ç¤ºåˆ°æ•´ä¸ª IDEA çª—ä½“ä¸­çš„å³è¾¹æ æˆ–è€…ä¸‹è¾¹æ ä¸­ï¼Œè¿™æ ·æ‰èƒ½æ»¡è¶³ä¸€ä¸ªæ’ä»¶çš„åŸºæœ¬éœ€æ±‚ã€‚

é‚£ä¹ˆè¿™æ ·å°±éœ€è¦åœ¨ IDEA çª—ä½“ `File -> Settings` ä¸­æ‰©å±•è‡ªå·±çš„é…ç½®çª—ä½“ï¼Œä»¥åŠå¼€å‘è‡ªå·±éœ€è¦çš„ ToolWindow åµŒå…¥åˆ° IDEA ä¸­(å·¦ä¾§ã€å³ä¾§ã€ä¸‹ä¾§)ï¼Œè¿™é‡Œçª—ä½“çš„å¼€å‘éœ€è¦ç”¨åˆ° Swing ä½†ç›®å‰åœ¨ IDEA ä¸­å¼€å‘è¿™æ ·çš„åŠŸèƒ½åªéœ€è¦æ‹–æ‹½çª—ä½“å°±å¯ä»¥ï¼Œè¿˜æ˜¯è›®å®¹æ˜“çš„ã€‚

é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ä»¥ä¸€ä¸ªåœ¨ IDEA ä¸­æ‘¸é±¼çœ‹ä¹¦çš„åœºæ™¯ä¸ºæ¡ˆä¾‹ï¼Œå­¦ä¹ é…ç½®çª—ä½“å’Œé˜…è¯»çª—ä½“çš„åŠŸèƒ½å®ç°ã€‚

## ä¸‰ã€æ¡ˆä¾‹å¼€å‘

### 1. å·¥ç¨‹ç»“æ„

```java
guide-idea-plugin-tool-window
â”œâ”€â”€ .gradle
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚   	â””â”€â”€ cn.bugstack.guide.idea.plugin 
    â”‚       	â””â”€â”€ factory
    â”‚       	â”‚	â”œâ”€â”€ ReadFactory.java 
    â”‚       	â”‚	â””â”€â”€ SettingFactory.java
    â”‚       	â””â”€â”€ ui
    â”‚       	â”‚	â”œâ”€â”€ ReadUI.java 
    â”‚       	â”‚	â”œâ”€â”€ ReadUI.form
    â”‚       	â”‚	â”œâ”€â”€ SettingUI.java  
    â”‚       	â”‚	â””â”€â”€ SettingUI.form
    â”‚       	â””â”€â”€ Config    
    â”œâ”€â”€ resources
    â”‚   â””â”€â”€ META-INF
    â”‚       â””â”€â”€ plugin.xml 
    â”œâ”€â”€ build.gradle  
    â””â”€â”€ gradle.properties
```

- **æºç è·å–**ï¼š#å…¬ä¼—å·ï¼š`bugstackè™«æ´æ ˆ` å›å¤ï¼š`idea` å³å¯ä¸‹è½½å…¨éƒ¨ IDEA æ’ä»¶å¼€å‘æºç 

æ­¤å·¥ç¨‹ä¸»è¦æ¶‰åŠä¸¤éƒ¨åˆ†ï¼Œåœ¨factoryä¸­ä¸€ä¸ªæ˜¯é…ç½®çª—ä½“ã€ä¸€ä¸ªæ˜¯é˜…è¯»çª—ä½“ï¼Œä¸ä¹‹å¯¹åº”çš„ä¸¤ç»„UIçš„å®ç°ã€‚æœ€å factory ç±»çš„å®ç°éƒ½ä¼šé…ç½®åˆ° plugin.xml ä¸­è¿›è¡Œä½¿ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯åœ¨ plugin.xml  ä¸­æ§åˆ¶çª—ä½“ä½ç½®å’Œå›¾æ ‡ã€‚

### 2. åˆ›å»º UI çª—ä½“

#### 2.1 åˆ›å»ºæ–¹å¼

**New -> Swing UI Designer -> GUI Form**

![](https://bugstack.cn/images/article/assembly/assembly-211103-01.png)

- åœ¨ Java ä¸­åˆ›å»ºçª—ä½“çš„æ–¹å¼ä¸»è¦æœ‰ AWTã€Swingã€JavaFxï¼Œç”±äº IDEA ä½¿ç”¨ Swing å¼€å‘ï¼Œæ‰€ä»¥è¿™é‡Œåˆ›å»º Swing çª—ä½“çš„å…¼å®¹æ€§ä¼šæ›´å¥½ã€‚
- é‚£ä¹ˆè¿™é‡Œ Swing çª—ä½“çš„åˆ›å»ºå¯ä»¥æ˜¯è‡ªå·±æ‰‹å†™çª—ä½“ç»“æ„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¯è§†åŒ–æ‹–æ‹½çš„ GUI Form å¦‚æœä½ çš„çª—ä½“ä¸å¤æ‚ï¼Œå…¶å®æ‹–æ‹½çš„æ–¹å¼å°±å¯ä»¥æ»¡è¶³ä½¿ç”¨ã€‚

#### 2.2 é…ç½®é¡µçª—ä½“

```java
public class SettingUI {

    private JPanel mainPanel;
    private JPanel settingPanel;
    private JLabel urlLabel;
    private JTextField urlTextField;
    private JButton urlBtn;

    public SettingUI() {
        // ç»™æŒ‰é’®æ·»åŠ ä¸€ä¸ªé€‰æ‹©æ–‡ä»¶çš„äº‹ä»¶
        urlBtn.addActionListener(e -> {
            JFileChooser fileChooser = new JFileChooser();
            fileChooser.setFileSelectionMode(JFileChooser.FILES_ONLY);
            fileChooser.showOpenDialog(settingPanel);
            File file = fileChooser.getSelectedFile();
            urlTextField.setText(file.getPath());
        });
    }

    public JComponent getComponent() {
        return mainPanel;
    }

    public JTextField getUrlTextField() {
        return urlTextField;
    }
}
```

![](https://bugstack.cn/images/article/assembly/assembly-211103-02.png)

- é…ç½®é¡µçª—ä½“ä¸»è¦æä¾›æ–‡ç« è·¯å¾„çš„é€‰æ‹©ï¼Œè¿™é‡Œéœ€è¦ç”¨åˆ°çš„æ ‡ç­¾åŒ…æ‹¬ï¼šJLabelã€JTextFieldã€JButton
- åœ¨ä½¿ç”¨  GUI Form åˆ›å»ºå®Œçª—ä½“åï¼Œå°±ä¼šå‡ºç°è¿™æ ·ä¸€ä¸ªå¯è§†åŒ–çš„é¡µé¢ï¼Œå³ä¾§å¯ä»¥æŠŠå„ç±»æ ‡ç­¾æ‹–åˆ°ä¸­é—´çš„é¢æ¿ä¸­ï¼Œå·¦ä¾§è¿›è¡Œè®¾ç½®å±•ç¤ºåç§°å’Œå±æ€§åç§°ã€‚
- æœ€ç»ˆè¿™é‡Œçš„ä»£ç æ ‡ç­¾ä»£ç ä¼šå±•ç¤ºåˆ° `SettingUI.java` ä¸­ï¼Œè€Œæ¸²æŸ“å†…å®¹ä¼šè¢«éšè—ï¼Œè¿™æ ·çš„æ–¹å¼ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿æ§åˆ¶ä¸€äº›è‡ªå®šä¹‰å†…å®¹çš„æ·»åŠ ï¼Œä¾‹å¦‚äº‹ä»¶å’Œæ–°çª—ä½“ç­‰
- å¦å¤–åœ¨ `SettingUI.java` ä¸­ï¼Œè¿˜éœ€è¦åœ¨æ„é€ å‡½æ•°æ·»åŠ ä¸€ä¸ªæŒ‰é’®äº‹ä»¶ï¼Œç”¨äºæ‰“å¼€æ–‡ä»¶é€‰æ‹©å™¨ï¼ŒæŠŠæˆ‘ä»¬éœ€è¦æ‰“å¼€çš„æ–‡ä»¶ï¼Œè®¾ç½®åˆ° `urlTextField` ä¸­ã€‚

#### 2.3 é˜…è¯»é¡µçª—ä½“

```java
public class ReadUI {

    private JPanel mainPanel;
    private JTextPane textContent;

    public JComponent getComponent() {
        return mainPanel;
    }

    public JTextPane getTextContent() {
        return textContent;
    }

}
```

![](https://bugstack.cn/images/article/assembly/assembly-211103-03.png)

- åœ¨çª—ä½“åˆ›å»ºå’Œé…ç½®é¡µçª—ä½“æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯é€šè¿‡æ‹–æ‹½åˆ°é¢æ¿ä¸­ï¼Œç”¨äºå±•ç¤ºè·¯å¾„æ–‡ä»¶å†…å®¹ã€‚
- ä½ å¯ä»¥é€‚å½“çš„æ·»åŠ ä¸€äº›å…¶ä»–æŒ‰é’®è¿›å»ï¼Œæ¯”å¦‚ç¿»é¡µé˜…è¯»ã€æ»šåŠ¨æ¡ã€å­—æ•°å±•ç¤ºç­‰ã€‚

### 3. ToolWindow å·¥å…·æ¡†

ä¸ºäº†æŠŠæˆ‘ä»¬è‡ªå·±å®ç°çš„`é˜…è¯»çª—ä½“`æ”¾åˆ°æ•´ä¸ª IDEA å³ä¾§ä¾§è¾¹æ ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®ç°äº† `ToolWindowFactory` çš„æ¥å£ï¼Œå¹¶æŠŠå®ç°ç±»é…ç½®åˆ° plugin.xml ä¸­

```java
public class ReadFactory implements ToolWindowFactory {

    private ReadUI readUI = new ReadUI();

    @Override
    public void createToolWindowContent(@NotNull Project project, @NotNull ToolWindow toolWindow) {
        // è·å–å†…å®¹å·¥å‚çš„å®ä¾‹
        ContentFactory contentFactory = ContentFactory.SERVICE.getInstance();
        // è·å– ToolWindow æ˜¾ç¤ºçš„å†…å®¹
        Content content = contentFactory.createContent(readUI.getComponent(), "", false);
        // è®¾ç½® ToolWindow æ˜¾ç¤ºçš„å†…å®¹
        toolWindow.getContentManager().addContent(content);
        // å…¨å±€ä½¿ç”¨
        Config.readUI = readUI;
    }

}
```

- æ¥å£æ–¹æ³• `ToolWindowFactory#createToolWindowContent` æ˜¯éœ€è¦è‡ªå·±å·¥å…·æ¡†ç±»å®ç°çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ª `createToolWindowContent` æ–¹æ³•ä¸­æŠŠè‡ªå·±çš„çª—ä½“ `ReadUI` å®ä¾‹åŒ–åå¡«å……è¿›å»å³å¯ã€‚
- æ·»åŠ çª—ä½“çš„è¡¥åŠ©ä¸»è¦ä¾èµ–äº `ContentFactory.SERVICE.getInstance()` åˆ›å»ºå‡º ContentFactory å¹¶æœ€ç»ˆä½¿ç”¨ toolWindow æ·»åŠ çª—ä½“æ˜¾ç¤º UI å³å¯ã€‚
- è¿™é‡Œæˆ‘ä»¬é¢å¤–çš„è¿˜æ·»åŠ äº†ä¸€ä¸ªå…¨å±€å±æ€§ `Config.readUI` è¿™æ˜¯ä¸ºäº†åç»­å¯ä»¥åœ¨é…ç½®çª—ä½“ä¸­ä½¿ç”¨è¿™ä¸ª UI è¿›è¡Œè®¾ç½®æ–‡ä»¶å†…å®¹ã€‚

### 4. Configurable é…ç½®æ¡†

```java
public class SettingFactory implements SearchableConfigurable {

    private SettingUI settingUI = new SettingUI();

    @Override
    public @NotNull String getId() {
        return "test.id";
    }

    @Override
    public @Nls(capitalization = Nls.Capitalization.Title) String getDisplayName() {
        return "test-config";
    }

    @Override
    public @Nullable JComponent createComponent() {
        return settingUI.getComponent();
    }

    @Override
    public boolean isModified() {
        return true;
    }

    @Override
    public void apply() throws ConfigurationException {
        String url = settingUI.getUrlTextField().getText();
        // è®¾ç½®æ–‡æœ¬ä¿¡æ¯
        try {
            File file = new File(url);
            RandomAccessFile randomAccessFile = new RandomAccessFile(file, "r");
            randomAccessFile.seek(0);

            byte[] bytes = new byte[1024 * 1024];
            int readSize = randomAccessFile.read(bytes);

            byte[] copy = new byte[readSize];
            System.arraycopy(bytes, 0, copy, 0, readSize);

            String str = new String(copy, StandardCharsets.UTF_8);

            // è®¾ç½®å†…å®¹
            Config.readUI.getTextContent().setText(str);

        } catch (Exception ignore) {
        }
    }

}
```

- å®ç°è‡ª SearchableConfigurable æ¥å£çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼ŒåŒ…æ‹¬ï¼šgetIdã€getDisplayNameã€`createComponent`ã€isModifiedã€`apply` è¿™äº›é‡Œé¢ç”¨äºå†™é€»è¾‘å®ç°çš„ä¸»è¦æ˜¯ `createComponent` å’Œ `apply`  
- createComponent æ–¹æ³•ä¸»è¦æ˜¯æŠŠæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ UI é¢æ¿æä¾›ç»™ JComponent
- apply æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»å®Œæˆé…ç½®çš„ OKã€å®Œæˆï¼Œæ—¶å€™å°±ä¼šè§¦å‘åˆ°è¿™ä¸ªæ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æˆ‘ä»¬æ‹¿åˆ°æ–‡ä»¶çš„ URL åœ°å€ä½¿ç”¨ `RandomAccessFile` è¿›è¡Œè¯»å–è§£ææ–‡ä»¶ï¼Œå¹¶æœ€ç»ˆæŠŠæ–‡ä»¶å†…å®¹å±•ç¤ºåˆ°é˜…è¯»çª—ä½“ä¸­ `Config.readUI.getTextContent().setText(str);`

### 5. é…ç½® plugin.xml

```java
<extensions defaultExtensionNs="com.intellij">
    <!-- Add your extensions here -->
    <!-- é…ç½® File -> Settings -> Tools -->
    <projectConfigurable groupId="tools" displayName="My Test Config" id="test.id"
                         instance="cn.bugstack.guide.idea.plugin.factory.SettingFactory"/>
                         
    <!-- çª—ä½“ (IDEA ç•Œé¢å³ä¾§) -->
    <toolWindow id="Read-Book" secondary="false" anchor="right" icon="/icons/logo.png"
                factoryClass="cn.bugstack.guide.idea.plugin.factory.ReadFactory"/>
</extensions>
```

- æœ¬æ¬¡åœ¨ plugin.xml ä¸­çš„ä¸»è¦é…ç½®å†…å®¹å°±æ˜¯ projectConfigurable å’Œ toolWindowï¼Œå¦å¤–åœ¨ toolWindow ä¸­è¿˜æ·»åŠ äº†ä¸€ä¸ª icon çš„ logoï¼Œé…ç½®å®Œæˆåå°±å¯ä»¥åœ¨ IDEA é¡µé¢å±•ç¤ºå‡ºæˆ‘ä»¬çš„è‡ªå·±æ·»åŠ çš„çª—ä½“äº†ã€‚

## å››ã€æ’ä»¶æµ‹è¯•

- é€šè¿‡ Plugin å¯åŠ¨æ’ä»¶ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„ IDEA çª—ä½“ï¼Œåœ¨è¿™ä¸ªæ–°çª—ä½“ä¸­å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ·»åŠ çš„åŠŸèƒ½äº†ã€‚

**é…ç½®æ–‡ä»¶è·¯å¾„**

![](https://bugstack.cn/images/article/assembly/assembly-211103-04.png)

- ç‚¹å‡»é€‰æ‹©æŒ‰é’®ï¼Œé€‰æ‹©ä½ çš„æ–‡ä»¶ä½ç½®ï¼Œé€‰æ‹©åç‚¹å‡» OK 

**æŸ¥çœ‹å±•ç¤ºæ–‡ä»¶**

![](https://bugstack.cn/images/article/assembly/assembly-211103c-05.png)

- ç¡®è®¤å¥½æ–‡ä»¶è·¯å¾„åï¼Œå°±å¯ä»¥å†å³ä¾§æ çœ‹åˆ°è‡ªå·±çš„æ–‡ä»¶å±•ç¤ºå†…å®¹äº†ã€‚*æ˜¯ä¸æ˜¯åœ¨æ‰©å±•äº›ï¼Œå°±é€‚åˆä½ æ‘¸é±¼äº†ï¼ï¼Ÿ*

## äº”ã€æ€»ç»“

- å­¦ä¹ è‡ªå®šä¹‰å¼€å‘UIï¼ŒæŠŠUIå¡«å……åˆ°éœ€è¦æ”¾ç½®çš„ IDEA çª—ä½“ä½ç½®ï¼Œå¹¶åœ¨çª—ä½“ä¸­æ·»åŠ åŠŸèƒ½çš„æµç¨‹æ­¥éª¤ï¼Œå…¶å®ä¸»è¦åŒ…æ‹¬ä¸‰æ–¹é¢ï¼šSwing UIã€Factory å®ç°ç±»ã€plugin é…ç½®ã€‚
- åœ¨ plugin é…ç½®ä¸­ï¼Œä¸»è¦åŒ…æ‹¬å¦‚çª—ä½“IDã€ä½ç½®ã€iconå›¾æ ‡ã€å¯¹åº”çš„å®ç°ç±»ï¼Œå¦‚æœä¸æ·»åŠ è¿™äº›æ˜¯ä¸èƒ½æ­£å¸¸å±•ç¤ºçª—ä½“ä¿¡æ¯çš„ã€‚
- å¦å¤–å¯ä»¥ä»¥è¿™ä¸ªæ¡ˆä¾‹ä¸ºåŸºç¡€ï¼Œæ·»åŠ è‡ªå·±æƒ³å®Œæˆçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è®©è¿™ä¸ªæ‘¸é±¼çœ‹ä¹¦çš„åŠŸèƒ½æ›´åŠ å®Œå–„ï¼Œå¯ä»¥æ”¯æŒä¸åŒç±»å‹çš„æ–‡ä»¶ï¼Œç”šè‡³å¯ä»¥æ˜¯ PDF çš„é˜…è¯»ï¼Œä»¥åŠä½ æƒ³çœ‹çš„ä¹¦ç±ã€‚