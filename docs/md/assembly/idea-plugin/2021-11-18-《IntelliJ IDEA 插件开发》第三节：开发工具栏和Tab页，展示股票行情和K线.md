---
title: ç¬¬3èŠ‚ï¼šå¼€å‘å·¥å…·æ å’ŒTabé¡µï¼Œå±•ç¤ºè‚¡ç¥¨è¡Œæƒ…å’ŒKçº¿
lock: need
---

# ã€ŠIntelliJ IDEA æ’ä»¶å¼€å‘ã€‹ç¬¬3èŠ‚ï¼šå¼€å‘å·¥å…·æ å’ŒTabé¡µï¼Œå±•ç¤ºè‚¡ç¥¨è¡Œæƒ…å’ŒKçº¿

ä½œè€…ï¼šå°å‚…å“¥
<br/>åšå®¢ï¼š[https://bugstack.cn](https://bugstack.cn)

>æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼ğŸ˜„

## ä¸€ã€å‰è¨€

`æ²¡æ‹›äº†ï¼Œä¸å†™ç‚¹åˆºæ¿€çš„ï¼Œä½ æ€»æ˜¯ä¸å¥½å¥½çœ‹ï¼`

ä»¥å‰ï¼Œæˆ‘ä¸æ‡‚ã€‚å†™çš„æŠ€æœ¯å°±æ˜¯æŠ€æœ¯å†…å®¹ï¼Œå†™çš„åœºæ™¯å°±æ˜¯åœºæ™¯åˆ†æï¼Œä½†ä»è¯»è€…çš„é˜…è¯»æˆ‘å‘ç°ï¼Œå¤§å®¶æ›´å–œæ¬¢çš„æ˜¯æŠ€æœ¯ä¸åœºæ™¯ç»“åˆï¼Œå°¤å…¶æ˜¯ç”¨æŠ€æœ¯ç»“åˆé‚£äº›ç¾ç¾ç­”ç­”çš„åœºæ™¯ï¼Œè™½ç„¶å˜´ä¸Šéƒ½ä¸è¯´ã€‚

æœ¬ç« èŠ‚ä¸»è¦æ˜¯æƒ³ç»™å¤§å®¶ä»‹ç»å…³äºåœ¨ IDEA æ’ä»¶å¼€å‘ä¸­å¦‚ä½•ä½¿ç”¨å·¥å…·æ å’ŒTabé¡µï¼Œæ¥å¡«å……åœ¨ IDEA ä¸­åº•éƒ¨çš„çª—ä½“ï¼Œå°±åƒ IDEA ä¸­çš„æ§åˆ¶å°ä¸€æ ·ã€‚ä½†å°±è¿™ä¹ˆå†™å¥½åƒæ˜¯å¤Ÿå‘›èƒ½æœ‰äººçœ‹ï¼Œå› ä¸ºå¤§å®¶åªä»æŠ€æœ¯ç‚¹æ¥çœ‹ï¼Œå¾ˆéš¾å‘ç°è¿™é‡Œé¢æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Œå³ä½¿çœ‹äº†å¥½åƒä¹Ÿä¸çŸ¥é“è¿™æŠ€æœ¯èƒ½å¹²å•¥ã€‚

**é‚£å’‹åŠ**ï¼Œæ•´ç‚¹`åˆºæ¿€`çš„å§ã€‚å¤§å®¶ä¸æ˜¯å–œæ¬¢`èµ”é’±ç‚’è‚¡`å—ï¼Œé‚£å°±æŠŠ`è‚¡ç¥¨è¡Œæƒ…`å’Œ`Kçº¿å±•ç¤º`ç»“åˆåˆ°IDEAæ’ä»¶å¼€å‘ä¸­ã€‚å¯ä»¥è®©å­¦ä¹ æ’ä»¶çš„ä¼™ä¼´ï¼Œéƒ½èƒ½åœ¨å†™ä»£ç ç–²æƒ«çš„æ—¶å€™è¿˜èƒ½çœ‹ä¸€çœ¼è‚¡ç¥¨ï¼Œä¹Ÿè®¸åœ¨å…³é”®çš„æ—¶å€™è¿˜èƒ½æé†’ä½ èµ¶ç´§æŠ›å‡ºå»ï¼

## äºŒã€éœ€æ±‚ç›®çš„

å®‰å…¨èµ·è§ï¼Œéœ€è¦åœ¨ IDEA ä¸­ä»¥ä¸€ä¸ªæ¯”è¾ƒéšç§˜çš„è§’è½ï¼Œå¼€å‘è‚¡ç¥¨æ’ä»¶ï¼Œè®©ç‚’è‚¡çš„åŒå­¦å¯ä»¥åœ¨ç´§å¼ ç¼–ç CRUDä¹‹ä½™ï¼Œä¸è¦å¿˜è®°è‡ªå·±å…³æ³¨çš„è‚¡ç¥¨è´­ä¹°å’ŒæŠ›å”®ã€‚

é‚£ä¹ˆä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å‡ ä¸ªæŠ€æœ¯ç‚¹ï¼ŒåŒ…æ‹¬ï¼šè‚¡ç¥¨æ•°æ®æ¥å£ã€æŸ¥è¯¢å¯¹è±¡å°è£…ã€IDEA åº•éƒ¨çª—ä½“å’Œå·¥å…·æ å¼€å‘ã€å®šæ—¶ä»»åŠ¡æ‰«æã€Swing UIã€è‚¡ç¥¨ä»£ç é…ç½®å’Œä¿å­˜ã€çª—ä½“æŒ‰é’®äº‹ä»¶ç›‘å¬ç­‰ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±ç»“åˆè¿™äº›æŠ€æœ¯ç‚¹ï¼Œæ¥è§£å†³å®é™…çš„åœºæ™¯é—®é¢˜ï¼Œçœ‹çœ‹å¦‚ä½•åœ¨ IDEA ä¸­å¼€å‘ä¸€ä¸ªè‚¡ç¥¨æ’ä»¶ã€‚

## ä¸‰ã€æ¡ˆä¾‹å¼€å‘

### 1. å·¥ç¨‹ç»“æ„

```java
guide-idea-plugin-tab
â”œâ”€â”€ .gradle
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚   	â””â”€â”€ cn.bugstack.guide.idea.plugin 
    â”‚       	â”œâ”€â”€ domain
    â”‚       	â”‚	â”œâ”€â”€ model
    â”‚       	â”‚	â”‚	â”œâ”€â”€ aggregates
    â”‚       	â”‚	â”‚	â”‚	â””â”€â”€ StockResult.java    
    â”‚       	â”‚	â”‚	â””â”€â”€ vo  
    â”‚       	â”‚	â”‚	 	â”œâ”€â”€ Data.java 
    â”‚       	â”‚	â”‚	 	â”œâ”€â”€ GoPicture.java     
    â”‚       	â”‚	â”‚	 	â””â”€â”€ Stock.java       
    â”‚       	â”‚	â””â”€â”€ service   
    â”‚       	â”‚	 	â”œâ”€â”€ impl     
    â”‚       	â”‚	 	â”‚	â””â”€â”€ StockImpl.java    
    â”‚       	â”‚	 	â””â”€â”€ IStock      
    â”‚       	â”œâ”€â”€ factory
    â”‚       	â”‚	â””â”€â”€ TabFactory.java  
    â”‚       	â”œâ”€â”€ infrastructure
    â”‚       	â”‚	â”œâ”€â”€ DataSetting.java       
    â”‚       	â”‚	â””â”€â”€ DataState.java     
    â”‚       	â”œâ”€â”€ module
    â”‚       	â”‚	â”œâ”€â”€ RefreshBar.java   
    â”‚       	â”‚	â”œâ”€â”€ SettingBar.java    
    â”‚       	â”‚	â””â”€â”€ ViewBars.java         
    â”‚       	â””â”€â”€ ui
    â”‚       	â”‚	â”œâ”€â”€ ConsoleUI.java 
    â”‚       	â”‚	â”œâ”€â”€ ConsoleUI.form
    â”‚       	â”‚	â”œâ”€â”€ GidConfig.java  
    â”‚       	â”‚	â””â”€â”€ GidConfig.form
    â”‚       	â””â”€â”€ Config    
    â”œâ”€â”€ resources
    â”‚   â””â”€â”€ META-INF
    â”‚       â””â”€â”€ plugin.xml 
    â”œâ”€â”€ build.gradle  
    â””â”€â”€ gradle.properties
```

**æºç è·å–**ï¼š#å…¬ä¼—å·ï¼š`bugstackè™«æ´æ ˆ` å›å¤ï¼š`idea` å³å¯ä¸‹è½½å…¨éƒ¨ IDEA æ’ä»¶å¼€å‘æºç 

åœ¨æ­¤ IDEA æ’ä»¶å·¥ç¨‹ä¸­ï¼Œä¸»è¦åˆ†ä¸º5å—åŒºåŸŸï¼š
- domainï¼šé¢†åŸŸå±‚ï¼Œæä¾›æŸ¥è¯¢è‚¡ç¥¨æ¥å£çš„æ•°æ®æœåŠ¡ï¼Œå¦‚æœä½ æ˜¯åšçš„ä¸€äº›å…¶ä»–å·¥å…·å‹åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥æŠŠä¸šåŠ¡ç±»çš„å†…å®¹æ”¾åˆ° domain ä¸­å®ç°ã€‚
- factoryï¼šå·¥å‚å±‚ï¼Œè¿™é‡Œä¸»è¦æä¾›çš„æ˜¯ä¸€ä¸ªå·¥å…·çª—ä½“ç”Ÿæˆçš„å…¥å£å¯¹è±¡ï¼Œæ¥åˆ›å»ºå‡ºæˆ‘ä»¬è‡ªå·±æ·»åŠ çš„çª—ä½“å†…å®¹ã€‚
- infrastructureï¼šåŸºç¡€å±‚ï¼Œæä¾›äº†æ•°æ®å­˜æ”¾å¯¹è±¡ï¼Œè¿™ä¸ªæ•°æ®å¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥è½ç›˜çš„æ“ä½œï¼Œåˆ›å»ºå¥½çš„ç±»é…ç½®åˆ° plugin.xml  ä¸­å³å¯ã€‚*è¿™æ ·æˆ‘ä»¬é…ç½®å¥½è‚¡ç¥¨ä»£ç åï¼Œå…³æœºé‡å¯ IDEA ä¹Ÿå¯ä»¥æŠŠé…ç½®è¯»å–å‡ºæ¥*
- moduleï¼šæ¨¡å—ï¼Œæä¾›ç”¨äº UI çª—ä½“ä½¿ç”¨çš„ä¸€äº›å·¥å…·é¡µæ“ä½œã€‚æ¯”å¦‚è¿™é‡Œçš„ ViewBars ä¼šåœ¨ TabFactory ä¸­å®ä¾‹åŒ–ï¼Œç”¨äºå±•ç¤ºå‡ºä½ æ·»åŠ çš„çª—ä½“ã€‚
- uiï¼šè¿™ä¸€éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ IDEA ä¸­è‡ªåŠ¨æ‹–æ‹½ç”Ÿæˆçš„çª—ä½“ï¼Œå…å»äº†æ‰‹å†™çš„å¤æ‚æ€§ï¼Œä¸€äº›ç®€å•çš„é¡µé¢ç›´æ¥æ‹–æ‹½å°±å¯ä»¥ã€‚*è¿™ä¹Ÿæ˜¯ä¸€ç§ä½ä»£ç å“¦ï¼*

**æ¥ä¸‹æ¥**ï¼Œæˆ‘ä»¬å°±åˆ†åˆ«çœ‹ä¸‹æ¯ä¸ªæ ¸å¿ƒåŠŸèƒ½ç‚¹çš„å®ç°è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ä½ å¯ä»¥æå‰æŠŠä»£ç ä¸‹è½½ä¸‹æ¥ï¼Œå¯¹ç…§ç€å­¦ä¹ ä¼šæ›´åŠ å®¹æ˜“ç†è§£ã€‚

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-01.png)

1. å®ç° ToolWindowFactory å¼€å‘ä¸€ä¸ªåº•éƒ¨çš„çª—ä½“ï¼Œç”¨äºæ‰¿è½½æ‰€éœ€çš„å†…å®¹
2. å·¦ä¾§æ˜¯ä¾§è¾¹å·¥å…·æ ï¼Œé…ç½®è‡ªé€‰è‚¡ã€åˆ·æ–°è‚¡ç¥¨æŒ‡æ•°
3. å³ä¾§æ˜¯2ä¸ª tab é¡µï¼Œåˆ†åˆ«ç”¨äºå±•ç¤ºè‚¡ç¥¨æ•°æ®å’ŒKçº¿å›¾ï¼Œè¿™é‡Œçš„æ•°æ®åˆ™éœ€è¦é€šè¿‡è‚¡ç¥¨æ¥å£æ¥æä¾›

### 2. tab é¡µçª—ä½“

é¦–å…ˆè¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨ IDEA æ’ä»¶å¼€å‘ä¸­ï¼ŒSwing UI åŠŸèƒ½ï¼Œæ‹–æ‹½å‡º2ä¸ªç®€å•çš„çª—ä½“ã€‚æœ‰äº†è¿™æ ·çš„ä¸€ä¸ªåŸºæœ¬ç»“æ„å¤§å®¶çš„è„‘å­é‡Œåº”è¯¥å°±å¯ä»¥`æœ‰ç”»é¢`äº†ã€‚

#### 2.1 è‡ªé€‰è‚¡é…ç½®çª—ä½“

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-04.png)

```java
public class GidConfig implements Configurable {

    private JPanel mainPanel;
    private JPanel settingPanel;
    private JLabel gidLabel;
    private JTextField gidTextField;

    private ConsoleUI consoleUI;

    public GidConfig(ConsoleUI consoleUI){
        this.consoleUI = consoleUI;
    }

    public JTextField getGidTextField() {
        return gidTextField;
    }

    @Override
    public void apply() throws ConfigurationException {
        List<String> gidList = DataSetting.getInstance().getGids();
        gidList.clear();
        String[] gids = gidTextField.getText().trim().split(",");
        for (String gid : gids) {
            gidList.add(gid.trim());
        }
        // åˆ·æ–°æ•°æ®
        consoleUI.addRows(gidList);
    }

}
```

- åœ¨ GidConfig å¯¹åº”çš„ java ç±»ä¸­ï¼Œå¯ä»¥å¯¹ä¸€äº›çª—ä½“ä¸­å‡ºç°çš„å±æ€§è¿›è¡Œè·å–ã€‚å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªçª—ä½“çš„ç¡®è®¤æŒ‰é’®åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ apply ä¸­æ‹¿åˆ°ç”¨æˆ·é…ç½®çš„è‚¡ç¥¨ä»£ç ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¯»å–å’Œè®¾ç½®è‚¡ç¥¨æ•°æ®ã€‚

#### 2.2 è‚¡ç¥¨å±•ç¤ºçª—ä½“

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-05.png)

```java
public class ConsoleUI {

    private JTabbedPane tabbedPane1;
    private JPanel one;
    private JPanel two;
    private JLabel picMin;
    private JTable table;
    private JLabel picDay;

    // æŸ¥è¯¢æ•°æ®æœåŠ¡
    private IStock stock = new StockImpl();

    private DefaultTableModel defaultTableModel = new DefaultTableModel(new Object[][]{}, new String[]{"è‚¡ç¥¨", "ä»£ç ", "æœ€æ–°", "æ¶¨è·Œ", "æ¶¨å¹…"});

    public ConsoleUI() {
        // åˆå§‹æ•°æ®
        table.setModel(defaultTableModel);
        addRows(DataSetting.getInstance().getGids());

        // æ·»åŠ äº‹ä»¶
        table.addMouseListener(new MouseAdapter() {
            @Override
            public void mouseClicked(MouseEvent e) {
                int row = table.getSelectedRow();
                Object value = table.getValueAt(row, 1);
                GoPicture goPicture = stock.queryGidGoPicture(value.toString());
                try {
                    // åˆ†é’ŸKçº¿
                    picMin.setSize(545, 300);
                    picMin.setIcon(new ImageIcon(new URL(goPicture.getMinurl())));

                    // å½“æ—¥Kçº¿
                    picDay.setSize(545, 300);
                    picDay.setIcon(new ImageIcon(new URL(goPicture.getDayurl())));
                } catch (MalformedURLException m) {
                    m.printStackTrace();
                }
            }
        });
    }

    public JTabbedPane getPanel() {
        return tabbedPane1;
    }

    public void addRows(List<String> gids) {
        // æŸ¥è¯¢
        List<Data> dataList = stock.queryPresetStockData(gids);

        // æ¸…ç©º
        int rowCount = defaultTableModel.getRowCount();
        for (int i = 0; i < rowCount; i++) {
            defaultTableModel.removeRow(0);
        }

        // æ·»åŠ 
        for (Data data : dataList) {
            defaultTableModel.addRow(new String[]{data.getName(), data.getGid(), data.getNowPri(), data.getIncrease(), data.getIncrePer()});
            table.setModel(defaultTableModel);
        }
    }

}
```

- å±•ç¤ºè‚¡ç¥¨çš„çª—ä½“å¯¹åº”çš„ ConsoleUI ç±»ï¼Œä¸»è¦è´Ÿè´£æ•°æ®çš„æ¸²æŸ“ã€æ›´æ–°å’Œå¯¹æ¯æ¡æ•°æ®çš„äº‹ä»¶æ“ä½œï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŸä¸€æ¡æ•°æ®ä»¥åï¼Œå°±å¯ä»¥åˆ° `Kçº¿` é¡µä¸­çœ‹åˆ°å¯¹åº”çš„è‚¡ç¥¨æŒ‡æ•°äº†ã€‚

### 3. è‚¡ç¥¨æ¡†ä½“è®¾ç½®

åœ¨å¼€å‘å®Œ UI çª—ä½“åï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ä¸€ä¸ª SimpleToolWindowPanel çš„ç»§æ‰¿å®ç°ç±»ï¼Œæ‰¿è½½å·¥å…·æ å’Œé¡µé¢çš„è®¾ç½®ã€‚

#### 3.1 è®¾ç½®-å·¥å…·æ 

**cn.bugstack.guide.idea.plugin.module.SettingBar**

```java
public class SettingBar extends DumbAwareAction {

    private ViewBars panel;

    public SettingBar(ViewBars panel) {
        super("é…ç½®è‚¡ç¥¨", "Click to setting", IconLoader.getIcon("/icons/config.svg"));
        this.panel = panel;
    }

    @Override
    public void actionPerformed(@NotNull AnActionEvent e) {
        ShowSettingsUtil.getInstance().editConfigurable(panel.getProject(), new GidConfig(panel.getConsoleUI()));
    }

}
```

- è®¾ç½®å·¥å…·æ ä½äºè‡ªå®šä¹‰æ’ä»¶é¢æ¿ä¸­æœ€å·¦ä¾§çš„ä½ç½®ï¼Œç”¨äºè®¾ç½®è‡ªé€‰è‚¡ç¥¨ä»£ç ã€‚
- é€šè¿‡åœ¨æ–¹æ³• `actionPerformed` ä¸­ä½¿ç”¨ `ShowSettingsUtil` å·¥å…·ç±»å¯åŠ¨ UI çª—ä½“ã€‚

#### 3.2 åˆ·æ–°-å·¥å…·æ 

**cn.bugstack.guide.idea.plugin.module.RefreshBar**

```java
public class RefreshBar extends DumbAwareAction {

    private ViewBars panel;

    public RefreshBar(ViewBars panel) {
        super("åˆ·æ–°æŒ‡æ•°", "Click to refresh", IconLoader.getIcon("/icons/refresh.svg"));
        this.panel = panel;
    }

    @Override
    public void actionPerformed(@NotNull AnActionEvent e) {
        panel.getConsoleUI().addRows(DataSetting.getInstance().getGids());
    }

}
```

- åœ¨åˆ·æ–°å·¥å…·æ ä¸­ä¸»è¦æ˜¯ç”¨äºæ‰‹åŠ¨è§¦å‘åˆ·æ–°è‚¡ç¥¨æœ€æ–°ç»“æœï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨æ‰‹åŠ¨åˆ·æ–°ä¸»è¦æ˜¯è¿™ä¸ªæ¥å£æœ‰æŸ¥è¯¢æ¬¡æ•°é™åˆ¶ï¼Œå¦‚æœæ˜¯å®šæ—¶ä»»åŠ¡ä¸€ç›´è·‘ï¼Œä¸€ä¼š100æ¬¡çš„æŸ¥è¯¢é™åˆ¶å°±ç”¨å®Œäº†ã€‚*ä¸è¿‡æˆ‘ä»¬è¿™é‡Œä¹Ÿæ˜¯ä¸ºäº†ä½“ç°ä¸“æ å†…å¯¹æŠ€æœ¯çš„ä½¿ç”¨ï¼Œå¢åŠ å¤šä¸ªè®¾ç½®æŒ‰é’®ï¼Œå°±æ›´å®¹æ˜“çŸ¥é“å¦‚ä½•æ·»åŠ äº†*

#### 3.3 çª—ä½“å¡«å……é¢æ¿

**cn.bugstack.guide.idea.plugin.module.ViewBars**

```java
public class ViewBars extends SimpleToolWindowPanel {

    private Project project;
    private ConsoleUI consoleUI;

    public ViewBars(Project project) {
        super(false, true);
        this.project = project;
        consoleUI = new ConsoleUI();

        // è®¾ç½®çª—ä½“ä¾§è¾¹æ æŒ‰é’®
        DefaultActionGroup group = new DefaultActionGroup();
        group.add(new SettingBar(this));
        group.add(new RefreshBar(this));

        ActionToolbar toolbar = ActionManager.getInstance().createActionToolbar("bar", group, false);
        toolbar.setTargetComponent(this);
        setToolbar(toolbar.getComponent());

        // æ·»åŠ 
        JBSplitter splitter = new JBSplitter(false);
        splitter.setSplitterProportionKey("main.splitter.key");
        splitter.setFirstComponent(consoleUI.getPanel());
        splitter.setProportion(0.3f);
        setContent(splitter);
    }

    public Project getProject() {
        return project;
    }

    public ConsoleUI getConsoleUI() {
        return consoleUI;
    }
}
```

- åœ¨å¡«å……é¢æ¿ä¸­ä¸»è¦æ˜¯åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ’ä»¶ä¸­ï¼Œåœ¨å·¦ä¾§æ·»åŠ å·¥å…·æ ï¼Œå…¶ä½™ä½ç½®æ·»åŠ è‚¡ç¥¨å±•ç¤ºé¢æ¿ã€‚
- `DefaultActionGroup` ä¸­å¯ä»¥ä»¥æ­¤æ·»åŠ è®¾ç½®å’Œåˆ·æ–°æŒ‰é’®ï¼Œå¹¶æœ€ç»ˆå¡«å……åˆ° `ActionToolbar` é‡Œå»ï¼Œè¿™æ ·å°±è®¾ç½®å®Œæˆäº†ã€‚
- `JBSplitter` æ˜¯ä¸€ä¸ªåˆ†å‰²çº¿ï¼Œå³ä¾§å¡«å……ä¸Šæˆ‘ä»¬çš„è‚¡ç¥¨æŒ‡æ•°å±•ç¤ºé¢æ¿ `splitter.setFirstComponent(consoleUI.getPanel())`

### 4. å¡«å……ä¸»é¢æ¿åˆ°IDEAå·¥å…·æ 

#### 4.1 çª—ä½“å·¥å‚

**cn.bugstack.guide.idea.plugin.factory.TabFactory**

```java
public class TabFactory implements ToolWindowFactory {

    @Override
    public void createToolWindowContent(@NotNull Project project, @NotNull ToolWindow toolWindow) {
        // çª—ä½“
        ViewBars viewPanel = new ViewBars(project);
        // è·å–å†…å®¹å·¥å‚çš„å®ä¾‹
        ContentFactory contentFactory = ContentFactory.SERVICE.getInstance();
        // è·å– ToolWindow æ˜¾ç¤ºçš„å†…å®¹
        Content content = contentFactory.createContent(viewPanel, "è‚¡ç¥¨", false);
        // è®¾ç½® ToolWindow æ˜¾ç¤ºçš„å†…å®¹
        toolWindow.getContentManager().addContent(content, 0);

        // å®šæ—¶ä»»åŠ¡ï¼Œè‡ªåŠ¨åˆ·æ–°è‚¡ç¥¨
        /* å› æ¯æ—¥æŸ¥è¯¢æ¬¡æ•°é™åˆ¶ï¼Œè¿™é‡Œå°±ä¸å¼€å®šæ—¶ä»»åŠ¡äº†ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œç”³è¯· https://dashboard.juhe.cn/home
        Timer timer = new Timer();
        timer.schedule(new TimerTask() {
            @Override
            public void run() {
                viewPanel.getConsoleUI().addRows(DataSetting.getInstance().getGids());
            }
        }, 3000, 2000);*/
    }

}
```

- åœ¨ TabFactory ä¸­ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯æŠŠ ViewBars å¡«å……åˆ°æ•´ä¸ª toolWindow ä¸­ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æˆ‘ä»¬ç›®å‰å·²ç»æ³¨é‡Šæ‰çš„åˆ·æ–°è‚¡ç¥¨æ•°æ®çš„å®šæ—¶ä»»åŠ¡ã€‚
- è¿™é‡Œç”±äºè‚¡ç¥¨æ¥å£æŸ¥è¯¢æ¬¡æ•°é™åˆ¶ï¼Œæ‰€ä»¥å°±æŠŠå®šæ—¶ä»»åŠ¡æ³¨é‡Šæ‰äº†ï¼Œå¦åˆ™ä¸€ä¼šå°±æŠŠå¯ç”¨æ¬¡æ•°è·‘æ²¡äº†ã€‚

#### 4.2 é…ç½®çª—ä½“

**plugin.xml**

```xml
<idea-plugin>
    
    <extensions defaultExtensionNs="com.intellij">
        <!-- Add your extensions here -->
        <toolWindow id="XUtil"
                    canCloseContents="true"
                    anchor="bottom"
                    factoryClass="cn.bugstack.guide.idea.plugin.factory.TabFactory"
                    icon="/icons/stock.png"
        />

    </extensions>

</idea-plugin>
```

- è¿™é‡Œæˆ‘ä»¬æŠŠçª—ä½“é…ç½®åˆ°æ•´ä¸ª IDEA ç•Œé¢çš„æœ€ä¸‹æ–¹ `anchor="bottom"` *è¿™ä¸ªä½ç½®æ—¢æ–¹ä¾¿åˆæœ€å®‰å…¨*

### 5. æ•°æ®æŒä¹…åŒ–é…ç½®

- å½“æˆ‘ä»¬ä½¿ç”¨ IDEA è¿›è¡Œé…ç½®ä¸€äº›åŸºæœ¬å‚æ•°åï¼Œä¾‹å¦‚ï¼šMavenã€Gradleã€Gitã€ç­¾åä¿¡æ¯ç­‰ï¼Œåœ¨æ—¥å¸¸çš„å…³é—­å’Œé‡å¯ IDEA æ—¶ï¼Œè¿™äº›é…ç½®ä¿¡æ¯æ˜¯ä¼šä¿å­˜ä¸‹æ¥çš„ï¼Œè€Œä¸ä¼šè¯´å…³é—­å°±æ²¡äº†ã€‚
- é‚£ä¹ˆæˆ‘ä»¬å¼€å‘çš„è¿™æ¬¾æ’ä»¶éœ€è¦åšçš„ä¸€äº›è‡ªé€‰è‚¡ç¥¨ä»£ç é…ç½®ï¼Œä¹Ÿè¦è¿›è¡Œä¿å­˜ï¼Œå¦åˆ™ä¸èƒ½æ¯æ¬¡éƒ½åœ¨ IDEA å¯åŠ¨æ—¶é‡æ–°è®¾ç½®ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° `plugin.xml` ä¸­ `applicationService` é…ç½®ä¸Šå®ç°äº† `PersistentStateComponent` çš„æ•°æ®è®¾ç½®å­˜æ”¾ç±»ã€‚

#### 5.1 å¯¹è±¡æ•°æ®

**cn.bugstack.guide.idea.plugin.infrastructure.DataState**

```java
public class DataState {

    private List<String> gids = new ArrayList<>();

    public List<String> getGids() {
        return gids;
    }

    public void setGids(List<String> gids) {
        this.gids = gids;
    }

}
```

- è¿™ä¸ªæ˜¯æ•°æ®å¯¹è±¡ç±»ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ä½ éœ€è¦çš„å±æ€§å­˜æ”¾ï¼Œå°±åƒ gids ä¸€æ ·ï¼Œç”¨äºå­˜æ”¾ç”¨æˆ·é…ç½®çš„è‚¡ç¥¨ä»£ç é›†åˆã€‚

#### 5.2 æŒä¹…æ•°æ®

**cn.bugstack.guide.idea.plugin.infrastructure.DataSetting**

```java
@State(name = "DataSetting",storages = @Storage("plugin.xml"))
public class DataSetting implements PersistentStateComponent<DataState> {

    private DataState state = new DataState();

    public static DataSetting getInstance() {
        return ServiceManager.getService(DataSetting.class);
    }

    @Nullable
    @Override
    public DataState getState() {
        return state;
    }

    @Override
    public void loadState(@NotNull DataState state) {
        this.state = state;
    }

     public List<String> getGids(){
        return state.getGids();
     }

}
```

- DataSetting ç±»éœ€è¦ä½¿ç”¨åˆ° IDEA æ’ä»¶å¼€å‘çš„æä¾›çš„æ³¨è§£ @State é…ç½®æŒä¹…å¯¹è±¡
- æ­¤å¤–è¿˜éœ€è¦æä¾›ä¸€ä¸ª getInstance æ–¹æ³•æ¥è·å–æ•°æ®å¯¹è±¡å®ä¾‹ï¼Œé‚£ä¹ˆåœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨çš„æ—¶å€™å°±å¯ä»¥æ‹¿åˆ°æˆ‘ä»¬é…ç½®çš„å¯¹è±¡äº†å¹¶è¿›è¡Œè®¾ç½®å’Œè¯»å–æ•°æ®ã€‚

#### 5.3 plugin.xml é…ç½®

```xml
<extensions defaultExtensionNs="com.intellij">
    <!-- Add your extensions here -->
    <applicationService serviceImplementation="cn.bugstack.guide.idea.plugin.infrastructure.DataSetting"/>
</extensions>
```

- åœ¨åˆ›å»ºå¥½æ•°æ®è®¾ç½®ç±»ä»¥åï¼Œåˆ™éœ€è¦ä½¿ç”¨ applicationService æ ‡ç­¾æŠŠä½ çš„ç±»é…ç½®åˆ° plugin.xml ä¸­ extensions é‡Œé¢ã€‚

### 6. è‚¡ç¥¨æ¥å£

#### 6.1 æŠ€æœ¯è°ƒç ”

- æ— è®ºä»€ä¹ˆåŠŸèƒ½å¼€å‘ï¼Œåœ¨å¼€å§‹ä¹‹å‰éƒ½éœ€è¦æŠŠè¿™äº›`é›¶ç¢çš„äº‹æƒ…`å¤„ç†å®Œï¼Œæ‰èƒ½è¿›è¡Œä»£ç å¼€å‘ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿå«åšæŠ€æœ¯è°ƒç ”åˆ°è®¾è®¡å’Œè¯„å®¡ã€‚å°±åƒç°åœ¨æˆ‘ä»¬éœ€è¦è¿›è¡Œè‚¡ç¥¨ä¿¡æ¯çš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥æä¾›æ•°æ®æŸ¥è¯¢çš„æ¥å£ï¼Œçœ‹çœ‹è¿™ä¸ªæ¥å£å¦‚ä½•ç”³è¯·ä½¿ç”¨ï¼Œä»¥åŠè¿”å›çš„å¯¹è±¡éƒ½æœ‰å“ªäº›å­—æ®µï¼Œæ˜¯å¦ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚
- è¿™é‡Œå°å‚…å“¥æ‰¾åˆ°äº†ä¸€ä¸ªèšåˆæ•°æ®çš„æ¥å£ï¼Œä¸è¿‡åªèƒ½å…è´¹`100æ¬¡/å¤©`è°ƒç”¨ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„å¯ä»¥æ›´æ¢ä¸‹ã€‚
  
  ![](https://bugstack.cn/images/article/assembly/assembly-211118-3-02.png)

- æ¥å£ï¼š[http://web.juhe.cn:8080/finance/stock/hs?gid=sz000651&key=è‡ªå·±ç”³è¯·](http://web.juhe.cn:8080/finance/stock/hs?gid=sz000651&key=è‡ªå·±ç”³è¯·) - è¿™é‡Œçš„ key éœ€è¦è‡ªå·±ç”³è¯·
- æ•°æ®ï¼š

  ![](https://bugstack.cn/images/article/assembly/assembly-211118-3-03.png)	

#### 6.2 æœåŠ¡å°è£…

æœ‰äº†è‚¡ç¥¨çš„æŸ¥è¯¢æ¥å£ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥å¯¹æ•°æ®åšä¸€ä¸ªæŸ¥è¯¢å’Œå¯¹è±¡è½¬æ¢äº†ã€‚

**cn.bugstack.guide.idea.plugin.domain.service.impl.StockImpl**

```java
public class StockImpl implements IStock {

    // è‡ªè¡Œç”³è¯·ï¼Œè‚¡ç¥¨APIï¼Œæ›¿æ¢keyå³å¯ã€ä¸€å¤©å¯å…è´¹è°ƒç”¨100æ¬¡ã€‘ï¼šhttps://dashboard.juhe.cn/home/
    private final String key = "4bc57728***********f0595";

    @Override
    public List<Data> queryPresetStockData(List<String> gids) {
        List<Data> dataList = new ArrayList<>();
        for (String gid : gids) {
            StockResult stockResult = JSON.parseObject(HttpUtil.get("http://web.juhe.cn:8080/finance/stock/hs?gid=" + gid + "&key=" + key), StockResult.class);
            Stock[] stocks = stockResult.getResult();
            for (Stock stock : stocks) {
                dataList.add(stock.getData());
            }
        }
        return dataList;
    }

}
```

- è¿™é‡Œæˆ‘ä»¬åœ¨ domain é¢†åŸŸå±‚ä¸­å®šä¹‰æ•°æ® vo å¯¹è±¡ï¼Œä»¥åŠæä¾›è‚¡ç¥¨æŸ¥è¯¢æœåŠ¡çš„å°è£…ã€‚è¿™æ ·è°ƒç”¨æ–¹å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä»½æ•°æ®äº†ï¼Œå¦‚æœä½ æ˜¯å…¶ä»–å‚å•†æä¾›çš„è‚¡ç¥¨æŸ¥è¯¢æ¥å£ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå°è£…å’Œæ›´æ¢ï¼Œåšä¸€ä¸ªæ¥å£é€‚é…å±‚ã€‚

## å››ã€æµ‹è¯•éªŒè¯

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-06.png)

- å¦‚æœä½ ä¸‹è½½å·¥ç¨‹åæ²¡æœ‰ Plugin å’Œä¸€ä¸ªç»¿è‰²ç®­å¤´ï¼Œé‚£ä¹ˆå¯ä»¥æŒ‰ç…§å›¾è‡ªå·±é…ç½® `:runIde` è¿™æ ·å°±å¯ä»¥è¿è¡Œäº†ã€‚

**è¿è¡Œæ•ˆæœ** - æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»åˆ°äº†ï¼Œå†ä¹Ÿä¸ç”¨æ‹…å¿ƒå†™ä»£ç å½±å“çœ‹è‚¡ç¥¨äº†å“¦

### 1. é…ç½®è‚¡ç¥¨

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-07.png)

- é¦–å…ˆä½ éœ€è¦åœ¨è¿™é‡Œé…ç½®ä½ å…³æ³¨çš„è‚¡ç¥¨ä»£ç ï¼Œæˆ‘é…ç½®äº†3ä¸ªæˆ‘çœ‹å¥½çš„ã€‚

### 2. è‡ªé€‰è‚¡æŒ‡æ•°

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-08.png)

- é…ç½®å¥½ä»¥åä½ å°±å¯ä»¥çœ‹åˆ°è‡ªå·±çš„è‡ªé€‰è‚¡æŒ‡æ•°äº†ï¼Œé€‰ä¸­ä¸€æ¡ä»¥åï¼Œåœ¨ç‚¹å‡»Kçº¿ã€‚
- å½“ä½ éœ€è¦çœ‹æœ€æ–°æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥ç‚¹å·¦ä¾§çš„åˆ·æ–°æŒ‰é’®ã€‚

### 3. Kçº¿

![](https://bugstack.cn/images/article/assembly/assembly-211118-3-09.png)

- ç°åœ¨è¿™ä¸ªå°±æ˜¯å¯¹åº”çš„ Kçº¿ï¼Œæ˜¯ä¸æ˜¯è¿˜æŒºé¦™çš„ã€‚ç›®å‰æ˜¯åŠ äº†æœ€è¿‘Kçº¿å’Œæ—¥Kçº¿ï¼Œä½ è¿˜å¯ä»¥æ‰©å±•å…¶ä»–ç»´åº¦çš„å›¾ã€‚

## äº”ã€æ€»ç»“

- æœ¬ç« èŠ‚æˆ‘ä»¬ä½¿ç”¨åˆ°äº†åœ¨ IDEA çª—ä½“ä¸­æ·»åŠ ç¨å¾®å¤æ‚ä¸€äº›çš„é¡µé¢ç»“æ„ï¼Œæœ‰ä¾§è¾¹æ ã€æœ‰Tabé¡µï¼Œå¹¶åœ¨éœ€è¦åœ¨è¿™äº›é¡µé¢ä½“ä¸­è¿›è¡Œäº¤äº’å’Œé€šä¿¡ã€‚æ­¤å¤–è¿˜æ˜¯ç”¨åˆ°äº†æ•°æ®çš„å­˜å‚¨è®¾ç½®ï¼Œè¿™ä¸ªåœ¨å¾ˆå¤šæ—¶å€™å¼€å‘IDEAæ’ä»¶é‡Œéƒ½ä¼šç”¨åˆ°ã€‚
- åƒæ˜¯è¿™æ ·çš„æŠ€æœ¯å®è·µä¸åªæ˜¯å¯ä»¥ç”¨äºå±•ç¤ºè‚¡ç¥¨æ•°æ®ï¼Œä½ è¿˜å¯ä»¥ç»“åˆè‡ªå·±æ‰€éœ€æ‰©å±•å±äºä½ å®é™…åœºæ™¯ä¸­éœ€è¦çš„å†…å®¹ï¼Œæ¯”å¦‚å¼€å‘ä¸€ä¸ªæ•°æ®é›†ä¸­æŸ¥è¯¢æ’ä»¶ï¼Œå¯ä»¥æŸ¥è¯¢æ•°æ®åº“ã€ESã€Redisç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰€æœ‰çš„å·¥å…·ç±»é›†åˆé¡µï¼Œè¿™äº›å†…å®¹ä¼šæ›´æœ‰æŠ€æœ¯ä»·å€¼ã€‚
- å½“ä½ è‡ªå·±å¼€å§‹ä¸»åŠ¨çš„å‘ä½ å­¦ä¹ åˆ°çš„ä¸€äº›æºç ã€æ¡†æ¶ã€ç»„ä»¶ã€é¡¹ç›®ç­‰ä¸­æ·»åŠ è‡ªå·±æƒ³è¦çš„åŠŸèƒ½æ—¶ï¼Œå°±æ˜¯ä½ çœŸçš„å¼€å§‹å­¦ä¹ äº†ï¼Œå¦åˆ™ä¸€ä¸ªå†…å®¹çœ‹è¿‡æ²¡å¤šä¹…ä¹Ÿå°±å¿˜è®°äº†ã€‚